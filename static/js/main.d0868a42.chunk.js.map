{"version":3,"sources":["util/error.ts","util/gedcom_util.ts","datasource/data_source.ts","details/translated-tag.tsx","details/wrapped-image.tsx","details/multiline-text.tsx","details/event-extras.tsx","details/events.tsx","details/details.tsx","datasource/embedded.ts","util/error_i18n.ts","menu/menu_item.tsx","util/media.ts","menu/search_index.ts","menu/search.tsx","menu/upload_menu.tsx","menu/top_bar.tsx","menu/url_menu.tsx","config.tsx","chart.tsx","app.tsx","index.tsx","util/date_util.ts","datasource/load_data.ts"],"names":["TopolaError","code","message","args","Error","pointerToId","pointer","substring","length","idToIndiMap","data","map","Map","indis","forEach","indi","set","id","idToFamMap","fams","fam","prepareGedcom","entries","head","find","entry","tag","other","strcmp","a","b","sortChildren","gedcom","comparator","indiMap","indiId1","indiId2","indi1","get","indi2","compareDates","birth","birthDatesComparator","newFams","children","newChildren","sort","Object","assign","sortFamilyChildren","sortSpouses","famMap","famId1","famId2","fam1","fam2","marriage","marriageDatesComparator","newIndis","sortIndiSpouses","dereference","getterFunction","dereferenced","getData","result","tree","subentry","last","push","normalizeGedcom","IMAGE_EXTENSIONS","isImageFile","fileName","lowerName","toLowerCase","some","ext","endsWith","filterImages","images","newImages","image","filePath","url","replaceAll","match","has","title","startsWith","filterImage","convertGedcom","parseGedcom","json","gedcomEntriesToJson","chartData","getName","person","names","filter","subEntry","name","nameEntry","replace","getFileName","fileEntry","fileTitle","fileExtension","getImageFileEntry","objectEntry","DataSourceEnum","TAG_DESCRIPTIONS","TranslatedTag","props","normalizedTag","defaultMessage","WrappedImage","useState","imageOpen","setImageOpen","imageLoaded","setImageLoaded","imageFailed","setImageFailed","imageSrc","setImageSrc","className","onClick","onLoad","onError","e","currentTarget","alt","src","filename","centered","Placeholder","Image","square","Container","fluid","textAlign","Message","negative","compact","Header","Modal","basic","size","closeIcon","Icon","color","open","onClose","onOpen","Content","label","Label","attached","content","wrapped","MultilineText","lines","line","index","properties","target","eventSources","sources","intl","List","source","Item","verticalAlign","author","publicationInfo","sourceElement","join","Description","page","date","formatDateOrRange","EventExtras","useIntl","activeIndex","setActiveIndex","setIndi","handleTabOnClick","event","menuItemProps","undefined","panes","menuItem","Menu","fitted","Popup","position","trigger","circular","render","Tab","Pane","notes","note","flatMap","tab","renderActiveOnly","menu","tabular","borderless","PersonLink","location","useLocation","search","queryString","Meta","to","pathname","EVENT_TAGS","FAMILY_EVENT_TAGS","EventHeader","as","type","sub","getSpouse","familyEntry","spouseReference","familySubEntry","includes","eventPlace","place","eventImages","imageFileEntry","sourceEntryReference","sourceEntry","abbr","sourceData","resolveDate","getDate","eventNotes","toEvent","family","familyMarriageEvent","personLink","tribe","languages","toFamilyEvents","toIndiEvent","Event","Events","events","eventEntry","event1","event2","EXCLUDED_TAGS","fileDetails","noteDetails","nameDetails","fullName","nameType","getDetails","tags","detailsFunction","element","hasData","getOtherDetails","dataDetails","getMultilineDetails","Details","entriesWithData","Group","divided","EmbeddedMessageType","EmbeddedDataSource","newSource","oldSource","resolve","reject","PARENT_READY","window","parent","postMessage","READY","GEDCOM","loadGedcom","Promise","addEventListener","onMessage","getI18nMessage","error","formatMessage","MenuType","AppMedia","createMedia","breakpoints","small","large","mediaStyles","createMediaStyle","Media","MediaContextProvider","MenuItem","newProps","menuType","Dropdown","require","lunr","normalize","input","toLocaleLowerCase","compare","score","naturalSort","ref","LunrSearchIndex","this","self","initMultiLingualLunrWithoutTrimmer","field","boost","firstName","lastName","spouseLastName","famId","husb","husbId","husband","getHusbandLastName","add","normalizedName","normalizedSpouseLastName","lunrInstance","pipelineFunctions","searchPipelineFunctions","language","unshift","stopWordFilter","stemmer","wordCharacters","pipeline","reset","apply","searchPipeline","query","split","s","slice","getNameLine","trim","SearchBar","searchResults","setSearchResults","searchString","setSearchString","searchIndex","useRef","getDescriptionLine","birthDate","deathDate","death","debouncedHandleSearch","debounce","results","current","key","description","displaySearchResult","useEffect","initialize","buildSearchIndex","Search","onSearchChange","_","value","onResultSelect","onSelection","generation","noResultsMessage","placeholder","selectFirstResult","isImageFileName","lower","UploadMenu","history","useHistory","files","filesArray","Array","from","gedcomFile","file","loadFile","URL","createObjectURL","imageFileNames","keys","hash","md5","state","htmlFor","accept","multiple","onChange","ScreenSize","UrlMenu","dialogOpen","setDialogOpen","setUrl","inputRef","handleLoad","focus","Form","onSubmit","Input","values","link","href","Actions","Button","secondary","primary","TopBar","chartMenus","screenSize","showingChart","LARGE","eventHandlers","onDownloadPdf","onDownloadPng","onDownloadSvg","onCenterView","SMALL","Divider","fileMenus","standalone","greaterThanOrEqual","inverted","at","icon","ChartColors","Ids","Sex","DEFAULT_CONFIG","COLOR_BY_GENERATION","SHOW","sex","COLOR_ARG","NO_COLOR","COLOR_BY_SEX","COLOR_ARG_INVERSE","v","k","ID_ARG","HIDE","ID_ARG_INVERSE","SEX_ARG","SEX_ARG_INVERSE","argsToConfig","getParam","ConfigPanel","Field","Checkbox","radio","tagName","checked","config","ChartType","zoomed","select","node","scale","transform","offsetX","max","clientWidth","offsetY","clientHeight","attr","scrollLeft","x","scrollTop","y","scrolled","zoomTransform","call","zoom","translateTo","loadAsDataUrl","blob","reader","FileReader","readAsDataURL","onload","inlineImage","baseVal","fetch","response","console","warn","inlineImages","svg","getElementsByTagName","all","loadImage","drawImageOnCanvas","canvas","document","createElement","width","height","ctx","getContext","oldFill","fillStyle","fillRect","drawImage","canvasToBlob","toBlob","getStrippedSvg","getElementById","cloneNode","removeAttribute","setAttribute","String","Number","getAttribute","querySelector","getSvgContentsWithInlinedImages","XMLSerializer","serializeToString","contents","Blob","saveAs","drawOnCanvas","downloadPng","downloadPdf","jspdf","default","doc","orientation","unit","format","addImage","save","chartColors","TopolaChartColors","ChartWrapper","chart","animating","rerenderRequired","zoomBehavior","rerenderProps","rerenderResetPosition","factor","scaleBy","initialRender","resetPosition","freezeAnimation","innerHTML","createChart","chartType","HourglassChart","renderer","DetailedRenderer","svgSelector","indiCallback","info","colors","animate","updateSvgSize","locale","setData","chartInfo","startIndi","selection","baseGeneration","zoomOutFactor","min","extent","scaleExtent","translateExtent","on","scrollTopTween","i","interpolateNumber","t","scrollLeftTween","dx","origin","dy","svgTransition","transition","delay","duration","tween","animationPromise","then","renderChart","Chart","chartWrapper","prevProps","usePrevious","hideIds","hideSex","AppState","staticUrl","process","REACT_APP_STATIC_URL","ErrorMessage","ErrorPopup","Portal","onDismiss","getArguments","getParamFromSearch","view","chartTypes","Hourglass","embedded","sourceSpec","GEDCOM_URL","handleCors","UPLOADED","EMBEDDED","parsedGen","isNaN","showSidePanel","messages","de","messages_de","fr","messages_fr","it","messages_it","es","messages_es","pl","messages_pl","navigator","browser","detect","ReactDOM","component","INITIAL","setState","setSelection","setError","setShowSidePanel","setStandalone","setChartType","showErrorPopup","setShowErrorPopup","setSourceSpec","setFreezeAnimation","setConfig","toggleDetails","shouldHideIds","shouldHideSex","hideId","uploadedDataSource","UploadedDataSource","gedcomUrlDataSource","GedcomUrlDataSource","embeddedDataSource","isNewData","newSourceSpec","newSelection","spec","loadData","updateUrl","gen","displayErrorPopup","downloadSvg","onDismissErrorPopup","renderMainArea","SHOWING_CHART","LOADING_MORE","updatedSelection","getSelection","sidePanelTabs","c","configToArgs","Loader","active","ERROR","LOADING","rootElement","classList","remove","exact","path","DATE_QUALIFIERS","formatDate","hasDay","day","hasMonth","month","hasYear","year","text","dateObject","Date","toDateObject","formatOptions","qualifier","lowerCaseQualifier","formatDateQualifier","Intl","DateTimeFormat","dateElement","dateOrRange","dateRange","fromDate","toDate","translatedFromDate","translatedToDate","formatDateRage","compareTopolaDates","date1","date2","firstDateOrRange","secondDateOrRange","prepareData","cacheId","serializedData","JSON","stringify","sessionStorage","setItem","loadGedzip","AdmZip","Buffer","arrayBuffer","zip","getEntries","entryName","toString","loadFromUrl","cachedData","getItem","parse","driveUrlMatch1","driveUrlMatch2","urlToFetch","status","statusText"],"mappings":"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","file":"static/js/main.d0868a42.chunk.js","sourcesContent":["/** Error class adding an error code used for i18n. */\nexport class TopolaError extends Error {\n    constructor(\n        public readonly code: string,\n        message: string,\n        public readonly args: { [key: string]: string } = {},\n    ) {\n        super(message);\n    }\n}\n","import {GedcomEntry, parse as parseGedcom} from 'parse-gedcom';\nimport {TopolaError} from './error';\nimport {\n    gedcomEntriesToJson,\n    JsonFam,\n    JsonGedcomData,\n    JsonImage,\n    JsonIndi,\n} from 'topola';\nimport {compareDates} from './date_util';\n\nexport interface GedcomData {\n    /** The HEAD entry. */\n    head: GedcomEntry;\n    /** INDI entries mapped by id. */\n    indis: { [key: string]: GedcomEntry };\n    /** FAM entries mapped by id. */\n    fams: { [key: string]: GedcomEntry };\n    /** Other entries mapped by id, e.g. NOTE, SOUR. */\n    other: { [key: string]: GedcomEntry };\n}\n\nexport interface TopolaData {\n    chartData: JsonGedcomData;\n    gedcom: GedcomData;\n}\n\n/**\n * Returns the identifier extracted from a pointer string.\n * E.g. '@I123@' -> 'I123'\n */\nexport function pointerToId(pointer: string): string {\n    return pointer.substring(1, pointer.length - 1);\n}\n\nexport function idToIndiMap(data: JsonGedcomData): Map<string, JsonIndi> {\n    const map = new Map<string, JsonIndi>();\n    data.indis.forEach((indi) => {\n        map.set(indi.id, indi);\n    });\n    return map;\n}\n\nexport function idToFamMap(data: JsonGedcomData): Map<string, JsonFam> {\n    const map = new Map<string, JsonFam>();\n    data.fams.forEach((fam) => {\n        map.set(fam.id, fam);\n    });\n    return map;\n}\n\nfunction prepareGedcom(entries: GedcomEntry[]): GedcomData {\n    const head = entries.find((entry) => entry.tag === 'HEAD')!;\n    const indis: { [key: string]: GedcomEntry } = {};\n    const fams: { [key: string]: GedcomEntry } = {};\n    const other: { [key: string]: GedcomEntry } = {};\n    entries.forEach((entry) => {\n        if (entry.tag === 'INDI') {\n            indis[pointerToId(entry.pointer)] = entry;\n        } else if (entry.tag === 'FAM') {\n            fams[pointerToId(entry.pointer)] = entry;\n        } else if (entry.pointer) {\n            other[pointerToId(entry.pointer)] = entry;\n        }\n    });\n    return {head, indis, fams, other};\n}\n\nfunction strcmp(a: string, b: string) {\n    if (a < b) {\n        return -1;\n    }\n    if (a > b) {\n        return 1;\n    }\n    return 0;\n}\n\n/** Birthdate comparator for individuals. */\nfunction birthDatesComparator(gedcom: JsonGedcomData) {\n    const indiMap = idToIndiMap(gedcom);\n    return (indiId1: string, indiId2: string) => {\n        const indi1: JsonIndi | undefined = indiMap.get(indiId1);\n        const indi2: JsonIndi | undefined = indiMap.get(indiId2);\n        return (\n            compareDates(indi1 && indi1.birth, indi2 && indi2.birth) ||\n            strcmp(indiId1, indiId2)\n        );\n    };\n}\n\n/** Marriage date comparator for families. */\nfunction marriageDatesComparator(gedcom: JsonGedcomData) {\n    const famMap = idToFamMap(gedcom);\n    return (famId1: string, famId2: string) => {\n        const fam1: JsonFam | undefined = famMap.get(famId1);\n        const fam2: JsonFam | undefined = famMap.get(famId2);\n        return (\n            compareDates(fam1 && fam1.marriage, fam2 && fam2.marriage) ||\n            strcmp(famId1, famId2)\n        );\n    };\n}\n\n/**\n * Sorts children by birthdate in the given family.\n * Does not modify the input objects.\n */\nfunction sortFamilyChildren(\n    fam: JsonFam,\n    comparator: (id1: string, id2: string) => number,\n): JsonFam {\n    if (!fam.children) {\n        return fam;\n    }\n    const newChildren = fam.children.sort(comparator);\n    return Object.assign({}, fam, {children: newChildren});\n}\n\n/**\n * Sorts children by birthdate.\n * Does not modify the input object.\n */\nfunction sortChildren(gedcom: JsonGedcomData): JsonGedcomData {\n    const comparator = birthDatesComparator(gedcom);\n    const newFams = gedcom.fams.map((fam) => sortFamilyChildren(fam, comparator));\n    return Object.assign({}, gedcom, {fams: newFams});\n}\n\n/**\n * Sorts spouses by marriage date.\n * Does not modify the input objects.\n */\nfunction sortIndiSpouses(\n    indi: JsonIndi,\n    comparator: (id1: string, id2: string) => number,\n): JsonFam {\n    if (!indi.fams) {\n        return indi;\n    }\n    const newFams = indi.fams.sort(comparator);\n    return Object.assign({}, indi, {fams: newFams});\n}\n\nfunction sortSpouses(gedcom: JsonGedcomData): JsonGedcomData {\n    const comparator = marriageDatesComparator(gedcom);\n    const newIndis = gedcom.indis.map((indi) =>\n        sortIndiSpouses(indi, comparator),\n    );\n    return Object.assign({}, gedcom, {indis: newIndis});\n}\n\n/**\n * If the entry is a reference to a top-level entry, the referenced entry is returned.\n * Otherwise, returns the given entry unmodified.\n */\nexport function dereference(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    getterFunction: (gedcom: GedcomData) => { [key: string]: GedcomEntry },\n) {\n    if (entry.data) {\n        const dereferenced = getterFunction(gedcom)[pointerToId(entry.data)];\n        if (dereferenced) {\n            return dereferenced;\n        }\n    }\n    return entry;\n}\n\n/**\n * Returns the data for the given GEDCOM entry as an array of lines.\n * Supports continuations with CONT and CONC.\n */\nexport function getData(entry: GedcomEntry) {\n    const result = [entry.data];\n    entry.tree.forEach((subentry) => {\n        if (subentry.tag === 'CONC' && subentry.data) {\n            const last = result.length - 1;\n            result[last] += subentry.data;\n        } else if (subentry.tag === 'CONT' && subentry.data) {\n            result.push(subentry.data);\n        }\n    });\n    return result;\n}\n\n/** Sorts children and spouses. */\nexport function normalizeGedcom(gedcom: JsonGedcomData): JsonGedcomData {\n    return sortSpouses(sortChildren(gedcom));\n}\n\nconst IMAGE_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.gif'];\n\n/** Returns true if the given file name has a known image extension. */\nexport function isImageFile(fileName: string): boolean {\n    const lowerName = fileName.toLowerCase();\n    return IMAGE_EXTENSIONS.some((ext) => lowerName.endsWith(ext));\n}\n\n/**\n * Removes images that are not HTTP links or do not have known image extensions.\n * Does not modify the input object.\n */\nfunction filterImage(indi: JsonIndi, images: Map<string, string>): JsonIndi {\n    if (!indi.images || indi.images.length === 0) {\n        return indi;\n    }\n    const newImages: JsonImage[] = [];\n    indi.images.forEach((image) => {\n        const filePath = image.url.replaceAll('\\\\', '/');\n        const fileName = filePath.match(/[^/]*$/)![0];\n        // If the image file has been loaded into memory, use it.\n        if (images.has(filePath)) {\n            newImages.push({url: images.get(filePath)!, title: image.title});\n        } else if (images.has(fileName)) {\n            newImages.push({url: images.get(fileName)!, title: image.title});\n        } else if (image.url.startsWith('http') && isImageFile(image.url)) {\n            newImages.push(image);\n        }\n    });\n    return Object.assign({}, indi, {images: newImages});\n}\n\n/**\n * Removes images that are not HTTP links.\n * Does not modify the input object.\n */\nfunction filterImages(\n    gedcom: JsonGedcomData,\n    images: Map<string, string>,\n): JsonGedcomData {\n    const newIndis = gedcom.indis.map((indi) => filterImage(indi, images));\n    return Object.assign({}, gedcom, {indis: newIndis});\n}\n\n/**\n * Converts GEDCOM file into JSON data performing additional transformations:\n * - sort children by birthdate\n * - remove images that are not HTTP links and aren't mapped in `images`.\n *\n * @param gedcom\n * @param images Map from file name to image URL. This is used to pass in\n *   uploaded images.\n */\nexport function convertGedcom(\n    gedcom: string,\n    images: Map<string, string>,\n): TopolaData {\n    const entries = parseGedcom(gedcom);\n    const json = gedcomEntriesToJson(entries);\n    if (\n        !json ||\n        !json.indis ||\n        !json.indis.length ||\n        !json.fams ||\n        !json.fams.length\n    ) {\n        throw new TopolaError('GEDCOM_READ_FAILED', 'Failed to read GEDCOM file');\n    }\n    return {\n        chartData: filterImages(normalizeGedcom(json), images),\n        gedcom: prepareGedcom(entries),\n    };\n}\n\nexport function getName(person: GedcomEntry): string | undefined {\n    const names = person.tree.filter((subEntry) => subEntry.tag === 'NAME');\n    const notMarriedName = names.find(\n        (subEntry) =>\n            subEntry.tree.filter(\n                (nameEntry) => nameEntry.tag === 'TYPE' && nameEntry.data === 'married',\n            ).length === 0,\n    );\n    const name = notMarriedName || names[0];\n    return name?.data.replace(/\\//g, '');\n}\n\nexport function getFileName(fileEntry: GedcomEntry): string | undefined {\n    const fileTitle = fileEntry?.tree.find((entry) => entry.tag === 'TITL')?.data;\n    const fileExtension = fileEntry?.tree.find((entry) => entry.tag === 'FORM')?.data;\n    return fileTitle && fileExtension && fileTitle + '.' + fileExtension;\n}\n\nexport function getImageFileEntry(objectEntry: GedcomEntry): GedcomEntry | undefined {\n    return objectEntry.tree.find(\n        (entry) =>\n            entry.tag === 'FILE' &&\n            entry.data.startsWith('http') &&\n            isImageFile(entry.data),\n    );\n}\n","import {IndiInfo} from 'topola';\nimport {TopolaData} from '../util/gedcom_util';\n\n/** Supported data sources. */\nexport enum DataSourceEnum {\n    UPLOADED,\n    GEDCOM_URL,\n    EMBEDDED,\n}\n\n/** Source specification together with individual selection. */\nexport interface SourceSelection<SourceSpecT> {\n    spec: SourceSpecT;\n    selection?: IndiInfo;\n}\n\n/** Interface encapsulating functions specific for a data source. */\nexport interface DataSource<SourceSpecT> {\n    /**\n     * Returns true if the application is now loading a completely new data set\n     * and the existing one should be wiped.\n     */\n    isNewData(\n        newSource: SourceSelection<SourceSpecT>,\n        oldSource: SourceSelection<SourceSpecT>,\n        data?: TopolaData,\n    ): boolean;\n\n    /** Loads data from the data source. */\n    loadData(spec: SourceSelection<SourceSpecT>): Promise<TopolaData>;\n}\n","import {FormattedMessage} from 'react-intl';\n\nconst TAG_DESCRIPTIONS = new Map([\n    ['ADOP', 'Adoption'],\n    ['BAPM', 'Baptism'],\n    ['BIRT', 'Birth'],\n    ['BURI', 'Burial'],\n    ['CENS', 'Census'],\n    ['CHR', 'Christening'],\n    ['CREM', 'Cremation'],\n    ['DEAT', 'Death'],\n    ['EDUC', 'Education'],\n    ['EMAIL', 'E-mail'],\n    ['EMIG', 'Emigration'],\n    ['EVEN', 'Event'],\n    ['FACT', 'Fact'],\n    ['IMMI', 'Immigration'],\n    ['MARR', 'Marriage'],\n    ['MARS', 'Marriage settlement'],\n    ['ETHN', 'Ethnic'],\n    ['TRIB', 'Clan'],\n    ['LANG', 'Language'],\n    ['DIV', 'Divorce'],\n    ['MILT', 'Military services'],\n    ['NATU', 'Naturalization'],\n    ['OCCU', 'Occupation'],\n    ['TITL', 'Title'],\n    ['WWW', 'WWW'],\n    ['birth', 'Birth name'],\n    ['married', 'Married name'],\n    ['maiden', 'Maiden name'],\n    ['immigrant', 'Immigrant name'],\n    ['aka', 'Also known as'],\n]);\n\ninterface Props {\n    tag: string;\n}\n\nexport function TranslatedTag(props: Props) {\n    const normalizedTag = props.tag.replace(/_/g, '');\n    return (\n        <FormattedMessage\n            id={`gedcom.${normalizedTag}`}\n            defaultMessage={TAG_DESCRIPTIONS.get(normalizedTag) || normalizedTag}\n        />\n    );\n}\n","import {\n    Container,\n    Icon,\n    Image,\n    Label,\n    Message,\n    Modal,\n    Placeholder,\n} from 'semantic-ui-react';\nimport {SyntheticEvent, useState} from 'react';\nimport {FormattedMessage} from 'react-intl';\n\ninterface Props {\n    url: string;\n    filename: string;\n    title?: string;\n}\n\nexport function WrappedImage(props: Props) {\n    const [imageOpen, setImageOpen] = useState(false);\n    const [imageLoaded, setImageLoaded] = useState(false);\n    const [imageFailed, setImageFailed] = useState(false);\n    const [imageSrc, setImageSrc] = useState('');\n\n    if (imageLoaded && imageSrc !== props.url) {\n        setImageLoaded(false);\n    }\n    return (\n        <>\n            <Image\n                className={imageLoaded ? 'loaded-image-thumbnail' : 'hidden-image'}\n                onClick={() => setImageOpen(true)}\n                onLoad={() => {\n                    setImageLoaded(true);\n                    setImageSrc(props.url);\n                    setImageFailed(false);\n                }}\n                onError={(e: SyntheticEvent<HTMLImageElement, Event>) => {\n                    setImageLoaded(true);\n                    setImageSrc(props.url);\n                    setImageFailed(true);\n                    e.currentTarget.alt = '';\n                }}\n                src={props.url}\n                alt={props.title || props.filename}\n                centered={true}\n            />\n            <Placeholder className={!imageLoaded ? 'image-placeholder' : 'hidden-image'}>\n                <Placeholder.Image square/>\n            </Placeholder>\n            {imageFailed && (\n                <Container fluid textAlign=\"center\">\n                    <Message negative compact>\n                        <Message.Header>\n                            <FormattedMessage\n                                id=\"error.failed_to_load_image\"\n                                defaultMessage={'Failed to load image file'}\n                            />\n                        </Message.Header>\n                    </Message>\n                </Container>\n            )}\n            <Modal\n                basic\n                size=\"large\"\n                closeIcon={<Icon name=\"close\" color=\"red\"/>}\n                open={imageOpen}\n                onClose={() => setImageOpen(false)}\n                onOpen={() => setImageOpen(true)}\n                centered={false}\n            >\n                <Modal.Header>{props.title}</Modal.Header>\n                <Modal.Content image>\n                    <Image\n                        className=\"modal-image\"\n                        src={props.url}\n                        alt={props.title || props.filename}\n                        label={<Label attached=\"bottom\" content={props.filename}/>}\n                        wrapped\n                    />\n                </Modal.Content>\n            </Modal>\n        </>\n    );\n}\n","import Linkify from 'react-linkify';\n\ninterface Props {\n    lines: (JSX.Element | string)[];\n}\n\nexport function MultilineText(props: Props) {\n    return (\n        <>\n            {props.lines.map((line, index) => (\n                <div key={index}>\n                    <Linkify properties={{target: '_blank'}}>{line}</Linkify>\n                    <br/>\n                </div>\n            ))}\n        </>\n    );\n}\n","import {FormattedMessage, IntlShape, useIntl} from 'react-intl';\nimport {\n    Icon,\n    Item,\n    List,\n    Menu,\n    MenuItemProps,\n    Popup,\n    Tab,\n} from 'semantic-ui-react';\nimport {useState} from 'react';\nimport {WrappedImage} from './wrapped-image';\nimport * as React from 'react';\nimport {MultilineText} from './multiline-text';\nimport {DateOrRange} from 'topola';\nimport {formatDateOrRange} from '../util/date_util';\nimport Linkify from 'react-linkify';\n\nexport interface Image {\n    url: string;\n    filename: string;\n    title?: string;\n}\n\nexport interface Source {\n    title?: string;\n    author?: string;\n    page?: string;\n    date?: DateOrRange;\n    publicationInfo?: string;\n}\n\ninterface Props {\n    images?: Image[];\n    notes?: string[][];\n    sources?: Source[];\n    indi: string;\n}\n\nfunction eventImages(images: Image[] | undefined) {\n    return (\n        !!images &&\n        images.map((image, index) => (\n            <List key={index}>\n                <List.Item>\n                    <WrappedImage\n                        url={image.url}\n                        filename={image.filename}\n                        title={image.title}\n                    />\n                </List.Item>\n            </List>\n        ))\n    );\n}\n\nfunction eventNotes(notes: string[][] | undefined) {\n    return (\n        !!notes?.length &&\n        notes.map((note, index) => (\n            <div key={index}>\n                <MultilineText\n                    lines={note.map((line, index) => (\n                        <i key={index}>{line}</i>\n                    ))}\n                />\n            </div>\n        ))\n    );\n}\n\nfunction eventSources(sources: Source[] | undefined, intl: IntlShape) {\n    return (\n        !!sources?.length && (\n            <List>\n                {sources.map((source, index) => (\n                    <List.Item key={index}>\n                        <List.Icon verticalAlign=\"middle\" name=\"circle\" size=\"tiny\"/>\n                        <List.Content>\n                            <List.Header>\n                                <Linkify properties={{target: '_blank'}}>\n                                    {[source.author, source.title, source.publicationInfo]\n                                        .filter((sourceElement) => sourceElement)\n                                        .join(', ')}\n                                </Linkify>\n                            </List.Header>\n                            <List.Description>\n                                <Linkify properties={{target: '_blank'}}>{source.page}</Linkify>\n                                {source.date\n                                    ? ' [' + formatDateOrRange(source.date, intl) + ']'\n                                    : null}\n                            </List.Description>\n                        </List.Content>\n                    </List.Item>\n                ))}\n            </List>\n        )\n    );\n}\n\nexport function EventExtras(props: Props) {\n    const intl = useIntl();\n    const [activeIndex, setActiveIndex] = useState(-1);\n    const [indi, setIndi] = useState('');\n\n    if (!indi || indi !== props.indi) {\n        setActiveIndex(-1);\n        setIndi(props.indi);\n    }\n\n    function handleTabOnClick(\n        event: React.MouseEvent<HTMLAnchorElement>,\n        menuItemProps: MenuItemProps,\n    ) {\n        menuItemProps.index !== undefined && activeIndex !== menuItemProps.index\n            ? setActiveIndex(menuItemProps.index)\n            : setActiveIndex(-1);\n    }\n\n    const imageTab = props.images?.length && {\n        menuItem: (\n            <Menu.Item fitted key=\"images\" onClick={handleTabOnClick}>\n                <Popup\n                    content={\n                        <FormattedMessage id=\"extras.images\" defaultMessage=\"Images\"/>\n                    }\n                    size=\"mini\"\n                    position=\"bottom center\"\n                    trigger={<Icon circular name=\"camera\"/>}\n                />\n            </Menu.Item>\n        ),\n        render: () => <Tab.Pane>{eventImages(props.images)}</Tab.Pane>,\n    };\n\n    const noteTab = props.notes?.length && {\n        menuItem: (\n            <Menu.Item fitted key=\"notes\" onClick={handleTabOnClick}>\n                <Popup\n                    content={\n                        <FormattedMessage id=\"extras.notes\" defaultMessage=\"Notes\"/>\n                    }\n                    size=\"mini\"\n                    position=\"bottom center\"\n                    trigger={<Icon circular name=\"sticky note outline\"/>}\n                />\n            </Menu.Item>\n        ),\n        render: () => <Tab.Pane>{eventNotes(props.notes)}</Tab.Pane>,\n    };\n\n    const sourceTab = props.sources?.length && {\n        menuItem: (\n            <Menu.Item fitted key=\"sources\" onClick={handleTabOnClick}>\n                <Popup\n                    content={\n                        <FormattedMessage id=\"extras.sources\" defaultMessage=\"Sources\"/>\n                    }\n                    size=\"mini\"\n                    position=\"bottom center\"\n                    trigger={<Icon circular name=\"quote right\"/>}\n                />\n            </Menu.Item>\n        ),\n        render: () => <Tab.Pane>{eventSources(props.sources, intl)}</Tab.Pane>,\n    };\n\n    const panes = [imageTab, noteTab, sourceTab].flatMap((tab) =>\n        tab ? [tab] : [],\n    );\n\n    if (panes.length) {\n        return (\n            <Item.Description>\n                <Tab\n                    className=\"event-extras\"\n                    activeIndex={activeIndex}\n                    renderActiveOnly={true}\n                    menu={{\n                        tabular: true,\n                        attached: true,\n                        compact: true,\n                        borderless: true,\n                    }}\n                    panes={panes}\n                />\n            </Item.Description>\n        );\n    }\n    return null;\n}\n","import * as queryString from 'query-string';\nimport flatMap from 'array.prototype.flatmap';\nimport {compareDates, formatDateOrRange} from '../util/date_util';\nimport {DateOrRange, getDate} from 'topola';\nimport {\n    dereference,\n    GedcomData,\n    getData,\n    getImageFileEntry,\n    getFileName,\n    getName,\n} from '../util/gedcom_util';\nimport {GedcomEntry} from 'parse-gedcom';\nimport {FormattedMessage, useIntl} from 'react-intl';\nimport {Link, useLocation} from 'react-router-dom';\nimport {pointerToId} from '../util/gedcom_util';\nimport {TranslatedTag} from './translated-tag';\nimport {Header, Item} from 'semantic-ui-react';\nimport {EventExtras, Image, Source} from './event-extras';\n\nfunction PersonLink(props: { person: GedcomEntry }) {\n    const location = useLocation();\n    const name = getName(props.person);\n    const search = queryString.parse(location.search);\n    search['indi'] = pointerToId(props.person.pointer);\n    return (\n        <Item.Meta>\n            <Link to={{pathname: '/view', search: queryString.stringify(search)}}>\n                {name ? (name) : (<FormattedMessage id=\"name.unknown_name\" defaultMessage=\"N.N.\"/>)}\n            </Link>\n        </Item.Meta>\n    );\n}\n\ninterface Props {\n    gedcom: GedcomData;\n    indi: string;\n    entries: GedcomEntry[];\n}\n\ninterface EventData {\n    type: string;\n    date?: DateOrRange;\n    personLink?: GedcomEntry;\n    place?: string[];\n    images?: Image[];\n    notes?: string[][];\n    sources?: Source[];\n    tribe: string | undefined;\n    languages: string[];\n    indi: string;\n}\n\nconst EVENT_TAGS = [\n    'BIRT',\n    'BAPM',\n    'CHR',\n    'FAMS',\n    'EVEN',\n    'CENS',\n    'DEAT',\n    'BURI',\n    '_TRIB',\n];\n\nconst FAMILY_EVENT_TAGS = ['MARR', 'MARS', 'DIV'];\n\nfunction EventHeader(props: { event: EventData }) {\n    const intl = useIntl();\n    return (\n        <div className=\"event-header\">\n            <Header as=\"span\" size=\"small\">\n                <TranslatedTag tag={props.event.type}/>\n            </Header>\n            {props.event.date ? (\n                <Header as=\"span\" textAlign=\"right\" sub>\n                    {formatDateOrRange(props.event.date, intl)}\n                </Header>\n            ) : null}\n        </div>\n    );\n}\n\nfunction getSpouse(indi: string, familyEntry: GedcomEntry, gedcom: GedcomData) {\n    const spouseReference = familyEntry.tree\n        .filter((familySubEntry) => ['WIFE', 'HUSB'].includes(familySubEntry.tag))\n        .find((familySubEntry) => !familySubEntry.data.includes(indi));\n    if (!spouseReference) {\n        return undefined;\n    }\n    return dereference(spouseReference, gedcom, (gedcom) => gedcom.indis);\n}\n\nfunction eventPlace(entry: GedcomEntry) {\n    const place = entry.tree.find((subEntry) => subEntry.tag === 'PLAC');\n    return place?.data ? getData(place) : undefined;\n}\n\nfunction eventImages(entry: GedcomEntry, gedcom: GedcomData): Image[] {\n    return entry.tree\n        .filter((subEntry) => 'OBJE' === subEntry.tag)\n        .map((objectEntry) =>\n            dereference(objectEntry, gedcom, (gedcom) => gedcom.other),\n        )\n        .map((objectEntry) => getImageFileEntry(objectEntry))\n        .flatMap((imageFileEntry) =>\n            imageFileEntry ? [\n                    {\n                        url: imageFileEntry?.data || '',\n                        filename: getFileName(imageFileEntry) || '',\n                    },\n                ] : [],\n        );\n}\n\nfunction eventSources(entry: GedcomEntry, gedcom: GedcomData): Source[] {\n    return entry.tree\n        .filter((subEntry) => 'SOUR' === subEntry.tag)\n        .map((sourceEntryReference) => {\n            const sourceEntry = dereference(sourceEntryReference, gedcom, (gedcom) => gedcom.other);\n            const title = sourceEntry.tree.find((subEntry) => 'TITL' === subEntry.tag);\n            const abbr = sourceEntry.tree.find((subEntry) => 'ABBR' === subEntry.tag);\n            const author = sourceEntry.tree.find((subEntry) => 'AUTH' === subEntry.tag);\n            const publicationInfo = sourceEntry.tree.find((subEntry) => 'PUBL' === subEntry.tag);\n            const page = sourceEntryReference.tree.find((subEntry) => 'PAGE' === subEntry.tag);\n            const sourceData = sourceEntryReference.tree.find((subEntry) => 'DATA' === subEntry.tag);\n            const date = sourceData ? resolveDate(sourceData) : undefined;\n            return {\n                title: title?.data || abbr?.data,\n                author: author?.data,\n                page: page?.data,\n                date: date ? getDate(date.data) : undefined,\n                publicationInfo: publicationInfo?.data,\n            };\n        });\n}\n\nfunction eventNotes(entry: GedcomEntry, gedcom: GedcomData): string[][] {\n    return entry.tree\n        .filter((subentry) => ['NOTE', 'TYPE'].includes(subentry.tag))\n        .map((note) => dereference(note, gedcom, (gedcom) => gedcom.other))\n        .map((note) => getData(note));\n}\n\nfunction toEvent(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    indi: string,\n): EventData[] {\n    return entry.tag === 'FAMS' ? toFamilyEvents(entry, gedcom, indi) : toIndiEvent(entry, gedcom, indi);\n}\n\nfunction toIndiEvent(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    indi: string,\n): EventData[] {\n    const date = resolveDate(entry) || null;\n    return [\n        {\n            date: date ? getDate(date.data) : undefined,\n            type: entry.tag,\n            place: eventPlace(entry),\n            images: eventImages(entry, gedcom),\n            notes: eventNotes(entry, gedcom),\n            sources: eventSources(entry, gedcom),\n            tribe: entry.data,\n            languages: [],\n            indi: indi,\n        },\n    ];\n}\n\nfunction resolveDate(entry: GedcomEntry) {\n    return entry.tree.find((subEntry) => subEntry.tag === 'DATE');\n}\n\nfunction toFamilyEvents(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    indi: string,\n): EventData[] {\n    const family = dereference(entry, gedcom, (gedcom) => gedcom.fams);\n    return flatMap(FAMILY_EVENT_TAGS, (tag) =>\n        family.tree.filter((entry) => entry.tag === tag),\n    ).map((familyMarriageEvent) => {\n        const date = resolveDate(familyMarriageEvent) || null;\n        return {\n            date: date ? getDate(date.data) : undefined,\n            type: familyMarriageEvent.tag,\n            personLink: getSpouse(indi, family, gedcom),\n            place: eventPlace(familyMarriageEvent),\n            images: eventImages(familyMarriageEvent, gedcom),\n            notes: eventNotes(familyMarriageEvent, gedcom),\n            sources: eventSources(familyMarriageEvent, gedcom),\n            tribe: undefined,\n            languages: [],\n            indi: indi,\n        };\n    });\n}\n\nfunction Event(props: { event: EventData }) {\n    return (\n        <Item>\n            <Item.Content>\n                <EventHeader event={props.event}/>\n                {!!props.event.personLink && (<PersonLink person={props.event.personLink}/>)}\n                {!!props.event.place && (<Item.Description>{props.event.place}</Item.Description>)}\n                {!!props.event.tribe && (<Item.Description>{props.event.tribe}</Item.Description>)}\n                <EventExtras\n                    images={props.event.images}\n                    notes={props.event.notes}\n                    sources={props.event.sources}\n                    indi={props.event.indi}\n                />\n            </Item.Content>\n        </Item>\n    );\n}\n\nexport function Events(props: Props) {\n    const events = flatMap(EVENT_TAGS, (tag) =>\n        props.entries\n            .filter((entry) => entry.tag === tag)\n            .map((eventEntry) => toEvent(eventEntry, props.gedcom, props.indi))\n            .flatMap((events) => events)\n            .sort((event1, event2) => compareDates(event1.date, event2.date)),\n    );\n    if (events.length) {\n        return (\n            <>\n                {events.map((event, index) => (\n                    <Event event={event} key={index}/>\n                ))}\n            </>\n        );\n    }\n    return null;\n}\n","import flatMap from 'array.prototype.flatmap';\nimport {\n    dereference,\n    GedcomData,\n    getData,\n    getFileName,\n    getImageFileEntry\n} from '../util/gedcom_util';\nimport {Events} from './events';\nimport {GedcomEntry} from 'parse-gedcom';\nimport {MultilineText} from './multiline-text';\nimport {TranslatedTag} from './translated-tag';\nimport {Header, Item} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {WrappedImage} from './wrapped-image';\n\nconst EXCLUDED_TAGS = [\n    'BIRT',\n    'BAPM',\n    'CHR',\n    'EVEN',\n    'CENS',\n    'DEAT',\n    'BURI',\n    'NAME',\n    'SEX',\n    'FAMC',\n    'FAMS',\n    'NOTE',\n    'SOUR',\n    'LANG'\n];\n\nfunction dataDetails(entry: GedcomEntry) {\n    const lines = [];\n    if (entry.data) {\n        lines.push(...getData(entry));\n    }\n    entry.tree\n        .filter((subentry) => subentry.tag === 'NOTE')\n        .forEach((note) =>\n            getData(note).forEach((line) => lines.push(<i>{line}</i>)),\n        );\n    if (!lines.length) {\n        return null;\n    }\n    return (\n        <>\n            <Header sub>\n                <TranslatedTag tag={entry.tag}/>\n            </Header>\n            <span>\n                <MultilineText lines={lines}/>\n            </span>\n        </>\n    );\n}\n\nfunction fileDetails(objectEntry: GedcomEntry) {\n    const imageFileEntry = getImageFileEntry(objectEntry);\n    return imageFileEntry ? (\n        <div className=\"person-image\">\n            <WrappedImage\n                url={imageFileEntry.data}\n                filename={getFileName(imageFileEntry) || ''}\n            />\n        </div>\n    ) : null;\n}\n\nfunction noteDetails(entry: GedcomEntry) {\n    return (\n        <MultilineText\n            lines={getData(entry).map((line, index) => (\n                <i key={index}>{line}</i>\n            ))}\n        />\n    );\n}\n\nfunction nameDetails(entry: GedcomEntry) {\n    const fullName = entry.data.replaceAll('/', '');\n    const nameType = entry.tree.find(\n        (entry) => entry.tag === 'TYPE' && entry.data !== 'Unknown',\n    )?.data;\n    return (\n        <>\n            <Header as=\"span\" size=\"large\">\n                {fullName ? (\n                    fullName\n                ) : (\n                    <FormattedMessage id=\"name.unknown_name\" defaultMessage=\"N.N.\"/>\n                )}\n            </Header>\n            {fullName && nameType && (\n                <Item.Meta>\n                    <TranslatedTag tag={nameType}/>\n                </Item.Meta>\n            )}\n        </>\n    );\n}\n\nfunction getDetails(\n    entries: GedcomEntry[],\n    tags: string[],\n    detailsFunction: (entry: GedcomEntry) => JSX.Element | null,\n): JSX.Element[] {\n    return flatMap(tags, (tag) =>\n        entries\n            .filter((entry) => entry.tag === tag)\n            .map((entry) => detailsFunction(entry)),\n    )\n        .filter((element) => element !== null)\n        .map((element, index) => (\n            <Item key={index}>\n                <Item.Content>{element}</Item.Content>\n            </Item>\n        ));\n}\n\n/**\n * Returns true if there is displayable information in this entry.\n * Returns false if there is no data in this entry or this is only a reference\n * to another entry.\n */\nfunction hasData(entry: GedcomEntry) {\n    return entry.tree.length > 0 || (entry.data && !entry.data.startsWith('@'));\n}\n\nfunction getOtherDetails(entries: GedcomEntry[]) {\n    return entries\n        .filter((entry) => !EXCLUDED_TAGS.includes(entry.tag))\n        .filter(hasData)\n        .map((entry) => dataDetails(entry))\n        .filter((element) => element !== null)\n        .map((element, index) => (\n            <Item key={index}>\n                <Item.Content>{element}</Item.Content>\n            </Item>\n        ));\n}\n\nfunction getMultilineDetails(\n    entries: GedcomEntry[],\n    tags: string[],\n    title: [string, string],\n) {\n    const lines= entries\n        .filter((entry) => tags.includes(entry.tag))\n        .filter(hasData)\n        .map((element) => element.data)\n    if (!lines.length) {\n        return null;\n    }\n    return (\n        <Item key=\"languages\">\n            <Item.Content>\n                <Header as=\"span\">\n                    <FormattedMessage id={title[0]} defaultMessage={title[1]}/>\n                </Header>\n                <span>\n                    <MultilineText lines={lines}/>\n                </span>\n            </Item.Content>\n        </Item>\n    );\n}\n\ninterface Props {\n    gedcom: GedcomData;\n    indi: string;\n}\n\nexport function Details(props: Props) {\n    const entries = props.gedcom.indis[props.indi].tree;\n    const entriesWithData = entries\n        .map((entry) => dereference(entry, props.gedcom, (gedcom) => gedcom.other))\n        .filter(hasData);\n\n    return (\n        <div className=\"details\">\n            <Item.Group divided>\n                {getDetails(entries, ['NAME'], nameDetails)}\n                {getDetails(entriesWithData, ['OBJE'], fileDetails)}\n                <Events gedcom={props.gedcom} entries={entries} indi={props.indi}/>\n                {getMultilineDetails(entriesWithData, ['LANG'], ['gedcom.languages', 'Languages'])}\n                {getOtherDetails(entriesWithData)}\n                {getDetails(entriesWithData, ['NOTE'], noteDetails)}\n            </Item.Group>\n        </div>\n    );\n}\n","import {DataSource, DataSourceEnum, SourceSelection} from './data_source';\nimport {TopolaData} from '../util/gedcom_util';\nimport {loadGedcom} from './load_data';\n\n/**\n * Message types used in embedded mode.\n * When the parent is ready to receive messages, it sends PARENT_READY.\n * When the child (this app) is ready to receive messages, it sends READY.\n * When the child receives PARENT_READY, it sends READY.\n * When the parent receives READY, it sends data in a GEDCOM message.\n */\nenum EmbeddedMessageType {\n    GEDCOM = 'gedcom',\n    READY = 'ready',\n    PARENT_READY = 'parent_ready',\n}\n\n/** Message sent to parent or received from parent in embedded mode. */\ninterface EmbeddedMessage {\n    message: EmbeddedMessageType;\n}\n\ninterface GedcomMessage extends EmbeddedMessage {\n    message: EmbeddedMessageType.GEDCOM;\n    gedcom?: string;\n}\n\nexport interface EmbeddedSourceSpec {\n    source: DataSourceEnum.EMBEDDED;\n}\n\n/** GEDCOM file received from outside of the iframe. */\nexport class EmbeddedDataSource implements DataSource<EmbeddedSourceSpec> {\n    isNewData(\n        newSource: SourceSelection<EmbeddedSourceSpec>,\n        oldSource: SourceSelection<EmbeddedSourceSpec>,\n        data?: TopolaData,\n    ): boolean {\n        // Never reload data.\n        return false;\n    }\n\n    private async onMessage(\n        message: EmbeddedMessage,\n        resolve: (value: TopolaData) => void,\n        reject: (reason: any) => void,\n    ) {\n        if (message.message === EmbeddedMessageType.PARENT_READY) {\n            // Parent didn't receive the first 'ready' message, so we need to send it again.\n            window.parent.postMessage({message: EmbeddedMessageType.READY}, '*');\n        } else if (message.message === EmbeddedMessageType.GEDCOM) {\n            const gedcom = (message as GedcomMessage).gedcom;\n            if (!gedcom) {\n                return;\n            }\n            try {\n                const data = await loadGedcom('', gedcom);\n                resolve(data);\n            } catch (error) {\n                reject(error);\n            }\n        }\n    }\n\n    async loadData(source: SourceSelection<EmbeddedSourceSpec>): Promise<TopolaData> {\n        // Notify the parent window that we are ready.\n        return new Promise<TopolaData>((resolve, reject) => {\n            window.parent.postMessage({message: EmbeddedMessageType.READY}, '*');\n            window.addEventListener('message', (data) =>\n                this.onMessage(data.data, resolve, reject),\n            );\n        });\n    }\n}\n","import {IntlShape} from 'react-intl';\nimport {TopolaError} from './error';\n\n/**\n * Returns a translated message for the given error. If the message can't be\n * translated, the original error.message is returned.\n */\nexport function getI18nMessage(error: Error, intl: IntlShape): string {\n    if (!(error instanceof TopolaError)) {\n        return error.message;\n    }\n    return intl.formatMessage(\n        {\n            id: `error.${error.code}`,\n            defaultMessage: error.message,\n        },\n        error.args,\n    );\n}\n","import {\n    Menu,\n    Dropdown,\n    MenuItemProps,\n    DropdownItemProps,\n} from 'semantic-ui-react';\n\nexport enum MenuType {\n    Menu,\n    Dropdown,\n}\n\ninterface Props {\n    menuType?: MenuType;\n}\n\nexport function MenuItem(props: Props & MenuItemProps & DropdownItemProps) {\n    const newProps = {...props};\n    // Remove menuType from props to avoid error message in the console.\n    delete newProps.menuType;\n    return (\n        <>\n            {props.menuType === MenuType.Menu ? (\n                <Menu.Item {...newProps}>{props.children}</Menu.Item>\n            ) : (\n                <Dropdown.Item {...newProps}>{props.children}</Dropdown.Item>\n            )}\n        </>\n    );\n}\n","import {createMedia} from '@artsy/fresnel';\n\n/** Defines the breakpoints at which to show different UI variants.*/\nconst AppMedia = createMedia({\n    breakpoints: {\n        small: 320,\n        large: 768,\n    },\n});\nexport const mediaStyles = AppMedia.createMediaStyle();\nexport const {Media, MediaContextProvider} = AppMedia;\n","import lunr, {PipelineFunction} from 'lunr';\nimport naturalSort from 'javascript-natural-sort';\nimport {idToFamMap, idToIndiMap} from '../util/gedcom_util';\nimport {JsonFam, JsonGedcomData, JsonIndi} from 'topola';\n\nrequire('lunr-languages/lunr.stemmer.support')(lunr);\nrequire('lunr-languages/lunr.de')(lunr);\nrequire('lunr-languages/lunr.fr')(lunr);\nrequire('lunr-languages/lunr.it')(lunr);\nrequire('lunr-languages/lunr.ru')(lunr);\n\nconst MAX_RESULTS = 8;\n\nexport interface SearchResult {\n    id: string;\n    indi: JsonIndi;\n}\n\nexport interface SearchIndex {\n    search(input: string): SearchResult[];\n}\n\n/** Removes accents from letters, e.g. ó->o, ę->e. */\nfunction normalize(input: string) {\n    return input\n        .toLocaleLowerCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .replace(/\\u0142/g, 'l'); // Special case: ł is not affected by NFD.\n}\n\n/** Comparator to sort by score first, then by id. */\nfunction compare(a: lunr.Index.Result, b: lunr.Index.Result) {\n    if (a.score !== b.score) {\n        return b.score - a.score;\n    }\n    return naturalSort(a.ref, b.ref);\n}\n\n/** Returns all last names of all husbands as a space-separated string. */\nfunction getHusbandLastName(\n    indi: JsonIndi,\n    indiMap: Map<String, JsonIndi>,\n    famMap: Map<string, JsonFam>,\n): string {\n    return (indi.fams || [])\n        .map((famId) => famMap.get(famId))\n        .map((fam) => fam && fam.husb)\n        .map((husbId) => husbId && indiMap.get(husbId))\n        .map((husband) => husband && husband.lastName)\n        .join(' ');\n}\n\nclass LunrSearchIndex implements SearchIndex {\n    private index: lunr.Index | undefined;\n    private indiMap: Map<string, JsonIndi>;\n    private famMap: Map<string, JsonFam>;\n\n    constructor(data: JsonGedcomData) {\n        this.indiMap = idToIndiMap(data);\n        this.famMap = idToFamMap(data);\n    }\n\n    initialize() {\n        const self = this;\n        this.index = lunr(function () {\n            //Trimmer will break non-latin characters, so custom multilingual implementation must be used\n            self.initMultiLingualLunrWithoutTrimmer(this, [\n                'de',\n                'en',\n                'fr',\n                'it',\n                'ru',\n            ]);\n            this.ref('id');\n            this.field('id');\n            this.field('name', {boost: 10});\n            this.field('normalizedName', {boost: 8});\n            this.field('spouseLastName', {boost: 2});\n            this.field('normalizedSpouseLastName', {boost: 2});\n\n            self.indiMap.forEach((indi) => {\n                const name = [indi.firstName, indi.lastName].join(' ');\n                const spouseLastName = getHusbandLastName(\n                    indi,\n                    self.indiMap,\n                    self.famMap,\n                );\n                this.add({\n                    id: indi.id,\n                    name,\n                    normalizedName: normalize(name),\n                    spouseLastName,\n                    normalizedSpouseLastName: normalize(spouseLastName),\n                });\n            });\n        });\n    }\n\n    private initMultiLingualLunrWithoutTrimmer(\n        lunrInstance: any,\n        languages: string[],\n    ): void {\n        let wordCharacters = '';\n        const pipelineFunctions: PipelineFunction[] = [];\n        const searchPipelineFunctions: PipelineFunction[] = [];\n        languages.forEach((language) => {\n            if (language === 'en') {\n                wordCharacters += '\\\\w';\n                pipelineFunctions.unshift(lunr.stopWordFilter);\n                pipelineFunctions.push(lunr.stemmer);\n                searchPipelineFunctions.push(lunr.stemmer);\n            } else {\n                wordCharacters += lunr[language].wordCharacters;\n                if (lunr[language].stopWordFilter) {\n                    pipelineFunctions.unshift(lunr[language].stopWordFilter);\n                }\n                if (lunr[language].stemmer) {\n                    pipelineFunctions.push(lunr[language].stemmer);\n                    searchPipelineFunctions.push(lunr[language].stemmer);\n                }\n            }\n        });\n        lunrInstance.pipeline.reset();\n        lunrInstance.pipeline.add.apply(lunrInstance.pipeline, pipelineFunctions);\n\n        if (lunrInstance.searchPipeline) {\n            lunrInstance.searchPipeline.reset();\n            lunrInstance.searchPipeline.add.apply(\n                lunrInstance.searchPipeline,\n                searchPipelineFunctions,\n            );\n        }\n    }\n\n    public search(input: string): SearchResult[] {\n        const query = input\n            .split(' ')\n            .filter((s) => !!s)\n            .map((s) => `${s} ${s}*`)\n            .join(' ');\n        const results = this.index!.search(query);\n        return results\n            .sort(compare)\n            .slice(0, MAX_RESULTS)\n            .map((result) => ({id: result.ref, indi: this.indiMap.get(result.ref)!}));\n    }\n}\n\n/** Builds a search index from data. */\nexport function buildSearchIndex(data: JsonGedcomData): SearchIndex {\n    const index = new LunrSearchIndex(data);\n    index.initialize();\n    return index;\n}\n","import debounce from 'debounce';\nimport {buildSearchIndex, SearchIndex, SearchResult} from './search_index';\nimport {formatDateOrRange} from '../util/date_util';\nimport {IndiInfo, JsonGedcomData} from 'topola';\nimport {JsonIndi} from 'topola';\nimport {Search, SearchResultProps} from 'semantic-ui-react';\nimport {useEffect, useRef, useState} from 'react';\nimport {useIntl} from 'react-intl';\n\nfunction getNameLine(result: SearchResult) {\n    const name = [result.indi.firstName, result.indi.lastName].join(' ').trim();\n    if (result.id.length > 8) {\n        return name;\n    }\n    return (\n        <>\n            {name} <i>({result.id})</i>\n        </>\n    );\n}\n\ninterface Props {\n    /** Data used for the search index. */\n    data: JsonGedcomData;\n    onSelection: (indiInfo: IndiInfo) => void;\n}\n\n/** Displays and handles the search box in the top bar. */\nexport function SearchBar(props: Props) {\n    const [searchResults, setSearchResults] = useState<SearchResultProps[]>([]);\n    const [searchString, setSearchString] = useState('');\n    const searchIndex = useRef<SearchIndex>();\n    const intl = useIntl();\n\n    function getDescriptionLine(indi: JsonIndi) {\n        const birthDate = formatDateOrRange(indi.birth, intl);\n        const deathDate = formatDateOrRange(indi.death, intl);\n        if (!deathDate) {\n            return birthDate;\n        }\n        return `${birthDate} – ${deathDate}`;\n    }\n\n    /** Produces an object that is displayed in the Semantic UI Search results. */\n    function displaySearchResult(result: SearchResult): SearchResultProps {\n        return {\n            id: result.id,\n            key: result.id,\n            title: getNameLine(result),\n            description: getDescriptionLine(result.indi),\n        } as SearchResultProps;\n    }\n\n    /** On search input change. */\n    function handleSearch(input: string | undefined) {\n        if (!input) {\n            return;\n        }\n        const results = searchIndex\n            .current!.search(input)\n            .map((result) => displaySearchResult(result));\n        setSearchResults(results);\n    }\n\n    const debouncedHandleSearch = useRef(debounce(handleSearch, 200));\n\n    /** On search result selected. */\n    function handleResultSelect(id: string) {\n        props.onSelection({id, generation: 0});\n        setSearchString('');\n    }\n\n    /** On search string changed. */\n    function onChange(value: string) {\n        debouncedHandleSearch.current(value);\n        setSearchString(value);\n    }\n\n    // Initialize the search index.\n    useEffect(() => {\n        searchIndex.current = buildSearchIndex(props.data);\n    }, [props.data]);\n\n    return (\n        <Search\n            onSearchChange={(_, data) => onChange(data.value!)}\n            onResultSelect={(_, data) => handleResultSelect(data.result.id)}\n            results={searchResults}\n            noResultsMessage={intl.formatMessage({\n                id: 'menu.search.no_results',\n                defaultMessage: 'No results found',\n            })}\n            placeholder={intl.formatMessage({\n                id: 'menu.search.placeholder',\n                defaultMessage: 'Search for people',\n            })}\n            selectFirstResult={true}\n            value={searchString}\n            id=\"search\"\n        />\n    );\n}\n","import * as queryString from 'query-string';\nimport md5 from 'md5';\nimport {Dropdown, Icon, Menu} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {MenuType} from './menu_item';\nimport {SyntheticEvent} from 'react';\nimport {useHistory, useLocation} from 'react-router';\nimport {loadFile} from '../datasource/load_data';\n\nfunction isImageFileName(fileName: string) {\n    const lower = fileName.toLowerCase();\n    return lower.endsWith('.jpg') || lower.endsWith('.png');\n}\n\ninterface Props {\n    menuType: MenuType;\n}\n\n/** Displays and handles the \"Open file\" menu. */\nexport function UploadMenu(props: Props) {\n    const history = useHistory();\n    const location = useLocation();\n\n    async function handleUpload(event: SyntheticEvent<HTMLInputElement>) {\n        const files = (event.target as HTMLInputElement).files;\n        if (!files || !files.length) {\n            return;\n        }\n        const filesArray = Array.from(files);\n        (event.target as HTMLInputElement).value = ''; // Reset the file input.\n\n        const gedcomFile =\n            filesArray.length === 1\n                ? filesArray[0]\n                : filesArray.find((file) => file.name.toLowerCase().endsWith('.ged')) ||\n                filesArray[0];\n        const {gedcom, images} = await loadFile(gedcomFile);\n\n        // Convert uploaded images to object URLs.\n        filesArray\n            .filter((file) => file.name !== gedcomFile.name && isImageFileName(file.name))\n            .forEach((file) => images.set(file.name, URL.createObjectURL(file)));\n\n        // Hash GEDCOM contents with uploaded image file names.\n        const imageFileNames = Array.from(images.keys()).sort().join('|');\n        const hash = md5(md5(gedcom) + imageFileNames);\n\n        // Use history.replace() when re-uploading the same file and history.push() when loading a new file.\n        const search = queryString.parse(location.search);\n        const historyPush = search.file === hash ? history.replace : history.push;\n\n        historyPush({\n            pathname: '/view',\n            search: queryString.stringify({file: hash}),\n            state: {data: gedcom, images},\n        });\n    }\n\n    const content = (\n        <>\n            <Icon name=\"folder open\"/>\n            <FormattedMessage id=\"menu.open_file\" defaultMessage=\"Open file\"/>\n        </>\n    );\n    return (\n        <>\n            {props.menuType === MenuType.Menu ? (\n                <label htmlFor=\"fileInput\">\n                    <Menu.Item as=\"a\">{content}</Menu.Item>\n                </label>\n            ) : (\n                <Dropdown.Item as=\"label\" htmlFor=\"fileInput\">\n                    {content}\n                </Dropdown.Item>\n            )}\n            <input\n                className=\"hidden\"\n                type=\"file\"\n                accept=\".ged,.gdz,.gedzip,.zip,image/*\"\n                id=\"fileInput\"\n                multiple\n                onChange={handleUpload}\n            />\n        </>\n    );\n}\n","import {Dropdown, Icon, Menu} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {IndiInfo, JsonGedcomData} from 'topola';\nimport {Media} from '../util/media';\nimport {MenuType} from './menu_item';\nimport {SearchBar} from './search';\nimport {UploadMenu} from './upload_menu';\nimport {UrlMenu} from './url_menu';\nimport {useHistory, useLocation} from 'react-router';\n\nenum ScreenSize {\n    LARGE,\n    SMALL,\n}\n\ninterface EventHandlers {\n    onSelection: (indiInfo: IndiInfo) => void;\n    onDownloadPdf: () => void;\n    onDownloadPng: () => void;\n    onDownloadSvg: () => void;\n    onCenterView: () => void;\n}\n\ninterface Props {\n    /** True if the application is currently showing a chart. */\n    showingChart: boolean;\n    /** Data used for the search index. */\n    data?: JsonGedcomData;\n    standalone: boolean;\n    eventHandlers: EventHandlers;\n}\n\nexport function TopBar(props: Props) {\n    useHistory();\n    useLocation();\n    function chartMenus(screenSize: ScreenSize) {\n        if (!props.showingChart) {\n            return null;\n        }\n        switch (screenSize) {\n            case ScreenSize.LARGE:\n                return (\n                    <>\n                        <Dropdown\n                            trigger={\n                                <div>\n                                    <Icon name=\"download\"/>\n                                    <FormattedMessage id=\"menu.download\" defaultMessage=\"Download\"/>\n                                </div>\n                            }\n                            className=\"item\"\n                        >\n                            <Dropdown.Menu>\n                                <Dropdown.Item onClick={props.eventHandlers.onDownloadPdf}>\n                                    <FormattedMessage id=\"menu.pdf_file\" defaultMessage=\"PDF file\"/>\n                                </Dropdown.Item>\n                                <Dropdown.Item onClick={props.eventHandlers.onDownloadPng}>\n                                    <FormattedMessage id=\"menu.png_file\" defaultMessage=\"PNG file\"/>\n                                </Dropdown.Item>\n                                <Dropdown.Item onClick={props.eventHandlers.onDownloadSvg}>\n                                    <FormattedMessage id=\"menu.svg_file\" defaultMessage=\"SVG file\"/>\n                                </Dropdown.Item>\n                            </Dropdown.Menu>\n                        </Dropdown>\n\n                        <Menu.Item onClick={props.eventHandlers.onCenterView}>\n                            <Icon name=\"eye\" />\n                            <FormattedMessage id=\"menu.view\" defaultMessage=\"Center view\" />\n                        </Menu.Item>\n\n                        <Menu.Menu position=\"right\">\n                            <SearchBar\n                                data={props.data!}\n                                onSelection={props.eventHandlers.onSelection}\n                                {...props}\n                            />\n                        </Menu.Menu>\n                    </>\n                );\n\n            case ScreenSize.SMALL:\n                return (\n                    <>\n                        <Dropdown.Item onClick={props.eventHandlers.onDownloadPdf}>\n                            <Icon name=\"download\"/>\n                            <FormattedMessage id=\"menu.download_pdf\" defaultMessage=\"Download PDF\"/>\n                        </Dropdown.Item>\n                        <Dropdown.Item onClick={props.eventHandlers.onDownloadPng}>\n                            <Icon name=\"download\"/>\n                            <FormattedMessage id=\"menu.download_png\" defaultMessage=\"Download PNG\"/>\n                        </Dropdown.Item>\n                        <Dropdown.Item onClick={props.eventHandlers.onDownloadSvg}>\n                            <Icon name=\"download\"/>\n                            <FormattedMessage id=\"menu.download_svg\" defaultMessage=\"Download SVG\"/>\n                        </Dropdown.Item>\n                        <Dropdown.Divider/>\n                    </>\n                );\n        }\n    }\n\n    function fileMenus(screenSize: ScreenSize) {\n        // Don't show \"open\" menus in non-standalone mode.\n        if (!props.standalone) {\n            return null;\n        }\n\n        switch (screenSize) {\n            case ScreenSize.LARGE:\n                // Show dropdown if chart is shown, otherwise show individual menu items.\n                return props.showingChart ? (\n                    <>\n                        <UploadMenu menuType={MenuType.Menu} {...props} />\n                        {/*<UrlMenu menuType={MenuType.Menu} {...props} />*/}\n                    </>\n                ) : (\n                    <Dropdown\n                        trigger={\n                            <div>\n                                <Icon name=\"folder open\"/>\n                                <FormattedMessage id=\"menu.open\" defaultMessage=\"Open\"/>\n                            </div>\n                        }\n                        className=\"item\"\n                    >\n                        <Dropdown.Menu>\n                            <UploadMenu menuType={MenuType.Dropdown} {...props} />\n                            <UrlMenu menuType={MenuType.Dropdown} {...props} />\n                        </Dropdown.Menu>\n                    </Dropdown>\n                );\n\n            case ScreenSize.SMALL:\n                return (\n                    <>\n                        <UploadMenu menuType={MenuType.Dropdown} {...props} />\n                        {/*<UrlMenu menuType={MenuType.Dropdown} {...props} />*/}\n                        <Dropdown.Divider/>\n                    </>\n                );\n        }\n    }\n\n    function mobileMenus() {\n        return (\n            <>\n                <Dropdown\n                    trigger={\n                        <div>\n                            <Icon name=\"sidebar\"/>\n                        </div>\n                    }\n                    className=\"item\"\n                    icon={null}\n                >\n                    <Dropdown.Menu>\n                        {fileMenus(ScreenSize.SMALL)}\n                        {chartMenus(ScreenSize.SMALL)}\n                    </Dropdown.Menu>\n                </Dropdown>\n            </>\n        );\n    }\n\n    function desktopMenus() {\n        return (\n            <>\n                {fileMenus(ScreenSize.LARGE)}\n                {chartMenus(ScreenSize.LARGE)}\n            </>\n        );\n    }\n\n    return (\n        <>\n            <Menu\n                as={Media}\n                greaterThanOrEqual=\"large\"\n                attached=\"top\"\n                inverted\n                color=\"blue\"\n                size=\"large\"\n            >\n                {desktopMenus()}\n            </Menu>\n            <Menu\n                as={Media}\n                at=\"small\"\n                attached=\"top\"\n                inverted\n                color=\"blue\"\n                size=\"large\"\n            >\n                {mobileMenus()}\n            </Menu>\n        </>\n    );\n}\n","import * as queryString from 'query-string';\nimport {Button, Form, Header, Icon, Input, Modal} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {MenuItem, MenuType} from './menu_item';\nimport {useEffect, useRef, useState} from 'react';\nimport {useHistory} from 'react-router';\n\ninterface Props {\n    menuType: MenuType;\n}\n\n/** Displays and handles the \"Open URL\" menu. */\nexport function UrlMenu(props: Props) {\n    const [dialogOpen, setDialogOpen] = useState(false);\n    const [url, setUrl] = useState('');\n    const inputRef = useRef<Input>(null);\n    const history = useHistory();\n\n    useEffect(() => {\n        if (dialogOpen) {\n            setUrl('');\n            inputRef.current!.focus();\n        }\n    }, [dialogOpen]);\n\n    /** Load button clicked in the \"Load from URL\" dialog. */\n    function handleLoad() {\n        setDialogOpen(false);\n        if (url) {\n            history.push({\n                pathname: '/view',\n                search: queryString.stringify({url}),\n            });\n        }\n    }\n\n    function loadFromUrlModal() {\n        return (\n            <Modal\n                open={dialogOpen}\n                onClose={() => setDialogOpen(false)}\n                centered={false}\n            >\n                <Header>\n                    <Icon name=\"cloud download\"/>\n                    <FormattedMessage\n                        id=\"load_from_url.title\"\n                        defaultMessage=\"Load from URL\"\n                    />\n                </Header>\n                <Modal.Content>\n                    <Form onSubmit={handleLoad}>\n                        <Input\n                            placeholder=\"https://\"\n                            fluid\n                            value={url}\n                            onChange={(_, data) => setUrl(data.value)}\n                            ref={inputRef}\n                        />\n                        <p>\n                            <FormattedMessage\n                                id=\"load_from_url.comment\"\n                                defaultMessage={\n                                    'Data from the URL will be loaded through {link} to avoid CORS issues.'\n                                }\n                                values={{\n                                    link: (\n                                        <a href=\"https://topolaproxy.bieda.it/\">\n                                            topolaproxy.bieda.it (cors-anywhere proxy)\n                                        </a>\n                                    ),\n                                }}\n                            />\n                        </p>\n                    </Form>\n                </Modal.Content>\n                <Modal.Actions>\n                    <Button secondary onClick={() => setDialogOpen(false)}>\n                        <FormattedMessage\n                            id=\"load_from_url.cancel\"\n                            defaultMessage=\"Cancel\"\n                        />\n                    </Button>\n                    <Button primary onClick={handleLoad}>\n                        <FormattedMessage id=\"load_from_url.load\" defaultMessage=\"Load\"/>\n                    </Button>\n                </Modal.Actions>\n            </Modal>\n        );\n    }\n\n    return (\n        <>\n            <MenuItem onClick={() => setDialogOpen(true)} menuType={props.menuType}>\n                <Icon name=\"cloud download\"/>\n                <FormattedMessage\n                    id=\"menu.load_from_url\"\n                    defaultMessage=\"Load from URL\"\n                />\n            </MenuItem>\n            {loadFromUrlModal()}\n        </>\n    );\n}\n","import {Item, Checkbox, Form, Header} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {ParsedQuery} from 'query-string';\n\nexport enum ChartColors {\n    NO_COLOR,\n    COLOR_BY_SEX,\n    COLOR_BY_GENERATION,\n}\n\nexport enum Ids {\n    HIDE,\n    SHOW,\n}\n\nexport enum Sex {\n    HIDE,\n    SHOW,\n}\n\nexport interface Config {\n    color: ChartColors;\n    id: Ids;\n    sex: Sex;\n}\n\nexport const DEFAULT_CONFIG: Config = {\n    color: ChartColors.COLOR_BY_GENERATION,\n    id: Ids.SHOW,\n    sex: Sex.SHOW,\n};\n\nconst COLOR_ARG = new Map<string, ChartColors>([\n    ['n', ChartColors.NO_COLOR],\n    ['g', ChartColors.COLOR_BY_GENERATION],\n    ['s', ChartColors.COLOR_BY_SEX],\n]);\nconst COLOR_ARG_INVERSE = new Map<ChartColors, string>();\nCOLOR_ARG.forEach((v, k) => COLOR_ARG_INVERSE.set(v, k));\n\nconst ID_ARG = new Map<string, Ids>([\n    ['h', Ids.HIDE],\n    ['s', Ids.SHOW],\n]);\nconst ID_ARG_INVERSE = new Map<Ids, string>();\nID_ARG.forEach((v, k) => ID_ARG_INVERSE.set(v, k));\n\nconst SEX_ARG = new Map<string, Sex>([\n    ['h', Sex.HIDE],\n    ['s', Sex.SHOW],\n]);\nconst SEX_ARG_INVERSE = new Map<Sex, string>();\nSEX_ARG.forEach((v, k) => SEX_ARG_INVERSE.set(v, k));\n\nexport function argsToConfig(args: ParsedQuery<any>): Config {\n    const getParam = (name: string) => {\n        const value = args[name];\n        return typeof value === 'string' ? value : undefined;\n    };\n\n    return {\n        color: COLOR_ARG.get(getParam('c') ?? '') ?? DEFAULT_CONFIG.color,\n        id: ID_ARG.get(getParam('i') ?? '') ?? DEFAULT_CONFIG.id,\n        sex: SEX_ARG.get(getParam('s') ?? '') ?? DEFAULT_CONFIG.sex,\n    };\n}\n\nexport function configToArgs(config: Config): ParsedQuery<any> {\n    return {\n        c: COLOR_ARG_INVERSE.get(config.color),\n        i: ID_ARG_INVERSE.get(config.id),\n        s: SEX_ARG_INVERSE.get(config.sex),\n    };\n}\n\nexport function ConfigPanel(props: {\n    config: Config;\n    onChange: (config: Config) => void;\n}) {\n    return (\n        <Form className=\"details\">\n            <Item.Group>\n                <Item>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.colors\" defaultMessage=\"Colors\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.NO_COLOR\" defaultMessage=\"none\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"none\"\n                                checked={props.config.color === ChartColors.NO_COLOR}\n                                onClick={() =>\n                                    props.onChange({...props.config, color: ChartColors.NO_COLOR})\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_GENERATION\" defaultMessage=\"by generation\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"generation\"\n                                checked={props.config.color === ChartColors.COLOR_BY_GENERATION}\n                                onClick={() =>\n                                    props.onChange({...props.config, color: ChartColors.COLOR_BY_GENERATION})\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_SEX\" defaultMessage=\"by sex\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"gender\"\n                                checked={props.config.color === ChartColors.COLOR_BY_SEX}\n                                onClick={() =>\n                                    props.onChange({...props.config, color: ChartColors.COLOR_BY_SEX})\n                                }\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n                <Item>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.ids\" defaultMessage=\"IDs\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.ids.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.id === Ids.HIDE}\n                                onClick={() =>\n                                    props.onChange({...props.config, id: Ids.HIDE})\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.ids.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.id === Ids.SHOW}\n                                onClick={() =>\n                                    props.onChange({...props.config, id: Ids.SHOW})\n                                }\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n                <Item>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.sex\" defaultMessage=\"Sex\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.sex.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.sex === Sex.HIDE}\n                                onClick={() =>\n                                    props.onChange({...props.config, sex: Sex.HIDE})\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.sex.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.sex === Sex.SHOW}\n                                onClick={() =>\n                                    props.onChange({...props.config, sex: Sex.SHOW})\n                                }\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n            </Item.Group>\n        </Form>\n    );\n}\n","import {ChartColors, Ids, Sex} from './config';\nimport {interpolateNumber} from 'd3-interpolate';\nimport {IntlShape, useIntl} from 'react-intl';\nimport {max, min} from 'd3-array';\nimport {Media} from './util/media';\nimport {saveAs} from 'file-saver';\nimport {select, Selection} from 'd3-selection';\nimport {useEffect, useRef} from 'react';\nimport 'd3-transition';\nimport {D3ZoomEvent, zoom, ZoomBehavior, ZoomedElementBaseType, zoomTransform,} from 'd3-zoom';\nimport {\n    ChartColors as TopolaChartColors,\n    ChartHandle,\n    createChart,\n    DetailedRenderer,\n    HourglassChart,\n    IndiInfo,\n    JsonGedcomData,\n} from 'topola';\n\n/** How much to zoom when using the +/- buttons. */\nconst ZOOM_FACTOR = 1.3;\n\n/**\n * Called when the view is dragged with the mouse.\n *\n * @param size the size of the chart\n * @param event\n */\nfunction zoomed(\n    size: [number, number],\n    event: D3ZoomEvent<ZoomedElementBaseType, unknown>,\n) {\n    const parent = select('#svgContainer').node() as Element;\n    const scale = event.transform.k;\n    const offsetX = max([0, (parent.clientWidth - size[0] * scale) / 2]);\n    const offsetY = max([0, (parent.clientHeight - size[1] * scale) / 2]);\n    select('#chartSvg')\n        .attr('width', size[0] * scale)\n        .attr('height', size[1] * scale)\n        .attr('transform', `translate(${offsetX}, ${offsetY})`);\n    select('#chart').attr('transform', `scale(${scale})`);\n    parent.scrollLeft = -event.transform.x;\n    parent.scrollTop = -event.transform.y;\n}\n\n/** Called when the scrollbars are used. */\nfunction scrolled() {\n    const parent = select('#svgContainer').node() as Element;\n    const x = parent.scrollLeft + parent.clientWidth / 2;\n    const y = parent.scrollTop + parent.clientHeight / 2;\n    const scale = zoomTransform(parent).k;\n    select(parent).call(zoom().translateTo, x / scale, y / scale);\n}\n\n/** Loads blob as data URL. */\nfunction loadAsDataUrl(blob: Blob): Promise<string> {\n    const reader = new FileReader();\n    reader.readAsDataURL(blob);\n    return new Promise<string>((resolve) => {\n        reader.onload = (e) => resolve((e.target as FileReader).result as string);\n    });\n}\n\nasync function inlineImage(image: SVGImageElement) {\n    const href = image.href.baseVal;\n    if (!href) {\n        return;\n    }\n    try {\n        const response = await fetch(href);\n        const blob = await response.blob();\n        image.href.baseVal = await loadAsDataUrl(blob);\n    } catch (e) {\n        console.warn('Failed to load image:', e);\n    }\n}\n\n/**\n * Fetches all images in the SVG and replaces them with inlined images as data\n * URLs. Images are replaced in place. The replacement is done, the returned\n * promise is resolved.\n */\nasync function inlineImages(svg: Element): Promise<void> {\n    const images = Array.from(svg.getElementsByTagName('image'));\n    await Promise.all(images.map(inlineImage));\n}\n\n/** Loads a blob into an image object. */\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\n    const image = new Image();\n    image.src = URL.createObjectURL(blob);\n    return new Promise<HTMLImageElement>((resolve) => {\n        image.addEventListener('load', () => resolve(image));\n    });\n}\n\n/** Draw image on a new canvas and return the canvas. */\nfunction drawImageOnCanvas(image: HTMLImageElement) {\n    const canvas = document.createElement('canvas');\n    // Scale image for better quality.\n    canvas.width = image.width * 2;\n    canvas.height = image.height * 2;\n    const ctx = canvas.getContext('2d')!;\n    const oldFill = ctx.fillStyle;\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    ctx.fillStyle = oldFill;\n    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);\n    return canvas;\n}\n\nfunction canvasToBlob(canvas: HTMLCanvasElement, type: string) {\n    return new Promise<Blob>((resolve, reject) => {\n        canvas.toBlob((blob) => {\n            if (blob) {\n                resolve(blob);\n            } else {\n                reject();\n            }\n        }, type);\n    });\n}\n\n/** Return a copy of the SVG chart but without scaling and positioning. */\nfunction getStrippedSvg() {\n    const svg = document.getElementById('chartSvg')!.cloneNode(true) as Element;\n    svg.removeAttribute('transform');\n    const parent = select('#svgContainer').node() as Element;\n    const scale = zoomTransform(parent).k;\n    svg.setAttribute('width', String(Number(svg.getAttribute('width')) / scale));\n    svg.setAttribute(\n        'height',\n        String(Number(svg.getAttribute('height')) / scale),\n    );\n    svg.querySelector('#chart')!.removeAttribute('transform');\n    return svg;\n}\n\nasync function getSvgContentsWithInlinedImages() {\n    const svg = getStrippedSvg();\n    await inlineImages(svg);\n    return new XMLSerializer().serializeToString(svg);\n}\n\nexport async function downloadSvg() {\n    const contents = await getSvgContentsWithInlinedImages();\n    const blob = new Blob([contents], {type: 'image/svg+xml'});\n    saveAs(blob, 'genealogy.svg');\n}\n\nasync function drawOnCanvas(): Promise<HTMLCanvasElement> {\n    const contents = await getSvgContentsWithInlinedImages();\n    const blob = new Blob([contents], {type: 'image/svg+xml'});\n    return drawImageOnCanvas(await loadImage(blob));\n}\n\nexport async function downloadPng() {\n    const canvas = await drawOnCanvas();\n    const blob = await canvasToBlob(canvas, 'image/png');\n    saveAs(blob, 'genealogy.png');\n}\n\nexport async function downloadPdf() {\n    // Lazy load jspdf.\n    const {default: jspdf} = await import('jspdf');\n    const canvas = await drawOnCanvas();\n    const doc = new jspdf({\n        orientation: canvas.width > canvas.height ? 'l' : 'p',\n        unit: 'pt',\n        format: [canvas.width, canvas.height],\n    });\n    doc.addImage(canvas, 'PNG', 0, 0, canvas.width, canvas.height, 'NONE');\n    doc.save('genealogy.pdf');\n}\n\n/** Supported chart types. */\nexport enum ChartType {\n    Hourglass\n}\n\nconst chartColors = new Map<ChartColors, TopolaChartColors>([\n    [ChartColors.NO_COLOR, TopolaChartColors.NO_COLOR],\n    [ChartColors.COLOR_BY_GENERATION, TopolaChartColors.COLOR_BY_GENERATION],\n    [ChartColors.COLOR_BY_SEX, TopolaChartColors.COLOR_BY_SEX],\n]);\n\nexport interface ChartProps {\n    data: JsonGedcomData;\n    selection: IndiInfo;\n    chartType: ChartType;\n    onSelection: (indiInfo: IndiInfo) => void;\n    freezeAnimation?: boolean;\n    colors?: ChartColors;\n    hideIds?: Ids;\n    hideSex?: Sex;\n}\n\nclass ChartWrapper {\n    private chart?: ChartHandle;\n    /** Animation is in progress. */\n    private animating = false;\n    /** Rendering is required after the current animation finishes. */\n    private rerenderRequired = false;\n    /** The d3 zoom behavior object. */\n    private zoomBehavior?: ZoomBehavior<Element, any>;\n    /** Props that will be used for re-rendering. */\n    private rerenderProps?: ChartProps;\n    private rerenderResetPosition?: boolean;\n\n    zoom(factor: number) {\n        const parent = select('#svgContainer') as Selection<Element, any, any, any>;\n        this.zoomBehavior!.scaleBy(parent, factor);\n    }\n\n    /**\n     * Renders the chart or performs a transition animation to a new state.\n     * If indiInfo is not given, it means that it is the initial render and no\n     * animation is performed.\n     */\n    renderChart(\n        props: ChartProps,\n        intl: IntlShape,\n        args: { initialRender: boolean; resetPosition: boolean } = {\n            initialRender: false,\n            resetPosition: false,\n        },\n    ) {\n        // Wait for animation to finish if animation is in progress.\n        if (!args.initialRender && this.animating) {\n            this.rerenderRequired = true;\n            this.rerenderProps = props;\n            this.rerenderResetPosition = args.resetPosition;\n            return;\n        }\n\n        // Freeze changing selection after initial rendering.\n        if (!args.initialRender && props.freezeAnimation) {\n            return;\n        }\n\n        if (args.initialRender) {\n            (select('#chart').node() as HTMLElement).innerHTML = '';\n            this.chart = createChart({\n                json: props.data,\n                chartType: HourglassChart,\n                renderer: DetailedRenderer,\n                svgSelector: '#chart',\n                indiCallback: (info) => props.onSelection(info),\n                colors: chartColors.get(props.colors!),\n                animate: true,\n                updateSvgSize: false,\n                locale: intl.locale,\n            });\n        } else {\n            this.chart!.setData(props.data);\n        }\n\n        const chartInfo = this.chart!.render({\n            startIndi: props.selection.id,\n            baseGeneration: props.selection.generation,\n        });\n        const svg = select('#chartSvg');\n        const parent = select('#svgContainer').node() as Element;\n        const scale = zoomTransform(parent).k;\n        const zoomOutFactor = min([\n            1,\n            scale,\n            parent.clientWidth / chartInfo.size[0],\n            parent.clientHeight / chartInfo.size[1],\n        ])!;\n        const extent: [number, number] = [max([0.1, zoomOutFactor])!, 2];\n\n        this.zoomBehavior = zoom()\n            .scaleExtent(extent)\n            .translateExtent([[0, 0], chartInfo.size])\n            .on('zoom', (event) => zoomed(chartInfo.size, event));\n        select(parent).on('scroll', scrolled).call(this.zoomBehavior);\n\n        const scrollTopTween = (scrollTop: number) => {\n            return () => {\n                const i = interpolateNumber(parent.scrollTop, scrollTop);\n                return (t: number) => {\n                    parent.scrollTop = i(t);\n                };\n            };\n        };\n        const scrollLeftTween = (scrollLeft: number) => {\n            return () => {\n                const i = interpolateNumber(parent.scrollLeft, scrollLeft);\n                return (t: number) => {\n                    parent.scrollLeft = i(t);\n                };\n            };\n        };\n\n        const dx = parent.clientWidth / 2 - chartInfo.origin[0] * scale;\n        const dy = parent.clientHeight / 2 - chartInfo.origin[1] * scale;\n        const offsetX = max([\n            0,\n            (parent.clientWidth - chartInfo.size[0] * scale) / 2,\n        ]);\n        const offsetY = max([\n            0,\n            (parent.clientHeight - chartInfo.size[1] * scale) / 2,\n        ]);\n        const svgTransition = svg.transition().delay(200).duration(500);\n        const transition = args.initialRender ? svg : svgTransition;\n        transition\n            .attr('transform', `translate(${offsetX}, ${offsetY})`)\n            .attr('width', chartInfo.size[0] * scale)\n            .attr('height', chartInfo.size[1] * scale);\n        if (args.resetPosition) {\n            if (args.initialRender) {\n                parent.scrollLeft = -dx;\n                parent.scrollTop = -dy;\n            } else {\n                svgTransition\n                    .tween('scrollLeft', scrollLeftTween(-dx))\n                    .tween('scrollTop', scrollTopTween(-dy));\n            }\n        }\n\n        // After the animation is finished, rerender the chart if required.\n        this.animating = true;\n        chartInfo.animationPromise.then(() => {\n            this.animating = false;\n            if (this.rerenderRequired) {\n                this.rerenderRequired = false;\n                // Use `this.rerenderProps` instead of the props in scope because\n                // the props may have been updated in the meantime.\n                this.renderChart(this.rerenderProps!, intl, {\n                    initialRender: false,\n                    resetPosition: !!this.rerenderResetPosition,\n                });\n            }\n        });\n    }\n}\n\nfunction usePrevious<T>(value: T): T | undefined {\n    const ref = useRef<T>();\n    useEffect(() => {\n        ref.current = value;\n    });\n    return ref.current;\n}\n\nexport function Chart(props: ChartProps) {\n    const chartWrapper = useRef(new ChartWrapper());\n    const prevProps = usePrevious(props);\n    const intl = useIntl();\n\n    useEffect(() => {\n        if (prevProps) {\n            const initialRender =\n                props.chartType !== prevProps?.chartType ||\n                props.colors !== prevProps?.colors ||\n                props.hideIds !== prevProps?.hideIds ||\n                props.hideSex !== prevProps?.hideSex;\n            const resetPosition =\n                props.chartType !== prevProps?.chartType ||\n                props.data !== prevProps.data ||\n                props.selection !== prevProps.selection;\n            chartWrapper.current.renderChart(props, intl, {\n                initialRender,\n                resetPosition,\n            });\n        } else {\n            chartWrapper.current.renderChart(props, intl, {\n                initialRender: true,\n                resetPosition: true,\n            });\n        }\n    });\n\n    return (\n        <div id=\"svgContainer\">\n            <Media greaterThanOrEqual=\"large\" className=\"zoom\">\n                <button className=\"zoom-in\" onClick={() => chartWrapper.current.zoom(ZOOM_FACTOR)}>+</button>\n                <button className=\"zoom-out\" onClick={() => chartWrapper.current.zoom(1 / ZOOM_FACTOR)}>−</button>\n            </Media>\n            <svg id=\"chartSvg\">\n                <g id=\"chart\"/>\n            </svg>\n        </div>\n    );\n}\n","import * as H from 'history';\nimport * as queryString from 'query-string';\nimport {DataSourceEnum, SourceSelection} from './datasource/data_source';\nimport {Details} from './details/details';\nimport {EmbeddedDataSource, EmbeddedSourceSpec} from './datasource/embedded';\nimport {FormattedMessage, useIntl} from 'react-intl';\nimport {getI18nMessage} from './util/error_i18n';\nimport {IndiInfo} from 'topola';\nimport {Loader, Message, Portal, Tab} from 'semantic-ui-react';\nimport {Media} from './util/media';\nimport {Redirect, Route, Switch} from 'react-router-dom';\nimport {TopBar} from './menu/top_bar';\nimport {TopolaData} from './util/gedcom_util';\nimport {useEffect, useState} from 'react';\nimport {useHistory, useLocation} from 'react-router';\nimport {idToIndiMap} from './util/gedcom_util';\nimport {\n    Chart,\n    ChartType,\n    downloadPdf,\n    downloadPng,\n    downloadSvg,\n} from './chart';\nimport {\n    argsToConfig,\n    Config,\n    ConfigPanel,\n    configToArgs,\n    DEFAULT_CONFIG,\n    Ids,\n    Sex,\n} from './config';\nimport {\n    getSelection,\n    UploadSourceSpec,\n    UrlSourceSpec,\n    GedcomUrlDataSource,\n    UploadedDataSource,\n} from './datasource/load_data';\n\n/**\n * Load GEDCOM URL from REACT_APP_STATIC_URL environment variable.\n *\n * If this environment variable is provided, the viewer is switched to\n * single-tree mode without the option to load other data.\n */\nconst staticUrl = process.env.REACT_APP_STATIC_URL;\n\n/** Shows an error message in the middle of the screen. */\nfunction ErrorMessage(props: { message?: string }) {\n    return (\n        <Message negative className=\"error\">\n            <Message.Header>\n                <FormattedMessage\n                    id=\"error.failed_to_load_file\"\n                    defaultMessage={'Failed to load file'}\n                />\n            </Message.Header>\n            <p>{props.message}</p>\n        </Message>\n    );\n}\n\ninterface ErrorPopupProps {\n    message?: string;\n    open: boolean;\n    onDismiss: () => void;\n}\n\n/**\n * Shows a dismissable error message in the bottom left corner of the screen.\n */\nfunction ErrorPopup(props: ErrorPopupProps) {\n    return (\n        <Portal open={props.open} onClose={props.onDismiss}>\n            <Message negative className=\"errorPopup\" onDismiss={props.onDismiss}>\n                <Message.Header>\n                    <FormattedMessage id=\"error.error\" defaultMessage={'Error'}/>\n                </Message.Header>\n                <p>{props.message}</p>\n            </Message>\n        </Portal>\n    );\n}\n\nenum AppState {\n    INITIAL,\n    LOADING,\n    ERROR,\n    SHOWING_CHART,\n    LOADING_MORE,\n}\n\ntype DataSourceSpec =\n    | UrlSourceSpec\n    | UploadSourceSpec\n    | EmbeddedSourceSpec;\n\n/**\n * Arguments passed to the application, primarily through URL parameters.\n * Non-optional arguments get populated with default values.\n */\ninterface Arguments {\n    sourceSpec?: DataSourceSpec;\n    selection?: IndiInfo;\n    chartType: ChartType;\n    standalone: boolean;\n    freezeAnimation: boolean;\n    showSidePanel: boolean;\n    config: Config;\n}\n\nfunction getParamFromSearch(name: string, search: queryString.ParsedQuery) {\n    const value = search[name];\n    return typeof value === 'string' ? value : undefined;\n}\n\n/**\n * Retrieve arguments passed into the application through the URL and uploaded\n * data.\n */\nfunction getArguments(location: H.Location<any>): Arguments {\n    const search = queryString.parse(location.search);\n    const getParam = (name: string) => getParamFromSearch(name, search);\n    const view = getParam('view');\n    const chartTypes = new Map<string | undefined, ChartType>([\n        ['hourglass', ChartType.Hourglass],\n    ]);\n\n    const hash = getParam('file');\n    const url = getParam('url');\n    const embedded = getParam('embedded') === 'true'; // False by default.\n    let sourceSpec: DataSourceSpec | undefined = undefined;\n    if (staticUrl) {\n        sourceSpec = {\n            source: DataSourceEnum.GEDCOM_URL,\n            url: staticUrl,\n            handleCors: false,\n        };\n    } else if (hash) {\n        sourceSpec = {\n            source: DataSourceEnum.UPLOADED,\n            hash,\n            gedcom: location.state && location.state.data,\n            images: location.state && location.state.images,\n        };\n    } else if (url) {\n        sourceSpec = {\n            source: DataSourceEnum.GEDCOM_URL,\n            url,\n            handleCors: getParam('handleCors') !== 'false', // True by default.\n        };\n    } else if (embedded) {\n        sourceSpec = {source: DataSourceEnum.EMBEDDED};\n    }\n\n    const indi = getParam('indi');\n    const parsedGen = Number(getParam('gen'));\n    const selection = indi\n        ? {id: indi, generation: !isNaN(parsedGen) ? parsedGen : 0}\n        : undefined;\n\n    return {\n        sourceSpec,\n        selection,\n        // Hourglass is the default view.\n        chartType: chartTypes.get(view) || ChartType.Hourglass,\n        showSidePanel: getParam('sidePanel') !== 'false', // True by default.\n        standalone: getParam('standalone') !== 'false' && !embedded && !staticUrl,\n        freezeAnimation: getParam('freeze') === 'true', // False by default\n        config: argsToConfig(search),\n    };\n}\n\nexport function App() {\n    /** State of the application. */\n    const [state, setState] = useState<AppState>(AppState.INITIAL);\n    /** Loaded data. */\n    const [data, setData] = useState<TopolaData>();\n    /** Selected individual. */\n    const [selection, setSelection] = useState<IndiInfo>();\n    /** Error to display. */\n    const [error, setError] = useState<string>();\n    /** Whether the side panel is shown. */\n    const [showSidePanel, setShowSidePanel] = useState(false);\n    /** Whether the app is in standalone mode, i.e. showing 'open file' menus. */\n    const [standalone, setStandalone] = useState(true);\n    /** Type of displayed chart. */\n    const [chartType, setChartType] = useState<ChartType>(ChartType.Hourglass);\n    /** Whether to show the error popup. */\n    const [showErrorPopup, setShowErrorPopup] = useState(false);\n    /** Specification of the source of the data. */\n    const [sourceSpec, setSourceSpec] = useState<DataSourceSpec>();\n    /** Freeze animations after initial chart render. */\n    const [freezeAnimation, setFreezeAnimation] = useState(false);\n    const [config, setConfig] = useState(DEFAULT_CONFIG);\n\n    const intl = useIntl();\n    const history = useHistory();\n    const location = useLocation();\n\n    /** Sets the state with a new individual selection and chart type. */\n    function updateDisplay(newSelection: IndiInfo) {\n        if (!selection || selection.id !== newSelection.id || selection!.generation !== newSelection.generation) {\n            setSelection(newSelection);\n        }\n    }\n\n    function toggleDetails(config: Config, data: TopolaData | undefined) {\n        if (data === undefined) {\n            return;\n        }\n        let shouldHideIds = config.id === Ids.HIDE;\n        let shouldHideSex = config.sex === Sex.HIDE;\n        let indiMap = idToIndiMap(data.chartData);\n        indiMap.forEach((indi) => {\n            indi.hideId = shouldHideIds;\n            indi.hideSex = shouldHideSex;\n        });\n    }\n\n    /** Sets error message after data load failure. */\n    function setErrorMessage(message: string) {\n        setError(message);\n        setState(AppState.ERROR);\n    }\n\n    const uploadedDataSource = new UploadedDataSource();\n    const gedcomUrlDataSource = new GedcomUrlDataSource();\n    const embeddedDataSource = new EmbeddedDataSource();\n\n    function isNewData(newSourceSpec: DataSourceSpec, newSelection?: IndiInfo) {\n        if (!sourceSpec || sourceSpec.source !== newSourceSpec.source) {\n            // New data source means new data.\n            return true;\n        }\n        const newSource = {spec: newSourceSpec, selection: newSelection};\n        const oldSource = {\n            spec: sourceSpec,\n            selection: selection,\n        };\n        switch (newSource.spec.source) {\n            case DataSourceEnum.UPLOADED:\n                return uploadedDataSource.isNewData(\n                    newSource as SourceSelection<UploadSourceSpec>,\n                    oldSource as SourceSelection<UploadSourceSpec>,\n                    data,\n                );\n            case DataSourceEnum.GEDCOM_URL:\n                return gedcomUrlDataSource.isNewData(\n                    newSource as SourceSelection<UrlSourceSpec>,\n                    oldSource as SourceSelection<UrlSourceSpec>,\n                    data,\n                );\n            case DataSourceEnum.EMBEDDED:\n                return embeddedDataSource.isNewData(\n                    newSource as SourceSelection<EmbeddedSourceSpec>,\n                    oldSource as SourceSelection<EmbeddedSourceSpec>,\n                    data,\n                );\n        }\n    }\n\n    function loadData(newSourceSpec: DataSourceSpec, newSelection?: IndiInfo) {\n        switch (newSourceSpec.source) {\n            case DataSourceEnum.UPLOADED:\n                return uploadedDataSource.loadData({\n                    spec: newSourceSpec,\n                    selection: newSelection,\n                });\n            case DataSourceEnum.GEDCOM_URL:\n                return gedcomUrlDataSource.loadData({\n                    spec: newSourceSpec,\n                    selection: newSelection,\n                });\n            case DataSourceEnum.EMBEDDED:\n                return embeddedDataSource.loadData({\n                    spec: newSourceSpec,\n                    selection: newSelection,\n                });\n        }\n    }\n\n    useEffect(() => {\n        const rootElement = document.getElementById('root');\n        if (location.pathname === '/') {\n            // @ts-ignore\n            rootElement.classList.add('bgLogo');\n        } else {\n            // @ts-ignore\n            rootElement.classList.remove('bgLogo');\n        }\n\n        (async () => {\n            if (location.pathname !== '/view') {\n                if (state !== AppState.INITIAL) {\n                    setState(AppState.INITIAL);\n                }\n                return;\n            }\n\n            const args = getArguments(location);\n            if (!args.sourceSpec) {\n                history.replace({pathname: '/'});\n                return;\n            }\n\n            if (\n                state === AppState.INITIAL || isNewData(args.sourceSpec, args.selection)\n            ) {\n                // Set loading state.\n                setState(AppState.LOADING);\n                // Set state from URL parameters.\n                setSourceSpec(args.sourceSpec);\n                setSelection(args.selection);\n                setStandalone(args.standalone);\n                setChartType(args.chartType);\n                setFreezeAnimation(args.freezeAnimation);\n                setConfig(args.config);\n                try {\n                    const data = await loadData(args.sourceSpec, args.selection);\n                    // Set state with data.\n                    setData(data);\n                    toggleDetails(args.config, data);\n                    setShowSidePanel(args.showSidePanel);\n                    setState(AppState.SHOWING_CHART);\n                } catch (error: any) {\n                    setErrorMessage(getI18nMessage(error, intl));\n                }\n            } else if (\n                state === AppState.SHOWING_CHART || state === AppState.LOADING_MORE\n            ) {\n                // Update selection if it has changed in the URL.\n                setChartType(args.chartType);\n                setState(AppState.SHOWING_CHART);\n                updateDisplay(args.selection!);\n            }\n        })();\n    });\n\n    function updateUrl(args: queryString.ParsedQuery<any>) {\n        const search = queryString.parse(location.search);\n        for (const key in args) {\n            search[key] = args[key];\n        }\n        location.search = queryString.stringify(search);\n        history.push(location);\n    }\n\n    /**\n     * Called when the user clicks an individual box in the chart. Updates the browser URL.\n     */\n    function onSelection(selection: IndiInfo) {\n        updateUrl({\n            indi: selection.id,\n            gen: selection.generation,\n        });\n    }\n\n    function displayErrorPopup(message: string) {\n        setShowErrorPopup(true);\n        setError(message);\n    }\n\n    async function onDownloadPdf() {\n        try {\n            await downloadPdf();\n        } catch (e) {\n            displayErrorPopup(\n                intl.formatMessage({\n                    id: 'error.failed_pdf',\n                    defaultMessage:\n                        'Failed to generate PDF file.' +\n                        ' Please try with a smaller diagram or download an SVG file.',\n                }),\n            );\n        }\n    }\n\n    async function onDownloadPng() {\n        try {\n            await downloadPng();\n        } catch (e) {\n            displayErrorPopup(\n                intl.formatMessage({\n                    id: 'error.failed_png',\n                    defaultMessage:'Failed to generate PNG file. Please try with a smaller diagram or download an SVG file.'\n                }),\n            );\n        }\n    }\n\n    function onDownloadSvg() {\n        downloadSvg();\n    }\n\n    function onCenterView() {\n        const startIndi: IndiInfo = {\n            id: data?.chartData?.indis?.[0]?.id || 'I0',\n            generation: 0,\n        };\n        onSelection(startIndi)\n    }\n\n    function onDismissErrorPopup() {\n        setShowErrorPopup(false);\n    }\n\n    function renderMainArea() {\n        switch (state) {\n            case AppState.SHOWING_CHART:\n            case AppState.LOADING_MORE:\n                const updatedSelection = getSelection(data!.chartData, selection);\n                const sidePanelTabs = [\n                    {\n                        menuItem: intl.formatMessage({\n                            id: 'tab.info',\n                            defaultMessage: 'Info',\n                        }),\n                        render: () => (\n                            <Details gedcom={data!.gedcom} indi={updatedSelection.id}/>\n                        ),\n                    },\n                    {\n                        menuItem: intl.formatMessage({\n                            id: 'tab.settings',\n                            defaultMessage: 'Settings',\n                        }),\n                        render: () => (\n                            <ConfigPanel\n                                config={config}\n                                onChange={(config) => {\n                                    setConfig(config);\n                                    toggleDetails(config, data);\n                                    updateUrl(configToArgs(config));\n                                }}\n                            />\n                        ),\n                    },\n                ];\n                return (\n                    <div id=\"content\">\n                        <ErrorPopup\n                            open={showErrorPopup}\n                            message={error}\n                            onDismiss={onDismissErrorPopup}\n                        />\n                        {state === AppState.LOADING_MORE ? (\n                            <Loader active size=\"small\" className=\"loading-more\"/>\n                        ) : null}\n                        <Chart\n                            data={data!.chartData}\n                            selection={updatedSelection}\n                            chartType={chartType}\n                            onSelection={onSelection}\n                            freezeAnimation={freezeAnimation}\n                            colors={config.color}\n                            hideIds={config.id}\n                            hideSex={config.sex}\n                        />\n                        {showSidePanel ? (\n                            <Media greaterThanOrEqual=\"large\" className=\"sidePanel\">\n                                <Tab panes={sidePanelTabs}/>\n                            </Media>\n                        ) : null}\n                    </div>\n                );\n            case AppState.ERROR:\n                return <ErrorMessage message={error!}/>;\n            case AppState.INITIAL:\n            case AppState.LOADING:\n                return <Loader active size=\"large\"/>;\n        }\n    }\n\n    return (\n        <>\n            <Route\n                render={() => (\n                    <TopBar\n                        data={data?.chartData}\n                        showingChart={\n                            history.location.pathname === '/view' &&\n                            (state === AppState.SHOWING_CHART || state === AppState.LOADING_MORE)\n                        }\n                        standalone={standalone}\n                        eventHandlers={{\n                            onSelection,\n                            onDownloadPdf,\n                            onDownloadPng,\n                            onDownloadSvg,\n                            onCenterView,\n                        }}\n                    />\n                )}\n            />\n            {staticUrl ? (\n                <Switch>\n                    <Route exact path=\"/view\" render={renderMainArea}/>\n                    <Redirect to={'/view'}/>\n                </Switch>\n            ) : (\n                <Switch>\n                    <Route exact path=\"/view\" render={renderMainArea}/>\n                    <Redirect to={'/'}/>\n                </Switch>\n            )}\n        </>\n    );\n}\n\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport messages_de from './translations/de.json';\nimport messages_fr from './translations/fr.json';\nimport messages_it from './translations/it.json';\nimport messages_es from './translations/es.json';\nimport messages_pl from './translations/pl.json';\nimport {App} from './app';\nimport {detect} from 'detect-browser';\nimport {HashRouter as Router, Route} from 'react-router-dom';\nimport {IntlProvider} from 'react-intl';\nimport {MediaContextProvider, mediaStyles} from './util/media';\nimport './index.css';\nimport 'semantic-ui-css/semantic.min.css';\nimport 'canvas-toBlob';\n\nconst messages = {\n    de: messages_de,\n    fr: messages_fr,\n    it: messages_it,\n    es: messages_es,\n    pl: messages_pl\n};\nconst language = navigator.language && navigator.language.split(/[-_]/)[0];\nconst browser = detect();\n\nif (browser && browser.name === 'ie') {\n    ReactDOM.render(\n        <p>Genealogy Viewer does not support Internet Explorer. Please try a different (modern) browser.</p>,\n        document.querySelector('#root'),\n    );\n} else {\n    ReactDOM.render(\n        <IntlProvider locale={language} messages={messages[language]}>\n            <MediaContextProvider>\n                <style>{mediaStyles}</style>\n                <Router>\n                    <Route component={App}/>\n                </Router>\n            </MediaContextProvider>\n        </IntlProvider>,\n        document.querySelector('#root'),\n    );\n}\n","import {Date as TopolaDate, DateOrRange, DateRange, getDate} from 'topola';\nimport {IntlShape} from 'react-intl';\n\nconst DATE_QUALIFIERS = new Map([\n    ['abt', 'about'],\n    ['cal', 'calculated'],\n    ['est', 'estimated'],\n]);\n\nfunction formatDate(date: TopolaDate, intl: IntlShape) {\n    const hasDay = date.day !== undefined;\n    const hasMonth = date.month !== undefined;\n    const hasYear = date.year !== undefined;\n    if (!hasDay && !hasMonth && !hasYear) {\n        return date.text || '';\n    }\n    const dateObject = toDateObject(date);\n    const translatedQualifier = formatDateQualifier(date.qualifier, intl);\n\n    const formatOptions: Intl.DateTimeFormatOptions = {\n        day: hasDay ? 'numeric' : undefined,\n        month: hasMonth ? 'long' : undefined,\n        year: hasYear ? 'numeric' : undefined,\n    };\n    const translatedDate = new Intl.DateTimeFormat(\n        intl.locale,\n        formatOptions,\n    ).format(dateObject);\n\n    return [translatedQualifier, translatedDate]\n        .filter((dateElement) => dateElement)\n        .join(' ');\n}\n\nfunction formatDateRage(dateRange: DateRange, intl: IntlShape) {\n    const fromDate = dateRange.from;\n    const toDate = dateRange.to;\n    const translatedFromDate = fromDate && formatDate(fromDate, intl);\n    const translatedToDate = toDate && formatDate(toDate, intl);\n    if (translatedFromDate && translatedToDate) {\n        return intl.formatMessage(\n            {\n                id: 'date.between',\n                defaultMessage: 'between {from} and {to}',\n            },\n            {from: translatedFromDate, to: translatedToDate},\n        );\n    }\n    if (translatedFromDate) {\n        return intl.formatMessage(\n            {\n                id: 'date.after',\n                defaultMessage: 'after {from}',\n            },\n            {from: translatedFromDate},\n        );\n    }\n    if (translatedToDate) {\n        return intl.formatMessage(\n            {\n                id: 'date.before',\n                defaultMessage: 'before {to}',\n            },\n            {to: translatedToDate},\n        );\n    }\n    return '';\n}\n\nexport function formatDateQualifier(\n    qualifier: string | undefined,\n    intl: IntlShape,\n): string {\n    const lowerCaseQualifier = qualifier && qualifier.toLowerCase();\n    return (\n        (lowerCaseQualifier &&\n            intl.formatMessage({\n                id: `date.${lowerCaseQualifier}`,\n                defaultMessage:\n                    DATE_QUALIFIERS.get(lowerCaseQualifier) || lowerCaseQualifier,\n            })) ||\n        ''\n    );\n}\n\n/** Formats a DateOrRange object. */\nexport function formatDateOrRange(\n    dateOrRange: DateOrRange | undefined,\n    intl: IntlShape,\n): string {\n    if (!dateOrRange) {\n        return '';\n    }\n    if (dateOrRange.date) {\n        return formatDate(dateOrRange.date, intl);\n    }\n    if (dateOrRange.dateRange) {\n        return formatDateRage(dateOrRange.dateRange, intl);\n    }\n    return '';\n}\n\n/** Formats a date given in GEDCOM format. */\nexport function translateDate(gedcomDate: string, intl: IntlShape): string {\n    return formatDateOrRange(getDate(gedcomDate), intl);\n}\n\nexport function compareTopolaDates(\n    date1: TopolaDate | undefined,\n    date2: TopolaDate | undefined,\n): number {\n    if (!date1 || !date1.year || !date2 || !date2.year) {\n        return 0;\n    }\n    if (date1.year !== date2.year) {\n        return date1.year - date2.year;\n    }\n    if (!date1.month || !date2.month) {\n        return 0;\n    }\n    if (date1.month !== date2.month) {\n        return date1.month - date2.month;\n    }\n    if (date1.day && date2.day && date1.day !== date2.day) {\n        return date1.month - date2.month;\n    }\n    return 0;\n}\n\n/** Compares a dates given in GEDCOM format. */\nexport function compareDates(\n    firstDateOrRange: DateOrRange | undefined,\n    secondDateOrRange: DateOrRange | undefined,\n): number {\n    const date1 =\n        firstDateOrRange &&\n        (firstDateOrRange.date ||\n            (firstDateOrRange.dateRange &&\n                (firstDateOrRange.dateRange.from || firstDateOrRange.dateRange.to)));\n    const date2 =\n        secondDateOrRange &&\n        (secondDateOrRange.date ||\n            (secondDateOrRange.dateRange &&\n                (secondDateOrRange.dateRange.from || secondDateOrRange.dateRange.to)));\n    return compareTopolaDates(date1, date2);\n}\n\nexport function areDateRangesOverlapped(\n    range1: DateRange,\n    range2: DateRange,\n): boolean {\n    return (\n        compareTopolaDates(range1.from, range2.to) <= 0 &&\n        compareTopolaDates(range1.to, range2.from) >= 0\n    );\n}\n\nexport function isValidDateOrRange(\n    dateOrRange: DateOrRange | undefined,\n): boolean {\n    // invalid when range is closed and start is before end\n    if (isDateRangeClosed(dateOrRange?.dateRange)) {\n        return (\n            compareTopolaDates(\n                dateOrRange?.dateRange?.from,\n                dateOrRange?.dateRange?.to,\n            ) <= 0\n        );\n    }\n    //valid when there is exact date or date range has start or end defined\n    return !!(\n        dateOrRange?.date ||\n        dateOrRange?.dateRange?.from ||\n        dateOrRange?.dateRange?.to\n    );\n}\n\nexport function isDateRangeClosed(range: DateRange | undefined): boolean {\n    return !!(range?.from && range?.to);\n}\n\nexport function toDateObject(date: TopolaDate): Date {\n    return new Date(\n        date.year !== undefined ? date.year! : 0,\n        date.month !== undefined ? date.month! - 1 : 0,\n        date.day !== undefined ? date.day! : 1,\n    );\n}\n","import {convertGedcom, TopolaData} from '../util/gedcom_util';\nimport {DataSource, DataSourceEnum, SourceSelection} from './data_source';\nimport {IndiInfo, JsonGedcomData} from 'topola';\nimport {TopolaError} from '../util/error';\nimport AdmZip from 'adm-zip';\n\n/**\n * Returns a valid IndiInfo object, either with the given indi and generation\n * or with an individual taken from the data and generation 0.\n */\nexport function getSelection(\n    data: JsonGedcomData,\n    selection?: IndiInfo,\n): IndiInfo {\n    // If ID is not given, or it doesn't exist in the data, use the first ID in the data.\n    const id =\n        selection && data.indis.some((i) => i.id === selection.id)\n            ? selection.id\n            : data.indis[0].id;\n    return {id, generation: selection?.generation || 0};\n}\n\nfunction prepareData(\n    gedcom: string,\n    cacheId: string,\n    images?: Map<string, string>,\n): TopolaData {\n    const data = convertGedcom(gedcom, images || new Map());\n    const serializedData = JSON.stringify(data);\n    try {\n        sessionStorage.setItem(cacheId, serializedData);\n    } catch (e) {\n        console.warn('Failed to store data in session storage: ' + e);\n    }\n    return data;\n}\n\nasync function loadGedzip(\n    blob: Blob,\n): Promise<{ gedcom: string; images: Map<string, string> }> {\n    const zip = new AdmZip(Buffer.from(await blob.arrayBuffer()));\n    const entries = zip.getEntries();\n    let gedcom = undefined;\n    const images = new Map<string, string>();\n    for (const entry of entries) {\n        if (entry.entryName.endsWith('.ged')) {\n            if (gedcom) {\n                console.warn('Multiple GEDCOM files found in zip archive.');\n            } else {\n                gedcom = entry.getData().toString();\n            }\n        } else {\n            // Save image for later.\n            images.set(\n                entry.entryName,\n                URL.createObjectURL(new Blob([entry.getData()])),\n            );\n        }\n    }\n    if (!gedcom) {\n        throw new Error('GEDCOM file not found in zip archive.');\n    }\n    return {gedcom, images};\n}\n\nexport async function loadFile(blob: Blob): Promise<{ gedcom: string; images: Map<string, string> }> {\n    const fileHeader = await blob.slice(0, 2).text();\n    if (fileHeader === 'PK') {\n        return loadGedzip(blob);\n    }\n    return {gedcom: await blob.text(), images: new Map()};\n}\n\n/** Fetches data from the given URL. Uses cors-anywhere if handleCors is true. */\nexport async function loadFromUrl(\n    url: string,\n    handleCors: boolean,\n): Promise<TopolaData> {\n    try {\n        const cachedData = sessionStorage.getItem(url);\n        if (cachedData) {\n            return JSON.parse(cachedData);\n        }\n    } catch (e) {\n        console.warn('Failed to load data from session storage: ' + e);\n    }\n    const driveUrlMatch1 = url.match(/https:\\/\\/drive\\.google\\.com\\/file\\/d\\/(.*)\\/.*/);\n    if (driveUrlMatch1) {\n        url = `https://drive.google.com/uc?id=${driveUrlMatch1[1]}&export=download`;\n    }\n    const driveUrlMatch2 = url.match(/https:\\/\\/drive\\.google\\.com\\/open\\?id=([^&]*)&?.*/);\n    if (driveUrlMatch2) {\n        url = `https://drive.google.com/uc?id=${driveUrlMatch2[1]}&export=download`;\n    }\n    const urlToFetch = handleCors ? 'https://topolaproxy.bieda.it/' + url : url;\n    const response = await window.fetch(urlToFetch);\n    if (response.status !== 200) {\n        throw new Error(response.statusText);\n    }\n    const {gedcom, images} = await loadFile(await response.blob());\n    return prepareData(gedcom, url, images);\n}\n\n/** Loads data from the given GEDCOM file contents. */\nexport async function loadGedcom(\n    hash: string,\n    gedcom?: string,\n    images?: Map<string, string>,\n): Promise<TopolaData> {\n    try {\n        const cachedData = sessionStorage.getItem(hash);\n        if (cachedData) {\n            return JSON.parse(cachedData);\n        }\n    } catch (e) {\n        console.warn('Failed to load data from session storage: ' + e);\n    }\n    if (!gedcom) {\n        throw new TopolaError(\n            'ERROR_LOADING_UPLOADED_FILE',\n            'Error loading data. Please upload your file again.',\n        );\n    }\n    return prepareData(gedcom, hash, images);\n}\n\nexport interface UploadSourceSpec {\n    source: DataSourceEnum.UPLOADED;\n    gedcom?: string;\n    /** Hash of the GEDCOM contents. */\n    hash: string;\n    images?: Map<string, string>;\n}\n\n/** Files opened from the local computer. */\nexport class UploadedDataSource implements DataSource<UploadSourceSpec> {\n    // isNewData(args: Arguments, state: State): boolean {\n    isNewData(\n        newSource: SourceSelection<UploadSourceSpec>,\n        oldSource: SourceSelection<UploadSourceSpec>,\n        data?: TopolaData,\n    ): boolean {\n        return newSource.spec.hash !== oldSource.spec.hash;\n    }\n\n    async loadData(\n        source: SourceSelection<UploadSourceSpec>,\n    ): Promise<TopolaData> {\n        try {\n            return await loadGedcom(\n                source.spec.hash,\n                source.spec.gedcom,\n                source.spec.images,\n            );\n        } catch (error) {\n            throw error;\n        }\n    }\n}\n\nexport interface UrlSourceSpec {\n    source: DataSourceEnum.GEDCOM_URL;\n    /** URL of the data that is loaded or is being loaded. */\n    url: string;\n    handleCors: boolean;\n}\n\n/** GEDCOM file loaded by pointing to a URL. */\nexport class GedcomUrlDataSource implements DataSource<UrlSourceSpec> {\n    isNewData(\n        newSource: SourceSelection<UrlSourceSpec>,\n        oldSource: SourceSelection<UrlSourceSpec>,\n        data?: TopolaData,\n    ): boolean {\n        return newSource.spec.url !== oldSource.spec.url;\n    }\n    async loadData(source: SourceSelection<UrlSourceSpec>): Promise<TopolaData> {\n        try {\n            return await loadFromUrl(source.spec.url, source.spec.handleCors);\n        } catch (error) {\n            throw error;\n        }\n    }\n}\n"],"sourceRoot":""}