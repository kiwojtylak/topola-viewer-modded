{"version":3,"sources":["datasource/load_data.ts","lib/topola/dist/chart-util.js","util/error.ts","lib/topola/dist/id-generator.js","lib/topola/dist/kinship/api.js","lib/topola/dist/kinship/hierarchy-filter.js","lib/topola/dist/ancestor-chart.js","lib/topola/dist/composite-renderer.js","lib/topola/dist/descendant-chart.js","util/gedcom_util.ts","lib/topola/dist/utils.js","lib/topola/dist/data.js","lib/topola/dist/date-format.js","lib/topola/dist/index.js","lib/topola/dist/api.js","lib/topola/dist/detailed-renderer.js","lib/topola/dist/gedcom.js","lib/topola/dist/hourglass-chart.js","lib/topola/dist/kinship-chart.js","lib/topola/dist/kinship/renderer.js","lib/topola/dist/kinship/hierarchy-creator.js","lib/topola/dist/relatives-chart.js","lib/topola/dist/simple-api.js","lib/topola/dist/simple-renderer.js","datasource/data_source.ts","details/translated-tag.tsx","details/wrapped-image.tsx","details/multiline-text.tsx","details/event-extras.tsx","details/events.tsx","details/details.tsx","datasource/embedded.ts","util/error_i18n.ts","menu/menu_item.tsx","util/media.ts","menu/search_index.ts","menu/search.tsx","menu/upload_menu.tsx","menu/top_bar.tsx","menu/url_menu.tsx","config.tsx","chart.tsx","app.tsx","index.tsx","util/date_util.ts"],"names":["getSelection","data","selection","id","indis","some","i","generation","prepareData","gedcom","cacheId","images","convertGedcom","Map","serializedData","JSON","stringify","sessionStorage","setItem","e","console","warn","loadGedzip","blob","a","AdmZip","Buffer","arrayBuffer","from","zip","entries","getEntries","undefined","entry","entryName","endsWith","getData","toString","set","URL","createObjectURL","Blob","Error","loadFile","slice","text","loadFromUrl","url","handleCors","cachedData","getItem","parse","driveUrlMatch1","match","driveUrlMatch2","urlToFetch","window","fetch","response","status","statusText","loadGedcom","hash","TopolaError","UploadedDataSource","newSource","oldSource","spec","source","GedcomUrlDataSource","Object","defineProperty","exports","value","ChartUtil","getChartInfoWithoutMargin","getChartInfo","linkId","V_SPACING","H_SPACING","d3_selection_1","require","d3_flextree_1","d3_array_1","HIDE_TIME_MS","MOVE_TIME_MS","node","parent","_a","child","additionalMarriage","nodes","x0","min","d","x","width","y0","y","height","size","max","origin","options","this","prototype","linkHorizontal","s","sAnchor","renderer","getFamilyAnchor","dAnchor","spouseParentNodeId","getSpouseAnchor","getIndiAnchor","sx","sy","_b","dx","dy","midX","linkVertical","midY","linkAdditionalMarriage","nodeIndex","children","findIndex","n","siblingNode","updateSvgDimensions","chartInfo","group","select","svgSelector","animate","transition","delay","duration","attr","layOutChart","root","layoutOptions","_this","svg","empty","append","getCss","each","depth","flipVertically","baseGeneration","updateNodes","descendants","vSizePerDepth","maxVSize","horizontal","get","vSize","vSpacing","hSpacing","flextree","nodeSize","maxChildSize_1","maxChildSize","spacing","treemap","forEach","renderChart","getSvgForRendering","nodeAnimation","renderNodes","linkAnimation","renderLinks","Promise","all","resolve","boundNodes","selectAll","nodeEnter","enter","transitionsPending","exit","transitionDone","merge","style","on","render","remove","link","links","filter","boundLinks","path","insert","code","message","args","IdGenerator","ids","getId","has","num","otherSideLinkType","LinkType","ChildNodes","overrides","indiParents","indiSiblings","spouseParents","spouseSiblings","assign","type","IndiParents","IndiSiblings","SpouseParents","SpouseSiblings","Children","getAll","concat","EMPTY","HierarchyFilter","modify","allAccepting","allRejecting","__assign","t","arguments","length","p","hasOwnProperty","call","apply","AncestorChart","getAncestorsTree","chart_util_1","d3_hierarchy_1","id_generator_1","ancestorChartOptions","startIndiFamilies","startIndi","getIndi","getFamiliesAsSpouse","startFam","getFam","getMother","swapStartSpouses","ancestorsRoot","createHierarchy","pop","util","famc","parents","stack","idGenerator","getFamilyAsChild","push","parentId","family","indi","indiParentNodeId","fam","getFather","father","mother","spouse","stratify","animationPromise","info","getFamPositionHorizontal","getFamPositionVertical","CompositeRenderer","getPreferredFamSize","setPreferredIndiSize","getPreferredIndiSize","indiVSizePerDepth","maxIndiVSize","getIndiVSize","getFamVSize","getVSize","hSize","indiHSize","getHSize","x_1","famYOffset","famXOffset","indiWidth","spouseWidth","familyWidth","indiHeight","spouseHeight","familyHeight","DescendantChart","layOutDescendants","DUMMY_ROOT_NODE_ID","removeDummyNode","allNodes","descendantsRoot","getNodes","famIds","map","famId","indiId","getSpouse","getFamNode","dummyNode_1","_loop_1","this_1","getChildren","childId","childNodes","pointerToId","pointer","substring","idToIndiMap","idToFamMap","fams","prepareGedcom","head","find","tag","other","strcmp","b","sortChildren","comparator","indiMap","indiId1","indiId2","indi1","indi2","compareDates","birth","birthDatesComparator","newFams","newChildren","sort","sortFamilyChildren","sortSpouses","famMap","famId1","famId2","fam1","fam2","marriage","marriageDatesComparator","newIndis","sortIndiSpouses","dereference","getterFunction","dereferenced","result","tree","subentry","last","normalizeGedcom","IMAGE_EXTENSIONS","isImageFile","fileName","lowerName","toLowerCase","ext","filterImages","newImages","image","filePath","replaceAll","title","startsWith","filterImage","parseGedcom","json","gedcomEntriesToJson","chartData","getName","person","names","subEntry","name","nameEntry","replace","getFileName","fileEntry","fileTitle","fileExtension","getImageFileEntry","objectEntry","points2pathd","nonEmpty","array","points","_i","JsonDataProvider","JsonIndiDetails","isEgo","getFirstName","firstName","getLastName","lastName","getBirthDate","getMaidenName","maidenName","getNumberOfChildren","numberOfChildren","getNumberOfMarriages","numberOfMarriages","getBirthPlace","place","getDeathDate","death","getDeathPlace","isConfirmedDeath","confirmed","getSex","sex","getLanguages","languages","getLanguagesLabel","abbreviations","lang","toUpperCase","join","getTribe","tribe","getImageUrl","getImages","getNotes","notes","getEvents","events","showLanguages","hideLanguages","showTribe","hideTribe","showId","hideId","showSex","hideSex","JsonFamDetails","husb","wife","getMarriageDate","getMarriagePlace","formatDateOrRange","formatDate","MONTHS_EN","QUALIFIERS_I18N","shortMonthCache","getShortMonth","month","locale","Intl","DateTimeFormat","cacheKey","format","Date","getQualifier","qualifier","language","split","languageMap","formatDateOnly","day","year","date","dateOrRange","dateRange","to","__createBinding","create","o","m","k","k2","enumerable","__exportStar","ChartColors","__extends","extendStatics","setPrototypeOf","__proto__","Array","TypeError","String","__","constructor","DetailedRenderer","getLength","_1","date_format_1","composite_renderer_1","DETAILS_HEIGHT","textLengthCache","textClass","g","getComputedTextLength","SEX_SYMBOLS","_super","getColoringClass","colors","NO_COLOR","COLOR_BY_GENERATION","COLOR_BY_SEX","COLOR_BY_TRIBE","COLOR_BY_LANGUAGES","getIndiDetails","detailsList","birthDate","birthPlace","deathDate","deathPlace","symbol","listIndex","details","tribeHeight","languagesHeight","idAndSexHeight","maxDetailsWidth","detail","getFamDetails","marriageDate","marriagePlace","update","indiUpdate","xOffset","yOffset","indiEnter","renderIndi","familyEnter","familyUpdate","getFamTransform","renderFamily","getSexClass","tribes_css","getTribeClass","startIndex","getLanguagesClass","indiHrefFunc","indiCallback","event","background","getClipId","getDetailsWidth","languages_height_start","tribe_height_start","maxDetails","values","v","details_height_start","_loop_2","lineGroup","sexSymbol","border","famHrefFunc","famCallback","gedcomToJson","getDate","parse_gedcom_1","findTag","findTags","extractName","arr","trim","MONTHS","parseDate","parts","lastPart","fullText","firstPart","Number","gedcomDate","date_1","createNotes","notesTag","reduce","createEvent","typeTag","dateTag","placeTag","createFam","husbTag","wifeTag","objects","ego","nameTags","isMaiden","nameTag","main","maiden","nchiTag","nmrTag","sexTag","tribeTag","famcTag","objeTags","realObjeTag","file","createIndi","gedcomContents","HourglassChart","ancestor_chart_1","descendant_chart_1","ancestorNodes","descendantNodes","KinshipChart","renderer_1","hierarchy_creator_1","KinshipChartRenderer","hierarchy","HierarchyCreator","EntryId","layOut","upRoot","downRoot","upNodes","downNodes","setChildNodesGenerationNumber","getRootsCount","getChildNodesByType","setGenerationNumber","EMPTY_HIERARCHY_TREE_NODES","childNodesById","nodeToHNode","__spreadArray","il","j","api_1","utils_1","rootsCount","allNodesDeduped","setLinkYs","renderRootDummyAdditionalMarriageLinkStub","svgg","keyFn","boundLinkNodes","cssClassForLink","linkPoints","primaryMarriage","additionalMarriageLinkPoints","linkFromParentType","boundLinkStubNodes","duplicateOf","duplicated","linkStubNodesEnter","boundLinkStubs","nodeToLinkStubRenderInfos","linkType","cssClassForLinkStub","treeDir","fromNode","cssClassForLinkType","linkStubs","isUpTree","anchorPoints","linkAnchorPoints","linkYs","getLinkY","base","offset","calcLinkOffsetDirs","indiOffsetDir","spouseOffsetDir","indiParentLinkAnchorX","spouseParentLinkAnchorX","childrenLinksX","findMinXOfChildNodesAnchors","findMaxXOfChildNodesAnchors","parentNode","findExtremeXOfChildNodesAnchors","isMin","extremeFindingFunction","dir","childNodesSet","Set","pointsFrom","pointsTo","reverse","prevSiblingNode","indiMidY","top","w","h","leftEdge","rightEdge","_c","indiW","spouseW","familyW","indisW","indisLeftEdge","indisRightEdge","siblingAnchorY","isFam","startEntryId","queuedNodesById","expandStartId","startFamIndi","famsIds","idToNode","queue","shift","UP_FILTER","DOWN_FILTER","ALL_ACCEPTING_FILTER","fillNodeData","childNode","getChildNodes","isFamNode","spouseId","childNodesForFam","childNodesForIndi","createLinkStubs","getParentsAndSiblings","indiParentsFamsIds","indiSiblingsIds","spouseParentsFamsIds","spouseSiblingsIds","childrenIds","famAsSpouseIdsToNodes","indiIdsToFamAsSpouseNodes","famcId","indiFamcId","indiFamc","parentFamsIds","unshift","siblingsIds","splice","indexOf","indiIds","childNodeType","flatMap","indiIdToFamAsSpouseNodes","isChildNodeTypeForbidden","famsNodes","idsToNodes","entryIds","duplicateCheck","entryId","areParentsAndSiblingsPresent","indiParentsPresent","indiSiblingsPresent","spouseParentsPresent","spouseSiblingsPresent","childrenPresent","flat","pmIndiId","pmSpouseId","RelativesChart","FilterChildFam","index","FilterChildData","layOutAncestorDescendants","focusedNode","ancestorData","eachAfter","descendantOptions","parentHeight","parentData","left","middle","thisNode","middleX","nodeData","indiParent","spouseParent","nodeX","nodeY","nodeWidth","nodeHeight","spouseTreeHeight","dx_1","dy_1","indiTreeHeight","dx_2","dy_2","ancestorOptions","ancestorDescentants","createChart","data_1","SimpleChartHandle","initialRender","renderOptions","chartOptions","indiUrl","famUrl","createChartOptions","chartType","updateSvgSize","setData","SimpleRenderer","getYears","birthYear","deathYear","years","Math","MIN_HEIGHT","spouseSelection","indiFunc","DataSourceEnum","TAG_DESCRIPTIONS","TranslatedTag","props","normalizedTag","defaultMessage","WrappedImage","useState","imageOpen","setImageOpen","imageLoaded","setImageLoaded","imageFailed","setImageFailed","imageSrc","setImageSrc","className","onClick","onLoad","onError","currentTarget","alt","src","filename","centered","Placeholder","Image","square","Container","fluid","textAlign","Message","negative","compact","Header","Modal","basic","closeIcon","Icon","color","open","onClose","onOpen","Content","label","Label","attached","content","wrapped","MultilineText","lines","line","properties","target","eventSources","sources","intl","List","Item","verticalAlign","author","publicationInfo","sourceElement","Description","page","EventExtras","useIntl","activeIndex","setActiveIndex","setIndi","handleTabOnClick","menuItemProps","panes","menuItem","Menu","fitted","Popup","position","trigger","circular","Tab","Pane","note","tab","renderActiveOnly","menu","tabular","borderless","PersonLink","location","useLocation","search","queryString","Meta","pathname","EVENT_TAGS","FAMILY_EVENT_TAGS","EventHeader","as","sub","familyEntry","spouseReference","familySubEntry","includes","eventPlace","eventImages","imageFileEntry","sourceEntryReference","sourceEntry","abbr","sourceData","resolveDate","eventNotes","toEvent","familyMarriageEvent","personLink","toFamilyEvents","toIndiEvent","Event","Events","eventEntry","event1","event2","EXCLUDED_TAGS","fileDetails","noteDetails","nameDetails","fullName","nameType","getDetails","tags","detailsFunction","element","hasData","getOtherDetails","dataDetails","getMultilineDetails","Details","entriesWithData","Group","divided","EmbeddedMessageType","EmbeddedDataSource","reject","PARENT_READY","postMessage","READY","GEDCOM","addEventListener","onMessage","getI18nMessage","error","formatMessage","MenuType","AppMedia","createMedia","breakpoints","small","large","mediaStyles","createMediaStyle","Media","MediaContextProvider","MenuItem","newProps","menuType","Dropdown","lunr","normalize","input","toLocaleLowerCase","compare","score","naturalSort","ref","LunrSearchIndex","self","initMultiLingualLunrWithoutTrimmer","field","boost","spouseLastName","husbId","husband","getHusbandLastName","add","normalizedName","normalizedSpouseLastName","lunrInstance","pipelineFunctions","searchPipelineFunctions","stopWordFilter","stemmer","wordCharacters","pipeline","reset","searchPipeline","query","getNameLine","SearchBar","searchResults","setSearchResults","searchString","setSearchString","searchIndex","useRef","getDescriptionLine","debouncedHandleSearch","debounce","results","current","key","description","displaySearchResult","useEffect","initialize","buildSearchIndex","Search","onSearchChange","_","onResultSelect","onSelection","noResultsMessage","placeholder","selectFirstResult","isImageFileName","lower","UploadMenu","history","useHistory","files","filesArray","gedcomFile","imageFileNames","keys","md5","state","htmlFor","accept","multiple","onChange","ScreenSize","UrlMenu","dialogOpen","setDialogOpen","setUrl","inputRef","handleLoad","focus","Form","onSubmit","Input","href","Actions","Button","secondary","primary","TopBar","chartMenus","screenSize","showingChart","LARGE","eventHandlers","onDownloadPdf","onDownloadPng","onDownloadSvg","onCenterView","SMALL","Divider","fileMenus","standalone","greaterThanOrEqual","inverted","at","icon","Languages","Tribe","Ids","Sex","DEFAULT_CONFIG","HIDE","SHOW","renderLanguagesOption","renderTribeOption","languageOptions","COLOR_ARG","COLOR_BY_NR_LANGUAGES","COLOR_BY_LANGUAGE","COLOR_ARG_INVERSE","LANGUAGES_ARG","LANGUAGES_ARG_INVERSE","TRIBE_ARG","TRIBE_ARG_INVERSE","ID_ARG","ID_ARG_INVERSE","SEX_ARG","SEX_ARG_INVERSE","argsToConfig","getParam","ConfigPanel","config","Field","Checkbox","radio","tagName","checked","ChartType","zoomed","scale","transform","offsetX","clientWidth","offsetY","clientHeight","scrollLeft","scrollTop","scrolled","zoomTransform","zoom","translateTo","loadAsDataUrl","reader","FileReader","readAsDataURL","onload","inlineImage","baseVal","inlineImages","getElementsByTagName","loadImage","drawImageOnCanvas","canvas","document","createElement","ctx","getContext","oldFill","fillStyle","fillRect","drawImage","canvasToBlob","toBlob","getStrippedSvg","getElementById","cloneNode","removeAttribute","setAttribute","getAttribute","querySelector","getSvgContentsWithInlinedImages","XMLSerializer","serializeToString","contents","saveAs","drawOnCanvas","downloadPng","downloadPdf","jspdf","default","doc","orientation","unit","addImage","save","chartColors","TopolaChartColors","ChartWrapper","chart","animating","rerenderRequired","zoomBehavior","rerenderProps","rerenderResetPosition","factor","scaleBy","resetPosition","freezeAnimation","innerHTML","zoomOutFactor","extent","scaleExtent","translateExtent","scrollTopTween","interpolateNumber","scrollLeftTween","svgTransition","tween","then","Chart","chartWrapper","prevProps","usePrevious","hideIds","AppState","staticUrl","process","REACT_APP_STATIC_URL","ErrorMessage","ErrorPopup","Portal","onDismiss","egoGen","getEgoIndi","getEgoGen","parseInt","getLanguageOptions","acc","getArguments","chartTypes","Hourglass","getParamFromSearch","view","embedded","sourceSpec","GEDCOM_URL","UPLOADED","EMBEDDED","parsedGen","isNaN","showSidePanel","messages","de","messages_de","fr","messages_fr","it","messages_it","es","messages_es","pl","messages_pl","navigator","browser","detect","ReactDOM","component","INITIAL","setState","setSelection","setError","setShowSidePanel","setStandalone","setChartType","showErrorPopup","setShowErrorPopup","setSourceSpec","setFreezeAnimation","setConfig","toggleDetails","uploadedDataSource","gedcomUrlDataSource","embeddedDataSource","isNewData","newSourceSpec","newSelection","loadData","updateUrl","gen","displayErrorPopup","downloadSvg","onDismissErrorPopup","renderMainArea","SHOWING_CHART","LOADING_MORE","updatedSelection","sidePanelTabs","c","l","configToArgs","Loader","active","ERROR","LOADING","rootElement","classList","exact","DATE_QUALIFIERS","hasDay","hasMonth","hasYear","dateObject","toDateObject","formatOptions","lowerCaseQualifier","formatDateQualifier","dateElement","fromDate","toDate","translatedFromDate","translatedToDate","formatDateRage","compareTopolaDates","date1","date2","firstDateOrRange","secondDateOrRange"],"mappings":"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","file":"static/js/main.90f6c415.chunk.js","sourcesContent":["import {convertGedcom, TopolaData} from '../util/gedcom_util';\nimport {DataSource, DataSourceEnum, SourceSelection} from './data_source';\nimport {IndiInfo, JsonGedcomData} from '../lib/topola';\nimport {TopolaError} from '../util/error';\nimport AdmZip from 'adm-zip';\n\n/**\n * Returns a valid IndiInfo object, either with the given indi and generation\n * or with an individual taken from the data and generation 0.\n */\nexport function getSelection(\n    data: JsonGedcomData,\n    selection?: IndiInfo,\n): IndiInfo {\n    // If ID is not given, or it doesn't exist in the data, use the first ID in the data.\n    const id = selection && data.indis.some((i) => i.id === selection.id)\n        ? selection.id\n        : data.indis[0].id;\n    return {id, generation: selection?.generation || 0};\n}\n\nfunction prepareData(\n    gedcom: string,\n    cacheId: string,\n    images?: Map<string, string>,\n): TopolaData {\n    const data = convertGedcom(gedcom, images || new Map());\n    const serializedData = JSON.stringify(data);\n    try {\n        sessionStorage.setItem(cacheId, serializedData);\n    } catch (e) {\n        console.warn('Failed to store data in session storage: ' + e);\n    }\n    return data;\n}\n\nasync function loadGedzip(blob: Blob): Promise<{ gedcom: string; images: Map<string, string> }> {\n    const zip = new AdmZip(Buffer.from(await blob.arrayBuffer()));\n    const entries = zip.getEntries();\n    let gedcom = undefined;\n    const images = new Map<string, string>();\n    for (const entry of entries) {\n        if (entry.entryName.endsWith('.ged')) {\n            if (gedcom) {\n                console.warn('Multiple GEDCOM files found in zip archive.');\n            } else {\n                gedcom = entry.getData().toString();\n            }\n        } else {\n            // Save image for later.\n            images.set(\n                entry.entryName,\n                URL.createObjectURL(new Blob([entry.getData()])),\n            );\n        }\n    }\n    if (!gedcom) {\n        throw new Error('GEDCOM file not found in zip archive.');\n    }\n    return {gedcom, images};\n}\n\nexport async function loadFile(blob: Blob): Promise<{ gedcom: string; images: Map<string, string> }> {\n    const fileHeader = await blob.slice(0, 2).text();\n    if (fileHeader === 'PK') {\n        return loadGedzip(blob);\n    }\n    return {gedcom: await blob.text(), images: new Map()};\n}\n\n/** Fetches data from the given URL. Uses cors-anywhere if handleCors is true. */\nexport async function loadFromUrl(\n    url: string,\n    handleCors: boolean,\n): Promise<TopolaData> {\n    try {\n        const cachedData = sessionStorage.getItem(url);\n        if (cachedData) {\n            return JSON.parse(cachedData);\n        }\n    } catch (e) {\n        console.warn('Failed to load data from session storage: ' + e);\n    }\n    const driveUrlMatch1 = url.match(/https:\\/\\/drive\\.google\\.com\\/file\\/d\\/(.*)\\/.*/);\n    if (driveUrlMatch1) {\n        url = `https://drive.google.com/uc?id=${driveUrlMatch1[1]}&export=download`;\n    }\n    const driveUrlMatch2 = url.match(/https:\\/\\/drive\\.google\\.com\\/open\\?id=([^&]*)&?.*/);\n    if (driveUrlMatch2) {\n        url = `https://drive.google.com/uc?id=${driveUrlMatch2[1]}&export=download`;\n    }\n    const urlToFetch = handleCors ? 'https://topolaproxy.bieda.it/' + url : url;\n    const response = await window.fetch(urlToFetch);\n    if (response.status !== 200) {\n        throw new Error(response.statusText);\n    }\n    const {gedcom, images} = await loadFile(await response.blob());\n    return prepareData(gedcom, url, images);\n}\n\n/** Loads data from the given GEDCOM file contents. */\nexport async function loadGedcom(\n    hash: string,\n    gedcom?: string,\n    images?: Map<string, string>,\n): Promise<TopolaData> {\n    try {\n        const cachedData = sessionStorage.getItem(hash);\n        if (cachedData) {\n            return JSON.parse(cachedData);\n        }\n    } catch (e) {\n        console.warn('Failed to load data from session storage: ' + e);\n    }\n    if (!gedcom) {\n        throw new TopolaError(\n            'ERROR_LOADING_UPLOADED_FILE',\n            'Error loading data. Please upload your file again.',\n        );\n    }\n    return prepareData(gedcom, hash, images);\n}\n\nexport interface UploadSourceSpec {\n    source: DataSourceEnum.UPLOADED;\n    gedcom?: string;\n    /** Hash of the GEDCOM contents. */\n    hash: string;\n    images?: Map<string, string>;\n}\n\n/** Files opened from the local computer. */\nexport class UploadedDataSource implements DataSource<UploadSourceSpec> {\n    isNewData(\n        newSource: SourceSelection<UploadSourceSpec>,\n        oldSource: SourceSelection<UploadSourceSpec>,\n        data?: TopolaData,\n    ): boolean {\n        return newSource.spec.hash !== oldSource.spec.hash;\n    }\n\n    async loadData(\n        source: SourceSelection<UploadSourceSpec>,\n    ): Promise<TopolaData> {\n        try {\n            return await loadGedcom(\n                source.spec.hash,\n                source.spec.gedcom,\n                source.spec.images,\n            );\n        } catch (error) {\n            throw error;\n        }\n    }\n}\n\nexport interface UrlSourceSpec {\n    source: DataSourceEnum.GEDCOM_URL;\n    /** URL of the data that is loaded or is being loaded. */\n    url: string;\n    handleCors: boolean;\n}\n\n/** GEDCOM file loaded by pointing to a URL. */\nexport class GedcomUrlDataSource implements DataSource<UrlSourceSpec> {\n    isNewData(\n        newSource: SourceSelection<UrlSourceSpec>,\n        oldSource: SourceSelection<UrlSourceSpec>,\n        data?: TopolaData,\n    ): boolean {\n        return newSource.spec.url !== oldSource.spec.url;\n    }\n    async loadData(source: SourceSelection<UrlSourceSpec>): Promise<TopolaData> {\n        try {\n            return await loadFromUrl(source.spec.url, source.spec.handleCors);\n        } catch (error) {\n            throw error;\n        }\n    }\n}\n","Object.defineProperty(exports, \"__esModule\", { value: true });\n\nexports.ChartUtil = exports.getChartInfoWithoutMargin = exports.getChartInfo = exports.linkId = exports.V_SPACING = exports.H_SPACING = void 0;\nconst d3_selection_1 = require(\"d3-selection\");\nconst d3_flextree_1 = require(\"d3-flextree\");\nconst d3_array_1 = require(\"d3-array\");\nrequire(\"d3-transition\");\n\n/** Horizontal distance between boxes. */\nexports.H_SPACING = 15;\n/** Vertical distance between boxes. */\nexports.V_SPACING = 30;\n/** Margin around the whole drawing. */\nconst MARGIN = 15;\nconst HIDE_TIME_MS = 200;\nconst MOVE_TIME_MS = 500;\n\n/** Assigns an identifier to a link. */\nfunction linkId(node) {\n    if (!node.parent) {\n        return node.id + \":A\";\n    }\n    const _a = node.data.generation > node.parent.data.generation\n        ? [node.data, node.parent.data]\n        : [node.parent.data, node.data], child = _a[0], parent = _a[1];\n    if (child.additionalMarriage) {\n        return child.id + \":A\";\n    }\n    return parent.id + \":\" + child.id;\n}\nexports.linkId = linkId;\nfunction getChartInfo(nodes) {\n    // Calculate chart boundaries.\n    const x0 = d3_array_1.min(nodes, function (d) {\n        return d.x - d.data.width / 2;\n    }) - MARGIN;\n    const y0 = d3_array_1.min(nodes, function (d) {\n        return d.y - d.data.height / 2;\n    }) - MARGIN;\n    const x1 = d3_array_1.max(nodes, function (d) {\n        return d.x + d.data.width / 2;\n    }) + MARGIN;\n    const y1 = d3_array_1.max(nodes, function (d) {\n        return d.y + d.data.height / 2;\n    }) + MARGIN;\n    return { size: [x1 - x0, y1 - y0], origin: [-x0, -y0] };\n}\nexports.getChartInfo = getChartInfo;\nfunction getChartInfoWithoutMargin(nodes) {\n    // Calculate chart boundaries.\n    const x0 = d3_array_1.min(nodes, function (d) {\n        return d.x - d.data.width / 2;\n    });\n    const y0 = d3_array_1.min(nodes, function (d) {\n        return d.y - d.data.height / 2;\n    });\n    const x1 = d3_array_1.max(nodes, function (d) {\n        return d.x + d.data.width / 2;\n    });\n    const y1 = d3_array_1.max(nodes, function (d) {\n        return d.y + d.data.height / 2;\n    });\n    return { size: [x1 - x0, y1 - y0], origin: [-x0, -y0] };\n}\nexports.getChartInfoWithoutMargin = getChartInfoWithoutMargin;\n/** Utility class with common code for all chart types. */\nlet ChartUtil = /** @class */ (function () {\n    function ChartUtil(options) {\n        this.options = options;\n    }\n    /** Creates a path from parent to the child node (horizontal layout). */\n    ChartUtil.prototype.linkHorizontal = function (s, d) {\n        const sAnchor = this.options.renderer.getFamilyAnchor(s.data);\n        const dAnchor = s.id === d.data.spouseParentNodeId\n            ? this.options.renderer.getSpouseAnchor(d.data)\n            : this.options.renderer.getIndiAnchor(d.data);\n        const _a = [s.x + sAnchor[0], s.y + sAnchor[1]], sx = _a[0], sy = _a[1];\n        const _b = [d.x + dAnchor[0], d.y + dAnchor[1]], dx = _b[0], dy = _b[1];\n        const midX = (s.x + s.data.width / 2 + d.x - d.data.width / 2) / 2;\n        return \"M \" + sx + \" \" + sy + \"\\n            L \" + midX + \" \" + sy + \",\\n              \" + midX + \" \" + dy + \",\\n              \" + dx + \" \" + dy;\n    };\n    /** Creates a path from parent to the child node (vertical layout). */\n    ChartUtil.prototype.linkVertical = function (s, d) {\n        const sAnchor = this.options.renderer.getFamilyAnchor(s.data);\n        const dAnchor = s.id === d.data.spouseParentNodeId\n            ? this.options.renderer.getSpouseAnchor(d.data)\n            : this.options.renderer.getIndiAnchor(d.data);\n        const _a = [s.x + sAnchor[0], s.y + sAnchor[1]], sx = _a[0], sy = _a[1];\n        const _b = [d.x + dAnchor[0], d.y + dAnchor[1]], dx = _b[0], dy = _b[1];\n        const midY = s.y + s.data.height / 2 + exports.V_SPACING / 2;\n        return \"M \" + sx + \" \" + sy + \"\\n            L \" + sx + \" \" + midY + \",\\n              \" + dx + \" \" + midY + \",\\n              \" + dx + \" \" + dy;\n    };\n    ChartUtil.prototype.linkAdditionalMarriage = function (node) {\n        const nodeIndex = node.parent.children.findIndex(function (n) {\n            return n.data.id === node.data.id;\n        });\n        // Assert nodeIndex > 0.\n        const siblingNode = node.parent.children[nodeIndex - 1];\n        const sAnchor = this.options.renderer.getIndiAnchor(node.data);\n        const dAnchor = this.options.renderer.getIndiAnchor(siblingNode.data);\n        const _a = [node.x + sAnchor[0], node.y + sAnchor[1]], sx = _a[0], sy = _a[1];\n        const _b = [siblingNode.x + dAnchor[0], siblingNode.y + dAnchor[1]], dx = _b[0], dy = _b[1];\n        return \"M \" + sx + \", \" + sy + \"\\n            L \" + dx + \", \" + dy;\n    };\n    ChartUtil.prototype.updateSvgDimensions = function (chartInfo) {\n        const svg = d3_selection_1.select(this.options.svgSelector);\n        const group = svg.select('g');\n        const transition = this.options.animate\n            ? group.transition().delay(HIDE_TIME_MS).duration(MOVE_TIME_MS)\n            : group;\n        transition.attr('transform', \"translate(\" + chartInfo.origin[0] + \", \" + chartInfo.origin[1] + \")\");\n    };\n    ChartUtil.prototype.layOutChart = function (root, layoutOptions) {\n        const _this = this;\n        if (layoutOptions === void 0) { layoutOptions = {}; }\n        // Add styles so that calculating text size is correct.\n        const svg = d3_selection_1.select(this.options.svgSelector);\n        if (svg.select('style').empty()) {\n            svg.append('style').text(this.options.renderer.getCss());\n        }\n        // Assign generation number.\n        root.each(function (node) {\n            node.data.generation =\n                node.depth * (layoutOptions.flipVertically ? -1 : 1) +\n                    (_this.options.baseGeneration || 0);\n        });\n        // Set preferred sizes.\n        this.options.renderer.updateNodes(root.descendants());\n        const vSizePerDepth = new Map();\n        root.each(function (node) {\n            const depth = node.depth;\n            const maxVSize = d3_array_1.max([\n                _this.options.horizontal ? node.data.width : node.data.height,\n                vSizePerDepth.get(depth),\n            ]);\n            vSizePerDepth.set(depth, maxVSize);\n        });\n        // Set sizes of whole nodes.\n        root.each(function (node) {\n            const vSize = vSizePerDepth.get(node.depth);\n            if (_this.options.horizontal) {\n                node.data.width = vSize;\n            }\n            else {\n                node.data.height = vSize;\n            }\n        });\n        const vSpacing = layoutOptions.vSpacing !== undefined ? layoutOptions.vSpacing : exports.V_SPACING;\n        const hSpacing = layoutOptions.hSpacing !== undefined ? layoutOptions.hSpacing : exports.H_SPACING;\n        // Assigns the x and y position for the nodes.\n        const treemap = d3_flextree_1.flextree()\n            .nodeSize(function (node) {\n                if (_this.options.horizontal) {\n                    const maxChildSize_1 = d3_array_1.max(node.children || [], function (n) {\n                        return n.data.width;\n                    }) || 0;\n                    return [\n                        node.data.height,\n                        (maxChildSize_1 + node.data.width) / 2 + vSpacing,\n                    ];\n                }\n                const maxChildSize = d3_array_1.max(node.children || [], function (n) {\n                    return n.data.height;\n                }) || 0;\n                return [\n                    node.data.width,\n                    (maxChildSize + node.data.height) / 2 + vSpacing,\n                ];\n            }).spacing(function () {\n                return hSpacing;\n            });\n        const nodes = treemap(root).descendants();\n        // Swap x-y coordinates for horizontal layout.\n        nodes.forEach(function (node) {\n            let _a;\n            if (layoutOptions.flipVertically) {\n                node.y = -node.y;\n            }\n            if (_this.options.horizontal) {\n                _a = [node.y, node.x];\n                node.x = _a[0];\n                node.y = _a[1];\n            }\n        });\n        return nodes;\n    };\n    ChartUtil.prototype.renderChart = function (nodes) {\n        const svg = this.getSvgForRendering();\n        const nodeAnimation = this.renderNodes(nodes, svg);\n        const linkAnimation = this.renderLinks(nodes, svg);\n        return Promise.all([\n            nodeAnimation,\n            linkAnimation,\n        ]);\n    };\n    ChartUtil.prototype.renderNodes = function (nodes, svg) {\n        const _this = this;\n        return new Promise(function (resolve) {\n            const boundNodes = svg\n                .select('g')\n                .selectAll('g.node')\n                .data(nodes, function (d) {\n                    return d.id;\n                });\n            const nodeEnter = boundNodes.enter().append('g');\n            let transitionsPending = boundNodes.exit().size() + boundNodes.size() + nodeEnter.size();\n            const transitionDone = function () {\n                transitionsPending--;\n                if (transitionsPending === 0) {\n                    resolve();\n                }\n            };\n            if (!_this.options.animate || transitionsPending === 0) {\n                resolve();\n            }\n            nodeEnter\n                .merge(boundNodes)\n                .attr('class', function (node) {\n                    return \"node generation\" + node.data.generation;\n                });\n            nodeEnter.attr('transform', function (node) {\n                return \"translate(\" + (node.x - node.data.width / 2) + \", \" + (node.y - node.data.height / 2) + \")\";\n            });\n            if (_this.options.animate) {\n                nodeEnter\n                    .style('opacity', 0)\n                    .transition()\n                    .delay(HIDE_TIME_MS + MOVE_TIME_MS)\n                    .duration(HIDE_TIME_MS)\n                    .style('opacity', 1)\n                    .on('end', transitionDone);\n            }\n            const updateTransition = _this.options.animate\n                ? boundNodes\n                    .transition()\n                    .delay(HIDE_TIME_MS)\n                    .duration(MOVE_TIME_MS)\n                    .on('end', transitionDone)\n                : boundNodes;\n            updateTransition.attr('transform', function (node) {\n                return \"translate(\" + (node.x - node.data.width / 2) + \", \" + (node.y - node.data.height / 2) + \")\";\n            });\n            _this.options.renderer.render(nodeEnter, boundNodes);\n            if (_this.options.animate) {\n                boundNodes\n                    .exit()\n                    .transition()\n                    .duration(HIDE_TIME_MS)\n                    .style('opacity', 0)\n                    .remove()\n                    .on('end', transitionDone);\n            } else {\n                boundNodes.exit().remove();\n            }\n        });\n    };\n    ChartUtil.prototype.renderLinks = function (nodes, svg) {\n        const _this = this;\n        return new Promise(function (resolve) {\n            const link = function (parent, child) {\n                if (child.data.additionalMarriage) {\n                    return _this.linkAdditionalMarriage(child);\n                }\n                const flipVertically = parent.data.generation > child.data.generation;\n                if (_this.options.horizontal) {\n                    if (flipVertically) {\n                        return _this.linkHorizontal(child, parent);\n                    }\n                    return _this.linkHorizontal(parent, child);\n                }\n                if (flipVertically) {\n                    return _this.linkVertical(child, parent);\n                }\n                return _this.linkVertical(parent, child);\n            };\n            const links = nodes.filter(function (n) {\n                return !!n.parent || n.data.additionalMarriage;\n            });\n            const boundLinks = svg\n                .select('g')\n                .selectAll('path.link')\n                .data(links, linkId);\n            const path = boundLinks\n                .enter()\n                .insert('path', 'g')\n                .attr('class', function (node) {\n                    return node.data.additionalMarriage ? 'link additional-marriage' : 'link';\n                })\n                .attr('d', function (node) {\n                    return link(node.parent, node);\n                });\n            let transitionsPending = boundLinks.exit().size() + boundLinks.size() + path.size();\n            const transitionDone = function () {\n                transitionsPending--;\n                if (transitionsPending === 0) {\n                    resolve();\n                }\n            };\n            if (!_this.options.animate || transitionsPending === 0) {\n                resolve();\n            }\n            const linkTransition = _this.options.animate\n                ? boundLinks\n                    .transition()\n                    .delay(HIDE_TIME_MS)\n                    .duration(MOVE_TIME_MS)\n                    .on('end', transitionDone)\n                : boundLinks;\n            linkTransition.attr('d', function (node) {\n                return link(node.parent, node);\n            });\n            if (_this.options.animate) {\n                path\n                    .style('opacity', 0)\n                    .transition()\n                    .delay(2 * HIDE_TIME_MS + MOVE_TIME_MS)\n                    .duration(0)\n                    .style('opacity', 1)\n                    .on('end', transitionDone);\n            }\n            if (_this.options.animate) {\n                boundLinks\n                    .exit()\n                    .transition()\n                    .duration(0)\n                    .style('opacity', 0)\n                    .remove()\n                    .on('end', transitionDone);\n            } else {\n                boundLinks.exit().remove();\n            }\n        });\n    };\n    ChartUtil.prototype.getSvgForRendering = function () {\n        const svg = d3_selection_1.select(this.options.svgSelector);\n        if (svg.select('g').empty()) {\n            svg.append('g');\n        }\n        return svg;\n    };\n    return ChartUtil;\n}());\nexports.ChartUtil = ChartUtil;\n","/** Error class adding an error code used for i18n. */\nexport class TopolaError extends Error {\n    constructor(\n        public readonly code: string,\n        message: string,\n        public readonly args: { [key: string]: string } = {},\n    ) {\n        super(message);\n    }\n}\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.IdGenerator = void 0;\n/** Provides unique identifiers. */\nvar IdGenerator = /** @class */ (function () {\n    function IdGenerator() {\n        this.ids = new Map();\n    }\n    /**\n     * Returns the given identifier if it wasn't used before. Otherwise, appends\n     * a number to the given identifier to make it unique.\n     */\n    IdGenerator.prototype.getId = function (id) {\n        if (this.ids.has(id)) {\n            var num = this.ids.get(id);\n            this.ids.set(id, num + 1);\n            return id + \":\" + num;\n        }\n        this.ids.set(id, 1);\n        return id;\n    };\n    return IdGenerator;\n}());\nexports.IdGenerator = IdGenerator;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.otherSideLinkType = exports.LinkType = exports.ChildNodes = void 0;\nvar ChildNodes = /** @class */ (function () {\n    function ChildNodes(overrides) {\n        if (overrides === void 0) { overrides = {}; }\n        this.indiParents = [];\n        this.indiSiblings = [];\n        this.spouseParents = [];\n        this.spouseSiblings = [];\n        this.children = [];\n        Object.assign(this, overrides);\n    }\n    ChildNodes.prototype.get = function (type) {\n        switch (type) {\n            case LinkType.IndiParents:\n                return this.indiParents;\n            case LinkType.IndiSiblings:\n                return this.indiSiblings;\n            case LinkType.SpouseParents:\n                return this.spouseParents;\n            case LinkType.SpouseSiblings:\n                return this.spouseSiblings;\n            case LinkType.Children:\n                return this.children;\n            default:\n                return null;\n        }\n    };\n    ChildNodes.prototype.getAll = function () {\n        return [].concat(this.indiSiblings, this.indiParents, this.children, this.spouseParents, this.spouseSiblings);\n    };\n    ChildNodes.EMPTY = new ChildNodes();\n    return ChildNodes;\n}());\nexports.ChildNodes = ChildNodes;\nvar LinkType;\n(function (LinkType) {\n    LinkType[LinkType[\"IndiParents\"] = 0] = \"IndiParents\";\n    LinkType[LinkType[\"IndiSiblings\"] = 1] = \"IndiSiblings\";\n    LinkType[LinkType[\"SpouseParents\"] = 2] = \"SpouseParents\";\n    LinkType[LinkType[\"SpouseSiblings\"] = 3] = \"SpouseSiblings\";\n    LinkType[LinkType[\"Children\"] = 4] = \"Children\";\n})(LinkType = exports.LinkType || (exports.LinkType = {}));\nfunction otherSideLinkType(type) {\n    switch (type) {\n        case LinkType.IndiParents:\n            return LinkType.Children;\n        case LinkType.IndiSiblings:\n            return LinkType.IndiSiblings;\n        case LinkType.SpouseParents:\n            return LinkType.Children;\n        case LinkType.SpouseSiblings:\n            return LinkType.IndiSiblings;\n        case LinkType.Children:\n            return LinkType.IndiParents;\n        default:\n            return null;\n    }\n}\nexports.otherSideLinkType = otherSideLinkType;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.HierarchyFilter = void 0;\nvar HierarchyFilter = /** @class */ (function () {\n    function HierarchyFilter(overrides) {\n        if (overrides === void 0) { overrides = {}; }\n        this.indiParents = true;\n        this.indiSiblings = true;\n        this.spouseParents = true;\n        this.spouseSiblings = true;\n        this.children = true;\n        this.modify(overrides);\n    }\n    HierarchyFilter.allAccepting = function () {\n        return new HierarchyFilter();\n    };\n    HierarchyFilter.allRejecting = function () {\n        return new HierarchyFilter().modify({\n            indiParents: false,\n            indiSiblings: false,\n            spouseParents: false,\n            spouseSiblings: false,\n            children: false,\n        });\n    };\n    HierarchyFilter.prototype.modify = function (overrides) {\n        Object.assign(this, overrides);\n        return this;\n    };\n    return HierarchyFilter;\n}());\nexports.HierarchyFilter = HierarchyFilter;\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AncestorChart = exports.getAncestorsTree = void 0;\nvar chart_util_1 = require(\"./chart-util\");\nvar d3_hierarchy_1 = require(\"d3-hierarchy\");\nvar id_generator_1 = require(\"./id-generator\");\nfunction getAncestorsTree(options) {\n    var ancestorChartOptions = __assign({}, options);\n    var startIndiFamilies = options.startIndi\n        ? options.data.getIndi(options.startIndi).getFamiliesAsSpouse()\n        : [];\n    // If the start individual is set and this person has at least one spouse,\n    // start with the family instead.\n    if (startIndiFamilies.length) {\n        ancestorChartOptions.startFam = startIndiFamilies[0];\n        ancestorChartOptions.startIndi = undefined;\n        var fam = options.data.getFam(startIndiFamilies[0]);\n        if (fam.getMother() === options.startIndi) {\n            ancestorChartOptions.swapStartSpouses = true;\n        }\n    }\n    var ancestors = new AncestorChart(ancestorChartOptions);\n    var ancestorsRoot = ancestors.createHierarchy();\n    // Remove spouse's ancestors if there are multiple spouses\n    // to avoid showing ancestors of just one spouse.\n    if (startIndiFamilies.length > 1 &&\n        ancestorsRoot.children &&\n        ancestorsRoot.children.length > 1) {\n        ancestorsRoot.children.pop();\n        ancestorsRoot.data.spouseParentNodeId = undefined;\n    }\n    return ancestorsRoot;\n}\nexports.getAncestorsTree = getAncestorsTree;\n/** Renders an ancestors chart. */\nvar AncestorChart = /** @class */ (function () {\n    function AncestorChart(options) {\n        this.options = options;\n        this.util = new chart_util_1.ChartUtil(options);\n    }\n    /** Creates a d3 hierarchy from the input data. */\n    AncestorChart.prototype.createHierarchy = function () {\n        let id;\n        let famc;\n        let indi;\n        var parents = [];\n        var stack = [];\n        var idGenerator = this.options.idGenerator || new id_generator_1.IdGenerator();\n        if (this.options.startIndi) {\n            indi = this.options.data.getIndi(this.options.startIndi);\n            famc = indi.getFamilyAsChild();\n            id = famc ? idGenerator.getId(famc) : undefined;\n            if (famc) {\n                stack.push({\n                    id: famc,\n                    parentId: this.options.startIndi,\n                    family: { id: famc },\n                });\n            }\n            parents.push({\n                id: this.options.startIndi,\n                indi: { id: this.options.startIndi },\n                indiParentNodeId: id,\n            });\n        }\n        else {\n            stack.push({\n                id: idGenerator.getId(this.options.startFam),\n                family: { id: this.options.startFam },\n            });\n        }\n        while (stack.length) {\n            var entry = stack.pop();\n            var fam = this.options.data.getFam(entry.family.id);\n            if (!fam) {\n                continue;\n            }\n            var _a = entry.family.id === this.options.startFam &&\n                this.options.swapStartSpouses\n                ? [fam.getMother(), fam.getFather()]\n                : [fam.getFather(), fam.getMother()], father = _a[0], mother = _a[1];\n            if (!father && !mother) {\n                continue;\n            }\n            if (mother) {\n                entry.spouse = { id: mother };\n                indi = this.options.data.getIndi(mother);\n                famc = indi.getFamilyAsChild();\n                if (famc) {\n                    id = idGenerator.getId(famc);\n                    entry.spouseParentNodeId = id;\n                    stack.push({\n                        id: id,\n                        parentId: entry.id,\n                        family: { id: famc },\n                    });\n                }\n            }\n            if (father) {\n                entry.indi = { id: father };\n                indi = this.options.data.getIndi(father);\n                famc = indi.getFamilyAsChild();\n                if (famc) {\n                    id = idGenerator.getId(famc);\n                    entry.indiParentNodeId = id;\n                    stack.push({\n                        id: id,\n                        parentId: entry.id,\n                        family: { id: famc },\n                    });\n                }\n            }\n            parents.push(entry);\n        }\n        return d3_hierarchy_1.stratify()(parents);\n    };\n    /**\n     * Renders the tree, calling the provided renderer to draw boxes for\n     * individuals.\n     */\n    AncestorChart.prototype.render = function () {\n        var root = this.createHierarchy();\n        var nodes = this.util.layOutChart(root, { flipVertically: true });\n        var animationPromise = this.util.renderChart(nodes);\n        var info = chart_util_1.getChartInfo(nodes);\n        this.util.updateSvgDimensions(info);\n        return Object.assign(info, { animationPromise: animationPromise });\n    };\n    return AncestorChart;\n}());\nexports.AncestorChart = AncestorChart;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.getFamPositionHorizontal = exports.getFamPositionVertical = exports.CompositeRenderer = void 0;\n\nconst d3_array_1 = require(\"d3-array\");\n\n/**\n * Common code for tree nodes that are composed of individual and family boxes.\n */\nlet CompositeRenderer = /** @class */ (function () {\n\n    function CompositeRenderer(options) {\n        this.options = options;\n    }\n\n    CompositeRenderer.prototype.getPreferredFamSize = function (id) {\n        // No family box in the simple renderer.\n        return [0, 0];\n    };\n\n    CompositeRenderer.prototype.setPreferredIndiSize = function (indi) {\n        let _a;\n        if (!indi) {\n            return;\n        }\n        _a = this.getPreferredIndiSize(indi.id);\n        indi.width = _a[0];\n        indi.height = _a[1];\n    };\n\n    CompositeRenderer.prototype.updateNodes = function (nodes) {\n        const _this = this;\n        // Calculate individual vertical size per depth.\n        const indiVSizePerDepth = new Map();\n        nodes.forEach(function (node) {\n            let _a;\n            _this.setPreferredIndiSize(node.data.indi);\n            _this.setPreferredIndiSize(node.data.spouse);\n            const family = node.data.family;\n            if (family) {\n                _a = _this.getPreferredFamSize(family.id);\n                family.width = _a[0];\n                family.height = _a[1];\n            }\n            const depth = node.depth;\n            const maxIndiVSize = d3_array_1.max([\n                getIndiVSize(node.data, !!_this.options.horizontal),\n                indiVSizePerDepth.get(depth),\n            ]);\n            indiVSizePerDepth.set(depth, maxIndiVSize);\n        });\n        // Set same width for each depth.\n        nodes.forEach(function (node) {\n            let _a;\n            if (_this.options.horizontal) {\n                if (node.data.indi) {\n                    node.data.indi.width = indiVSizePerDepth.get(node.depth);\n                }\n                if (node.data.spouse) {\n                    node.data.spouse.width = indiVSizePerDepth.get(node.depth);\n                }\n            } else {\n                if (node.data.indi) {\n                    node.data.indi.height = indiVSizePerDepth.get(node.depth);\n                }\n                if (node.data.spouse) {\n                    node.data.spouse.height = indiVSizePerDepth.get(node.depth);\n                }\n            }\n            const vSize = getVSize(node.data, !!_this.options.horizontal);\n            const hSize = getHSize(node.data, !!_this.options.horizontal);\n            _a = _this.options.horizontal ? [vSize, hSize] : [hSize, vSize];\n            node.data.width = _a[0];\n            node.data.height = _a[1];\n        });\n    };\n\n    CompositeRenderer.prototype.getFamilyAnchor = function (node) {\n        if (this.options.horizontal) {\n            const x_1 = -node.width / 2 + getIndiVSize(node, this.options.horizontal) / 2;\n            const famYOffset = node.family\n                ? d3_array_1.max([-getFamPositionHorizontal(node), 0])\n                : 0;\n            const y_1 = -(node.indi && node.spouse ? node.height / 2 - node.indi.height : 0) +\n                famYOffset;\n            return [x_1, y_1];\n        }\n        const famXOffset = node.family\n            ? d3_array_1.max([-getFamPositionVertical(node), 0])\n            : 0;\n        const x = -(node.indi && node.spouse ? node.width / 2 - node.indi.width : 0) +\n            famXOffset;\n        const y = -node.height / 2 + getIndiVSize(node, this.options.horizontal) / 2;\n        return [x, y];\n    };\n\n    CompositeRenderer.prototype.getSpouseAnchor = function (node) {\n        if (this.options.horizontal) {\n            const x_2 = -node.width / 2 + getIndiVSize(node, this.options.horizontal) / 2;\n            const y_2 = node.indi ? node.indi.height / 2 : 0;\n            return [x_2, y_2];\n        }\n        const x = node.indi ? node.indi.width / 2 : 0;\n        const y = -node.height / 2 + getIndiVSize(node, !!this.options.horizontal) / 2;\n        return [x, y];\n    };\n\n    CompositeRenderer.prototype.getIndiAnchor = function (node) {\n        if (this.options.horizontal) {\n            const x_3 = -node.width / 2 + getIndiVSize(node, this.options.horizontal) / 2;\n            const y_3 = node.spouse ? -node.spouse.height / 2 : 0;\n            return [x_3, y_3];\n        }\n        const x = node.spouse ? -node.spouse.width / 2 : 0;\n        const y = -node.height / 2 + getIndiVSize(node, !!this.options.horizontal) / 2;\n        return [x, y];\n    };\n\n    return CompositeRenderer;\n}());\nexports.CompositeRenderer = CompositeRenderer;\n\n/**\n * Returns the relative position of the family box for the vertical layout.\n */\nfunction getFamPositionVertical(node) {\n    const indiWidth = node.indi ? node.indi.width : 0;\n    const spouseWidth = node.spouse ? node.spouse.width : 0;\n    const familyWidth = node.family.width;\n    if (!node.indi || !node.spouse || indiWidth + spouseWidth <= familyWidth) {\n        return (indiWidth + spouseWidth - familyWidth) / 2;\n    }\n    if (familyWidth / 2 >= spouseWidth) {\n        return indiWidth + spouseWidth - familyWidth;\n    }\n    if (familyWidth / 2 >= indiWidth) {\n        return 0;\n    }\n    return indiWidth - familyWidth / 2;\n}\nexports.getFamPositionVertical = getFamPositionVertical;\n\n/**\n * Returns the relative position of the family box for the horizontal layout.\n */\nfunction getFamPositionHorizontal(node) {\n    const indiHeight = node.indi ? node.indi.height : 0;\n    const spouseHeight = node.spouse ? node.spouse.height : 0;\n    const familyHeight = node.family.height;\n    if (!node.indi || !node.spouse) {\n        return (indiHeight + spouseHeight - familyHeight) / 2;\n    }\n    return indiHeight - familyHeight / 2;\n}\nexports.getFamPositionHorizontal = getFamPositionHorizontal;\n\n/** Returns the horizontal size. */\nfunction getHSize(node, horizontal) {\n    if (horizontal) {\n        return ((node.indi ? node.indi.height : 0) +\n            (node.spouse ? node.spouse.height : 0));\n    }\n    const indiHSize = (node.indi ? node.indi.width : 0) + (node.spouse ? node.spouse.width : 0);\n    return d3_array_1.max([indiHSize, node.family ? node.family.width : 0]);\n}\n\nfunction getFamVSize(node, horizontal) {\n    if (horizontal) {\n        return node.family ? node.family.width : 0;\n    }\n    return node.family ? node.family.height : 0;\n}\n\n/** Returns the vertical size of individual boxes. */\nfunction getIndiVSize(node, horizontal) {\n    if (horizontal) {\n        return d3_array_1.max([\n            node.indi ? node.indi.width : 0,\n            node.spouse ? node.spouse.width : 0,\n        ]);\n    }\n    return d3_array_1.max([\n        node.indi ? node.indi.height : 0,\n        node.spouse ? node.spouse.height : 0,\n    ]);\n}\n\n/** Returns the vertical size. */\nfunction getVSize(node, horizontal) {\n    return getIndiVSize(node, horizontal) + getFamVSize(node, horizontal);\n}\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.DescendantChart = exports.layOutDescendants = exports.DUMMY_ROOT_NODE_ID = void 0;\nvar d3_hierarchy_1 = require(\"d3-hierarchy\");\nvar chart_util_1 = require(\"./chart-util\");\nvar id_generator_1 = require(\"./id-generator\");\nexports.DUMMY_ROOT_NODE_ID = 'DUMMY_ROOT_NODE';\nfunction layOutDescendants(options, layoutOptions) {\n    if (layoutOptions === void 0) { layoutOptions = {}; }\n    var descendants = new DescendantChart(options);\n    var descendantsRoot = descendants.createHierarchy();\n    return removeDummyNode(new chart_util_1.ChartUtil(options).layOutChart(descendantsRoot, layoutOptions));\n}\nexports.layOutDescendants = layOutDescendants;\n/** Removes the dummy root node if it was added in createHierarchy(). */\nfunction removeDummyNode(allNodes) {\n    if (allNodes[0].id !== exports.DUMMY_ROOT_NODE_ID) {\n        return allNodes;\n    }\n    var nodes = allNodes.slice(1);\n    // Move first node to (0, 0) coordinates.\n    var dx = -nodes[0].x;\n    var dy = -nodes[0].y;\n    nodes.forEach(function (node) {\n        if (node.parent &&\n            node.parent.id === exports.DUMMY_ROOT_NODE_ID &&\n            !node.data.additionalMarriage) {\n            node.parent = null;\n        }\n        node.x += dx;\n        node.y += dy;\n        node.data.generation--;\n    });\n    return nodes;\n}\n/** Returns the spouse of the given individual in the given family. */\nfunction getSpouse(indiId, fam) {\n    if (fam.getFather() === indiId) {\n        return fam.getMother();\n    }\n    return fam.getFather();\n}\n/** Renders a descendants chart. */\nvar DescendantChart = /** @class */ (function () {\n    function DescendantChart(options) {\n        this.options = options;\n        this.util = new chart_util_1.ChartUtil(options);\n    }\n    DescendantChart.prototype.getNodes = function (id) {\n        var _this = this;\n        var indi = this.options.data.getIndi(id);\n        var famIds = indi.getFamiliesAsSpouse();\n        if (!famIds.length) {\n            // Single person.\n            return [\n                {\n                    id: id,\n                    indi: {\n                        id: id,\n                    },\n                },\n            ];\n        }\n        // Marriages.\n        var nodes = famIds.map(function (famId) {\n            var entry = {\n                id: famId,\n                indi: {\n                    id: id,\n                },\n                family: {\n                    id: famId,\n                },\n            };\n            var fam = _this.options.data.getFam(famId);\n            var spouse = getSpouse(id, fam);\n            if (spouse) {\n                entry.spouse = { id: spouse };\n            }\n            return entry;\n        });\n        nodes.slice(1).forEach(function (node) {\n            node.additionalMarriage = true;\n        });\n        return nodes;\n    };\n    DescendantChart.prototype.getFamNode = function (famId) {\n        var node = { id: famId, family: { id: famId } };\n        var fam = this.options.data.getFam(famId);\n        var father = fam.getFather();\n        if (father) {\n            node.indi = { id: father };\n        }\n        var mother = fam.getMother();\n        if (mother) {\n            node.spouse = { id: mother };\n        }\n        return node;\n    };\n    /** Creates a d3 hierarchy from the input data. */\n    DescendantChart.prototype.createHierarchy = function () {\n        var _this = this;\n        var parents = [];\n        var nodes = this.options.startIndi\n            ? this.getNodes(this.options.startIndi)\n            : [this.getFamNode(this.options.startFam)];\n        var idGenerator = this.options.idGenerator || new id_generator_1.IdGenerator();\n        nodes.forEach(function (node) { return (node.id = idGenerator.getId(node.id)); });\n        // If there are multiple root nodes, i.e. the start individual has multiple\n        // marriages, create a dummy root node.\n        // After layout is complete, the dummy node will be removed.\n        if (nodes.length > 1) {\n            var dummyNode_1 = {\n                id: exports.DUMMY_ROOT_NODE_ID,\n                height: 1,\n                width: 1,\n            };\n            parents.push(dummyNode_1);\n            nodes.forEach(function (node) { return (node.parentId = dummyNode_1.id); });\n        }\n        parents.push.apply(parents, nodes);\n        var stack = [];\n        nodes.forEach(function (node) {\n            if (node.family) {\n                stack.push(node);\n            }\n        });\n        var _loop_1 = function () {\n            var entry = stack.pop();\n            var fam = this_1.options.data.getFam(entry.family.id);\n            var children = fam.getChildren();\n            children.forEach(function (childId) {\n                var childNodes = _this.getNodes(childId);\n                childNodes.forEach(function (node) {\n                    node.parentId = entry.id;\n                    if (node.family) {\n                        node.id = \"\" + idGenerator.getId(node.family.id);\n                        stack.push(node);\n                    }\n                });\n                parents.push.apply(parents, childNodes);\n            });\n        };\n        var this_1 = this;\n        while (stack.length) {\n            _loop_1();\n        }\n        return d3_hierarchy_1.stratify()(parents);\n    };\n    /**\n     * Renders the tree, calling the provided renderer to draw boxes for\n     * individuals.\n     */\n    DescendantChart.prototype.render = function () {\n        var root = this.createHierarchy();\n        var nodes = removeDummyNode(this.util.layOutChart(root));\n        var animationPromise = this.util.renderChart(nodes);\n        var info = chart_util_1.getChartInfo(nodes);\n        this.util.updateSvgDimensions(info);\n        return Object.assign(info, { animationPromise: animationPromise });\n    };\n    return DescendantChart;\n}());\nexports.DescendantChart = DescendantChart;\n","import {GedcomEntry, parse as parseGedcom} from 'parse-gedcom';\nimport {TopolaError} from './error';\nimport {gedcomEntriesToJson, JsonFam, JsonGedcomData, JsonImage, JsonIndi} from '../lib/topola';\nimport {compareDates} from './date_util';\n\nexport interface GedcomData {\n    /** The HEAD entry. */\n    head: GedcomEntry;\n    /** INDI entries mapped by id. */\n    indis: { [key: string]: GedcomEntry };\n    /** FAM entries mapped by id. */\n    fams: { [key: string]: GedcomEntry };\n    /** Other entries mapped by id, e.g. NOTE, SOUR. */\n    other: { [key: string]: GedcomEntry };\n}\n\nexport interface TopolaData {\n    chartData: JsonGedcomData;\n    gedcom: GedcomData;\n}\n\n/**\n * Returns the identifier extracted from a pointer string.\n * E.g. '@I123@' -> 'I123'\n */\nexport function pointerToId(pointer: string): string {\n    return pointer.substring(1, pointer.length - 1);\n}\n\nexport function idToIndiMap(data: JsonGedcomData): Map<string, JsonIndi> {\n    const map = new Map<string, JsonIndi>();\n    data.indis.forEach((indi) => {\n        map.set(indi.id, indi);\n    });\n    return map;\n}\n\nexport function idToFamMap(data: JsonGedcomData): Map<string, JsonFam> {\n    const map = new Map<string, JsonFam>();\n    data.fams.forEach((fam) => {\n        map.set(fam.id, fam);\n    });\n    return map;\n}\n\nfunction prepareGedcom(entries: GedcomEntry[]): GedcomData {\n    const head = entries.find((entry) => entry.tag === 'HEAD')!;\n    const indis: { [key: string]: GedcomEntry } = {};\n    const fams: { [key: string]: GedcomEntry } = {};\n    const other: { [key: string]: GedcomEntry } = {};\n    entries.forEach((entry) => {\n        if (entry.tag === 'INDI') {\n            indis[pointerToId(entry.pointer)] = entry;\n        } else if (entry.tag === 'FAM') {\n            fams[pointerToId(entry.pointer)] = entry;\n        } else if (entry.pointer) {\n            other[pointerToId(entry.pointer)] = entry;\n        }\n    });\n    return {head, indis, fams, other};\n}\n\nfunction strcmp(a: string, b: string) {\n    if (a < b) {\n        return -1;\n    }\n    if (a > b) {\n        return 1;\n    }\n    return 0;\n}\n\n/** Birthdate comparator for individuals. */\nfunction birthDatesComparator(gedcom: JsonGedcomData) {\n    const indiMap = idToIndiMap(gedcom);\n    return (indiId1: string, indiId2: string) => {\n        const indi1: JsonIndi | undefined = indiMap.get(indiId1);\n        const indi2: JsonIndi | undefined = indiMap.get(indiId2);\n        return (\n            compareDates(indi1 && indi1.birth, indi2 && indi2.birth) ||\n            strcmp(indiId1, indiId2)\n        );\n    };\n}\n\n/** Marriage date comparator for families. */\nfunction marriageDatesComparator(gedcom: JsonGedcomData) {\n    const famMap = idToFamMap(gedcom);\n    return (famId1: string, famId2: string) => {\n        const fam1: JsonFam | undefined = famMap.get(famId1);\n        const fam2: JsonFam | undefined = famMap.get(famId2);\n        return (\n            compareDates(fam1 && fam1.marriage, fam2 && fam2.marriage) ||\n            strcmp(famId1, famId2)\n        );\n    };\n}\n\n/**\n * Sorts children by birthdate in the given family.\n * Does not modify the input objects.\n */\nfunction sortFamilyChildren(\n    fam: JsonFam,\n    comparator: (id1: string, id2: string) => number,\n): JsonFam {\n    if (!fam.children) {\n        return fam;\n    }\n    const newChildren = fam.children.sort(comparator);\n    return Object.assign({}, fam, {children: newChildren});\n}\n\n/**\n * Sorts children by birthdate.\n * Does not modify the input object.\n */\nfunction sortChildren(gedcom: JsonGedcomData): JsonGedcomData {\n    const comparator = birthDatesComparator(gedcom);\n    const newFams = gedcom.fams.map((fam) => sortFamilyChildren(fam, comparator));\n    return Object.assign({}, gedcom, {fams: newFams});\n}\n\n/**\n * Sorts spouses by marriage date.\n * Does not modify the input objects.\n */\nfunction sortIndiSpouses(\n    indi: JsonIndi,\n    comparator: (id1: string, id2: string) => number,\n): JsonFam {\n    if (!indi.fams) {\n        return indi;\n    }\n    const newFams = indi.fams.sort(comparator);\n    return Object.assign({}, indi, {fams: newFams});\n}\n\nfunction sortSpouses(gedcom: JsonGedcomData): JsonGedcomData {\n    const comparator = marriageDatesComparator(gedcom);\n    const newIndis = gedcom.indis.map((indi) =>\n        sortIndiSpouses(indi, comparator),\n    );\n    return Object.assign({}, gedcom, {indis: newIndis});\n}\n\n/**\n * If the entry is a reference to a top-level entry, the referenced entry is returned.\n * Otherwise, returns the given entry unmodified.\n */\nexport function dereference(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    getterFunction: (gedcom: GedcomData) => { [key: string]: GedcomEntry },\n) {\n    if (entry.data) {\n        const dereferenced = getterFunction(gedcom)[pointerToId(entry.data)];\n        if (dereferenced) {\n            return dereferenced;\n        }\n    }\n    return entry;\n}\n\n/**\n * Returns the data for the given GEDCOM entry as an array of lines.\n * Supports continuations with CONT and CONC.\n */\nexport function getData(entry: GedcomEntry) {\n    const result = [entry.data];\n    entry.tree.forEach((subentry) => {\n        if (subentry.tag === 'CONC' && subentry.data) {\n            const last = result.length - 1;\n            result[last] += subentry.data;\n        } else if (subentry.tag === 'CONT' && subentry.data) {\n            result.push(subentry.data);\n        }\n    });\n    return result;\n}\n\n/** Sorts children and spouses. */\nexport function normalizeGedcom(gedcom: JsonGedcomData): JsonGedcomData {\n    return sortSpouses(sortChildren(gedcom));\n}\n\nconst IMAGE_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.gif'];\n\n/** Returns true if the given file name has a known image extension. */\nexport function isImageFile(fileName: string): boolean {\n    const lowerName = fileName.toLowerCase();\n    return IMAGE_EXTENSIONS.some((ext) => lowerName.endsWith(ext));\n}\n\n/**\n * Removes images that are not HTTP links or do not have known image extensions.\n * Does not modify the input object.\n */\nfunction filterImage(indi: JsonIndi, images: Map<string, string>): JsonIndi {\n    if (!indi.images || indi.images.length === 0) {\n        return indi;\n    }\n    const newImages: JsonImage[] = [];\n    indi.images.forEach((image) => {\n        const filePath = image.url.replaceAll('\\\\', '/');\n        const fileName = filePath.match(/[^/]*$/)![0];\n        // If the image file has been loaded into memory, use it.\n        if (images.has(filePath)) {\n            newImages.push({url: images.get(filePath)!, title: image.title});\n        } else if (images.has(fileName)) {\n            newImages.push({url: images.get(fileName)!, title: image.title});\n        } else if (image.url.startsWith('http') && isImageFile(image.url)) {\n            newImages.push(image);\n        }\n    });\n    return Object.assign({}, indi, {images: newImages});\n}\n\n/**\n * Removes images that are not HTTP links.\n * Does not modify the input object.\n */\nfunction filterImages(\n    gedcom: JsonGedcomData,\n    images: Map<string, string>,\n): JsonGedcomData {\n    const newIndis = gedcom.indis.map((indi) => filterImage(indi, images));\n    return Object.assign({}, gedcom, {indis: newIndis});\n}\n\n/**\n * Converts GEDCOM file into JSON data performing additional transformations:\n * - sort children by birthdate\n * - remove images that are not HTTP links and aren't mapped in `images`.\n *\n * @param gedcom\n * @param images Map from file name to image URL. This is used to pass in\n *   uploaded images.\n */\nexport function convertGedcom(\n    gedcom: string,\n    images: Map<string, string>,\n): TopolaData {\n    const entries = parseGedcom(gedcom);\n    const json = gedcomEntriesToJson(entries);\n    if (\n        !json ||\n        !json.indis ||\n        !json.indis.length ||\n        !json.fams ||\n        !json.fams.length\n    ) {\n        throw new TopolaError('GEDCOM_READ_FAILED', 'Failed to read GEDCOM file');\n    }\n    return {\n        chartData: filterImages(normalizeGedcom(json), images),\n        gedcom: prepareGedcom(entries),\n    };\n}\n\nexport function getName(person: GedcomEntry): string | undefined {\n    const names = person.tree.filter((subEntry) => subEntry.tag === 'NAME');\n    const notMarriedName = names.find(\n        (subEntry) =>\n            subEntry.tree.filter(\n                (nameEntry) => nameEntry.tag === 'TYPE' && nameEntry.data === 'married',\n            ).length === 0,\n    );\n    const name = notMarriedName || names[0];\n    return name?.data.replace(/\\//g, '');\n}\n\nexport function getFileName(fileEntry: GedcomEntry): string | undefined {\n    const fileTitle = fileEntry?.tree.find((entry) => entry.tag === 'TITL')?.data;\n    const fileExtension = fileEntry?.tree.find((entry) => entry.tag === 'FORM')?.data;\n    return fileTitle && fileExtension && fileTitle + '.' + fileExtension;\n}\n\nexport function getImageFileEntry(objectEntry: GedcomEntry): GedcomEntry | undefined {\n    return objectEntry.tree.find(\n        (entry) =>\n            entry.tag === 'FILE' &&\n            entry.data.startsWith('http') &&\n            isImageFile(entry.data),\n    );\n}\n","Object.defineProperty(exports, \"__esModule\", { value: true });\n\nexports.points2pathd = exports.zip = exports.last = exports.nonEmpty = void 0;\n\nfunction nonEmpty(array) {\n    return !!(array && array.length);\n}\nexports.nonEmpty = nonEmpty;\n\nfunction last(array) {\n    return array[array.length - 1];\n}\nexports.last = last;\n\nfunction zip(a, b) {\n    return a.map(function (e, i) { return [e, b[i]]; });\n}\nexports.zip = zip;\n\nfunction points2pathd(points) {\n    let result = \"M \" + points[0].x + \" \" + points[0].y + \" L\";\n    let _i = 0, _a = points.slice(1);\n    for (; _i < _a.length; _i++) {\n        const s = _a[_i];\n        result += \" \" + s.x + \" \" + s.y;\n    }\n    return result;\n}\nexports.points2pathd = points2pathd;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.JsonDataProvider = void 0;\n/** Details of an individual based on Json input. */\nvar JsonIndiDetails = /** @class */ (function () {\n    function JsonIndiDetails(json) {\n        this.json = json;\n    }\n    JsonIndiDetails.prototype.getId = function () {\n        return this.json.id;\n    };\n    JsonIndiDetails.prototype.isEgo = function () {\n        return this.json.isEgo;\n    };\n    JsonIndiDetails.prototype.getFamiliesAsSpouse = function () {\n        return this.json.fams || [];\n    };\n    JsonIndiDetails.prototype.getFamilyAsChild = function () {\n        return this.json.famc || null;\n    };\n    JsonIndiDetails.prototype.getFirstName = function () {\n        return this.json.firstName || null;\n    };\n    JsonIndiDetails.prototype.getLastName = function () {\n        return this.json.lastName || null;\n    };\n    JsonIndiDetails.prototype.getBirthDate = function () {\n        return this.json.birth || null;\n    };\n    JsonIndiDetails.prototype.getMaidenName = function () {\n        return this.json.maidenName || null;\n    };\n    JsonIndiDetails.prototype.getNumberOfChildren = function () {\n        return this.json.numberOfChildren || null;\n    };\n    JsonIndiDetails.prototype.getNumberOfMarriages = function () {\n        return this.json.numberOfMarriages || null;\n    };\n    JsonIndiDetails.prototype.getBirthPlace = function () {\n        return (this.json.birth && this.json.birth.place) || null;\n    };\n    JsonIndiDetails.prototype.getDeathDate = function () {\n        return this.json.death || null;\n    };\n    JsonIndiDetails.prototype.getDeathPlace = function () {\n        return (this.json.death && this.json.death.place) || null;\n    };\n    JsonIndiDetails.prototype.isConfirmedDeath = function () {\n        return !!this.json.death && !!this.json.death.confirmed;\n    };\n    JsonIndiDetails.prototype.getSex = function () {\n        return this.json.sex || null;\n    };\n    JsonIndiDetails.prototype.getLanguages = function () {\n        return this.json.languages || null;\n    };\n    JsonIndiDetails.prototype.getLanguagesLabel = function () {\n        const abbreviations = this.json.languages.map(lang => lang.slice(0, 3).toUpperCase());\n        return abbreviations.length > 0 ? `${abbreviations.join(', ')}` : null;\n    };\n    JsonIndiDetails.prototype.getTribe = function () {\n        return this.json.tribe || null;\n    };\n    JsonIndiDetails.prototype.getImageUrl = function () {\n        return ((this.json.images &&\n            this.json.images.length > 0 &&\n            this.json.images[0].url) ||\n            null);\n    };\n    JsonIndiDetails.prototype.getImages = function () {\n        return this.json.images || null;\n    };\n    JsonIndiDetails.prototype.getNotes = function () {\n        return this.json.notes || null;\n    };\n    JsonIndiDetails.prototype.getEvents = function () {\n        return this.json.events || null;\n    };\n    JsonIndiDetails.prototype.showLanguages = function () {\n        return !this.json.hideLanguages;\n    };\n    JsonIndiDetails.prototype.showTribe = function () {\n        return !this.json.hideTribe;\n    };\n    JsonIndiDetails.prototype.showId = function () {\n        return !this.json.hideId;\n    };\n    JsonIndiDetails.prototype.showSex = function () {\n        return !this.json.hideSex;\n    };\n    return JsonIndiDetails;\n}());\n/** Details of a family based on Json input. */\nvar JsonFamDetails = /** @class */ (function () {\n    function JsonFamDetails(json) {\n        this.json = json;\n    }\n    JsonFamDetails.prototype.getId = function () {\n        return this.json.id;\n    };\n    JsonFamDetails.prototype.getFather = function () {\n        return this.json.husb || null;\n    };\n    JsonFamDetails.prototype.getMother = function () {\n        return this.json.wife || null;\n    };\n    JsonFamDetails.prototype.getChildren = function () {\n        return this.json.children || [];\n    };\n    JsonFamDetails.prototype.getMarriageDate = function () {\n        return this.json.marriage || null;\n    };\n    JsonFamDetails.prototype.getMarriagePlace = function () {\n        return (this.json.marriage && this.json.marriage.place) || null;\n    };\n    return JsonFamDetails;\n}());\n/** Implementation of the DataProvider interface based on Json input. */\nvar JsonDataProvider = /** @class */ (function () {\n    function JsonDataProvider(json) {\n        var _this = this;\n        this.json = json;\n        this.indis = new Map();\n        this.fams = new Map();\n        json.indis.forEach(function (indi) {\n            return _this.indis.set(indi.id, new JsonIndiDetails(indi));\n        });\n        json.fams.forEach(function (fam) { return _this.fams.set(fam.id, new JsonFamDetails(fam)); });\n    }\n    JsonDataProvider.prototype.getIndi = function (id) {\n        return this.indis.get(id) || null;\n    };\n    JsonDataProvider.prototype.getFam = function (id) {\n        return this.fams.get(id) || null;\n    };\n    return JsonDataProvider;\n}());\nexports.JsonDataProvider = JsonDataProvider;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.formatDateOrRange = exports.formatDate = void 0;\n/** Month in English is used as fallback if a requested translation is not found. */\nvar MONTHS_EN = new Map([\n    [1, 'Jan'],\n    [2, 'Feb'],\n    [3, 'Mar'],\n    [4, 'Apr'],\n    [5, 'May'],\n    [6, 'Jun'],\n    [7, 'Jul'],\n    [8, 'Aug'],\n    [9, 'Sep'],\n    [10, 'Oct'],\n    [11, 'Nov'],\n    [12, 'Dec'],\n]);\n/** Translations of the GEDCOM date qualifiers. */\nvar QUALIFIERS_I18N = new Map([\n    [\n        'cs',\n        new Map([\n            ['cal', 'vypot.'],\n            ['abt', 'o'],\n            ['est', 'ocenil'],\n            ['before', 'ped'],\n            ['after', 'po'],\n        ]),\n    ],\n    [\n        'de',\n        new Map([\n            ['cal', 'errech.'],\n            ['abt', 'etwa'],\n            ['est', 'gescht.'],\n            ['before', 'vor'],\n            ['after', 'nach'],\n        ]),\n    ],\n    [\n        'fr',\n        new Map([\n            ['cal', 'calc.'],\n            ['abt', 'vers'],\n            ['est', 'est.'],\n            ['before', 'avant'],\n            ['after', 'aprs'],\n        ]),\n    ],\n    [\n        'it',\n        new Map([\n            ['cal', 'calc.'],\n            ['abt', 'circa il'],\n            ['est', 'stim.'],\n            ['before', 'prima del'],\n            ['after', 'dopo del'],\n        ]),\n    ],\n    [\n        'pl',\n        new Map([\n            ['cal', 'wyl.'],\n            ['abt', 'ok.'],\n            ['est', 'szac.'],\n            ['before', 'przed'],\n            ['after', 'po'],\n        ]),\n    ],\n    [\n        'ru',\n        new Map([\n            ['cal', '.'],\n            ['abt', '.'],\n            ['est', '.'],\n            ['before', ''],\n            ['after', ''],\n        ]),\n    ],\n]);\nvar shortMonthCache = new Map();\nfunction getShortMonth(month, locale) {\n    if (!Intl || !Intl.DateTimeFormat) {\n        return MONTHS_EN.get(month);\n    }\n    var cacheKey = month + \"|\" + (locale || '');\n    if (shortMonthCache.has(cacheKey)) {\n        return shortMonthCache.get(cacheKey);\n    }\n    var result = new Intl.DateTimeFormat(locale, { month: 'short' }).format(new Date(2000, month - 1));\n    shortMonthCache.set(cacheKey, result);\n    return result;\n}\nfunction getQualifier(qualifier, locale) {\n    var language = locale && locale.split(/[-_]/)[0];\n    var languageMap = language && QUALIFIERS_I18N.get(language);\n    return languageMap ? languageMap.get(qualifier) : qualifier;\n}\n/**\n * Formats the date consisting of day, month and year.\n * All parts of the date are optional.\n */\nfunction formatDateOnly(day, month, year, locale) {\n    if (!day && !month && !year) {\n        return '';\n    }\n    // Fall back to formatting the date manually in case of\n    // - locale not provided\n    // - English (to avoid formatting like 'Oct 11, 2009')\n    // - Lack of i18n support in the browser\n    if (!Intl || !Intl.DateTimeFormat || !locale || locale === 'en') {\n        return [day, month && getShortMonth(month, locale), year].join(' ');\n    }\n    var format = {\n        day: day ? 'numeric' : undefined,\n        month: month ? 'short' : undefined,\n        year: year ? 'numeric' : undefined,\n    };\n    return new Intl.DateTimeFormat(locale, format).format(new Date(year !== null && year !== void 0 ? year : 2000, month ? month - 1 : 1, day !== null && day !== void 0 ? day : 1));\n}\n/** Simple date formatter. */\nfunction formatDate(date, locale) {\n    return [\n        date.qualifier && getQualifier(date.qualifier, locale),\n        formatDateOnly(date.day, date.month, date.year, locale),\n        date.text,\n    ].join(' ');\n}\nexports.formatDate = formatDate;\n/** Formats a DateOrRange object. */\nfunction formatDateOrRange(dateOrRange, locale) {\n    if (dateOrRange.date) {\n        return formatDate(dateOrRange.date, locale);\n    }\n    if (!dateOrRange.dateRange) {\n        return '';\n    }\n    var from = dateOrRange.dateRange.from && formatDate(dateOrRange.dateRange.from);\n    var to = dateOrRange.dateRange.to && formatDate(dateOrRange.dateRange.to);\n    if (from && to) {\n        return from + \" .. \" + to;\n    }\n    if (from) {\n        return getQualifier('after', locale) + \" \" + from;\n    }\n    if (to) {\n        return getQualifier('before', locale) + \" \" + to;\n    }\n    return '';\n}\nexports.formatDateOrRange = formatDateOrRange;\n","var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\n\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nrequire(\"array-flat-polyfill\");\n__exportStar(require(\"./ancestor-chart\"), exports);\n__exportStar(require(\"./api\"), exports);\n__exportStar(require(\"./chart-util\"), exports);\n__exportStar(require(\"./composite-renderer\"), exports);\n__exportStar(require(\"./data\"), exports);\n__exportStar(require(\"./date-format\"), exports);\n__exportStar(require(\"./descendant-chart\"), exports);\n__exportStar(require(\"./detailed-renderer\"), exports);\n__exportStar(require(\"./gedcom\"), exports);\n__exportStar(require(\"./hourglass-chart\"), exports);\n__exportStar(require(\"./kinship-chart\"), exports);\n__exportStar(require(\"./relatives-chart\"), exports);\n__exportStar(require(\"./simple-api\"), exports);\n__exportStar(require(\"./simple-renderer\"), exports);\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.ChartColors = void 0;\nlet ChartColors;\n(function (ChartColors) {\n    ChartColors[ChartColors[\"NO_COLOR\"] = 0] = \"NO_COLOR\";\n    ChartColors[ChartColors[\"COLOR_BY_GENERATION\"] = 1] = \"COLOR_BY_GENERATION\";\n    ChartColors[ChartColors[\"COLOR_BY_SEX\"] = 2] = \"COLOR_BY_SEX\";\n    ChartColors[ChartColors[\"COLOR_BY_TRIBE\"] = 3] = \"COLOR_BY_TRIBE\";\n    ChartColors[ChartColors[\"COLOR_BY_LANGUAGES\"] = 4] = \"COLOR_BY_LANGUAGES\";\n})\n// eslint-disable-next-line\n(ChartColors = exports.ChartColors || (exports.ChartColors = {}));\n","var __extends = (this && this.__extends) || (function () {\n    let extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({__proto__: []} instanceof Array && function (d, b) {\n                d.__proto__ = b;\n            }) ||\n            function (d, b) {\n                for (const p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n            };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        if (b === null) {\n            d.prototype = Object.create(b);\n        } else {\n            __.prototype = b.prototype;  // Set the prototype of __ to b's prototype\n            d.prototype = new __();      // Create a new instance of __ to set as d's prototype\n        }\n    };\n})();\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DetailedRenderer = exports.getLength = void 0;\n\nconst d3_selection_1 = require(\"d3-selection\");\nconst _1 = require(\"./index\");\nconst date_format_1 = require(\"./date-format\");\nconst d3_array_1 = require(\"d3-array\");\nrequire(\"d3-transition\");\nconst composite_renderer_1 = require(\"./composite-renderer\");\nconst INDI_MIN_HEIGHT = 44;\nconst INDI_MIN_WIDTH = 64;\nconst FAM_MIN_HEIGHT = 10;\nconst FAM_MIN_WIDTH = 15;\nconst IMAGE_WIDTH = 70;\n\n/** Minimum box height when an image is present. */\nconst IMAGE_HEIGHT = 90;\nconst TRIBE_HEIGHT = 17;\nconst LANGUAGES_HEIGHT = 17;\nconst DETAILS_HEIGHT = 17;\nconst ANIMATION_DELAY_MS = 200;\nconst ANIMATION_DURATION_MS = 500;\nconst textLengthCache = new Map();\n\n/** Calculates the length of the given text in pixels when rendered. */\nfunction getLength(text, textClass) {\n    const cacheKey = text + \"|\" + textClass;\n    if (textLengthCache.has(cacheKey)) {\n        return textLengthCache.get(cacheKey);\n    }\n    const g = d3_selection_1.select('svg').append('g').attr('class', 'detailed node');\n    const x = g.append('text').attr('class', textClass).text(text);\n    const length = x.node().getComputedTextLength();\n    g.remove();\n    textLengthCache.set(cacheKey, length);\n    return length;\n}\nexports.getLength = getLength;\n\nconst SEX_SYMBOLS = new Map([\n    ['F', '\\u2640'],\n    ['M', '\\u2642'],\n]);\n\n/**\n * Renders some details about a person such as date and place of birth\n * and death.\n */\nvar DetailedRenderer = /** @class */ (function (_super) {\n    __extends(DetailedRenderer, _super);\n\n    function DetailedRenderer(options) {\n        var _this = _super.call(this, options) || this;\n        _this.options = options;\n        return _this;\n    }\n\n    DetailedRenderer.prototype.getColoringClass = function () {\n        switch (this.options.colors) {\n            case _1.ChartColors.NO_COLOR:\n                return 'nocolor';\n            case _1.ChartColors.COLOR_BY_GENERATION:\n                return 'bygeneration';\n            case _1.ChartColors.COLOR_BY_SEX:\n                return 'bysex';\n            case _1.ChartColors.COLOR_BY_TRIBE:\n                return 'bytribe';\n            case _1.ChartColors.COLOR_BY_LANGUAGES:\n                return 'bylanguages';\n            default:\n                return 'bygeneration';\n        }\n    };\n\n    /** Extracts lines of details for a person. */\n    DetailedRenderer.prototype.getIndiDetails = function (indi) {\n        const detailsList = [];\n        const birthDate = indi.getBirthDate() && date_format_1.formatDateOrRange(indi.getBirthDate(), this.options.locale);\n        const birthPlace = indi.getBirthPlace();\n        const deathDate = indi.getDeathDate() && date_format_1.formatDateOrRange(indi.getDeathDate(), this.options.locale);\n        const deathPlace = indi.getDeathPlace();\n        if (birthDate) {\n            detailsList.push({ symbol: '', text: birthDate });\n        }\n        if (birthPlace) {\n            detailsList.push({ symbol: '', text: birthPlace });\n        }\n        if (birthDate || birthPlace) {\n            detailsList[0].symbol = '*';\n        }\n        const listIndex = detailsList.length;\n        if (deathDate) {\n            detailsList.push({ symbol: '', text: deathDate });\n        }\n        if (deathPlace) {\n            detailsList.push({ symbol: '', text: deathPlace });\n        }\n        if (deathDate || deathPlace) {\n            detailsList[listIndex].symbol = '+';\n        }\n        else if (indi.isConfirmedDeath()) {\n            detailsList.push({ symbol: '+', text: '' });\n        }\n        return detailsList;\n    };\n\n    DetailedRenderer.prototype.getPreferredIndiSize = function (id) {\n        // Height\n        const indi = this.options.data.getIndi(id);\n        const details = this.getIndiDetails(indi);\n        const tribeHeight = indi.showTribe() && indi.getTribe() != null ? TRIBE_HEIGHT : 0;\n        const languagesHeight = indi.showLanguages() && indi.getLanguages() != null ? LANGUAGES_HEIGHT : 0;\n        const idAndSexHeight = indi.showId() || indi.showSex() ? DETAILS_HEIGHT : 0;\n        const height = d3_array_1.max([\n            INDI_MIN_HEIGHT + languagesHeight + tribeHeight + (details.length * DETAILS_HEIGHT) + idAndSexHeight,\n            indi.getImageUrl() ? IMAGE_HEIGHT : 0,\n        ]);\n        // Width\n        const maxDetailsWidth = d3_array_1.max(details.map(detail => getLength(detail.text, 'details')));\n        const width = d3_array_1.max([\n            maxDetailsWidth + 22,\n            getLength(indi.getFirstName() || '', 'name') + 8,\n            getLength(indi.getLastName() || '', 'name') + 8,\n            indi.showLanguages() && indi.getLanguages() != null ? (getLength(indi.getLanguagesLabel(), 'languages') + 28) : 0,\n            indi.showTribe() && indi.getTribe() != null ? (getLength(indi.getTribe(), 'tribe') + 28) : 0,\n            getLength(id, 'id') + 32,\n            INDI_MIN_WIDTH,\n        ]) + (indi.getImageUrl() ? IMAGE_WIDTH : 0);\n        return [width, height];\n    };\n\n    /** Extracts lines of details for a family. */\n    DetailedRenderer.prototype.getFamDetails = function (fam) {\n        const detailsList = [];\n        const marriageDate = fam.getMarriageDate() &&\n            date_format_1.formatDateOrRange(fam.getMarriageDate(), this.options.locale);\n        const marriagePlace = fam.getMarriagePlace();\n        if (marriageDate) {\n            detailsList.push({ symbol: '', text: marriageDate });\n        }\n        if (marriagePlace) {\n            detailsList.push({ symbol: '', text: marriagePlace });\n        }\n        if (marriageDate || marriagePlace) {\n            detailsList[0].symbol = '\\u26AD';\n        }\n        return detailsList;\n    };\n\n    DetailedRenderer.prototype.getPreferredFamSize = function (id) {\n        const fam = this.options.data.getFam(id);\n        const details = this.getFamDetails(fam);\n        const height = d3_array_1.max([10 + details.length * DETAILS_HEIGHT, FAM_MIN_HEIGHT]);\n        const maxDetailsWidth = d3_array_1.max(details.map(function (x) { return getLength(x.text, 'details'); }));\n        const width = d3_array_1.max([maxDetailsWidth + 22, FAM_MIN_WIDTH]);\n        return [width, height];\n    };\n\n    DetailedRenderer.prototype.render = function (enter, update) {\n        const _this = this;\n        enter = enter.append('g').attr('class', 'detailed');\n        update = update.select('g');\n        const indiUpdate = enter\n            .merge(update)\n            .selectAll('g.indi')\n            .data(function (node) {\n                const result = [];\n                const famXOffset = !_this.options.horizontal && node.data.family\n                ? d3_array_1.max([-composite_renderer_1.getFamPositionVertical(node.data), 0])\n                : 0;\n                const famYOffset = _this.options.horizontal && node.data.family\n                ? d3_array_1.max([-composite_renderer_1.getFamPositionHorizontal(node.data), 0])\n                : 0;\n            if (node.data.indi) {\n                result.push({\n                    indi: node.data.indi,\n                    generation: node.data.generation,\n                    xOffset: famXOffset,\n                    yOffset: 0,\n                });\n            }\n            if (node.data.spouse) {\n                result.push({\n                    indi: node.data.spouse,\n                    generation: node.data.generation,\n                    xOffset: !_this.options.horizontal && node.data.indi\n                        ? node.data.indi.width + famXOffset\n                        : 0,\n                    yOffset: _this.options.horizontal && node.data.indi\n                        ? node.data.indi.height + famYOffset\n                        : 0,\n                });\n            }\n            return result;\n        }, function (data) { return data.indi.id; });\n        const indiEnter = indiUpdate\n            .enter()\n            .append('g')\n            .attr('class', 'indi');\n        this.transition(indiEnter.merge(indiUpdate)).attr('transform', function (node) { return \"translate(\" + node.xOffset + \", \" + node.yOffset + \")\"; });\n        this.renderIndi(indiEnter, indiUpdate);\n        const familyEnter = enter\n            .select(function (node) {\n            return node.data.family ? this : null;\n        }).append('g').attr('class', 'family');\n        const familyUpdate = update\n            .select(function (node) {\n            return node.data.family ? this : null;\n        }).select('g.family');\n        this.transition(familyEnter.merge(familyUpdate)).attr('transform', function (node) {\n            return _this.getFamTransform(node.data);\n        });\n        this.renderFamily(familyEnter);\n    };\n\n    DetailedRenderer.prototype.getCss = function () {\n        return null  // moved to external file\n    };\n\n    DetailedRenderer.prototype.transition = function (selection) {\n        return this.options.animate\n            ? selection\n                .transition()\n                .delay(ANIMATION_DELAY_MS)\n                .duration(ANIMATION_DURATION_MS)\n            : selection;\n    };\n\n    DetailedRenderer.prototype.getFamTransform = function (node) {\n        if (this.options.horizontal) {\n            return \"translate(\" + ((node.indi && node.indi.width) || node.spouse.width) + \", \" + d3_array_1.max([composite_renderer_1.getFamPositionHorizontal(node), 0]) + \")\";\n        }\n        return \"translate(\" + d3_array_1.max([composite_renderer_1.getFamPositionVertical(node), 0]) + \", \" + ((node.indi && node.indi.height) || node.spouse.height) + \")\";\n    };\n\n    DetailedRenderer.prototype.getSexClass = function (indiId) {\n        let _a;\n        const sex = (_a = this.options.data.getIndi(indiId)) === null || _a === void 0 ? void 0 : _a.getSex();\n        switch (sex) {\n            case 'M':\n                return 'male';\n            case 'F':\n                return 'female';\n            default:\n                return '';\n        }\n    };\n\n    const tribes_css = new Map();\n    DetailedRenderer.prototype.getTribeClass = function (indiId) {\n        let _a;\n        const indi = this.options.data.getIndi(indiId)\n        const tribe = (_a = this.options.data.getIndi(indiId)) === null || _a === void 0 ? void 0 : _a.getTribe();\n        if (tribe) {\n            if (indi.isEgo()) {\n                tribes_css.set(tribe, \"tribe0\")\n            } else {\n                if (!tribes_css.has(tribe)) {\n                    const startIndex = tribes_css.size + 1\n                    tribes_css.set(tribe, \"tribe\" + startIndex)\n                }\n            }\n            return tribes_css.get(tribe);\n        }\n        return ''  // Blank if not tribe\n    };\n\n    // const nLanguages_css = new Map();\n    DetailedRenderer.prototype.getLanguagesClass = function (indiId) {\n        let _a;\n        // const indi = this.options.data.getIndi(indiId)\n        const languages = (_a = this.options.data.getIndi(indiId)) === null || _a === void 0 ? void 0 : _a.getLanguages();\n        // TODO: improve, if > 7 then 7, etc\n        return languages.length > 0 ? 'n' + languages.length : '';\n    }\n\n    DetailedRenderer.prototype.renderIndi = function (enter, update) {\n        const _this = this;\n\n        if (this.options.indiHrefFunc) {\n            enter = enter\n                .append('a')\n                .attr('href', function (data) { return _this.options.indiHrefFunc(data.indi.id); });\n            update = update.select('a');\n        }\n\n        if (this.options.indiCallback) {\n            enter.on('click', function (event, data) {\n                return _this.options.indiCallback({\n                    id: data.indi.id,\n                    generation: data.generation,\n                });\n            });\n        }\n\n        // Background\n        const background = enter\n            .append('rect')\n            .attr('rx', 5)\n            .attr('stroke-width', 0)\n            .attr('class', function (node) {\n                return \"background \"\n                    +_this.getColoringClass() + \" \"\n                    + _this.getSexClass(node.indi.id) + \" \"\n                    + _this.getTribeClass(node.indi.id) + \" \"\n                    + _this.getLanguagesClass(node.indi.id) + \" \";\n            })\n            .merge(update.select('rect.background'));\n        this.transition(background)\n            .attr('width', function (node) { return node.indi.width; })\n            .attr('height', function (node) { return node.indi.height; });\n\n        // Clip path\n        const getClipId = function (id) {\n            return \"clip-\" + id;\n        };\n        enter\n            .append('clipPath')\n            .attr('id', function (node) { return getClipId(node.indi.id); })\n            .append('rect')\n            .attr('rx', 5)\n            .merge(update.select('clipPath rect'))\n            .attr('width', function (node) { return node.indi.width; })\n            .attr('height', function (node) { return node.indi.height; });\n        const getIndi = function (data) {\n            return _this.options.data.getIndi(data.indi.id);\n        };\n        const getDetailsWidth = function (data) {\n            return data.indi.width - (getIndi(data).getImageUrl() ? IMAGE_WIDTH : 0);\n        };\n\n        // Name\n        enter\n            .append('text')\n            .attr('text-anchor', 'middle')\n            .attr('class', 'name')\n            .attr('transform', function (node) { return \"translate(\" + getDetailsWidth(node) / 2 + \", 17)\"; })\n            .text(function (node) { return getIndi(node).getFirstName(); });\n        enter\n            .append('text')\n            .attr('text-anchor', 'middle')\n            .attr('class', 'name')\n            .attr('transform', function (node) { return \"translate(\" + getDetailsWidth(node) / 2 + \", 33)\"; })\n            .text(function (node) { return getIndi(node).getLastName(); })\n\n        // Languages\n        const languages = enter\n            .filter(function (node) {\n                return getIndi(node).showLanguages() && getIndi(node).getLanguages().length > 0\n            })\n            .append('text')\n            .attr('text-anchor', 'middle')\n            .attr('class', 'languages')\n            .text(function (node) {\n                return getIndi(node).getLanguagesLabel()\n            });\n        this.transition(languages).attr('transform', function (node) {\n            // if the indi does not have tribe to show, the height start does not apply\n            const languages_height_start =  getIndi(node).showLanguages() && getIndi(node).getLanguages().length > 0 ? 52 : null\n            return \"translate(\" + getDetailsWidth(node) / 2 + \", \" + languages_height_start + \")\";\n        });\n\n        // Tribe\n        const tribe = enter\n            .filter(function (node) {\n                return getIndi(node).showTribe() && getIndi(node).getTribe() != null\n            })\n            .append('text')\n            .attr('class', 'tribe')\n            .text(function (node) {\n                return ' ' + getIndi(node).getTribe()\n            });\n        this.transition(tribe).attr('transform', function (node) {\n            let tribe_height_start =  null\n            if (getIndi(node).showLanguages() && getIndi(node).getLanguages().length > 0) {\n                tribe_height_start = 71\n            } else if (getIndi(node).showTribe() && getIndi(node).getTribe() != null) {\n                tribe_height_start = 55\n            }\n            return \"translate(5, \" + tribe_height_start + \")\";\n        });\n\n        // Extract details\n        const details = new Map();\n        enter.each(function (node) {\n            const indi = getIndi(node);\n            const detailsList = _this.getIndiDetails(indi);\n            details.set(node.indi.id, detailsList);\n        });\n        const maxDetails = d3_array_1.max(Array.from(details.values(), function (v) {\n            return v.length;\n        }));\n\n        function details_height_start(node) {\n            return 55\n                + ((getIndi(node).showLanguages() && getIndi(node).getLanguages().length > 0) ? LANGUAGES_HEIGHT : 0)\n                + ((getIndi(node).showTribe() && getIndi(node).getTribe() != null) ? TRIBE_HEIGHT : 0)\n        }\n\n        const _loop_2 = function (i) {\n            const lineGroup = enter.filter(function (node) {\n                return details.get(node.indi.id).length > i;\n            });\n\n            lineGroup\n                .append('text')\n                .attr('text-anchor', 'middle')\n                .attr('class', 'details')\n                .attr('transform', function (node) {\n                    return \"translate(9, \" + (details_height_start(node) + i * DETAILS_HEIGHT) + \")\"\n                })\n                .text(function (node) {\n                    return details.get(node.indi.id)[i].symbol;\n                });\n            lineGroup\n                .append('text')\n                .attr('class', 'details')\n                .attr('transform', function (node) {\n                    return \"translate(15, \" + (details_height_start(node) + i * DETAILS_HEIGHT) + \")\"\n                })\n                .text(function (node) {\n                    return details.get(node.indi.id)[i].text;\n                });\n        };\n        // Render details\n        for (let i = 0; i < maxDetails; ++i) {\n            _loop_2(i);\n        }\n\n        // Render id\n        const id = enter\n            .append('text')\n            .attr('class', 'id')\n            .text(function (node) {\n                return (getIndi(node).showId() ? node.indi.id : '');\n            })\n            .merge(update.select('text.id'));\n        this.transition(id).attr('transform', function (node) { return \"translate(9, \" + (node.indi.height - 5) + \")\"; });\n\n        // Render sex\n        const sex = enter\n            .append('text')\n            .attr('class', 'details sex')\n            .attr('text-anchor', 'end')\n            .text(function (node) {\n                const sexSymbol = SEX_SYMBOLS.get(getIndi(node).getSex() || '') || '';\n                return getIndi(node).showSex() ? sexSymbol : '';\n            })\n            .merge(update.select('text.sex'));\n        this.transition(sex).attr('transform', function (node) {\n            return \"translate(\" + (getDetailsWidth(node) - 5) + \", \" + (node.indi.height - 5) + \")\";\n        });\n\n        // Image\n        enter.filter(function (node) { return !!getIndi(node).getImageUrl(); })\n            .append('image')\n            .attr('width', IMAGE_WIDTH)\n            .attr('height', function (node) { return node.indi.height; })\n            .attr('preserveAspectRatio', 'xMidYMin')\n            .attr('transform', function (node) { return \"translate(\" + (node.indi.width - IMAGE_WIDTH) + \", 0)\"; })\n            .attr('clip-path', function (node) { return \"url(#\" + getClipId(node.indi.id) + \")\"; })\n            .attr('href', function (node) { return getIndi(node).getImageUrl(); });\n\n        // Border on top\n        const border = enter\n            .append('rect')\n            .attr('rx', 5)\n            .attr('fill-opacity', 0)\n            .attr('class', 'border')\n            .merge(update.select('rect.border'));\n        this.transition(border)\n            .attr('width', function (node) { return node.indi.width; })\n            .attr('height', function (node) { return node.indi.height; });\n    };\n\n    DetailedRenderer.prototype.renderFamily = function (enter) {\n        const _this = this;\n\n        if (this.options.famHrefFunc) {\n            enter = enter\n                .append('a')\n                .attr('href', function (node) {\n                return _this.options.famHrefFunc(node.data.family.id);\n            });\n        }\n\n        if (this.options.famCallback) {\n            enter.on('click', function (event, node) {\n                return _this.options.famCallback({\n                    id: node.data.family.id,\n                    generation: node.data.generation,\n                });\n            });\n        }\n\n        // Extract details\n        const details = new Map();\n        enter.each(function (node) {\n            const famId = node.data.family.id;\n            const fam = _this.options.data.getFam(famId);\n            const detailsList = _this.getFamDetails(fam);\n            details.set(famId, detailsList);\n        });\n        const maxDetails = d3_array_1.max(Array.from(details.values(), function (v) {\n            return v.length;\n        }));\n\n        // Box\n        enter.filter(function (node) {\n                const detail = details.get(node.data.family.id);\n                return 0 < detail.length;\n        }).append('rect')\n        .attr('class', this.getColoringClass())\n        .attr('rx', 5)\n        .attr('ry', 5)\n        .attr('width', function (node) { return node.data.family.width; })\n        .attr('height', function (node) { return node.data.family.height; });\n        const _loop_2 = function (i) {\n            const lineGroup = enter.filter(function (node) {\n                return details.get(node.data.family.id).length > i;\n            });\n            lineGroup\n                .append('text')\n                .attr('text-anchor', 'middle')\n                .attr('class', 'details')\n                .attr('transform', \"translate(9, \" + (16 + i * DETAILS_HEIGHT) + \")\")\n                .text(function (node) {\n                    return details.get(node.data.family.id)[i].symbol;\n                });\n            lineGroup\n                .append('text')\n                .attr('text-anchor', 'start')\n                .attr('class', 'details')\n                .attr('transform', \"translate(15, \" + (16 + i * DETAILS_HEIGHT) + \")\")\n                .text(function (node) {\n                    return details.get(node.data.family.id)[i].text;\n                });\n        };\n        // Render details\n        for (let i = 0; i < maxDetails; ++i) {\n            _loop_2(i);\n        }\n    };\n\n    return DetailedRenderer;\n}(composite_renderer_1.CompositeRenderer));\nexports.DetailedRenderer = DetailedRenderer;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.gedcomEntriesToJson = exports.gedcomToJson = exports.getDate = void 0;\n\nvar parse_gedcom_1 = require(\"parse-gedcom\");\n\n/** Returns the first entry with the given tag or undefined if not found. */\nfunction findTag(tree, tag) {\n    return tree.find(function (entry) { return entry.tag === tag; });\n}\n\n/** Returns all entries with the given tag. */\nfunction findTags(tree, tag) {\n    return tree.filter(function (entry) { return entry.tag === tag; });\n}\n\n/**\n * Returns the identifier extracted from a pointer string.\n * E.g. '@I123@' -> 'I123'\n */\nfunction pointerToId(pointer) {\n    return pointer.substring(1, pointer.length - 1);\n}\n\n/** Extracts the first and last name from a GEDCOM name field. */\nfunction extractName(name) {\n    const arr = name.split('/');\n    if (arr.length === 1) {\n        return { firstName: arr[0].trim() };\n    }\n    return { firstName: arr[0].trim(), lastName: arr[1].trim() };\n}\n\n/** Maps month abbreviations used in GEDCOM to month numbers. */\nconst MONTHS = new Map([\n    ['jan', 1],\n    ['feb', 2],\n    ['mar', 3],\n    ['apr', 4],\n    ['may', 5],\n    ['jun', 6],\n    ['jul', 7],\n    ['aug', 8],\n    ['sep', 9],\n    ['oct', 10],\n    ['nov', 11],\n    ['dec', 12],\n]);\n\n/** Parses the GEDCOM date into the Date structure. */\nfunction parseDate(parts) {\n    let lastPart;\n    if (!parts || !parts.length) {\n        return undefined;\n    }\n    const result = {};\n    // Remove parentheses if they surround the text\n    if (parts[0].startsWith('(') && parts[parts.length - 1].endsWith(')')) {\n        parts[0] = parts[0].substring(1);\n        lastPart = parts[parts.length - 1];\n        parts[parts.length - 1] = lastPart.substring(0, lastPart.length - 1);\n    }\n    const fullText = parts.join(' ');\n    const firstPart = parts[0].toLowerCase();\n    if (firstPart === 'cal' || firstPart === 'abt' || firstPart === 'est') {\n        result.qualifier = firstPart;\n        parts = parts.slice(1);\n    }\n    if (parts.length && parts[parts.length - 1].match(/^\\d{1,4}$/)) {\n        result.year = Number(parts[parts.length - 1]);\n        parts = parts.slice(0, parts.length - 1);\n    }\n    if (parts.length) {\n        lastPart = parts[parts.length - 1].toLowerCase();\n        if (MONTHS.has(lastPart)) {\n            result.month = MONTHS.get(lastPart);\n            parts = parts.slice(0, parts.length - 1);\n        }\n    }\n    if (parts.length && parts[0].match(/^\\d\\d?$/)) {\n        result.day = Number(parts[0]);\n        parts = parts.slice(0, parts.length - 1);\n    }\n    if (parts.length) {\n        // A part didn't get parsed. Return the whole text verbatim.\n        return { text: fullText };\n    }\n    return result;\n}\n\n/** Parses a GEDCOM date or date range. */\nfunction getDate(gedcomDate) {\n    const parts = gedcomDate.replace(/@.*@/, '').trim().split(' ');\n    const firstPart = parts[0].toLowerCase();\n    if (firstPart.startsWith('bet')) {\n        const i = parts.findIndex(function (x) {\n            return x.toLowerCase() === 'and';\n        });\n        const from = parseDate(parts.slice(1, i));\n        const to = parseDate(parts.slice(i + 1));\n        return { dateRange: { from: from, to: to } };\n    }\n    if (firstPart.startsWith('bef') || firstPart.startsWith('aft')) {\n        const date_1 = parseDate(parts.slice(1));\n        if (firstPart.startsWith('bef')) {\n            return { dateRange: { to: date_1 } };\n        }\n        return { dateRange: { from: date_1 } };\n    }\n    const date = parseDate(parts);\n    if (date) {\n        return { date: date };\n    }\n    return undefined;\n}\nexports.getDate = getDate;\n\n/**\n * Tries to treat an input tag as NOTE and parse all lines of notes\n */\nfunction createNotes(notesTag) {\n    if (!notesTag || notesTag.tag !== 'NOTE')\n        return undefined;\n    return findTags(notesTag.tree, 'CONT')\n        .filter(function (x) { return x.data; })\n        .reduce(function (a, i) { return a.concat(i.data); }, [notesTag.data]);\n}\n\n/**\n * Creates a JsonEvent object from a GEDCOM entry.\n * Used for BIRT, DEAT and MARR tags.\n */\nfunction createEvent(entry) {\n    if (!entry) {\n        return undefined;\n    }\n    const typeTag = findTag(entry.tree, 'TYPE');\n    const dateTag = findTag(entry.tree, 'DATE');\n    const placeTag = findTag(entry.tree, 'PLAC');\n    const date = dateTag && dateTag.data && getDate(dateTag.data);\n    const place = placeTag && placeTag.data;\n    if (date || place) {\n        const result = date || {};\n        if (place) {\n            result.place = place;\n        }\n        result.confirmed = true;\n        result.type = typeTag ? typeTag.data : undefined;\n        result.notes = createNotes(findTag(entry.tree, 'NOTE'));\n        return result;\n    }\n    if (entry.data && entry.data.toLowerCase() === 'y') {\n        return { confirmed: true };\n    }\n    return undefined;\n}\n\n/** Creates a JsonIndi object from an INDI entry in GEDCOM. */\nfunction createIndi(entry, objects, ego) {\n    let firstName;\n    let lastName;\n    const id = pointerToId(entry.pointer);\n    const fams = findTags(entry.tree, 'FAMS').map(function (entry) {\n        return pointerToId(entry.data);\n    });\n    const indi = {id: id, fams: fams};\n\n    // is Ego?\n    if (ego) {\n        indi.isEgo = pointerToId(ego.pointer) === id\n    }\n\n    // Name\n    const nameTags = findTags(entry.tree, 'NAME');\n    const isMaiden = function (nameTag) {\n        const type = findTag(nameTag.tree, 'TYPE');\n        return type !== undefined && type.data === 'maiden';\n    };\n    const main = nameTags.find(function (x) {\n        return !isMaiden(x);\n    });\n    const maiden = nameTags.find(isMaiden);\n    if (main) {\n        const _a = extractName(main.data);\n        firstName = _a.firstName;\n        lastName = _a.lastName;\n        if (firstName) {\n            indi.firstName = firstName;\n        }\n        if (lastName) {\n            indi.lastName = lastName;\n        }\n    }\n    if (maiden) {\n        let _b = extractName(maiden.data);\n        firstName = _b.firstName;\n        lastName = _b.lastName;\n        if (lastName) {\n            indi.maidenName = lastName;\n        }\n        if (firstName && !indi.firstName) {\n            indi.firstName = firstName;\n        }\n    }\n    // Number of children\n    const nchiTag = findTag(entry.tree, 'NCHI');\n    if (nchiTag) {\n        indi.numberOfChildren = +nchiTag.data;\n    }\n    // Number of marriages\n    const nmrTag = findTag(entry.tree, 'NMR');\n    if (nmrTag) {\n        indi.numberOfMarriages = +nmrTag.data;\n    }\n    // Sex\n    const sexTag = findTag(entry.tree, 'SEX');\n    if (sexTag) {\n        indi.sex = sexTag.data;\n    }\n    // Languages\n    const languageTags = findTags(entry.tree, 'LANG')\n    if (languageTags) {\n        indi.languages = findTags(entry.tree, 'LANG').map(lang => lang.data)\n    }\n\n    // Tribe\n    const tribeTag = findTag(entry.tree, '_TRIB');\n    if (tribeTag) {\n        indi.tribe = tribeTag.data;\n    }\n    // Family with parents\n    const famcTag = findTag(entry.tree, 'FAMC');\n    if (famcTag) {\n        indi.famc = pointerToId(famcTag.data);\n    }\n    // Image URL\n    const objeTags = findTags(entry.tree, 'OBJE');\n    if (objeTags.length > 0) {\n        // Dereference OBJECT if needed\n        const getFileTag = function (tag) {\n            const realObjeTag = tag.data ? objects.get(pointerToId(tag.data)) : tag;\n            if (!realObjeTag)\n                return undefined;\n            const file = findTag(realObjeTag.tree, 'FILE');\n            const title = findTag(realObjeTag.tree, 'TITL');\n            if (!file)\n                return undefined;\n            return {\n                url: file.data,\n                title: title && title.data,\n            };\n        };\n        indi.images = objeTags\n            .map(getFileTag)\n            .filter(function (x) { return x !== undefined; });\n    }\n    // Birthdate and place\n    const birth = createEvent(findTag(entry.tree, 'BIRT'));\n    if (birth) {\n        indi.birth = birth;\n    }\n    // Death date and place\n    const death = createEvent(findTag(entry.tree, 'DEAT'));\n    if (death) {\n        indi.death = death;\n    }\n    // Notes\n    indi.notes = createNotes(findTag(entry.tree, 'NOTE'));\n    // Events\n    indi.events = findTags(entry.tree, 'EVEN')\n        .map(createEvent)\n        .filter(function (x) { return x !== null; });\n    return indi;\n}\n\n/** Creates a JsonFam object from an FAM entry in GEDCOM. */\nfunction createFam(entry) {\n    const id = pointerToId(entry.pointer);\n    const children = findTags(entry.tree, 'CHIL').map(function (entry) {\n        return pointerToId(entry.data);\n    });\n    const fam = {id: id, children: children};\n    // Husband.\n    const husbTag = findTag(entry.tree, 'HUSB');\n    if (husbTag) {\n        fam.husb = pointerToId(husbTag.data);\n    }\n    // Wife.\n    const wifeTag = findTag(entry.tree, 'WIFE');\n    if (wifeTag) {\n        fam.wife = pointerToId(wifeTag.data);\n    }\n    // Marriage\n    const marriage = createEvent(findTag(entry.tree, 'MARR'));\n    if (marriage) {\n        fam.marriage = marriage;\n    }\n    return fam;\n}\n\n/** Creates a map from ID to entry from an array of entries. */\nfunction createMap(entries) {\n    return new Map(entries.map(function (entry) { return [pointerToId(entry.pointer), entry]; }));\n}\n\n/** Parses a GEDCOM file into a JsonGedcomData structure. */\nfunction gedcomToJson(gedcomContents) {\n    return gedcomEntriesToJson(parse_gedcom_1.parse(gedcomContents));\n}\nexports.gedcomToJson = gedcomToJson;\n\n/** Converts parsed GEDCOM entries into a JsonGedcomData structure. */\nfunction gedcomEntriesToJson(gedcom) {\n    const objects = createMap(findTags(gedcom, 'OBJE'));\n    const ego = findTags(gedcom, 'EGO')\n    const indis = findTags(gedcom, 'INDI').map(function (entry) {\n        return createIndi(entry, objects, ego.length > 0 ? ego[0]: undefined);\n    });\n    const fams = findTags(gedcom, 'FAM').map(createFam);\n    return { indis: indis, fams: fams };\n}\nexports.gedcomEntriesToJson = gedcomEntriesToJson;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.HourglassChart = void 0;\nvar ancestor_chart_1 = require(\"./ancestor-chart\");\nvar chart_util_1 = require(\"./chart-util\");\nvar descendant_chart_1 = require(\"./descendant-chart\");\n/**\n * Renders an hourglass chart. It consists of an ancestor chart and\n * a descendant chart for a family.\n */\nvar HourglassChart = /** @class */ (function () {\n    function HourglassChart(options) {\n        this.options = options;\n        this.util = new chart_util_1.ChartUtil(options);\n    }\n    HourglassChart.prototype.render = function () {\n        var ancestorsRoot = ancestor_chart_1.getAncestorsTree(this.options);\n        var ancestorNodes = this.util.layOutChart(ancestorsRoot, {\n            flipVertically: true,\n        });\n        var descendantNodes = descendant_chart_1.layOutDescendants(this.options);\n        // slice(1) removes the duplicated start node.\n        var nodes = ancestorNodes.slice(1).concat(descendantNodes);\n        var animationPromise = this.util.renderChart(nodes);\n        var info = chart_util_1.getChartInfo(nodes);\n        this.util.updateSvgDimensions(info);\n        return Object.assign(info, { animationPromise: animationPromise });\n    };\n    return HourglassChart;\n}());\nexports.HourglassChart = HourglassChart;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.KinshipChart = void 0;\nvar renderer_1 = require(\"./kinship/renderer\");\nvar hierarchy_creator_1 = require(\"./kinship/hierarchy-creator\");\nvar KinshipChart = /** @class */ (function () {\n    function KinshipChart(options) {\n        this.options = options;\n        this.renderer = new renderer_1.KinshipChartRenderer(this.options);\n    }\n    KinshipChart.prototype.render = function () {\n        var _this = this;\n        var hierarchy = hierarchy_creator_1.HierarchyCreator.createHierarchy(this.options.data, new hierarchy_creator_1.EntryId(this.options.startIndi || null, this.options.startFam || null));\n        var _a = this.renderer.layOut(hierarchy.upRoot, hierarchy.downRoot), upNodes = _a[0], downNodes = _a[1];\n        upNodes.concat(downNodes).forEach(function (node) {\n            _this.setChildNodesGenerationNumber(node);\n        });\n        return this.renderer.render(upNodes, downNodes, hierarchy_creator_1.getRootsCount(hierarchy.upRoot, this.options.data));\n    };\n    KinshipChart.prototype.setChildNodesGenerationNumber = function (node) {\n        var childNodes = this.getChildNodesByType(node);\n        var setGenerationNumber = function (childNodes, value) {\n            return childNodes.forEach(function (n) { return (n.data.generation = node.data.generation + value); });\n        };\n        setGenerationNumber(childNodes.indiParents, -1);\n        setGenerationNumber(childNodes.indiSiblings, 0);\n        setGenerationNumber(childNodes.spouseParents, -1);\n        setGenerationNumber(childNodes.spouseSiblings, 0);\n        setGenerationNumber(childNodes.children, 1);\n    };\n    KinshipChart.prototype.getChildNodesByType = function (node) {\n        if (!node || !node.children)\n            return EMPTY_HIERARCHY_TREE_NODES;\n        // Maps id to node object for all children of the input node\n        var childNodesById = new Map(node.children.map(function (n) { return [n.data.id, n]; }));\n        var nodeToHNode = function (n) {\n            return childNodesById.get(n.id);\n        };\n        var childNodes = node.data.childNodes;\n        return {\n            indiParents: childNodes.indiParents.map(nodeToHNode),\n            indiSiblings: childNodes.indiSiblings.map(nodeToHNode),\n            spouseParents: childNodes.spouseParents.map(nodeToHNode),\n            spouseSiblings: childNodes.spouseSiblings.map(nodeToHNode),\n            children: childNodes.children.map(nodeToHNode),\n        };\n    };\n    return KinshipChart;\n}());\nexports.KinshipChart = KinshipChart;\nvar EMPTY_HIERARCHY_TREE_NODES = {\n    indiParents: [],\n    indiSiblings: [],\n    spouseParents: [],\n    spouseSiblings: [],\n    children: [],\n};\n","const __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\nexports.KinshipChartRenderer = void 0;\nvar d3_array_1 = require(\"d3-array\");\nvar api_1 = require(\"./api\");\nvar chart_util_1 = require(\"../chart-util\");\nvar utils_1 = require(\"../utils\");\nvar LINKS_BASE_OFFSET = 17;\nvar PARENT_LINK_ANCHOR_X_OFFSET = 15;\nvar SIBLING_LINK_ANCHOR_Y_OFFSET = 5;\nvar SIBLING_LINK_STARTER_LENGTH = 7;\nvar LINKS_SEPARATION = 6;\nvar LINK_STUB_CIRCLE_R = 3;\nvar KinshipChartRenderer = /** @class */ (function () {\n    function KinshipChartRenderer(options) {\n        this.options = options;\n        this.util = new chart_util_1.ChartUtil(this.options);\n    }\n    KinshipChartRenderer.prototype.layOut = function (upRoot, downRoot) {\n        var svg = this.util.getSvgForRendering();\n        // Add styles so that calculating text size is correct.\n        if (svg.select('style').empty()) {\n            svg.append('style').text(this.options.renderer.getCss());\n        }\n        return [\n            this.util.layOutChart(upRoot, { flipVertically: true }),\n            this.util.layOutChart(downRoot),\n        ];\n    };\n    KinshipChartRenderer.prototype.render = function (upNodes, downNodes, rootsCount) {\n        var _this = this;\n        var allNodes = upNodes.concat(downNodes);\n        var allNodesDeduped = allNodes.slice(1); // Remove duplicate start/center node\n        // Prepare for rendering\n        upNodes.forEach(function (node) { return _this.setLinkYs(node, true); });\n        downNodes.forEach(function (node) { return _this.setLinkYs(node, false); });\n        // Render chart\n        var animationPromise = this.util.renderNodes(allNodesDeduped, this.util.getSvgForRendering());\n        this.renderLinks(allNodes);\n        if (rootsCount > 1) {\n            this.renderRootDummyAdditionalMarriageLinkStub(allNodes[0]);\n        }\n        var info = chart_util_1.getChartInfo(allNodesDeduped);\n        this.util.updateSvgDimensions(info);\n        return Object.assign(info, { animationPromise: animationPromise });\n    };\n    KinshipChartRenderer.prototype.renderLinks = function (nodes) {\n        var _this = this;\n        var svgg = this.util.getSvgForRendering().select('g');\n        var keyFn = function (d) { return d.data.id; };\n        // Render links\n        var boundLinkNodes = svgg.selectAll('path.internode-link').data(nodes.filter(function (n) { return !!n.parent; }), keyFn);\n        boundLinkNodes\n            .enter()\n            .insert('path', 'g')\n            .attr('class', function (node) { return _this.cssClassForLink(node); })\n            .merge(boundLinkNodes)\n            .attr('d', function (node) {\n            var linkPoints = node.data.primaryMarriage\n                ? _this.additionalMarriageLinkPoints(node)\n                : _this.linkPoints(node.parent, node, node.data.linkFromParentType);\n            return utils_1.points2pathd(linkPoints);\n        });\n        boundLinkNodes.exit().remove();\n        // Render link stubs container \"g\" element\n        var boundLinkStubNodes = svgg.selectAll('g.link-stubs').data(nodes.filter(function (n) { return n.data.duplicateOf || n.data.duplicated || n.data.primaryMarriage; }), keyFn);\n        var linkStubNodesEnter = boundLinkStubNodes\n            .enter()\n            .insert('g', 'g')\n            .attr('class', 'link-stubs');\n        boundLinkStubNodes.exit().remove();\n        // Render link stubs\n        var boundLinkStubs = linkStubNodesEnter\n            .merge(boundLinkStubNodes)\n            .selectAll('g')\n            .data(function (node) { return _this.nodeToLinkStubRenderInfos(node); }, function (d) { return d.linkType.toString(); });\n        boundLinkStubs\n            .enter()\n            .append('g')\n            .call(function (g) {\n            return g\n                .append('path')\n                .attr('class', function (d) { return _this.cssClassForLinkStub(d.linkType); })\n                .merge(boundLinkStubs.select('path.link-stub'))\n                .attr('d', function (d) { return utils_1.points2pathd(d.points); });\n        })\n            .call(function (g) {\n            return g\n                .append('circle')\n                .attr('r', LINK_STUB_CIRCLE_R)\n                .style('stroke', 'black')\n                .style('fill', 'none')\n                .merge(boundLinkStubs.select('circle'))\n                .attr('transform', function (d) {\n                return \"translate(\" + utils_1.last(d.points).x + \", \" + (utils_1.last(d.points).y + LINK_STUB_CIRCLE_R * d.treeDir) + \")\";\n            });\n        });\n        boundLinkStubs.exit().remove();\n    };\n    KinshipChartRenderer.prototype.cssClassForLink = function (fromNode) {\n        if (fromNode.data.primaryMarriage) {\n            return 'link internode-link additional-marriage';\n        }\n        return ('link internode-link ' +\n            this.cssClassForLinkType(fromNode.data.linkFromParentType));\n    };\n    KinshipChartRenderer.prototype.cssClassForLinkStub = function (linkType) {\n        return 'link link-stub ' + this.cssClassForLinkType(linkType);\n    };\n    KinshipChartRenderer.prototype.cssClassForLinkType = function (linkType) {\n        switch (linkType) {\n            case api_1.LinkType.IndiParents:\n            case api_1.LinkType.SpouseParents:\n                return 'parents-link';\n            case api_1.LinkType.IndiSiblings:\n            case api_1.LinkType.SpouseSiblings:\n                return 'siblings-link';\n            case api_1.LinkType.Children:\n                return 'children-link';\n            default:\n                return null;\n        }\n    };\n    KinshipChartRenderer.prototype.nodeToLinkStubRenderInfos = function (node) {\n        var _this = this;\n        return node.data.linkStubs.map(function (linkType) {\n            var isUpTree = node.y < node.parent.y;\n            var treeDir = isUpTree ? -1 : 1;\n            var anchorPoints = _this.linkAnchorPoints(node, linkType, isUpTree);\n            var y = node.data.linkYs.children -\n                (2 * LINKS_SEPARATION + 2 * LINK_STUB_CIRCLE_R) * treeDir;\n            return {\n                treeDir: treeDir,\n                linkType: linkType,\n                points: __spreadArray(__spreadArray([], anchorPoints), [{ x: utils_1.last(anchorPoints).x, y: y }]),\n            };\n        });\n    };\n    KinshipChartRenderer.prototype.getLinkY = function (node, type) {\n        switch (type) {\n            case api_1.LinkType.IndiParents:\n                return node.data.linkYs.indi;\n            case api_1.LinkType.IndiSiblings:\n                return node.data.linkYs.indi;\n            case api_1.LinkType.SpouseParents:\n                return node.data.linkYs.spouse;\n            case api_1.LinkType.SpouseSiblings:\n                return node.data.linkYs.spouse;\n            case api_1.LinkType.Children:\n                return node.data.linkYs.children;\n            default:\n                return null;\n        }\n    };\n    KinshipChartRenderer.prototype.setLinkYs = function (node, isUpTree) {\n        var treeDir = isUpTree ? -1 : 1;\n        var base = node.y + (node.data.height / 2 + LINKS_BASE_OFFSET) * treeDir;\n        var offset = LINKS_SEPARATION * treeDir;\n        var _a = this.calcLinkOffsetDirs(node), indiOffsetDir = _a[0], spouseOffsetDir = _a[1];\n        node.data.linkYs = {\n            indi: base + offset * indiOffsetDir,\n            spouse: base + offset * spouseOffsetDir,\n            children: base,\n        };\n    };\n    /***\n     * Calculates indi (indiParent and indiSiblings) and spouse (spouseParent and spouseSiblings)\n     * links offset directions, so they don't merge/collide with children links and with each other.\n     ***/\n    KinshipChartRenderer.prototype.calcLinkOffsetDirs = function (node) {\n        let indiParentLinkAnchorX;\n        var childNodes = node.data.childNodes;\n        if (childNodes.children.length) {\n            // Check children-indi and children-spouse links collisions\n            indiParentLinkAnchorX = this.linkAnchorPoints(node, api_1.LinkType.IndiParents, true)[0].x;\n            var spouseParentLinkAnchorX = this.linkAnchorPoints(node, api_1.LinkType.SpouseParents, true)[0].x;\n            var childrenLinksX = {\n                min: this.findMinXOfChildNodesAnchors(node, childNodes.children),\n                max: this.findMaxXOfChildNodesAnchors(node, childNodes.children),\n            };\n            if (childrenLinksX.min < indiParentLinkAnchorX &&\n                childrenLinksX.max > spouseParentLinkAnchorX) {\n                return [-1, -1]; // This shouldn't happen! It can't happen with start node, because start node have children links going down and other links going up. It can't happen with non-start node, as there can't be outgoing indi, spouse and children links at the same time on non-start node. -- But.. It might be useful to not remove it, so that this function might be used when constructing links for other types of charts.\n            }\n            else if (childrenLinksX.min < indiParentLinkAnchorX) {\n                return [-1, 1];\n            }\n            else if (childrenLinksX.max > spouseParentLinkAnchorX) {\n                return [1, -1];\n            }\n        }\n        else if ((childNodes.indiParents.length || childNodes.indiSiblings.length) &&\n            (childNodes.spouseParents.length || childNodes.spouseSiblings.length)) {\n            // Check indi-spouse links collision\n            indiParentLinkAnchorX = this.linkAnchorPoints(node, api_1.LinkType.IndiParents, true)[0].x;\n            const spouseLinksMinX = this.findMinXOfChildNodesAnchors(node, childNodes.spouseSiblings.concat(childNodes.spouseParents));\n            if (spouseLinksMinX < indiParentLinkAnchorX) {\n                return [-1, 1];\n            }\n        }\n        return [1, -1];\n    };\n    KinshipChartRenderer.prototype.findMinXOfChildNodesAnchors = function (parentNode, childNodes) {\n        return this.findExtremeXOfChildNodesAnchors(parentNode, childNodes, true);\n    };\n    KinshipChartRenderer.prototype.findMaxXOfChildNodesAnchors = function (parentNode, childNodes) {\n        return this.findExtremeXOfChildNodesAnchors(parentNode, childNodes, false);\n    };\n    KinshipChartRenderer.prototype.findExtremeXOfChildNodesAnchors = function (parentNode, childNodes, isMin) {\n        var extremeFindingFunction = isMin ? d3_array_1.min : d3_array_1.max;\n        var dir = isMin ? -1 : 1;\n        var childNodesSet = new Set(childNodes);\n        return (extremeFindingFunction(parentNode.children.filter(function (n) { return childNodesSet.has(n.data); }), function (n) { return n.x + (dir * n.data.width) / 2; }) +\n            dir * SIBLING_LINK_STARTER_LENGTH);\n    };\n    KinshipChartRenderer.prototype.linkPoints = function (from, to, type) {\n        var isUpTree = from.y > to.y;\n        var pointsFrom = this.linkAnchorPoints(from, type, isUpTree);\n        var pointsTo = this.linkAnchorPoints(to, api_1.otherSideLinkType(type), !isUpTree).reverse();\n        var y = this.getLinkY(from, type);\n        return __spreadArray(__spreadArray(__spreadArray([], pointsFrom), [\n            { x: pointsFrom[pointsFrom.length - 1].x, y: y },\n            { x: pointsTo[0].x, y: y }\n        ]), pointsTo);\n    };\n    KinshipChartRenderer.prototype.additionalMarriageLinkPoints = function (node) {\n        var nodeIndex = node.parent.children.findIndex(function (n) { return n.data.id === node.data.id; });\n        var prevSiblingNode = node.parent.children[nodeIndex - 1];\n        var y = this.indiMidY(node);\n        return [\n            { x: prevSiblingNode.x, y: y },\n            { x: node.x, y: y },\n        ];\n    };\n    KinshipChartRenderer.prototype.linkAnchorPoints = function (node, type, top) {\n        var _a = [node.x, node.y], x = _a[0], y = _a[1];\n        var _b = [node.data.width, node.data.height], w = _b[0], h = _b[1];\n        var leftEdge = x - w / 2;\n        var rightEdge = x + w / 2;\n        var _c = [\n            node.data.indi,\n            node.data.spouse,\n            node.data.family,\n        ].map(function (e) { return (e ? e.width : 0); }), indiW = _c[0], spouseW = _c[1], familyW = _c[2];\n        var indisW = indiW + spouseW;\n        var indisLeftEdge = x - w / 2 + (familyW > indisW ? (familyW - indisW) / 2 : 0);\n        var indisRightEdge = indisLeftEdge + indisW;\n        var siblingAnchorY = this.indiMidY(node) + SIBLING_LINK_ANCHOR_Y_OFFSET * (top ? -1 : 1);\n        switch (type) {\n            case api_1.LinkType.IndiParents:\n                return [\n                    { x: indisLeftEdge + PARENT_LINK_ANCHOR_X_OFFSET, y: y - h / 2 },\n                ];\n            case api_1.LinkType.SpouseParents:\n                return [\n                    { x: indisRightEdge - PARENT_LINK_ANCHOR_X_OFFSET, y: y - h / 2 },\n                ];\n            case api_1.LinkType.IndiSiblings:\n                return [\n                    { x: indisLeftEdge, y: siblingAnchorY },\n                    {\n                        x: (familyW > indisW && !top ? leftEdge : indisLeftEdge) -\n                            SIBLING_LINK_STARTER_LENGTH,\n                        y: siblingAnchorY,\n                    },\n                ];\n            case api_1.LinkType.SpouseSiblings:\n                return [\n                    { x: indisRightEdge, y: siblingAnchorY },\n                    {\n                        x: (familyW > indisW && !top ? rightEdge : indisRightEdge) +\n                            SIBLING_LINK_STARTER_LENGTH,\n                        y: siblingAnchorY,\n                    },\n                ];\n            case api_1.LinkType.Children:\n                return [\n                    { x: indisLeftEdge + (node.data.spouse ? indiW : indiW / 2), y: y },\n                ];\n            default:\n                return null;\n        }\n    };\n    KinshipChartRenderer.prototype.indiMidY = function (node) {\n        return node.y - node.data.height / 2 + node.data.indi.height / 2;\n    };\n    KinshipChartRenderer.prototype.renderRootDummyAdditionalMarriageLinkStub = function (root) {\n        var svgg = this.util.getSvgForRendering().select('g');\n        var y = this.indiMidY(root);\n        var x = root.data.width / 2 + 20;\n        var r = 3;\n        svgg.selectAll('.root-dummy-additional-marriage').remove();\n        svgg\n            .insert('g', 'g')\n            .attr('class', 'root-dummy-additional-marriage')\n            .call(function (g) {\n            return g\n                .append('path')\n                .attr('d', \"M 0 \" + y + \" L \" + x + \" \" + y)\n                .attr('class', 'link additional-marriage');\n        })\n            .call(function (g) {\n            return g\n                .append('circle')\n                .attr('transform', \"translate(\" + (x + r) + \", \" + y + \")\")\n                .attr('r', r)\n                .style('stroke', 'black')\n                .style('fill', 'black');\n        });\n    };\n    return KinshipChartRenderer;\n}());\nexports.KinshipChartRenderer = KinshipChartRenderer;\n","import {ChildNodes, LinkType, otherSideLinkType} from \"./api\";\nimport {hierarchy} from \"d3-hierarchy\";\nimport {HierarchyFilter} from \"./hierarchy-filter\";\nimport {IdGenerator} from \"../id-generator\";\nimport {nonEmpty} from \"../utils\";\n\n/* ID of indi or fam */\nconst EntryId = /** @class */ (function () {\n    class EntryId {\n        constructor(indiId, famId) {\n            if (!indiId && !famId)\n                throw new Error('Invalid EntryId');\n            this.id = (indiId || famId);\n            this.isFam = !!famId;\n        }\n\n        static indi(id) {\n            return new EntryId(id, null);\n        }\n\n        static fam(id) {\n            return new EntryId(null, id);\n        }\n    }\n\n    return EntryId;\n}());\n(function () {\n    class HierarchyCreator {\n        constructor(data, startEntryId) {\n            let _a;\n            this.data = data;\n            this.queuedNodesById = new Map();\n            this.idGenerator = new IdGenerator();\n            _a = this.expandStartId(startEntryId);\n            this.startEntryId = _a[0];\n            this.startFamIndi = _a[1];\n        }\n\n        // Convert entry id to values of startEntryId and startFamIndi fields\n        expandStartId(startEntryId) {\n            if (startEntryId.isFam)\n                return [startEntryId, null];\n            const indi = this.data.getIndi(startEntryId.id);\n            if (!indi)\n                throw new Error('Invalid startId');\n            const famsIds = indi.getFamiliesAsSpouse();\n            if (famsIds.length)\n                return [EntryId.fam(famsIds[0]), startEntryId.id];\n            return [startEntryId, null];\n        }\n\n        createHierarchy() {\n            const upRoot = this.idToNode(this.startEntryId, null, null, false);\n            const downRoot = this.idToNode(this.startEntryId, null, null, false);\n            if (!upRoot || !downRoot)\n                throw new Error('Invalid root node');\n            if (this.startFamIndi) {\n                upRoot.indi = {id: this.startFamIndi};\n                downRoot.indi = {id: this.startFamIndi};\n            }\n            const queue = [upRoot, downRoot];\n            while (queue.length) {\n                const node = queue.shift();\n                const filter = node === upRoot\n                    ? HierarchyCreator.UP_FILTER\n                    : node === downRoot\n                        ? HierarchyCreator.DOWN_FILTER\n                        : HierarchyCreator.ALL_ACCEPTING_FILTER;\n                this.fillNodeData(node, filter);\n                let _i = 0, _a = node.childNodes.getAll();\n                for (; _i < _a.length; _i++) {\n                    const childNode = _a[_i];\n                    queue.push(childNode);\n                }\n            }\n            const getChildNodes = function (node) {\n                const childNodes = node.childNodes.getAll();\n                return childNodes.length ? childNodes : null;\n            };\n            return {\n                upRoot: hierarchy(upRoot, getChildNodes),\n                downRoot: hierarchy(downRoot, getChildNodes),\n            };\n        }\n\n        fillNodeData(node, filter) {\n            if (this.isFamNode(node)) {\n                const fam = this.data.getFam(node.id);\n                const _a = node.indi && node.indi.id === fam.getMother()\n                    ? [fam.getMother(), fam.getFather()]\n                    : [fam.getFather(), fam.getMother()], indiId = _a[0], spouseId = _a[1];\n                Object.assign(node, {\n                    id: this.idGenerator.getId(node.id),\n                    indi: indiId && {id: indiId},\n                    spouse: spouseId && {id: spouseId},\n                });\n                if (!node.duplicateOf && !node.duplicated) {\n                    node.childNodes = this.childNodesForFam(fam, node, filter);\n                }\n            } else {\n                const indi = this.data.getIndi(node.id);\n                Object.assign(node, {\n                    id: this.idGenerator.getId(node.id),\n                    indi: {id: indi.getId()},\n                });\n                if (!node.duplicateOf && !node.duplicated) {\n                    node.childNodes = this.childNodesForIndi(indi, node, filter);\n                }\n            }\n            node.linkStubs = this.createLinkStubs(node);\n        }\n\n        childNodesForFam(fam, parentNode, filter) {\n            const indi = parentNode.indi ? this.data.getIndi(parentNode.indi.id) : null;\n            const spouse = parentNode.spouse\n                ? this.data.getIndi(parentNode.spouse.id)\n                : null;\n            const _a = this.getParentsAndSiblings(indi), indiParentsFamsIds = _a[0], indiSiblingsIds = _a[1];\n            const _b = this.getParentsAndSiblings(spouse), spouseParentsFamsIds = _b[0], spouseSiblingsIds = _b[1];\n            const childrenIds = fam.getChildren();\n            return new ChildNodes({\n                indiParents: filter.indiParents\n                    ? this.famAsSpouseIdsToNodes(indiParentsFamsIds, parentNode, LinkType.IndiParents)\n                    : [],\n                indiSiblings: filter.indiSiblings\n                    ? this.indiIdsToFamAsSpouseNodes(indiSiblingsIds, parentNode, LinkType.IndiSiblings)\n                    : [],\n                spouseParents: filter.spouseParents\n                    ? this.famAsSpouseIdsToNodes(spouseParentsFamsIds, parentNode, LinkType.SpouseParents)\n                    : [],\n                spouseSiblings: filter.spouseSiblings\n                    ? this.indiIdsToFamAsSpouseNodes(spouseSiblingsIds, parentNode, LinkType.SpouseSiblings)\n                    : [],\n                children: filter.children\n                    ? this.indiIdsToFamAsSpouseNodes(childrenIds, parentNode, LinkType.Children)\n                    : [],\n            });\n        }\n\n        childNodesForIndi(indi, parentNode, filter) {\n            const _a = this.getParentsAndSiblings(indi), indiParentsFamsIds = _a[0], indiSiblingsIds = _a[1];\n            return new ChildNodes({\n                indiParents: filter.indiParents\n                    ? this.famAsSpouseIdsToNodes(indiParentsFamsIds, parentNode, LinkType.IndiParents)\n                    : [],\n                indiSiblings: filter.indiSiblings\n                    ? this.indiIdsToFamAsSpouseNodes(indiSiblingsIds, parentNode, LinkType.IndiSiblings)\n                    : [],\n            });\n        }\n\n        areParentsAndSiblingsPresent(indiId) {\n            const indi = indiId && this.data.getIndi(indiId);\n            const famcId = indi && indi.getFamilyAsChild();\n            const famc = famcId && this.data.getFam(famcId);\n            if (!famc)\n                return [false, false];\n            return [\n                !!(famc.getFather() || famc.getMother()),\n                famc.getChildren().length > 1,\n            ];\n        }\n\n        getParentsAndSiblings(indi) {\n            const indiFamcId = indi && indi.getFamilyAsChild();\n            const indiFamc = this.data.getFam(indiFamcId);\n            if (!indiFamc)\n                return [[], []];\n            const father = this.data.getIndi(indiFamc.getFather());\n            const mother = this.data.getIndi(indiFamc.getMother());\n            const parentFamsIds = []\n                .concat(father ? father.getFamiliesAsSpouse() : [], mother ? mother.getFamiliesAsSpouse() : [])\n                .filter(function (id) {\n                    return id !== indiFamcId;\n                });\n            parentFamsIds.unshift(indiFamcId);\n            const siblingsIds = Array.from(indiFamc.getChildren());\n            siblingsIds.splice(siblingsIds.indexOf(indi.getId()), 1); // Remove indi from indi's siblings\n            return [parentFamsIds, siblingsIds];\n        }\n\n        indiIdsToFamAsSpouseNodes(indiIds, parentNode, childNodeType) {\n            const _this = this;\n            return indiIds.flatMap(function (id) {\n                return _this.indiIdToFamAsSpouseNodes(id, parentNode, childNodeType);\n            });\n        }\n\n        indiIdToFamAsSpouseNodes(indiId, parentNode, childNodeType) {\n            const _this = this;\n            if (this.isChildNodeTypeForbidden(childNodeType, parentNode))\n                return [];\n            const famsIds = this.data.getIndi(indiId).getFamiliesAsSpouse();\n            if (!famsIds.length) {\n                const node = this.idToNode(EntryId.indi(indiId), parentNode, childNodeType);\n                return node ? [node] : [];\n            }\n            const famsNodes = famsIds.map(function (id) {\n                return {\n                    id: id,\n                    indi: {id: indiId},\n                    family: {id: id},\n                    parentNode: parentNode,\n                    linkFromParentType: childNodeType,\n                    childNodes: ChildNodes.EMPTY,\n                    linkStubs: [],\n                };\n            });\n            famsNodes.forEach(function (node, i) {\n                if (i !== 0)\n                    node.primaryMarriage = famsNodes[0];\n                const duplicateOf = _this.queuedNodesById.get(node.id);\n                if (duplicateOf) {\n                    node.duplicateOf = duplicateOf;\n                    duplicateOf.duplicated = true;\n                } else\n                    _this.queuedNodesById.set(node.id, node);\n            });\n            return famsNodes;\n        }\n\n        famAsSpouseIdsToNodes(famsIds, parentNode, childNodeType) {\n            const nodes = this.idsToNodes(famsIds.map(EntryId.fam), parentNode, childNodeType);\n            nodes.slice(1).forEach(function (node) {\n                return (node.primaryMarriage = nodes[0]);\n            });\n            return nodes;\n        }\n\n        idsToNodes(entryIds, parentNode, childNodeType, duplicateCheck) {\n            const _this = this;\n            if (duplicateCheck === void 0) {\n                duplicateCheck = true;\n            }\n            return entryIds\n                .map(function (entryId) {\n                    return _this.idToNode(entryId, parentNode, childNodeType, duplicateCheck);\n                })\n                .filter(function (node) {\n                    return node != null;\n                });\n        }\n\n        idToNode(entryId, parentNode, childNodeType, duplicateCheck) {\n            if (duplicateCheck === void 0) {\n                duplicateCheck = true;\n            }\n            if (this.isChildNodeTypeForbidden(childNodeType, parentNode))\n                return null;\n            const id = entryId.id, isFam = entryId.isFam;\n            if (isFam) {\n                const fam = this.data.getFam(id);\n                if (!fam || (!fam.getFather() && !fam.getMother()))\n                    return null; // Don't create fam nodes that are missing both husband and wife\n            }\n            const duplicateOf = this.queuedNodesById.get(id);\n            const node = {\n                id: id,\n                parentNode: parentNode,\n                linkFromParentType: childNodeType,\n                childNodes: ChildNodes.EMPTY,\n                linkStubs: [],\n            };\n            if (isFam)\n                node.family = {id: id};\n            if (duplicateCheck && duplicateOf) {\n                node.duplicateOf = duplicateOf;\n                duplicateOf.duplicated = true;\n            }\n            if (!duplicateOf)\n                this.queuedNodesById.set(id, node);\n            return node;\n        }\n\n        createLinkStubs(node) {\n            const _this = this;\n            if (!this.isFamNode(node) ||\n                (!node.duplicateOf && !node.duplicated && !node.primaryMarriage)) {\n                return [];\n            }\n            const fam = this.data.getFam(node.family.id);\n            const _a = this.areParentsAndSiblingsPresent(node.indi ? node.indi.id : null), indiParentsPresent = _a[0],\n                indiSiblingsPresent = _a[1];\n            const _b = this.areParentsAndSiblingsPresent(node.spouse ? node.spouse.id : null),\n                spouseParentsPresent = _b[0],\n                spouseSiblingsPresent = _b[1];\n            const childrenPresent = nonEmpty(fam.getChildren());\n            return [\n                indiParentsPresent ? [LinkType.IndiParents] : [],\n                indiSiblingsPresent ? [LinkType.IndiSiblings] : [],\n                spouseParentsPresent ? [LinkType.SpouseParents] : [],\n                spouseSiblingsPresent ? [LinkType.SpouseSiblings] : [],\n                childrenPresent ? [LinkType.Children] : [],\n            ]\n                .flat()\n                .filter(function (linkType) {\n                    return !_this.isChildNodeTypeForbidden(linkType, node) &&\n                        !node.childNodes.get(linkType).length;\n                });\n        }\n\n        isChildNodeTypeForbidden(childNodeType, parentNode) {\n            if (childNodeType === null || !parentNode)\n                return false;\n            switch (otherSideLinkType(parentNode.linkFromParentType)) {\n                case LinkType.IndiParents:\n                case LinkType.IndiSiblings:\n                    if (childNodeType === LinkType.IndiParents ||\n                        childNodeType === LinkType.IndiSiblings) {\n                        return true;\n                    }\n                    break;\n                case LinkType.Children:\n                    if (!parentNode.primaryMarriage &&\n                        childNodeType === LinkType.Children) {\n                        return true;\n                    }\n                    break;\n                default:\n                    return null;\n            }\n            if (parentNode.primaryMarriage) {\n                // Forbid indi/spouse from parentNode that is also indi/spouse in primaryMarriage from having parents and siblings, as they are already added to primaryMarriage node. This prevents drawing parents/siblings of a person for each marriage of this person.\n                const indiId = parentNode.indi.id;\n                const spouseId = parentNode.spouse.id;\n                const pmIndiId = parentNode.primaryMarriage.indi.id;\n                const pmSpouseId = parentNode.primaryMarriage.spouse.id;\n                if (indiId === pmIndiId || indiId === pmSpouseId) {\n                    if (childNodeType === LinkType.IndiParents ||\n                        childNodeType === LinkType.IndiSiblings) {\n                        return true;\n                    }\n                } else if (spouseId === pmIndiId || spouseId === pmSpouseId) {\n                    if (childNodeType === LinkType.SpouseParents ||\n                        childNodeType === LinkType.SpouseSiblings) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        }\n\n        isFamNode(node) {\n            return !!node.family;\n        }\n\n        static createHierarchy(data, startEntryId) {\n            return new HierarchyCreator(data, startEntryId).createHierarchy();\n        }\n    }\n\n    HierarchyCreator.UP_FILTER = HierarchyFilter.allRejecting().modify({\n        indiParents: true,\n        spouseParents: true,\n        indiSiblings: true,\n        spouseSiblings: true,\n    });\n    HierarchyCreator.DOWN_FILTER = HierarchyFilter.allRejecting().modify({\n        children: true,\n    });\n    HierarchyCreator.ALL_ACCEPTING_FILTER = HierarchyFilter.allAccepting();\n    return HierarchyCreator;\n}());\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RelativesChart = void 0;\nvar ancestor_chart_1 = require(\"./ancestor-chart\");\nvar id_generator_1 = require(\"./id-generator\");\nvar descendant_chart_1 = require(\"./descendant-chart\");\nvar d3_array_1 = require(\"d3-array\");\nvar chart_util_1 = require(\"./chart-util\");\n/** A view of a family that hides one child individual. */\nvar FilterChildFam = /** @class */ (function () {\n    function FilterChildFam(fam, childId) {\n        this.fam = fam;\n        this.childId = childId;\n    }\n    FilterChildFam.prototype.getId = function () {\n        return this.fam.getId();\n    };\n    FilterChildFam.prototype.getFather = function () {\n        return this.fam.getFather();\n    };\n    FilterChildFam.prototype.getMother = function () {\n        return this.fam.getMother();\n    };\n    FilterChildFam.prototype.getChildren = function () {\n        var children = __spreadArray([], this.fam.getChildren());\n        var index = children.indexOf(this.childId);\n        if (index !== -1) {\n            children.splice(index, 1);\n        }\n        return children;\n    };\n    return FilterChildFam;\n}());\n/** Data provider proxy that filters out a specific child individual. */\nvar FilterChildData = /** @class */ (function () {\n    function FilterChildData(data, childId) {\n        this.data = data;\n        this.childId = childId;\n    }\n    FilterChildData.prototype.getIndi = function (id) {\n        return this.data.getIndi(id);\n    };\n    FilterChildData.prototype.getFam = function (id) {\n        return new FilterChildFam(this.data.getFam(id), this.childId);\n    };\n    return FilterChildData;\n}());\n/** Chart layout showing all relatives of a person. */\nvar RelativesChart = /** @class */ (function () {\n    function RelativesChart(options) {\n        this.options = options;\n        this.util = new chart_util_1.ChartUtil(options);\n        this.options.idGenerator = this.options.idGenerator || new id_generator_1.IdGenerator();\n    }\n    RelativesChart.prototype.layOutAncestorDescendants = function (ancestorsRoot, focusedNode) {\n        // let ancestorDescentants: Array<HierarchyPointNode<TreeNode>> = [];\n        var _this = this;\n        var ancestorData = new Map();\n        ancestorsRoot.eachAfter(function (node) {\n            if (!node.parent) {\n                return;\n            }\n            var descendantOptions = __assign({}, _this.options);\n            descendantOptions.startFam = node.data.family.id;\n            descendantOptions.startIndi = undefined;\n            var child = node.id === node.parent.data.spouseParentNodeId\n                ? node.parent.data.spouse.id\n                : node.parent.data.indi.id;\n            descendantOptions.data = new FilterChildData(descendantOptions.data, child);\n            descendantOptions.baseGeneration =\n                (_this.options.baseGeneration || 0) - node.depth;\n            var descendantNodes = descendant_chart_1.layOutDescendants(descendantOptions);\n            // The id could be modified because of duplicates. This can happen when\n            // drawing one family in multiple places of the chart).\n            node.data.id = descendantNodes[0].id;\n            var chartInfo = chart_util_1.getChartInfoWithoutMargin(descendantNodes);\n            var parentData = (node.children || []).map(function (childNode) {\n                return ancestorData.get(childNode.data.id);\n            });\n            var parentHeight = parentData\n                .map(function (data) { return data.height; })\n                .reduce(function (a, b) { return a + b + chart_util_1.V_SPACING; }, 0);\n            var data = {\n                descendantNodes: descendantNodes,\n                width: chartInfo.size[0],\n                height: chartInfo.size[1] + parentHeight,\n                x: chartInfo.origin[0],\n                y: chartInfo.origin[1] + parentHeight,\n            };\n            ancestorData.set(node.data.id, data);\n        });\n        ancestorsRoot.each(function (node) {\n            if (!node.parent) {\n                return;\n            }\n            var data = ancestorData.get(node.data.id);\n            var parentData = ancestorData.get(node.parent.data.id);\n            data.left =\n                parentData && !parentData.middle\n                    ? parentData.left\n                    : node.parent.data.indiParentNodeId === node.id;\n            data.middle =\n                (!parentData || parentData.middle) &&\n                    node.parent.children.length === 1;\n        });\n        ancestorsRoot.each(function (node) {\n            var data = ancestorData.get(node.data.id);\n            var thisNode = data ? data.descendantNodes[0] : focusedNode;\n            (node.children || []).forEach(function (child) {\n                var childNode = ancestorData.get(child.data.id).descendantNodes[0];\n                childNode.parent = thisNode;\n            });\n            if (node.data.indiParentNodeId && node.children) {\n                thisNode.data.indiParentNodeId = node.children.find(function (childNode) { return childNode.id === node.data.indiParentNodeId; }).data.id;\n            }\n            if (node.data.spouseParentNodeId && node.children) {\n                thisNode.data.spouseParentNodeId = node.children.find(function (childNode) { return childNode.id === node.data.spouseParentNodeId; }).data.id;\n            }\n        });\n        ancestorsRoot.each(function (node) {\n            let middleX;\n            let parentData;\n            let parentNode;\n            let data;\n            var nodeData = ancestorData.get(node.data.id);\n            // Lay out the nodes produced by laying out descendants of ancestors\n            // instead of the ancestor nodes from ancestorsRoot.\n            var thisNode = nodeData ? nodeData.descendantNodes[0] : focusedNode;\n            var indiParent = node.children &&\n                node.children.find(function (child) { return child.id === node.data.indiParentNodeId; });\n            var spouseParent = node.children &&\n                node.children.find(function (child) { return child.id === node.data.spouseParentNodeId; });\n            var nodeX = thisNode.x;\n            var nodeY = thisNode.y;\n            var nodeWidth = thisNode.data.width;\n            var nodeHeight = thisNode.data.height;\n            var indiWidth = thisNode.data.indi ? thisNode.data.indi.width : 0;\n            var spouseWidth = thisNode.data.spouse\n                ? thisNode.data.spouse.width\n                : 0;\n            // Lay out the individual's ancestors and their descendants.\n            if (indiParent) {\n                data = ancestorData.get(indiParent.data.id);\n                parentNode = data.descendantNodes[0];\n                parentData = parentNode.data;\n                var spouseTreeHeight = spouseParent\n                    ? ancestorData.get(spouseParent.data.id).height + chart_util_1.V_SPACING\n                    : 0;\n                var dx_1 = nodeX +\n                    data.x -\n                    nodeWidth / 2 +\n                    indiWidth / 2 +\n                    (data.left ? -data.width - chart_util_1.H_SPACING : chart_util_1.H_SPACING);\n                var dy_1 = nodeY +\n                    data.y -\n                    nodeHeight / 2 -\n                    data.height +\n                    (data.left ? -chart_util_1.V_SPACING : -spouseTreeHeight - chart_util_1.V_SPACING);\n                // Move all nodes by (dx, dy). The ancestor node,\n                // ie. data.descendantNodes[0] is now at (0, 0).\n                data.descendantNodes.forEach(function (node) {\n                    node.x += dx_1;\n                    node.y += dy_1;\n                });\n                // Set the ancestor's horizontal position independently.\n                middleX = indiWidth / 2 -\n                    nodeWidth / 2 +\n                    parentData.width / 2 -\n                    (parentData.indi\n                        ? parentData.indi.width\n                        : parentData.spouse.width);\n                if (data.middle) {\n                    parentNode.x = 0;\n                }\n                else if (!nodeData || nodeData.middle) {\n                    parentNode.x =\n                        -nodeWidth / 2 - parentData.width / 2 + indiWidth - chart_util_1.H_SPACING / 2;\n                }\n                else if (data.left) {\n                    parentNode.x =\n                        nodeX +\n                            d3_array_1.min([\n                                nodeWidth / 2 -\n                                    parentData.width / 2 -\n                                    spouseWidth / 2 -\n                                    chart_util_1.H_SPACING,\n                                middleX,\n                            ]);\n                }\n                else {\n                    parentNode.x =\n                        nodeX + d3_array_1.max([parentData.width / 2 - nodeWidth / 2, middleX]);\n                }\n            }\n            // Lay out the spouse's ancestors and their descendants.\n            if (spouseParent) {\n                data = ancestorData.get(spouseParent.data.id);\n                parentNode = data.descendantNodes[0];\n                parentData = parentNode.data;\n                const indiTreeHeight = indiParent\n                    ? ancestorData.get(indiParent.data.id).height + chart_util_1.V_SPACING\n                    : 0;\n                const dx_2 = nodeX +\n                    data.x +\n                    nodeWidth / 2 -\n                    spouseWidth / 2 +\n                    (data.left ? -data.width - chart_util_1.H_SPACING : chart_util_1.H_SPACING);\n                const dy_2 = nodeY +\n                    data.y -\n                    nodeHeight / 2 -\n                    data.height +\n                    (data.left ? -indiTreeHeight - chart_util_1.V_SPACING : -chart_util_1.V_SPACING);\n                // Move all nodes by (dx, dy). The ancestor node,\n                // ie. data.descendantNodes[0] is now at (0, 0).\n                data.descendantNodes.forEach(function (node) {\n                    node.x += dx_2;\n                    node.y += dy_2;\n                });\n                // Set the ancestor's horizontal position independently.\n                middleX = nodeWidth / 2 -\n                    spouseWidth / 2 +\n                    parentData.width / 2 -\n                    (parentData.indi\n                        ? parentData.indi.width\n                        : parentData.spouse.width);\n                if (data.middle) {\n                    parentNode.x = 0;\n                }\n                else if (!nodeData || nodeData.middle) {\n                    parentNode.x =\n                        nodeWidth / 2 + parentData.width / 2 - spouseWidth + chart_util_1.H_SPACING / 2;\n                }\n                else if (data.left) {\n                    parentNode.x =\n                        nodeX + d3_array_1.min([nodeWidth / 2 - parentData.width / 2, middleX]);\n                }\n                else {\n                    parentNode.x =\n                        nodeX +\n                            d3_array_1.max([\n                                parentData.width / 2 - nodeWidth / 2 + indiWidth / 2 + chart_util_1.H_SPACING,\n                                middleX,\n                            ]);\n                }\n            }\n        });\n        return Array.from(ancestorData.values())\n            .map(function (data) { return data.descendantNodes; })\n            .reduce(function (a, b) { return a.concat(b); }, []);\n    };\n    RelativesChart.prototype.render = function () {\n        var descendantNodes = descendant_chart_1.layOutDescendants(this.options);\n        // Don't use common id generator because these nodes will not be drawn.\n        var ancestorOptions = Object.assign({}, this.options, {\n            idGenerator: undefined,\n        });\n        var ancestorsRoot = ancestor_chart_1.getAncestorsTree(ancestorOptions);\n        var ancestorDescentants = this.layOutAncestorDescendants(ancestorsRoot, descendantNodes[0]);\n        var nodes = descendantNodes.concat(ancestorDescentants);\n        var animationPromise = this.util.renderChart(nodes);\n        var info = chart_util_1.getChartInfo(nodes);\n        this.util.updateSvgDimensions(info);\n        return Object.assign(info, { animationPromise: animationPromise });\n    };\n    return RelativesChart;\n}());\nexports.RelativesChart = RelativesChart;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.createChart = void 0;\nvar d3_selection_1 = require(\"d3-selection\");\nvar data_1 = require(\"./data\");\nvar DEFAULT_SVG_SELECTOR = 'svg';\nfunction createChartOptions(chartOptions, renderOptions, options) {\n    var data = new data_1.JsonDataProvider(chartOptions.json);\n    const indiHrefFunc = chartOptions.indiUrl\n        ? function (id) {\n            return chartOptions.indiUrl.replace(`${id}`, id);\n        }\n        : undefined;\n    const famHrefFunc = chartOptions.famUrl\n        ? function (id) {\n            return chartOptions.famUrl.replace(`${id}`, id);\n        }\n        : undefined;\n    // If startIndi nor startFam is provided, select the first indi in the data.\n    if (!renderOptions.startIndi && !renderOptions.startFam) {\n        renderOptions.startIndi = chartOptions.json.indis[0].id;\n    }\n    const animate = !options.initialRender && chartOptions.animate;\n    return {\n        data: data,\n        renderer: new chartOptions.renderer({\n            data: data,\n            indiHrefFunc: indiHrefFunc,\n            famHrefFunc: famHrefFunc,\n            indiCallback: chartOptions.indiCallback,\n            famCallback: chartOptions.famCallback,\n            horizontal: chartOptions.horizontal,\n            colors: chartOptions.colors,\n            animate: animate,\n            locale: chartOptions.locale,\n        }),\n        startIndi: renderOptions.startIndi,\n        startFam: renderOptions.startFam,\n        svgSelector: chartOptions.svgSelector || DEFAULT_SVG_SELECTOR,\n        horizontal: chartOptions.horizontal,\n        baseGeneration: renderOptions.baseGeneration,\n        animate: animate,\n    };\n}\nvar SimpleChartHandle = /** @class */ (function () {\n    function SimpleChartHandle(options) {\n        this.options = options;\n        this.initialRender = true;\n    }\n    SimpleChartHandle.prototype.render = function (renderOptions) {\n        if (renderOptions === void 0) { renderOptions = {}; }\n        var chartOptions = createChartOptions(this.options, renderOptions, {\n            initialRender: this.initialRender,\n        });\n        this.initialRender = false;\n        var chart = new this.options.chartType(chartOptions);\n        var info = chart.render();\n        if (this.options.updateSvgSize !== false) {\n            d3_selection_1.select(chartOptions.svgSelector)\n                .attr('width', info.size[0])\n                .attr('height', info.size[1]);\n        }\n        return info;\n    };\n    /**\n     * Updates the chart input data.\n     * This is useful when the data is dynamically loaded and a different subset\n     * of data will be displayed.\n     */\n    SimpleChartHandle.prototype.setData = function (json) {\n        this.options.json = json;\n    };\n    return SimpleChartHandle;\n}());\nfunction createChart(options) {\n    return new SimpleChartHandle(options);\n}\nexports.createChart = createChart;\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        if (b === null) {\n            d.prototype = Object.create(b);\n        } else {\n            __.prototype = b.prototype;\n            d.prototype = new __();\n        }\n\n    };\n})();\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SimpleRenderer = void 0;\nvar d3_selection_1 = require(\"d3-selection\");\nvar composite_renderer_1 = require(\"./composite-renderer\");\nvar MIN_HEIGHT = 27;\nvar MIN_WIDTH = 50;\n/** Calculates the length of the given text in pixels when rendered. */\nfunction getLength(text) {\n    var g = d3_selection_1.select('svg').append('g').attr('class', 'simple node');\n    var x = g.append('text').attr('class', 'name').text(text);\n    var w = x.node().getComputedTextLength();\n    g.remove();\n    return w;\n}\nfunction getName(indi) {\n    return [indi.getFirstName() || '', indi.getLastName() || ''].join(' ');\n}\nfunction getYears(indi) {\n    const birthDate = indi.getBirthDate();\n    const birthYear = birthDate && birthDate.date && birthDate.date.year;\n    const deathDate = indi.getDeathDate();\n    const deathYear = deathDate && deathDate.date && deathDate.date.year;\n    if (!birthYear && !deathYear) {\n        return '';\n    }\n    return (birthYear || '') + \" \\u2013 \" + (deathYear || '');\n}\n/**\n * Simple rendering of an individual box showing only the person's name and\n * years of birth and death.\n */\nvar SimpleRenderer = /** @class */ (function (_super) {\n    __extends(SimpleRenderer, _super);\n    function SimpleRenderer(options) {\n        var _this = _super.call(this, options) || this;\n        _this.options = options;\n        return _this;\n    }\n    SimpleRenderer.prototype.getPreferredIndiSize = function (id) {\n        const indi = this.options.data.getIndi(id);\n        const years = getYears(indi);\n        const width = Math.max(getLength(getName(indi)) + 8, getLength(years), MIN_WIDTH);\n        const height = years ? MIN_HEIGHT + 14 : MIN_HEIGHT;\n        return [width, height];\n    };\n    SimpleRenderer.prototype.render = function (enter, update) {\n        const _this = this;\n        const selection = enter.merge(update).append('g').attr('class', 'simple');\n        this.renderIndi(selection, function (node) { return node.indi; });\n        const spouseSelection = selection\n            .filter(function (node) { return !!node.data.spouse; })\n            .append('g')\n            .attr('transform', function (node) {\n            return _this.options.horizontal\n                ? \"translate(0, \" + node.data.indi.height + \")\"\n                : \"translate(\" + node.data.indi.width + \", 0)\";\n        });\n        this.renderIndi(spouseSelection, function (node) { return node.spouse; });\n    };\n    SimpleRenderer.prototype.getCss = function () {\n        return \"\\n.simple text {\\n  font: 12px sans-serif;\\n}\\n\\n.simple .name {\\n  font-weight: bold;\\n}\\n\\n.simple rect {\\n  fill: #fff;\\n  stroke: black;\\n}\\n\\n.link {\\n  fill: none;\\n  stroke: #000;\\n  stroke-width: 1px;\\n}\\n\\n.additional-marriage {\\n  stroke-dasharray: 2;\\n}\";\n    };\n    SimpleRenderer.prototype.renderIndi = function (selection, indiFunc) {\n        const _this = this;\n        // Optionally add a link.\n        const group = this.options.indiHrefFunc\n            ? selection\n                .append('a')\n                .attr('href', function (node) {\n                return _this.options.indiHrefFunc(indiFunc(node.data).id);\n            })\n            : selection;\n        // Box.\n        group\n            .append('rect')\n            .attr('width', function (node) { return indiFunc(node.data).width; })\n            .attr('height', function (node) { return indiFunc(node.data).height; });\n        // Text.\n        group\n            .append('text')\n            .attr('text-anchor', 'middle')\n            .attr('class', 'name')\n            .attr('transform', function (node) { return \"translate(\" + indiFunc(node.data).width / 2 + \", 17)\"; })\n            .text(function (node) {\n            return getName(_this.options.data.getIndi(indiFunc(node.data).id));\n        });\n        group\n            .append('text')\n            .attr('text-anchor', 'middle')\n            .attr('class', 'details')\n            .attr('transform', function (node) { return \"translate(\" + indiFunc(node.data).width / 2 + \", 33)\"; })\n            .text(function (node) {\n            return getYears(_this.options.data.getIndi(indiFunc(node.data).id));\n        });\n    };\n    return SimpleRenderer;\n}(composite_renderer_1.CompositeRenderer));\nexports.SimpleRenderer = SimpleRenderer;\n","import {IndiInfo} from '../lib/topola';\nimport {TopolaData} from '../util/gedcom_util';\n\n/** Supported data sources. */\nexport enum DataSourceEnum {\n    UPLOADED,\n    GEDCOM_URL,\n    EMBEDDED,\n}\n\n/** Source specification together with individual selection. */\nexport interface SourceSelection<SourceSpecT> {\n    spec: SourceSpecT;\n    selection?: IndiInfo;\n}\n\n/** Interface encapsulating functions specific for a data source. */\nexport interface DataSource<SourceSpecT> {\n    /**\n     * Returns true if the application is now loading a completely new data set\n     * and the existing one should be wiped.\n     */\n    isNewData(\n        newSource: SourceSelection<SourceSpecT>,\n        oldSource: SourceSelection<SourceSpecT>,\n        data?: TopolaData,\n    ): boolean;\n\n    /** Loads data from the data source. */\n    loadData(spec: SourceSelection<SourceSpecT>): Promise<TopolaData>;\n}\n","import {FormattedMessage} from 'react-intl';\n\nconst TAG_DESCRIPTIONS = new Map([\n    ['ADOP', 'Adoption'],\n    ['BAPM', 'Baptism'],\n    ['BIRT', 'Birth'],\n    ['BURI', 'Burial'],\n    ['CENS', 'Census'],\n    ['CHR', 'Christening'],\n    ['CREM', 'Cremation'],\n    ['DEAT', 'Death'],\n    ['EDUC', 'Education'],\n    ['EMAIL', 'E-mail'],\n    ['EMIG', 'Emigration'],\n    ['EVEN', 'Event'],\n    ['FACT', 'Fact'],\n    ['IMMI', 'Immigration'],\n    ['MARR', 'Marriage'],\n    ['MARS', 'Marriage settlement'],\n    ['ETHN', 'Ethnic'],\n    ['TRIB', 'Clan'],\n    ['LANG', 'Language'],\n    ['DIV', 'Divorce'],\n    ['MILT', 'Military services'],\n    ['NATU', 'Naturalization'],\n    ['OCCU', 'Occupation'],\n    ['TITL', 'Title'],\n    ['WWW', 'WWW'],\n    ['birth', 'Birth name'],\n    ['married', 'Married name'],\n    ['maiden', 'Maiden name'],\n    ['immigrant', 'Immigrant name'],\n    ['aka', 'Also known as'],\n]);\n\ninterface Props {\n    tag: string;\n}\n\nexport function TranslatedTag(props: Props) {\n    const normalizedTag = props.tag.replace(/_/g, '');\n    return (\n        <FormattedMessage\n            id={`gedcom.${normalizedTag}`}\n            defaultMessage={TAG_DESCRIPTIONS.get(normalizedTag) || normalizedTag}\n        />\n    );\n}\n","import {\n    Container,\n    Icon,\n    Image,\n    Label,\n    Message,\n    Modal,\n    Placeholder,\n} from 'semantic-ui-react';\nimport {SyntheticEvent, useState} from 'react';\nimport {FormattedMessage} from 'react-intl';\n\ninterface Props {\n    url: string;\n    filename: string;\n    title?: string;\n}\n\nexport function WrappedImage(props: Props) {\n    const [imageOpen, setImageOpen] = useState(false);\n    const [imageLoaded, setImageLoaded] = useState(false);\n    const [imageFailed, setImageFailed] = useState(false);\n    const [imageSrc, setImageSrc] = useState('');\n\n    if (imageLoaded && imageSrc !== props.url) {\n        setImageLoaded(false);\n    }\n    return (\n        <>\n            <Image\n                className={imageLoaded ? 'loaded-image-thumbnail' : 'hidden-image'}\n                onClick={() => setImageOpen(true)}\n                onLoad={() => {\n                    setImageLoaded(true);\n                    setImageSrc(props.url);\n                    setImageFailed(false);\n                }}\n                onError={(e: SyntheticEvent<HTMLImageElement, Event>) => {\n                    setImageLoaded(true);\n                    setImageSrc(props.url);\n                    setImageFailed(true);\n                    e.currentTarget.alt = '';\n                }}\n                src={props.url}\n                alt={props.title || props.filename}\n                centered={true}\n            />\n            <Placeholder className={!imageLoaded ? 'image-placeholder' : 'hidden-image'}>\n                <Placeholder.Image square/>\n            </Placeholder>\n            {imageFailed && (\n                <Container fluid textAlign=\"center\">\n                    <Message negative compact>\n                        <Message.Header>\n                            <FormattedMessage\n                                id=\"error.failed_to_load_image\"\n                                defaultMessage={'Failed to load image file'}\n                            />\n                        </Message.Header>\n                    </Message>\n                </Container>\n            )}\n            <Modal\n                basic\n                size=\"large\"\n                closeIcon={<Icon name=\"close\" color=\"red\"/>}\n                open={imageOpen}\n                onClose={() => setImageOpen(false)}\n                onOpen={() => setImageOpen(true)}\n                centered={false}\n            >\n                <Modal.Header>{props.title}</Modal.Header>\n                <Modal.Content image>\n                    <Image\n                        className=\"modal-image\"\n                        src={props.url}\n                        alt={props.title || props.filename}\n                        label={<Label attached=\"bottom\" content={props.filename}/>}\n                        wrapped\n                    />\n                </Modal.Content>\n            </Modal>\n        </>\n    );\n}\n","import Linkify from 'react-linkify';\n\ninterface Props {\n    lines: (JSX.Element | string)[];\n}\n\nexport function MultilineText(props: Props) {\n    return (\n        <>\n            {props.lines.map((line, index) => (\n                <div key={index}>\n                    <Linkify properties={{target: '_blank'}}>{line}</Linkify>\n                    <br/>\n                </div>\n            ))}\n        </>\n    );\n}\n","import {FormattedMessage, IntlShape, useIntl} from 'react-intl';\nimport {Icon, Item, List, Menu, MenuItemProps, Popup, Tab,} from 'semantic-ui-react';\nimport * as React from 'react';\nimport {useState} from 'react';\nimport {WrappedImage} from './wrapped-image';\nimport {MultilineText} from './multiline-text';\nimport {DateOrRange} from '../lib/topola';\nimport {formatDateOrRange} from '../util/date_util';\nimport Linkify from 'react-linkify';\n\nexport interface Image {\n    url: string;\n    filename: string;\n    title?: string;\n}\n\nexport interface Source {\n    title?: string;\n    author?: string;\n    page?: string;\n    date?: DateOrRange;\n    publicationInfo?: string;\n}\n\ninterface Props {\n    images?: Image[];\n    notes?: string[][];\n    sources?: Source[];\n    indi: string;\n}\n\nfunction eventImages(images: Image[] | undefined) {\n    return (\n        !!images &&\n        images.map((image, index) => (\n            <List key={index}>\n                <List.Item>\n                    <WrappedImage\n                        url={image.url}\n                        filename={image.filename}\n                        title={image.title}\n                    />\n                </List.Item>\n            </List>\n        ))\n    );\n}\n\nfunction eventNotes(notes: string[][] | undefined) {\n    return (\n        !!notes?.length &&\n        notes.map((note, index) => (\n            <div key={index}>\n                <MultilineText\n                    lines={note.map((line, index) => (\n                        <i key={index}>{line}</i>\n                    ))}\n                />\n            </div>\n        ))\n    );\n}\n\nfunction eventSources(sources: Source[] | undefined, intl: IntlShape) {\n    return (\n        !!sources?.length && (\n            <List>\n                {sources.map((source, index) => (\n                    <List.Item key={index}>\n                        <List.Icon verticalAlign=\"middle\" name=\"circle\" size=\"tiny\"/>\n                        <List.Content>\n                            <List.Header>\n                                <Linkify properties={{target: '_blank'}}>\n                                    {[source.author, source.title, source.publicationInfo]\n                                        .filter((sourceElement) => sourceElement)\n                                        .join(', ')}\n                                </Linkify>\n                            </List.Header>\n                            <List.Description>\n                                <Linkify properties={{target: '_blank'}}>{source.page}</Linkify>\n                                {source.date\n                                    ? ' [' + formatDateOrRange(source.date, intl) + ']'\n                                    : null}\n                            </List.Description>\n                        </List.Content>\n                    </List.Item>\n                ))}\n            </List>\n        )\n    );\n}\n\nexport function EventExtras(props: Props) {\n    const intl = useIntl();\n    const [activeIndex, setActiveIndex] = useState(-1);\n    const [indi, setIndi] = useState('');\n\n    if (!indi || indi !== props.indi) {\n        setActiveIndex(-1);\n        setIndi(props.indi);\n    }\n\n    function handleTabOnClick(\n        event: React.MouseEvent<HTMLAnchorElement>,\n        menuItemProps: MenuItemProps,\n    ) {\n        menuItemProps.index !== undefined && activeIndex !== menuItemProps.index\n            ? setActiveIndex(menuItemProps.index)\n            : setActiveIndex(-1);\n    }\n\n    const imageTab = props.images?.length && {\n        menuItem: (\n            <Menu.Item fitted key=\"images\" onClick={handleTabOnClick}>\n                <Popup\n                    content={\n                        <FormattedMessage id=\"extras.images\" defaultMessage=\"Images\"/>\n                    }\n                    size=\"mini\"\n                    position=\"bottom center\"\n                    trigger={<Icon circular name=\"camera\"/>}\n                />\n            </Menu.Item>\n        ),\n        render: () => <Tab.Pane>{eventImages(props.images)}</Tab.Pane>,\n    };\n\n    const noteTab = props.notes?.length && {\n        menuItem: (\n            <Menu.Item fitted key=\"notes\" onClick={handleTabOnClick}>\n                <Popup\n                    content={\n                        <FormattedMessage id=\"extras.notes\" defaultMessage=\"Notes\"/>\n                    }\n                    size=\"mini\"\n                    position=\"bottom center\"\n                    trigger={<Icon circular name=\"sticky note outline\"/>}\n                />\n            </Menu.Item>\n        ),\n        render: () => <Tab.Pane>{eventNotes(props.notes)}</Tab.Pane>,\n    };\n\n    const sourceTab = props.sources?.length && {\n        menuItem: (\n            <Menu.Item fitted key=\"sources\" onClick={handleTabOnClick}>\n                <Popup\n                    content={\n                        <FormattedMessage id=\"extras.sources\" defaultMessage=\"Sources\"/>\n                    }\n                    size=\"mini\"\n                    position=\"bottom center\"\n                    trigger={<Icon circular name=\"quote right\"/>}\n                />\n            </Menu.Item>\n        ),\n        render: () => <Tab.Pane>{eventSources(props.sources, intl)}</Tab.Pane>,\n    };\n\n    const panes = [imageTab, noteTab, sourceTab].flatMap((tab) =>\n        tab ? [tab] : [],\n    );\n\n    if (panes.length) {\n        return (\n            <Item.Description>\n                <Tab\n                    className=\"event-extras\"\n                    activeIndex={activeIndex}\n                    renderActiveOnly={true}\n                    menu={{\n                        tabular: true,\n                        attached: true,\n                        compact: true,\n                        borderless: true,\n                    }}\n                    panes={panes}\n                />\n            </Item.Description>\n        );\n    }\n    return null;\n}\n","import * as queryString from 'query-string';\nimport flatMap from 'array.prototype.flatmap';\nimport {compareDates, formatDateOrRange} from '../util/date_util';\nimport {\n    dereference,\n    GedcomData,\n    getData,\n    getFileName,\n    getImageFileEntry,\n    getName,\n    pointerToId,\n} from '../util/gedcom_util';\nimport {GedcomEntry} from 'parse-gedcom';\nimport {FormattedMessage, useIntl} from 'react-intl';\nimport {Link, useLocation} from 'react-router-dom';\nimport {TranslatedTag} from './translated-tag';\nimport {Header, Item} from 'semantic-ui-react';\nimport {EventExtras, Image, Source} from './event-extras';\nimport {DateOrRange, getDate} from '../lib/topola';\n\nfunction PersonLink(props: { person: GedcomEntry }) {\n    const location = useLocation();\n    const name = getName(props.person);\n    const search = queryString.parse(location.search);\n    search['indi'] = pointerToId(props.person.pointer);\n    return (\n        <Item.Meta>\n            <Link to={{pathname: '/view', search: queryString.stringify(search)}}>\n                {name ? (name) : (<FormattedMessage id=\"name.unknown_name\" defaultMessage=\"N.N.\"/>)}\n            </Link>\n        </Item.Meta>\n    );\n}\n\ninterface Props {\n    gedcom: GedcomData;\n    indi: string;\n    entries: GedcomEntry[];\n}\n\ninterface EventData {\n    type: string;\n    date?: DateOrRange;\n    personLink?: GedcomEntry;\n    place?: string[];\n    images?: Image[];\n    notes?: string[][];\n    sources?: Source[];\n    indi: string;\n}\n\nconst EVENT_TAGS = [\n    'BIRT',\n    'BAPM',\n    'CHR',\n    'FAMS',\n    'EVEN',\n    'CENS',\n    'DEAT',\n    'BURI',\n];\n\nconst FAMILY_EVENT_TAGS = ['MARR', 'MARS', 'DIV'];\n\nfunction EventHeader(props: { event: EventData }) {\n    const intl = useIntl();\n    return (\n        <div className=\"event-header\">\n            <Header as=\"span\" size=\"small\">\n                <TranslatedTag tag={props.event.type}/>\n            </Header>\n            {props.event.date ? (\n                <Header as=\"span\" textAlign=\"right\" sub>\n                    {formatDateOrRange(props.event.date, intl)}\n                </Header>\n            ) : null}\n        </div>\n    );\n}\n\nfunction getSpouse(indi: string, familyEntry: GedcomEntry, gedcom: GedcomData) {\n    const spouseReference = familyEntry.tree\n        .filter((familySubEntry) => ['WIFE', 'HUSB'].includes(familySubEntry.tag))\n        .find((familySubEntry) => !familySubEntry.data.includes(indi));\n    if (!spouseReference) {\n        return undefined;\n    }\n    return dereference(spouseReference, gedcom, (gedcom) => gedcom.indis);\n}\n\nfunction eventPlace(entry: GedcomEntry) {\n    const place = entry.tree.find((subEntry) => subEntry.tag === 'PLAC');\n    return place?.data ? getData(place) : undefined;\n}\n\nfunction eventImages(entry: GedcomEntry, gedcom: GedcomData): Image[] {\n    return entry.tree\n        .filter((subEntry) => 'OBJE' === subEntry.tag)\n        .map((objectEntry) =>\n            dereference(objectEntry, gedcom, (gedcom) => gedcom.other),\n        )\n        .map((objectEntry) => getImageFileEntry(objectEntry))\n        .flatMap((imageFileEntry) =>\n            imageFileEntry ? [\n                    {\n                        url: imageFileEntry?.data || '',\n                        filename: getFileName(imageFileEntry) || '',\n                    },\n                ] : [],\n        );\n}\n\nfunction eventSources(entry: GedcomEntry, gedcom: GedcomData): Source[] {\n    return entry.tree\n        .filter((subEntry) => 'SOUR' === subEntry.tag)\n        .map((sourceEntryReference) => {\n            const sourceEntry = dereference(sourceEntryReference, gedcom, (gedcom) => gedcom.other);\n            const title = sourceEntry.tree.find((subEntry) => 'TITL' === subEntry.tag);\n            const abbr = sourceEntry.tree.find((subEntry) => 'ABBR' === subEntry.tag);\n            const author = sourceEntry.tree.find((subEntry) => 'AUTH' === subEntry.tag);\n            const publicationInfo = sourceEntry.tree.find((subEntry) => 'PUBL' === subEntry.tag);\n            const page = sourceEntryReference.tree.find((subEntry) => 'PAGE' === subEntry.tag);\n            const sourceData = sourceEntryReference.tree.find((subEntry) => 'DATA' === subEntry.tag);\n            const date = sourceData ? resolveDate(sourceData) : undefined;\n            return {\n                title: title?.data || abbr?.data,\n                author: author?.data,\n                page: page?.data,\n                date: date ? getDate(date.data) : undefined,\n                publicationInfo: publicationInfo?.data,\n            };\n        });\n}\n\nfunction eventNotes(entry: GedcomEntry, gedcom: GedcomData): string[][] {\n    return entry.tree\n        .filter((subentry) => ['NOTE', 'TYPE'].includes(subentry.tag))\n        .map((note) => dereference(note, gedcom, (gedcom) => gedcom.other))\n        .map((note) => getData(note));\n}\n\nfunction toEvent(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    indi: string,\n): EventData[] {\n    return entry.tag === 'FAMS' ? toFamilyEvents(entry, gedcom, indi) : toIndiEvent(entry, gedcom, indi);\n}\n\nfunction toIndiEvent(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    indi: string,\n): EventData[] {\n    const date = resolveDate(entry) || null;\n    return [\n        {\n            date: date ? getDate(date.data) : undefined,\n            type: entry.tag,\n            place: eventPlace(entry),\n            images: eventImages(entry, gedcom),\n            notes: eventNotes(entry, gedcom),\n            sources: eventSources(entry, gedcom),\n            indi: indi,\n        },\n    ];\n}\n\nfunction resolveDate(entry: GedcomEntry) {\n    return entry.tree.find((subEntry) => subEntry.tag === 'DATE');\n}\n\nfunction toFamilyEvents(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    indi: string,\n): EventData[] {\n    const family = dereference(entry, gedcom, (gedcom) => gedcom.fams);\n    return flatMap(FAMILY_EVENT_TAGS, (tag) =>\n        family.tree.filter((entry) => entry.tag === tag),\n    ).map((familyMarriageEvent) => {\n        const date = resolveDate(familyMarriageEvent) || null;\n        return {\n            date: date ? getDate(date.data) : undefined,\n            type: familyMarriageEvent.tag,\n            personLink: getSpouse(indi, family, gedcom),\n            place: eventPlace(familyMarriageEvent),\n            images: eventImages(familyMarriageEvent, gedcom),\n            notes: eventNotes(familyMarriageEvent, gedcom),\n            sources: eventSources(familyMarriageEvent, gedcom),\n            indi: indi,\n        };\n    });\n}\n\nfunction Event(props: { event: EventData }) {\n    return (\n        <Item>\n            <Item.Content>\n                <EventHeader event={props.event}/>\n                {!!props.event.personLink && (<PersonLink person={props.event.personLink}/>)}\n                {!!props.event.place && (<Item.Description>{props.event.place}</Item.Description>)}\n                <EventExtras\n                    images={props.event.images}\n                    notes={props.event.notes}\n                    sources={props.event.sources}\n                    indi={props.event.indi}\n                />\n            </Item.Content>\n        </Item>\n    );\n}\n\nexport function Events(props: Props) {\n    const events = flatMap(EVENT_TAGS, (tag) =>\n        props.entries\n            .filter((entry) => entry.tag === tag)\n            .map((eventEntry) => toEvent(eventEntry, props.gedcom, props.indi))\n            .flatMap((events) => events)\n            .sort((event1, event2) => compareDates(event1.date, event2.date)),\n    );\n    if (events.length) {\n        return (\n            <>\n                {events.map((event, index) => (\n                    <Event event={event} key={index}/>\n                ))}\n            </>\n        );\n    }\n    return null;\n}\n","import flatMap from 'array.prototype.flatmap';\nimport {\n    dereference,\n    GedcomData,\n    getData,\n    getFileName,\n    getImageFileEntry\n} from '../util/gedcom_util';\nimport {Events} from './events';\nimport {GedcomEntry} from 'parse-gedcom';\nimport {MultilineText} from './multiline-text';\nimport {TranslatedTag} from './translated-tag';\nimport {Header, Item} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {WrappedImage} from './wrapped-image';\n\nconst EXCLUDED_TAGS = [\n    'BIRT',\n    'BAPM',\n    'CHR',\n    'EVEN',\n    'CENS',\n    'DEAT',\n    'BURI',\n    'NAME',\n    'SEX',\n    'FAMC',\n    'FAMS',\n    'NOTE',\n    'SOUR',\n    'LANG',\n];\n\nfunction dataDetails(entry: GedcomEntry) {\n    const lines = [];\n    if (entry.data) {\n        lines.push(...getData(entry));\n    }\n    entry.tree\n        .filter((subentry) => subentry.tag === 'NOTE')\n        .forEach((note) =>\n            getData(note).forEach((line) => lines.push(<i>{line}</i>)),\n        );\n    if (!lines.length) {\n        return null;\n    }\n    return (\n        <>\n            <Header sub>\n                <TranslatedTag tag={entry.tag}/>\n            </Header>\n            <span>\n                <MultilineText lines={lines}/>\n            </span>\n        </>\n    );\n}\n\nfunction fileDetails(objectEntry: GedcomEntry) {\n    const imageFileEntry = getImageFileEntry(objectEntry);\n    return imageFileEntry ? (\n        <div className=\"person-image\">\n            <WrappedImage\n                url={imageFileEntry.data}\n                filename={getFileName(imageFileEntry) || ''}\n            />\n        </div>\n    ) : null;\n}\n\nfunction noteDetails(entry: GedcomEntry) {\n    return (\n        <MultilineText\n            lines={getData(entry).map((line, index) => (\n                <i key={index}>{line}</i>\n            ))}\n        />\n    );\n}\n\nfunction nameDetails(entry: GedcomEntry) {\n    const fullName = entry.data.replaceAll('/', '');\n    const nameType = entry.tree.find(\n        (entry) => entry.tag === 'TYPE' && entry.data !== 'Unknown',\n    )?.data;\n    return (\n        <>\n            <Header as=\"span\" size=\"large\">\n                {fullName ? (\n                    fullName\n                ) : (\n                    <FormattedMessage id=\"name.unknown_name\" defaultMessage=\"N.N.\"/>\n                )}\n            </Header>\n            {fullName && nameType && (\n                <Item.Meta>\n                    <TranslatedTag tag={nameType}/>\n                </Item.Meta>\n            )}\n        </>\n    );\n}\n\nfunction getDetails(\n    entries: GedcomEntry[],\n    tags: string[],\n    detailsFunction: (entry: GedcomEntry) => JSX.Element | null,\n): JSX.Element[] {\n    return flatMap(tags, (tag) =>\n        entries\n            .filter((entry) => entry.tag === tag)\n            .map((entry) => detailsFunction(entry)),\n    )\n        .filter((element) => element !== null)\n        .map((element, index) => (\n            <Item key={index}>\n                <Item.Content>{element}</Item.Content>\n            </Item>\n        ));\n}\n\n/**\n * Returns true if there is displayable information in this entry.\n * Returns false if there is no data in this entry or this is only a reference\n * to another entry.\n */\nfunction hasData(entry: GedcomEntry) {\n    return entry.tree.length > 0 || (entry.data && !entry.data.startsWith('@'));\n}\n\nfunction getOtherDetails(entries: GedcomEntry[]) {\n    return entries\n        .filter((entry) => !EXCLUDED_TAGS.includes(entry.tag))\n        .filter(hasData)\n        .map((entry) => dataDetails(entry))\n        .filter((element) => element !== null)\n        .map((element, index) => (\n            <Item key={index}>\n                <Item.Content>{element}</Item.Content>\n            </Item>\n        ));\n}\n\nfunction getMultilineDetails(\n    entries: GedcomEntry[],\n    tags: string[],\n    title: [string, string],\n) {\n    const lines= entries\n        .filter((entry) => tags.includes(entry.tag))\n        .filter(hasData)\n        .map((element) => element.data)\n    if (!lines.length) {\n        return null;\n    }\n    return (\n        <Item key=\"languages\">\n            <Item.Content>\n                <Header as=\"span\">\n                    <FormattedMessage id={title[0]} defaultMessage={title[1]}/>\n                </Header>\n                <span>\n                    <MultilineText lines={lines}/>\n                </span>\n            </Item.Content>\n        </Item>\n    );\n}\n\ninterface Props {\n    gedcom: GedcomData;\n    indi: string;\n}\n\nexport function Details(props: Props) {\n    const entries = props.gedcom.indis[props.indi].tree;\n    const entriesWithData = entries\n        .map((entry) => dereference(entry, props.gedcom, (gedcom) => gedcom.other))\n        .filter(hasData);\n\n    return (\n        <div className=\"details\">\n            <Item.Group divided>\n                {getDetails(entries, ['NAME'], nameDetails)}\n                {getDetails(entriesWithData, ['OBJE'], fileDetails)}\n                <Events gedcom={props.gedcom} entries={entries} indi={props.indi}/>\n                {getMultilineDetails(entriesWithData, ['LANG'], ['gedcom.languages', 'Languages'])}\n                {getOtherDetails(entriesWithData)}\n                {getDetails(entriesWithData, ['NOTE'], noteDetails)}\n            </Item.Group>\n        </div>\n    );\n}\n","import {DataSource, DataSourceEnum, SourceSelection} from './data_source';\nimport {TopolaData} from '../util/gedcom_util';\nimport {loadGedcom} from './load_data';\n\n/**\n * Message types used in embedded mode.\n * When the parent is ready to receive messages, it sends PARENT_READY.\n * When the child (this app) is ready to receive messages, it sends READY.\n * When the child receives PARENT_READY, it sends READY.\n * When the parent receives READY, it sends data in a GEDCOM message.\n */\nenum EmbeddedMessageType {\n    GEDCOM = 'gedcom',\n    READY = 'ready',\n    PARENT_READY = 'parent_ready',\n}\n\n/** Message sent to parent or received from parent in embedded mode. */\ninterface EmbeddedMessage {\n    message: EmbeddedMessageType;\n}\n\ninterface GedcomMessage extends EmbeddedMessage {\n    message: EmbeddedMessageType.GEDCOM;\n    gedcom?: string;\n}\n\nexport interface EmbeddedSourceSpec {\n    source: DataSourceEnum.EMBEDDED;\n}\n\n/** GEDCOM file received from outside of the iframe. */\nexport class EmbeddedDataSource implements DataSource<EmbeddedSourceSpec> {\n    isNewData(\n        newSource: SourceSelection<EmbeddedSourceSpec>,\n        oldSource: SourceSelection<EmbeddedSourceSpec>,\n        data?: TopolaData,\n    ): boolean {\n        // Never reload data.\n        return false;\n    }\n\n    private async onMessage(\n        message: EmbeddedMessage,\n        resolve: (value: TopolaData) => void,\n        reject: (reason: any) => void,\n    ) {\n        if (message.message === EmbeddedMessageType.PARENT_READY) {\n            // Parent didn't receive the first 'ready' message, so we need to send it again.\n            window.parent.postMessage({message: EmbeddedMessageType.READY}, '*');\n        } else if (message.message === EmbeddedMessageType.GEDCOM) {\n            const gedcom = (message as GedcomMessage).gedcom;\n            if (!gedcom) {\n                return;\n            }\n            try {\n                const data = await loadGedcom('', gedcom);\n                resolve(data);\n            } catch (error) {\n                reject(error);\n            }\n        }\n    }\n\n    async loadData(source: SourceSelection<EmbeddedSourceSpec>): Promise<TopolaData> {\n        // Notify the parent window that we are ready.\n        return new Promise<TopolaData>((resolve, reject) => {\n            window.parent.postMessage({message: EmbeddedMessageType.READY}, '*');\n            window.addEventListener('message', (data) =>\n                this.onMessage(data.data, resolve, reject),\n            );\n        });\n    }\n}\n","import {IntlShape} from 'react-intl';\nimport {TopolaError} from './error';\n\n/**\n * Returns a translated message for the given error. If the message can't be\n * translated, the original error.message is returned.\n */\nexport function getI18nMessage(error: Error, intl: IntlShape): string {\n    if (!(error instanceof TopolaError)) {\n        return error.message;\n    }\n    return intl.formatMessage(\n        {\n            id: `error.${error.code}`,\n            defaultMessage: error.message,\n        },\n        error.args,\n    );\n}\n","import {\n    Menu,\n    Dropdown,\n    MenuItemProps,\n    DropdownItemProps,\n} from 'semantic-ui-react';\n\nexport enum MenuType {\n    Menu,\n    Dropdown,\n}\n\ninterface Props {\n    menuType?: MenuType;\n}\n\nexport function MenuItem(props: Props & MenuItemProps & DropdownItemProps) {\n    const newProps = {...props};\n    // Remove menuType from props to avoid error message in the console.\n    delete newProps.menuType;\n    return (\n        <>\n            {props.menuType === MenuType.Menu ? (\n                <Menu.Item {...newProps}>{props.children}</Menu.Item>\n            ) : (\n                <Dropdown.Item {...newProps}>{props.children}</Dropdown.Item>\n            )}\n        </>\n    );\n}\n","import {createMedia} from '@artsy/fresnel';\n\n/** Defines the breakpoints at which to show different UI variants.*/\nconst AppMedia = createMedia({\n    breakpoints: {\n        small: 320,\n        large: 768,\n    },\n});\nexport const mediaStyles = AppMedia.createMediaStyle();\nexport const {Media, MediaContextProvider} = AppMedia;\n","import lunr, {PipelineFunction} from 'lunr';\nimport naturalSort from 'javascript-natural-sort';\nimport {idToFamMap, idToIndiMap} from '../util/gedcom_util';\nimport {JsonFam, JsonGedcomData, JsonIndi} from '../lib/topola';\n\nrequire('lunr-languages/lunr.stemmer.support')(lunr);\nrequire('lunr-languages/lunr.de')(lunr);\nrequire('lunr-languages/lunr.fr')(lunr);\nrequire('lunr-languages/lunr.it')(lunr);\nrequire('lunr-languages/lunr.ru')(lunr);\n\nconst MAX_RESULTS = 8;\n\nexport interface SearchResult {\n    id: string;\n    indi: JsonIndi;\n}\n\nexport interface SearchIndex {\n    search(input: string): SearchResult[];\n}\n\n/** Removes accents from letters, e.g. ->o, ->e. */\nfunction normalize(input: string) {\n    return input\n        .toLocaleLowerCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .replace(/\\u0142/g, 'l'); // Special case:  is not affected by NFD.\n}\n\n/** Comparator to sort by score first, then by id. */\nfunction compare(a: lunr.Index.Result, b: lunr.Index.Result) {\n    if (a.score !== b.score) {\n        return b.score - a.score;\n    }\n    return naturalSort(a.ref, b.ref);\n}\n\n/** Returns all last names of all husbands as a space-separated string. */\nfunction getHusbandLastName(\n    indi: JsonIndi,\n    indiMap: Map<String, JsonIndi>,\n    famMap: Map<string, JsonFam>,\n): string {\n    return (indi.fams || [])\n        .map((famId) => famMap.get(famId))\n        .map((fam) => fam && fam.husb)\n        .map((husbId) => husbId && indiMap.get(husbId))\n        .map((husband) => husband && husband.lastName)\n        .join(' ');\n}\n\nclass LunrSearchIndex implements SearchIndex {\n    private index: lunr.Index | undefined;\n    private indiMap: Map<string, JsonIndi>;\n    private famMap: Map<string, JsonFam>;\n\n    constructor(data: JsonGedcomData) {\n        this.indiMap = idToIndiMap(data);\n        this.famMap = idToFamMap(data);\n    }\n\n    initialize() {\n        const self = this;\n        this.index = lunr(function () {\n            //Trimmer will break non-latin characters, so custom multilingual implementation must be used\n            self.initMultiLingualLunrWithoutTrimmer(this, [\n                'de',\n                'en',\n                'fr',\n                'it',\n                'ru',\n            ]);\n            this.ref('id');\n            this.field('id');\n            this.field('name', {boost: 10});\n            this.field('normalizedName', {boost: 8});\n            this.field('spouseLastName', {boost: 2});\n            this.field('normalizedSpouseLastName', {boost: 2});\n\n            self.indiMap.forEach((indi) => {\n                const name = [indi.firstName, indi.lastName].join(' ');\n                const spouseLastName = getHusbandLastName(\n                    indi,\n                    self.indiMap,\n                    self.famMap,\n                );\n                this.add({\n                    id: indi.id,\n                    name,\n                    normalizedName: normalize(name),\n                    spouseLastName,\n                    normalizedSpouseLastName: normalize(spouseLastName),\n                });\n            });\n        });\n    }\n\n    private initMultiLingualLunrWithoutTrimmer(\n        lunrInstance: any,\n        languages: string[],\n    ): void {\n        let wordCharacters = '';\n        const pipelineFunctions: PipelineFunction[] = [];\n        const searchPipelineFunctions: PipelineFunction[] = [];\n        languages.forEach((language) => {\n            if (language === 'en') {\n                wordCharacters += '\\\\w';\n                pipelineFunctions.unshift(lunr.stopWordFilter);\n                pipelineFunctions.push(lunr.stemmer);\n                searchPipelineFunctions.push(lunr.stemmer);\n            } else {\n                wordCharacters += lunr[language].wordCharacters;\n                if (lunr[language].stopWordFilter) {\n                    pipelineFunctions.unshift(lunr[language].stopWordFilter);\n                }\n                if (lunr[language].stemmer) {\n                    pipelineFunctions.push(lunr[language].stemmer);\n                    searchPipelineFunctions.push(lunr[language].stemmer);\n                }\n            }\n        });\n        lunrInstance.pipeline.reset();\n        lunrInstance.pipeline.add.apply(lunrInstance.pipeline, pipelineFunctions);\n\n        if (lunrInstance.searchPipeline) {\n            lunrInstance.searchPipeline.reset();\n            lunrInstance.searchPipeline.add.apply(\n                lunrInstance.searchPipeline,\n                searchPipelineFunctions,\n            );\n        }\n    }\n\n    public search(input: string): SearchResult[] {\n        const query = input\n            .split(' ')\n            .filter((s) => !!s)\n            .map((s) => `${s} ${s}*`)\n            .join(' ');\n        const results = this.index!.search(query);\n        return results\n            .sort(compare)\n            .slice(0, MAX_RESULTS)\n            .map((result) => ({id: result.ref, indi: this.indiMap.get(result.ref)!}));\n    }\n}\n\n/** Builds a search index from data. */\nexport function buildSearchIndex(data: JsonGedcomData): SearchIndex {\n    const index = new LunrSearchIndex(data);\n    index.initialize();\n    return index;\n}\n","import debounce from 'debounce';\nimport {buildSearchIndex, SearchIndex, SearchResult} from './search_index';\nimport {formatDateOrRange} from '../util/date_util';\nimport {IndiInfo, JsonGedcomData, JsonIndi} from '../lib/topola';\nimport {Search, SearchResultProps} from 'semantic-ui-react';\nimport {useEffect, useRef, useState} from 'react';\nimport {useIntl} from 'react-intl';\n\nfunction getNameLine(result: SearchResult) {\n    const name = [result.indi.firstName, result.indi.lastName].join(' ').trim();\n    if (result.id.length > 8) {\n        return name;\n    }\n    return (\n        <>\n            {name} <i>({result.id})</i>\n        </>\n    );\n}\n\ninterface Props {\n    /** Data used for the search index. */\n    data: JsonGedcomData;\n    onSelection: (indiInfo: IndiInfo) => void;\n}\n\n/** Displays and handles the search box in the top bar. */\nexport function SearchBar(props: Props) {\n    const [searchResults, setSearchResults] = useState<SearchResultProps[]>([]);\n    const [searchString, setSearchString] = useState('');\n    const searchIndex = useRef<SearchIndex>();\n    const intl = useIntl();\n\n    function getDescriptionLine(indi: JsonIndi) {\n        const birthDate = formatDateOrRange(indi.birth, intl);\n        const deathDate = formatDateOrRange(indi.death, intl);\n        if (!deathDate) {\n            return birthDate;\n        }\n        return `${birthDate}  ${deathDate}`;\n    }\n\n    /** Produces an object that is displayed in the Semantic UI Search results. */\n    function displaySearchResult(result: SearchResult): SearchResultProps {\n        return {\n            id: result.id,\n            key: result.id,\n            title: getNameLine(result),\n            description: getDescriptionLine(result.indi),\n        } as SearchResultProps;\n    }\n\n    /** On search input change. */\n    function handleSearch(input: string | undefined) {\n        if (!input) {\n            return;\n        }\n        const results = searchIndex\n            .current!.search(input)\n            .map((result) => displaySearchResult(result));\n        setSearchResults(results);\n    }\n\n    const debouncedHandleSearch = useRef(debounce(handleSearch, 200));\n\n    /** On search result selected. */\n    function handleResultSelect(id: string) {\n        props.onSelection({id, generation: 0});\n        setSearchString('');\n    }\n\n    /** On search string changed. */\n    function onChange(value: string) {\n        debouncedHandleSearch.current(value);\n        setSearchString(value);\n    }\n\n    // Initialize the search index.\n    useEffect(() => {\n        searchIndex.current = buildSearchIndex(props.data);\n    }, [props.data]);\n\n    return (\n        <Search\n            onSearchChange={(_, data) => onChange(data.value!)}\n            onResultSelect={(_, data) => handleResultSelect(data.result.id)}\n            results={searchResults}\n            noResultsMessage={intl.formatMessage({\n                id: 'menu.search.no_results',\n                defaultMessage: 'No results found',\n            })}\n            placeholder={intl.formatMessage({\n                id: 'menu.search.placeholder',\n                defaultMessage: 'Search for people',\n            })}\n            selectFirstResult={true}\n            value={searchString}\n            id=\"search\"\n        />\n    );\n}\n","import * as queryString from 'query-string';\nimport md5 from 'md5';\nimport {Dropdown, Icon, Menu} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {MenuType} from './menu_item';\nimport {SyntheticEvent} from 'react';\nimport {useHistory, useLocation} from 'react-router';\nimport {loadFile} from '../datasource/load_data';\n\nfunction isImageFileName(fileName: string) {\n    const lower = fileName.toLowerCase();\n    return lower.endsWith('.jpg') || lower.endsWith('.png');\n}\n\ninterface Props {\n    menuType: MenuType;\n}\n\n/** Displays and handles the \"Open file\" menu. */\nexport function UploadMenu(props: Props) {\n    const history = useHistory();\n    const location = useLocation();\n\n    async function handleUpload(event: SyntheticEvent<HTMLInputElement>) {\n        const files = (event.target as HTMLInputElement).files;\n        if (!files || !files.length) {\n            return;\n        }\n        const filesArray = Array.from(files);\n        (event.target as HTMLInputElement).value = ''; // Reset the file input.\n\n        const gedcomFile =\n            filesArray.length === 1\n                ? filesArray[0]\n                : filesArray.find((file) => file.name.toLowerCase().endsWith('.ged')) ||\n                filesArray[0];\n        const {gedcom, images} = await loadFile(gedcomFile);\n\n        // Convert uploaded images to object URLs.\n        filesArray\n            .filter((file) => file.name !== gedcomFile.name && isImageFileName(file.name))\n            .forEach((file) => images.set(file.name, URL.createObjectURL(file)));\n\n        // Hash GEDCOM contents with uploaded image file names.\n        const imageFileNames = Array.from(images.keys()).sort().join('|');\n        const hash = md5(md5(gedcom) + imageFileNames);\n\n        // Use history.replace() when re-uploading the same file and history.push() when loading a new file.\n        const search = queryString.parse(location.search);\n        const historyPush = search.file === hash ? history.replace : history.push;\n\n        historyPush({\n            pathname: '/view',\n            search: queryString.stringify({file: hash}),\n            state: {data: gedcom, images},\n        });\n    }\n\n    const content = (\n        <>\n            <Icon name=\"folder open\"/>\n            <FormattedMessage id=\"menu.open_file\" defaultMessage=\"Open file\"/>\n        </>\n    );\n    return (\n        <>\n            {props.menuType === MenuType.Menu ? (\n                <label htmlFor=\"fileInput\">\n                    <Menu.Item as=\"a\">{content}</Menu.Item>\n                </label>\n            ) : (\n                <Dropdown.Item as=\"label\" htmlFor=\"fileInput\">\n                    {content}\n                </Dropdown.Item>\n            )}\n            <input\n                className=\"hidden\"\n                type=\"file\"\n                accept=\".ged,.gdz,.gedzip,.zip,image/*\"\n                id=\"fileInput\"\n                multiple\n                onChange={handleUpload}\n            />\n        </>\n    );\n}\n","import {Dropdown, Icon, Menu} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {Media} from '../util/media';\nimport {MenuType} from './menu_item';\nimport {SearchBar} from './search';\nimport {UploadMenu} from './upload_menu';\nimport {UrlMenu} from './url_menu';\nimport {useHistory, useLocation} from 'react-router';\nimport {IndiInfo, JsonGedcomData} from '../lib/topola';\n\nenum ScreenSize {\n    LARGE,\n    SMALL,\n}\n\ninterface EventHandlers {\n    onSelection: (indiInfo: IndiInfo) => void;\n    onDownloadPdf: () => void;\n    onDownloadPng: () => void;\n    onDownloadSvg: () => void;\n    onCenterView: () => void;\n}\n\ninterface Props {\n    /** True if the application is currently showing a chart. */\n    showingChart: boolean;\n    /** Data used for the search index. */\n    data?: JsonGedcomData;\n    standalone: boolean;\n    eventHandlers: EventHandlers;\n}\n\nexport function TopBar(props: Props) {\n    useHistory();\n    useLocation();\n    function chartMenus(screenSize: ScreenSize) {\n        if (!props.showingChart) {\n            return null;\n        }\n        switch (screenSize) {\n            case ScreenSize.LARGE:\n                return (\n                    <>\n                        <Dropdown\n                            trigger={\n                                <div>\n                                    <Icon name=\"download\"/>\n                                    <FormattedMessage id=\"menu.download\" defaultMessage=\"Download\"/>\n                                </div>\n                            }\n                            className=\"item\"\n                        >\n                            <Dropdown.Menu>\n                                <Dropdown.Item onClick={props.eventHandlers.onDownloadPdf}>\n                                    <FormattedMessage id=\"menu.pdf_file\" defaultMessage=\"PDF file\"/>\n                                </Dropdown.Item>\n                                <Dropdown.Item onClick={props.eventHandlers.onDownloadPng}>\n                                    <FormattedMessage id=\"menu.png_file\" defaultMessage=\"PNG file\"/>\n                                </Dropdown.Item>\n                                <Dropdown.Item onClick={props.eventHandlers.onDownloadSvg}>\n                                    <FormattedMessage id=\"menu.svg_file\" defaultMessage=\"SVG file\"/>\n                                </Dropdown.Item>\n                            </Dropdown.Menu>\n                        </Dropdown>\n\n                        <Menu.Item onClick={props.eventHandlers.onCenterView}>\n                            <Icon name=\"eye\" />\n                            <FormattedMessage id=\"menu.view\" defaultMessage=\"Center view\" />\n                        </Menu.Item>\n\n                        <Menu.Menu position=\"right\">\n                            <SearchBar\n                                data={props.data!}\n                                onSelection={props.eventHandlers.onSelection}\n                                {...props}\n                            />\n                        </Menu.Menu>\n                    </>\n                );\n\n            case ScreenSize.SMALL:\n                return (\n                    <>\n                        <Dropdown.Item onClick={props.eventHandlers.onDownloadPdf}>\n                            <Icon name=\"download\"/>\n                            <FormattedMessage id=\"menu.download_pdf\" defaultMessage=\"Download PDF\"/>\n                        </Dropdown.Item>\n                        <Dropdown.Item onClick={props.eventHandlers.onDownloadPng}>\n                            <Icon name=\"download\"/>\n                            <FormattedMessage id=\"menu.download_png\" defaultMessage=\"Download PNG\"/>\n                        </Dropdown.Item>\n                        <Dropdown.Item onClick={props.eventHandlers.onDownloadSvg}>\n                            <Icon name=\"download\"/>\n                            <FormattedMessage id=\"menu.download_svg\" defaultMessage=\"Download SVG\"/>\n                        </Dropdown.Item>\n                        <Dropdown.Divider/>\n                    </>\n                );\n        }\n    }\n\n    function fileMenus(screenSize: ScreenSize) {\n        // Don't show \"open\" menus in non-standalone mode.\n        if (!props.standalone) {\n            return null;\n        }\n\n        switch (screenSize) {\n            case ScreenSize.LARGE:\n                // Show dropdown if chart is shown, otherwise show individual menu items.\n                return props.showingChart ? (\n                    <>\n                        <UploadMenu menuType={MenuType.Menu} {...props} />\n                        {/*<UrlMenu menuType={MenuType.Menu} {...props} />*/}\n                    </>\n                ) : (\n                    <Dropdown\n                        trigger={\n                            <div>\n                                <Icon name=\"folder open\"/>\n                                <FormattedMessage id=\"menu.open\" defaultMessage=\"Open\"/>\n                            </div>\n                        }\n                        className=\"item\"\n                    >\n                        <Dropdown.Menu>\n                            <UploadMenu menuType={MenuType.Dropdown} {...props} />\n                            <UrlMenu menuType={MenuType.Dropdown} {...props} />\n                        </Dropdown.Menu>\n                    </Dropdown>\n                );\n\n            case ScreenSize.SMALL:\n                return (\n                    <>\n                        <UploadMenu menuType={MenuType.Dropdown} {...props} />\n                        {/*<UrlMenu menuType={MenuType.Dropdown} {...props} />*/}\n                        <Dropdown.Divider/>\n                    </>\n                );\n        }\n    }\n\n    function mobileMenus() {\n        return (\n            <>\n                <Dropdown\n                    trigger={\n                        <div>\n                            <Icon name=\"sidebar\"/>\n                        </div>\n                    }\n                    className=\"item\"\n                    icon={null}\n                >\n                    <Dropdown.Menu>\n                        {fileMenus(ScreenSize.SMALL)}\n                        {chartMenus(ScreenSize.SMALL)}\n                    </Dropdown.Menu>\n                </Dropdown>\n            </>\n        );\n    }\n\n    function desktopMenus() {\n        return (\n            <>\n                {fileMenus(ScreenSize.LARGE)}\n                {chartMenus(ScreenSize.LARGE)}\n            </>\n        );\n    }\n\n    return (\n        <>\n            <Menu\n                as={Media}\n                greaterThanOrEqual=\"large\"\n                attached=\"top\"\n                inverted\n                color=\"blue\"\n                size=\"large\"\n            >\n                {desktopMenus()}\n            </Menu>\n            <Menu\n                as={Media}\n                at=\"small\"\n                attached=\"top\"\n                inverted\n                color=\"blue\"\n                size=\"large\"\n            >\n                {mobileMenus()}\n            </Menu>\n        </>\n    );\n}\n","import * as queryString from 'query-string';\nimport {Button, Form, Header, Icon, Input, Modal} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {MenuItem, MenuType} from './menu_item';\nimport {useEffect, useRef, useState} from 'react';\nimport {useHistory} from 'react-router';\n\ninterface Props {\n    menuType: MenuType;\n}\n\n/** Displays and handles the \"Open URL\" menu. */\nexport function UrlMenu(props: Props) {\n    const [dialogOpen, setDialogOpen] = useState(false);\n    const [url, setUrl] = useState('');\n    const inputRef = useRef<Input>(null);\n    const history = useHistory();\n\n    useEffect(() => {\n        if (dialogOpen) {\n            setUrl('');\n            inputRef.current!.focus();\n        }\n    }, [dialogOpen]);\n\n    /** Load button clicked in the \"Load from URL\" dialog. */\n    function handleLoad() {\n        setDialogOpen(false);\n        if (url) {\n            history.push({\n                pathname: '/view',\n                search: queryString.stringify({url}),\n            });\n        }\n    }\n\n    function loadFromUrlModal() {\n        return (\n            <Modal\n                open={dialogOpen}\n                onClose={() => setDialogOpen(false)}\n                centered={false}\n            >\n                <Header>\n                    <Icon name=\"cloud download\"/>\n                    <FormattedMessage\n                        id=\"load_from_url.title\"\n                        defaultMessage=\"Load from URL\"\n                    />\n                </Header>\n                <Modal.Content>\n                    <Form onSubmit={handleLoad}>\n                        <Input\n                            placeholder=\"https://\"\n                            fluid\n                            value={url}\n                            onChange={(_, data) => setUrl(data.value)}\n                            ref={inputRef}\n                        />\n                        <p>\n                            <FormattedMessage\n                                id=\"load_from_url.comment\"\n                                defaultMessage={\n                                    'Data from the URL will be loaded through {link} to avoid CORS issues.'\n                                }\n                                values={{\n                                    link: (\n                                        <a href=\"https://topolaproxy.bieda.it/\">\n                                            topolaproxy.bieda.it (cors-anywhere proxy)\n                                        </a>\n                                    ),\n                                }}\n                            />\n                        </p>\n                    </Form>\n                </Modal.Content>\n                <Modal.Actions>\n                    <Button secondary onClick={() => setDialogOpen(false)}>\n                        <FormattedMessage\n                            id=\"load_from_url.cancel\"\n                            defaultMessage=\"Cancel\"\n                        />\n                    </Button>\n                    <Button primary onClick={handleLoad}>\n                        <FormattedMessage id=\"load_from_url.load\" defaultMessage=\"Load\"/>\n                    </Button>\n                </Modal.Actions>\n            </Modal>\n        );\n    }\n\n    return (\n        <>\n            <MenuItem onClick={() => setDialogOpen(true)} menuType={props.menuType}>\n                <Icon name=\"cloud download\"/>\n                <FormattedMessage\n                    id=\"menu.load_from_url\"\n                    defaultMessage=\"Load from URL\"\n                />\n            </MenuItem>\n            {loadFromUrlModal()}\n        </>\n    );\n}\n","import {Item, Checkbox, Form, Header} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {ParsedQuery} from 'query-string';\n\nexport enum ChartColors {\n    NO_COLOR,\n    COLOR_BY_SEX,\n    COLOR_BY_GENERATION,\n    COLOR_BY_TRIBE,\n    COLOR_BY_NR_LANGUAGES = 4,\n    COLOR_BY_LANGUAGE = 5,\n}\n\nexport enum Languages {\n    HIDE,\n    SHOW,\n}\n\nexport enum Tribe {\n    HIDE,\n    SHOW,\n}\n\nexport enum Ids {\n    HIDE,\n    SHOW,\n}\n\nexport enum Sex {\n    HIDE,\n    SHOW,\n}\n\nexport interface Config {\n    color: ChartColors;\n    languages: Languages;\n    tribe: Tribe;\n    id: Ids;\n    sex: Sex;\n    renderLanguagesOption: boolean\n    renderTribeOption: boolean\n    languageOptions: string[]\n}\n\nexport const DEFAULT_CONFIG: Config = {\n    color: ChartColors.COLOR_BY_GENERATION,\n    languages: Languages.HIDE,\n    tribe: Tribe.HIDE,\n    id: Ids.SHOW,\n    sex: Sex.SHOW,\n    renderLanguagesOption: false,\n    renderTribeOption: false,\n    languageOptions: []\n};\n\nconst COLOR_ARG = new Map<string, ChartColors>([\n    ['n', ChartColors.NO_COLOR],\n    ['g', ChartColors.COLOR_BY_GENERATION],\n    ['s', ChartColors.COLOR_BY_SEX],\n    ['t', ChartColors.COLOR_BY_TRIBE],\n    ['nl', ChartColors.COLOR_BY_NR_LANGUAGES],\n    ['l', ChartColors.COLOR_BY_LANGUAGE],\n]);\nconst COLOR_ARG_INVERSE = new Map<ChartColors, string>();\nCOLOR_ARG.forEach((v, k) => COLOR_ARG_INVERSE.set(v, k));\n\nconst LANGUAGES_ARG = new Map<string, Languages>([\n    ['h', Languages.HIDE],\n    ['s', Languages.SHOW],\n]);\nconst LANGUAGES_ARG_INVERSE = new Map<Languages, string>();\nLANGUAGES_ARG.forEach((v, k) => LANGUAGES_ARG_INVERSE.set(v, k));\n\nconst TRIBE_ARG = new Map<string, Tribe>([\n    ['h', Tribe.HIDE],\n    ['s', Tribe.SHOW],\n]);\nconst TRIBE_ARG_INVERSE = new Map<Tribe, string>();\nTRIBE_ARG.forEach((v, k) => TRIBE_ARG_INVERSE.set(v, k));\n\nconst ID_ARG = new Map<string, Ids>([\n    ['h', Ids.HIDE],\n    ['s', Ids.SHOW],\n]);\nconst ID_ARG_INVERSE = new Map<Ids, string>();\nID_ARG.forEach((v, k) => ID_ARG_INVERSE.set(v, k));\n\nconst SEX_ARG = new Map<string, Sex>([\n    ['h', Sex.HIDE],\n    ['s', Sex.SHOW],\n]);\nconst SEX_ARG_INVERSE = new Map<Sex, string>();\nSEX_ARG.forEach((v, k) => SEX_ARG_INVERSE.set(v, k));\n\nconst RENDER_TRIBE_OPTION_ARG: boolean = false;\nconst RENDER_LANGUAGES_OPTION_ARG: boolean = false;\n\nexport function argsToConfig(args: ParsedQuery<any>): Config {\n    const getParam = (name: string) => {\n        return typeof args[name] === 'string' ? args[name] : undefined;\n    };\n    return {\n        color: COLOR_ARG.get(getParam('c') ?? '') ?? DEFAULT_CONFIG.color,\n        languages: LANGUAGES_ARG.get(getParam('l') ?? '') ?? DEFAULT_CONFIG.languages,\n        tribe: TRIBE_ARG.get(getParam('t') ?? '') ?? DEFAULT_CONFIG.tribe,\n        id: ID_ARG.get(getParam('i') ?? '') ?? DEFAULT_CONFIG.id,\n        sex: SEX_ARG.get(getParam('s') ?? '') ?? DEFAULT_CONFIG.sex,\n        renderTribeOption: RENDER_TRIBE_OPTION_ARG,\n        renderLanguagesOption: RENDER_LANGUAGES_OPTION_ARG,\n        languageOptions: DEFAULT_CONFIG.languageOptions,\n    };\n}\n\nexport function configToArgs(config: Config): ParsedQuery<any> {\n    return {\n        c: COLOR_ARG_INVERSE.get(config.color),\n        l: LANGUAGES_ARG_INVERSE.get(config.languages),\n        t: TRIBE_ARG_INVERSE.get(config.tribe),\n        i: ID_ARG_INVERSE.get(config.id),\n        s: SEX_ARG_INVERSE.get(config.sex),\n    };\n}\n\nexport function ConfigPanel(props: {\n    config: Config;\n    onChange: (config: Config) => void;\n}) {\n    const languageOptions = [];\n    for (let i = 0; i < props.config.languageOptions.length; i++) {\n        const language = props.config.languageOptions[i];\n        languageOptions.push(\n            <Form.Field key={i} className={!props.config.renderLanguagesOption ? 'hidden' : 'no-margin suboption'}>\n                <Checkbox\n                    radio\n                    label={language}\n                    name=\"checkboxRadioGroup\"\n                    value={\"l\"+i}\n                />\n            </Form.Field>\n        );\n    }\n    return (\n        <Form className=\"details no-border-bottom\">\n            <Item.Group>\n                <Item>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.colors\" defaultMessage=\"Colors\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.NO_COLOR\" defaultMessage=\"none\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"none\"\n                                checked={props.config.color === ChartColors.NO_COLOR}\n                                onClick={() => props.onChange({\n                                    ...props.config,\n                                    color: ChartColors.NO_COLOR,\n                                    languages: Languages.HIDE,\n                                    tribe: Tribe.HIDE\n                                })\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_GENERATION\" defaultMessage=\"by generation\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"generation\"\n                                checked={props.config.color === ChartColors.COLOR_BY_GENERATION}\n                                onClick={() => props.onChange({\n                                    ...props.config,\n                                    color: ChartColors.COLOR_BY_GENERATION,\n                                    languages: Languages.HIDE,\n                                    tribe: Tribe.HIDE\n                                })\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_SEX\" defaultMessage=\"by sex\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"gender\"\n                                checked={props.config.color === ChartColors.COLOR_BY_SEX}\n                                onClick={() => props.onChange({\n                                    ...props.config,\n                                    color: ChartColors.COLOR_BY_SEX,\n                                    languages: Languages.HIDE,\n                                    tribe: Tribe.HIDE\n                                })\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className={!props.config.renderTribeOption ? 'hidden' : 'no-margin'}>\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_TRIBE\" defaultMessage=\"by tribe\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"tribe\"\n                                checked={props.config.color === ChartColors.COLOR_BY_TRIBE}\n                                onClick={() => props.onChange({\n                                    ...props.config,\n                                    color: ChartColors.COLOR_BY_TRIBE,\n                                    languages: Languages.HIDE,\n                                    tribe: Tribe.SHOW\n                                })\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className={!props.config.renderLanguagesOption ? 'hidden' : 'no-margin'}>\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_LANGUAGES\" defaultMessage=\"by languages\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"languages\"\n                                checked={props.config.color === ChartColors.COLOR_BY_NR_LANGUAGES}\n                                onClick={() => props.onChange({\n                                    ...props.config,\n                                    color: ChartColors.COLOR_BY_NR_LANGUAGES,\n                                    languages: Languages.SHOW,\n                                    tribe: Tribe.HIDE\n                                })\n                                }\n                            />\n                        </Form.Field>\n                        {languageOptions}\n                    </Item.Content>\n                </Item>\n\n                <Item className={!props.config.renderLanguagesOption ? 'hidden' : ''}>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.languages\" defaultMessage=\"Languages\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.languages.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.languages === Languages.HIDE}\n                                onClick={() => props.onChange({...props.config, languages: Languages.HIDE})}\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.languages.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.languages === Languages.SHOW}\n                                onClick={() => props.onChange({...props.config, languages: Languages.SHOW})}\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n\n                <Item className={!props.config.renderTribeOption ? 'hidden' : ''}>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.tribe\" defaultMessage=\"Tribe\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.tribe.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.tribe === Tribe.HIDE}\n                                onClick={() => props.onChange({...props.config, tribe: Tribe.HIDE})}\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.tribe.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.tribe === Tribe.SHOW}\n                                onClick={() => props.onChange({...props.config, tribe: Tribe.SHOW})}\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n\n                <Item>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.ids\" defaultMessage=\"IDs\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.ids.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.id === Ids.HIDE}\n                                onClick={() => props.onChange({...props.config, id: Ids.HIDE})}\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.ids.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.id === Ids.SHOW}\n                                onClick={() => props.onChange({...props.config, id: Ids.SHOW})}\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n\n                <Item>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.sex\" defaultMessage=\"Sex\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.sex.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.sex === Sex.HIDE}\n                                onClick={() => props.onChange({...props.config, sex: Sex.HIDE})}\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.sex.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.sex === Sex.SHOW}\n                                onClick={() => props.onChange({...props.config, sex: Sex.SHOW})}\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n            </Item.Group>\n            <div style={{textAlign: \"center\"}}>\n                <Form.Button primary onClick={() => props.onChange(DEFAULT_CONFIG)}>\n                    <FormattedMessage id=\"config.reset\" defaultMessage=\"Reset\"/>\n                </Form.Button>\n            </div>\n        </Form>\n\n);\n}\n","import {ChartColors, Languages, Tribe, Ids, Sex} from './config';\nimport {interpolateNumber} from 'd3-interpolate';\nimport {IntlShape, useIntl} from 'react-intl';\nimport {max, min} from 'd3-array';\nimport {Media} from './util/media';\nimport {saveAs} from 'file-saver';\nimport {select, Selection} from 'd3-selection';\nimport {useEffect, useRef} from 'react';\nimport 'd3-transition';\nimport {D3ZoomEvent, zoom, ZoomBehavior, ZoomedElementBaseType, zoomTransform,} from 'd3-zoom';\nimport {\n    ChartColors as TopolaChartColors,\n    ChartHandle,\n    createChart,\n    DetailedRenderer,\n    HourglassChart,\n    IndiInfo,\n    JsonGedcomData,\n} from './lib/topola';\n\n\n/** How much to zoom when using the +/- buttons. */\nconst ZOOM_FACTOR = 1.3;\n\n/**\n * Called when the view is dragged with the mouse.\n *\n * @param size the size of the chart\n * @param event\n */\nfunction zoomed(\n    size: [number, number],\n    event: D3ZoomEvent<ZoomedElementBaseType, unknown>,\n) {\n    const parent = select('#svgContainer').node() as Element;\n    const scale = event.transform.k;\n    const offsetX = max([0, (parent.clientWidth - size[0] * scale) / 2]);\n    const offsetY = max([0, (parent.clientHeight - size[1] * scale) / 2]);\n    select('#chartSvg')\n        .attr('width', size[0] * scale)\n        .attr('height', size[1] * scale)\n        .attr('transform', `translate(${offsetX}, ${offsetY})`);\n    select('#chart').attr('transform', `scale(${scale})`);\n    parent.scrollLeft = -event.transform.x;\n    parent.scrollTop = -event.transform.y;\n}\n\n/** Called when the scrollbars are used. */\nfunction scrolled() {\n    const parent = select('#svgContainer').node() as Element;\n    const x = parent.scrollLeft + parent.clientWidth / 2;\n    const y = parent.scrollTop + parent.clientHeight / 2;\n    const scale = zoomTransform(parent).k;\n    select(parent).call(zoom().translateTo, x / scale, y / scale);\n}\n\n/** Loads blob as data URL. */\nfunction loadAsDataUrl(blob: Blob): Promise<string> {\n    const reader = new FileReader();\n    reader.readAsDataURL(blob);\n    return new Promise<string>((resolve) => {\n        reader.onload = (e) => resolve((e.target as FileReader).result as string);\n    });\n}\n\nasync function inlineImage(image: SVGImageElement) {\n    const href = image.href.baseVal;\n    if (!href) {\n        return;\n    }\n    try {\n        const response = await fetch(href);\n        const blob = await response.blob();\n        image.href.baseVal = await loadAsDataUrl(blob);\n    } catch (e) {\n        console.warn('Failed to load image:', e);\n    }\n}\n\n/**\n * Fetches all images in the SVG and replaces them with inlined images as data\n * URLs. Images are replaced in place. The replacement is done, the returned\n * promise is resolved.\n */\nasync function inlineImages(svg: Element): Promise<void> {\n    const images = Array.from(svg.getElementsByTagName('image'));\n    await Promise.all(images.map(inlineImage));\n}\n\n/** Loads a blob into an image object. */\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\n    const image = new Image();\n    image.src = URL.createObjectURL(blob);\n    return new Promise<HTMLImageElement>((resolve) => {\n        image.addEventListener('load', () => resolve(image));\n    });\n}\n\n/** Draw image on a new canvas and return the canvas. */\nfunction drawImageOnCanvas(image: HTMLImageElement) {\n    const canvas = document.createElement('canvas');\n    // Scale image for better quality.\n    canvas.width = image.width * 2;\n    canvas.height = image.height * 2;\n    const ctx = canvas.getContext('2d')!;\n    const oldFill = ctx.fillStyle;\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    ctx.fillStyle = oldFill;\n    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);\n    return canvas;\n}\n\nfunction canvasToBlob(canvas: HTMLCanvasElement, type: string) {\n    return new Promise<Blob>((resolve, reject) => {\n        canvas.toBlob((blob) => {\n            if (blob) {\n                resolve(blob);\n            } else {\n                reject();\n            }\n        }, type);\n    });\n}\n\n/** Return a copy of the SVG chart but without scaling and positioning. */\nfunction getStrippedSvg() {\n    const svg = document.getElementById('chartSvg')!.cloneNode(true) as Element;\n    svg.removeAttribute('transform');\n    const parent = select('#svgContainer').node() as Element;\n    const scale = zoomTransform(parent).k;\n    svg.setAttribute('width', String(Number(svg.getAttribute('width')) / scale));\n    svg.setAttribute(\n        'height',\n        String(Number(svg.getAttribute('height')) / scale),\n    );\n    svg.querySelector('#chart')!.removeAttribute('transform');\n    return svg;\n}\n\nasync function getSvgContentsWithInlinedImages() {\n    const svg = getStrippedSvg();\n    await inlineImages(svg);\n    return new XMLSerializer().serializeToString(svg);\n}\n\nexport async function downloadSvg() {\n    const contents = await getSvgContentsWithInlinedImages();\n    const blob = new Blob([contents], {type: 'image/svg+xml'});\n    saveAs(blob, 'genealogy.svg');\n}\n\nasync function drawOnCanvas(): Promise<HTMLCanvasElement> {\n    const contents = await getSvgContentsWithInlinedImages();\n    const blob = new Blob([contents], {type: 'image/svg+xml'});\n    return drawImageOnCanvas(await loadImage(blob));\n}\n\nexport async function downloadPng() {\n    const canvas = await drawOnCanvas();\n    const blob = await canvasToBlob(canvas, 'image/png');\n    saveAs(blob, 'genealogy.png');\n}\n\nexport async function downloadPdf() {\n    // Lazy load jspdf.\n    const {default: jspdf} = await import('jspdf');\n    const canvas = await drawOnCanvas();\n    const doc = new jspdf({\n        orientation: canvas.width > canvas.height ? 'l' : 'p',\n        unit: 'pt',\n        format: [canvas.width, canvas.height],\n    });\n    doc.addImage(canvas, 'PNG', 0, 0, canvas.width, canvas.height, 'NONE');\n    doc.save('genealogy.pdf');\n}\n\n/** Supported chart types. */\nexport enum ChartType {\n    Hourglass\n}\n\nconst chartColors = new Map<ChartColors, TopolaChartColors>([\n    [ChartColors.NO_COLOR, TopolaChartColors.NO_COLOR],\n    [ChartColors.COLOR_BY_GENERATION, TopolaChartColors.COLOR_BY_GENERATION],\n    [ChartColors.COLOR_BY_SEX, TopolaChartColors.COLOR_BY_SEX],\n    [ChartColors.COLOR_BY_TRIBE, TopolaChartColors.COLOR_BY_TRIBE],\n    [ChartColors.COLOR_BY_NR_LANGUAGES, TopolaChartColors.COLOR_BY_LANGUAGES]\n]);\n\nexport interface ChartProps {\n    data: JsonGedcomData;\n    selection: IndiInfo;\n    chartType: ChartType;\n    onSelection: (indiInfo: IndiInfo) => void;\n    freezeAnimation?: boolean;\n    colors?: ChartColors;\n    hideLanguages?: Languages;\n    hideTribe?: Tribe;\n    hideIds?: Ids;\n    hideSex?: Sex;\n}\n\nclass ChartWrapper {\n    private chart?: ChartHandle;\n    /** Animation is in progress. */\n    private animating = false;\n    /** Rendering is required after the current animation finishes. */\n    private rerenderRequired = false;\n    /** The d3 zoom behavior object. */\n    private zoomBehavior?: ZoomBehavior<Element, any>;\n    /** Props that will be used for re-rendering. */\n    private rerenderProps?: ChartProps;\n    private rerenderResetPosition?: boolean;\n\n    zoom(factor: number) {\n        const parent = select('#svgContainer') as Selection<Element, any, any, any>;\n        this.zoomBehavior!.scaleBy(parent, factor);\n    }\n\n    /**\n     * Renders the chart or performs a transition animation to a new state.\n     * If indiInfo is not given, it means that it is the initial render and no animation is performed.\n     */\n    renderChart(\n        props: ChartProps,\n        intl: IntlShape,\n        args: { initialRender: boolean; resetPosition: boolean } = {\n            initialRender: false,\n            resetPosition: false,\n        },\n    ) {\n        // Wait for animation to finish if animation is in progress.\n        if (!args.initialRender && this.animating) {\n            this.rerenderRequired = true;\n            this.rerenderProps = props;\n            this.rerenderResetPosition = args.resetPosition;\n            return;\n        }\n\n        // Freeze changing selection after initial rendering.\n        if (!args.initialRender && props.freezeAnimation) {\n            return;\n        }\n\n        if (args.initialRender) {\n            (select('#chart').node() as HTMLElement).innerHTML = '';\n            this.chart = createChart({\n                json: props.data,\n                chartType: HourglassChart,\n                renderer: DetailedRenderer,\n                svgSelector: '#chart',\n                indiCallback: (info) => props.onSelection(info),\n                colors: chartColors.get(props.colors!),\n                animate: true,\n                updateSvgSize: false,\n                locale: intl.locale,\n            });\n        } else {\n            this.chart!.setData(props.data);\n        }\n\n        const chartInfo = this.chart!.render({\n            startIndi: props.selection.id,\n            baseGeneration: props.selection.generation,\n        });\n        const svg = select('#chartSvg');\n        const parent = select('#svgContainer').node() as Element;\n        const scale = zoomTransform(parent).k;\n        const zoomOutFactor = min([\n            1,\n            scale,\n            parent.clientWidth / chartInfo.size[0],\n            parent.clientHeight / chartInfo.size[1],\n        ])!;\n        const extent: [number, number] = [max([0.1, zoomOutFactor])!, 2];\n\n        this.zoomBehavior = zoom()\n            .scaleExtent(extent)\n            .translateExtent([[0, 0], chartInfo.size])\n            .on('zoom', (event) => zoomed(chartInfo.size, event));\n        select(parent).on('scroll', scrolled).call(this.zoomBehavior);\n\n        const scrollTopTween = (scrollTop: number) => {\n            return () => {\n                const i = interpolateNumber(parent.scrollTop, scrollTop);\n                return (t: number) => {\n                    parent.scrollTop = i(t);\n                };\n            };\n        };\n\n        const scrollLeftTween = (scrollLeft: number) => {\n            return () => {\n                const i = interpolateNumber(parent.scrollLeft, scrollLeft);\n                return (t: number) => {\n                    parent.scrollLeft = i(t);\n                };\n            };\n        };\n\n        const dx = parent.clientWidth / 2 - chartInfo.origin[0] * scale;\n        const dy = parent.clientHeight / 2 - chartInfo.origin[1] * scale;\n        const offsetX = max([\n            0,\n            (parent.clientWidth - chartInfo.size[0] * scale) / 2,\n        ]);\n        const offsetY = max([\n            0,\n            (parent.clientHeight - chartInfo.size[1] * scale) / 2,\n        ]);\n        const svgTransition = svg.transition().delay(200).duration(500);\n        const transition = args.initialRender ? svg : svgTransition;\n        transition\n            .attr('transform', `translate(${offsetX}, ${offsetY})`)\n            .attr('width', chartInfo.size[0] * scale)\n            .attr('height', chartInfo.size[1] * scale);\n        if (args.resetPosition) {\n            if (args.initialRender) {\n                parent.scrollLeft = -dx;\n                parent.scrollTop = -dy;\n            } else {\n                svgTransition\n                    .tween('scrollLeft', scrollLeftTween(-dx))\n                    .tween('scrollTop', scrollTopTween(-dy));\n            }\n        }\n\n        // After the animation is finished, rerender the chart if required.\n        this.animating = true;\n        chartInfo.animationPromise.then(() => {\n            this.animating = false;\n            if (this.rerenderRequired) {\n                this.rerenderRequired = false;\n                // Use `this.rerenderProps` instead of the props in scope because\n                // the props may have been updated in the meantime.\n                this.renderChart(this.rerenderProps!, intl, {\n                    initialRender: false,\n                    resetPosition: !!this.rerenderResetPosition,\n                });\n            }\n        });\n    }\n}\n\nfunction usePrevious<T>(value: T): T | undefined {\n    const ref = useRef<T>();\n    useEffect(() => {\n        ref.current = value;\n    });\n    return ref.current;\n}\n\nexport function Chart(props: ChartProps) {\n    const chartWrapper = useRef(new ChartWrapper());\n    const prevProps = usePrevious(props);\n    const intl = useIntl();\n\n    useEffect(() => {\n        if (prevProps) {\n            const initialRender =\n                props.chartType !== prevProps?.chartType ||\n                props.colors !== prevProps?.colors ||\n                props.hideLanguages !== prevProps?.hideLanguages ||\n                props.hideTribe !== prevProps?.hideTribe ||\n                props.hideIds !== prevProps?.hideIds ||\n                props.hideSex !== prevProps?.hideSex;\n            const resetPosition =\n                props.chartType !== prevProps?.chartType ||\n                props.data !== prevProps.data ||\n                props.selection !== prevProps.selection;\n            chartWrapper.current.renderChart(props, intl, {\n                initialRender,\n                resetPosition,\n            });\n        } else {\n            chartWrapper.current.renderChart(props, intl, {\n                initialRender: true,\n                resetPosition: true,\n            });\n        }\n    });\n\n    return (\n        <div id=\"svgContainer\">\n            <Media greaterThanOrEqual=\"large\" className=\"zoom\">\n                <button className=\"zoom-in\" onClick={() => chartWrapper.current.zoom(ZOOM_FACTOR)}>+</button>\n                <button className=\"zoom-out\" onClick={() => chartWrapper.current.zoom(1 / ZOOM_FACTOR)}></button>\n            </Media>\n            <svg id=\"chartSvg\">\n                <g id=\"chart\"/>\n            </svg>\n        </div>\n    );\n}\n","import * as H from 'history';\nimport * as queryString from 'query-string';\nimport {DataSourceEnum, SourceSelection} from './datasource/data_source';\nimport {Details} from './details/details';\nimport {EmbeddedDataSource, EmbeddedSourceSpec} from './datasource/embedded';\nimport {FormattedMessage, useIntl} from 'react-intl';\nimport {getI18nMessage} from './util/error_i18n';\nimport {IndiInfo} from './lib/topola';\nimport {Loader, Message, Portal, Tab} from 'semantic-ui-react';\nimport {Media} from './util/media';\nimport {Redirect, Route, Switch} from 'react-router-dom';\nimport {TopBar} from './menu/top_bar';\nimport {TopolaData} from './util/gedcom_util';\nimport {useEffect, useState} from 'react';\nimport {useHistory, useLocation} from 'react-router';\nimport {idToIndiMap} from './util/gedcom_util';\nimport {\n    Chart,\n    ChartType,\n    downloadPdf,\n    downloadPng,\n    downloadSvg,\n} from './chart';\nimport {\n    argsToConfig,\n    Config,\n    ConfigPanel,\n    configToArgs,\n    DEFAULT_CONFIG,\n    Languages,\n    Tribe,\n    Ids,\n    Sex,\n} from './config';\nimport {\n    getSelection,\n    UploadSourceSpec,\n    UrlSourceSpec,\n    GedcomUrlDataSource,\n    UploadedDataSource,\n} from './datasource/load_data';\n\n/**\n * Load GEDCOM URL from REACT_APP_STATIC_URL environment variable.\n *\n * If this environment variable is provided, the viewer is switched to\n * single-tree mode without the option to load other data.\n */\nconst staticUrl = process.env.REACT_APP_STATIC_URL;\n\n/** Shows an error message in the middle of the screen. */\nfunction ErrorMessage(props: { message?: string }) {\n    return (\n        <Message negative className=\"error\">\n            <Message.Header>\n                <FormattedMessage\n                    id=\"error.failed_to_load_file\"\n                    defaultMessage={'Failed to load file'}\n                />\n            </Message.Header>\n            <p>{props.message}</p>\n        </Message>\n    );\n}\n\ninterface ErrorPopupProps {\n    message?: string;\n    open: boolean;\n    onDismiss: () => void;\n}\n\n/**\n * Shows a dismissable error message in the bottom left corner of the screen.\n */\nfunction ErrorPopup(props: ErrorPopupProps) {\n    return (\n        <Portal open={props.open} onClose={props.onDismiss}>\n            <Message negative className=\"errorPopup\" onDismiss={props.onDismiss}>\n                <Message.Header>\n                    <FormattedMessage id=\"error.error\" defaultMessage={'Error'}/>\n                </Message.Header>\n                <p>{props.message}</p>\n            </Message>\n        </Portal>\n    );\n}\n\nenum AppState {\n    INITIAL,\n    LOADING,\n    ERROR,\n    SHOWING_CHART,\n    LOADING_MORE,\n}\n\ntype DataSourceSpec =\n    | UrlSourceSpec\n    | UploadSourceSpec\n    | EmbeddedSourceSpec;\n\n/**\n * Arguments passed to the application, primarily through URL parameters.\n * Non-optional arguments get populated with default values.\n */\ninterface Arguments {\n    sourceSpec?: DataSourceSpec;\n    selection?: IndiInfo;\n    chartType: ChartType;\n    standalone: boolean;\n    freezeAnimation: boolean;\n    showSidePanel: boolean;\n    config: Config;\n}\n\nfunction getParamFromSearch(name: string, search: queryString.ParsedQuery) {\n    const value = search[name];\n    return typeof value === 'string' ? value : undefined;\n}\n\nfunction startIndi(data: TopolaData | undefined) {\n    const egoGen = getEgoGen(data)\n    return {\n        id: data?.chartData?.indis?.[0]?.id || 'I0',  // lowest ID on the chart\n        generation: egoGen !== undefined ? -parseInt(egoGen, 10) : 0\n    };\n}\n\nfunction getEgoIndi(data: TopolaData | undefined) {\n    return Object.entries(data?.gedcom?.other || {})\n        .filter(([_, value]) => value.tag === \"EGO\")\n}\n\nfunction getEgoGen(data: TopolaData | undefined) {\n    return getEgoIndi(data)\n        .map(([_, value]) => value.tree.find(sub => sub.tag === \"GEN\")?.data)\n        .find(data => data !== undefined);\n}\n\nfunction getLanguageOptions(data: TopolaData | undefined) {\n    return Object.entries(data?.gedcom?.indis || {})\n        .reduce<Set<string>>((acc, [_, value]) => {\n            const langDataArray = value.tree.filter((sub: any) => sub.tag === \"LANG\");\n            langDataArray.forEach(lang => {\n                if (lang.data) acc.add(lang.data);\n            });\n            return acc;\n        }, new Set<string>());\n}\n\nfunction getTribes(data: TopolaData | undefined) {\n    return Object.entries(data?.gedcom?.indis || {})\n        .reduce<Set<string>>((acc, [_, value]) => {\n            const langDataArray = value.tree.filter((sub: any) => sub.tag === \"_TRIB\");\n            langDataArray.forEach(lang => {\n                if (lang.data) acc.add(lang.data);\n            });\n            return acc;\n        }, new Set<string>());\n}\n\n/**\n * Retrieve arguments passed into the application through the URL and uploaded data.\n */\nfunction getArguments(location: H.Location<any>): Arguments {\n    const chartTypes = new Map<string | undefined, ChartType>([\n        ['hourglass', ChartType.Hourglass]\n    ]);\n    const search = queryString.parse(location.search);\n    const getParam = (name: string) => getParamFromSearch(name, search);\n    const view = getParam('view');\n    const hash = getParam('file');\n    const url = getParam('url');\n    const embedded = getParam('embedded') === 'true'; // False by default.\n    let sourceSpec: DataSourceSpec | undefined = undefined;\n    if (staticUrl) {\n        sourceSpec = {\n            source: DataSourceEnum.GEDCOM_URL,\n            url: staticUrl,\n            handleCors: false,\n        };\n    } else if (hash) {\n        sourceSpec = {\n            source: DataSourceEnum.UPLOADED,\n            hash,\n            gedcom: location.state && location.state.data,\n            images: location.state && location.state.images,\n        };\n    } else if (url) {\n        sourceSpec = {\n            source: DataSourceEnum.GEDCOM_URL,\n            url,\n            handleCors: getParam('handleCors') !== 'false', // True by default.\n        };\n    } else if (embedded) {\n        sourceSpec = {source: DataSourceEnum.EMBEDDED};\n    }\n\n    const indi = getParam('indi');\n    const parsedGen = Number(getParam('gen'));\n    const selection = indi\n        ? {id: indi, generation: !isNaN(parsedGen) ? parsedGen : 0}\n        : undefined\n\n    return {\n        sourceSpec,\n        selection,\n        // Hourglass is the default view.\n        chartType: chartTypes.get(view) || ChartType.Hourglass,\n        showSidePanel: getParam('sidePanel') !== 'false', // True by default.\n        standalone: getParam('standalone') !== 'false' && !embedded && !staticUrl,\n        freezeAnimation: getParam('freeze') === 'true', // False by default\n        config: argsToConfig(search),\n    };\n}\n\nexport function App() {\n    /** State of the application. */\n    const [state, setState] = useState<AppState>(AppState.INITIAL);\n    /** Loaded data. */\n    const [data, setData] = useState<TopolaData>();\n    /** Selected individual. */\n    const [selection, setSelection] = useState<IndiInfo>();\n    /** Error to display. */\n    const [error, setError] = useState<string>();\n    /** Whether the side panel is shown. */\n    const [showSidePanel, setShowSidePanel] = useState(false);\n    /** Whether the app is in standalone mode, i.e. showing 'open file' menus. */\n    const [standalone, setStandalone] = useState(true);\n    /** Type of displayed chart. */\n    const [chartType, setChartType] = useState<ChartType>(ChartType.Hourglass);\n    /** Whether to show the error popup. */\n    const [showErrorPopup, setShowErrorPopup] = useState(false);\n    /** Specification of the source of the data. */\n    const [sourceSpec, setSourceSpec] = useState<DataSourceSpec>();\n    /** Freeze animations after initial chart render. */\n    const [freezeAnimation, setFreezeAnimation] = useState(false);\n    const [config, setConfig] = useState(DEFAULT_CONFIG);\n\n    const intl = useIntl();\n    const history = useHistory();\n    const location = useLocation();\n\n    /** Sets the state with a new individual selection and chart type. */\n    function updateDisplay(newSelection: IndiInfo) {\n        if (!selection || selection.id !== newSelection.id || selection!.generation !== newSelection.generation) {\n            setSelection(newSelection);\n        }\n    }\n\n    function toggleDetails(config: Config, data: TopolaData | undefined) {\n        if (data === undefined) {\n            return;\n        }\n        // If no ego indi, no need to render the tribe/languages options\n        const egoIndi = getEgoIndi(data)\n        // Find if there are languages\n        config.languageOptions = Array.from(getLanguageOptions(data)).sort()\n        config.renderLanguagesOption = config.languageOptions.length > 0\n        // Find if there are tribes\n        config.renderTribeOption = Array.from(getLanguageOptions(data)).length > 0\n        idToIndiMap(data.chartData).forEach((indi) => {\n            indi.hideLanguages = config.languages === Languages.HIDE;\n            indi.hideTribe = config.tribe === Tribe.HIDE;\n            indi.hideId = config.id === Ids.HIDE;\n            indi.hideSex = config.sex === Sex.HIDE;\n        });\n    }\n\n    /** Sets error message after data load failure. */\n    function setErrorMessage(message: string) {\n        setError(message);\n        setState(AppState.ERROR);\n    }\n\n    const uploadedDataSource = new UploadedDataSource();\n    const gedcomUrlDataSource = new GedcomUrlDataSource();\n    const embeddedDataSource = new EmbeddedDataSource();\n\n    function isNewData(newSourceSpec: DataSourceSpec, newSelection?: IndiInfo) {\n        if (!sourceSpec || sourceSpec.source !== newSourceSpec.source) {\n            // New data source means new data\n            return true;\n        }\n        const newSource = {spec: newSourceSpec, selection: newSelection};\n        const oldSource = {\n            spec: sourceSpec,\n            selection: selection,\n        };\n        switch (newSource.spec.source) {\n            case DataSourceEnum.UPLOADED:\n                return uploadedDataSource.isNewData(\n                    newSource as SourceSelection<UploadSourceSpec>,\n                    oldSource as SourceSelection<UploadSourceSpec>,\n                    data,\n                );\n            case DataSourceEnum.GEDCOM_URL:\n                return gedcomUrlDataSource.isNewData(\n                    newSource as SourceSelection<UrlSourceSpec>,\n                    oldSource as SourceSelection<UrlSourceSpec>,\n                    data,\n                );\n            case DataSourceEnum.EMBEDDED:\n                return embeddedDataSource.isNewData(\n                    newSource as SourceSelection<EmbeddedSourceSpec>,\n                    oldSource as SourceSelection<EmbeddedSourceSpec>,\n                    data,\n                );\n        }\n    }\n\n    function loadData(newSourceSpec: DataSourceSpec, newSelection?: IndiInfo) {\n        switch (newSourceSpec.source) {\n            case DataSourceEnum.UPLOADED:\n                return uploadedDataSource.loadData({\n                    spec: newSourceSpec,\n                    selection: newSelection,\n                });\n            case DataSourceEnum.GEDCOM_URL:\n                return gedcomUrlDataSource.loadData({\n                    spec: newSourceSpec,\n                    selection: newSelection,\n                });\n            case DataSourceEnum.EMBEDDED:\n                return embeddedDataSource.loadData({\n                    spec: newSourceSpec,\n                    selection: newSelection,\n                });\n        }\n    }\n\n    useEffect(() => {\n        const rootElement = document.getElementById('root');\n        if (location.pathname === '/') {\n            // @ts-ignore\n            rootElement.classList.add('bgLogo');\n        } else {\n            // @ts-ignore\n            rootElement.classList.remove('bgLogo');\n        }\n\n        (async () => {\n            if (location.pathname !== '/view') {\n                if (state !== AppState.INITIAL) {\n                    setState(AppState.INITIAL);\n                }\n                return;\n            }\n            const args = getArguments(location);\n            if (!args.sourceSpec) {\n                history.replace({pathname: '/'});\n                return;\n            }\n            if (\n                state === AppState.INITIAL || isNewData(args.sourceSpec, args.selection)\n            ) {\n                setState(AppState.LOADING);\n                setSourceSpec(args.sourceSpec);\n                setStandalone(args.standalone);\n                setChartType(args.chartType);\n                setFreezeAnimation(args.freezeAnimation);\n                setConfig(args.config);\n                try {\n                    const data = await loadData(args.sourceSpec, args.selection);\n                    setData(data);\n                    setSelection(args.selection !== undefined ? args.selection : startIndi(data));\n                    toggleDetails(args.config, data);\n                    setShowSidePanel(args.showSidePanel);\n                    setState(AppState.SHOWING_CHART);\n                } catch (error: any) {\n                    setErrorMessage(getI18nMessage(error, intl));\n                }\n            } else if (\n                state === AppState.SHOWING_CHART || state === AppState.LOADING_MORE\n            ) {\n                // Update selection if it has changed in the URL.\n                setChartType(args.chartType);\n                setState(AppState.SHOWING_CHART);\n                updateDisplay(args.selection !== undefined ? args.selection : startIndi(data));\n            }\n        })();\n    });\n\n    function updateUrl(args: queryString.ParsedQuery<any>) {\n        const search = queryString.parse(location.search);\n        for (const key in args) {\n            search[key] = args[key];\n        }\n        location.search = queryString.stringify(search);\n        history.push(location);\n    }\n\n    /**\n     * Called when the user clicks an individual box in the chart. Updates the browser URL.\n     */\n    function onSelection(selection: IndiInfo) {\n        updateUrl({\n            indi: selection.id,\n            gen: selection.generation,\n        });\n    }\n\n    function displayErrorPopup(message: string) {\n        setShowErrorPopup(true);\n        setError(message);\n    }\n\n    async function onDownloadPdf() {\n        try {\n            await downloadPdf();\n        } catch (e) {\n            displayErrorPopup(\n                intl.formatMessage({\n                    id: 'error.failed_pdf',\n                    defaultMessage:\n                        'Failed to generate PDF file.' +\n                        ' Please try with a smaller diagram or download an SVG file.',\n                }),\n            );\n        }\n    }\n\n    async function onDownloadPng() {\n        try {\n            await downloadPng();\n        } catch (e) {\n            displayErrorPopup(\n                intl.formatMessage({\n                    id: 'error.failed_png',\n                    defaultMessage:'Failed to generate PNG file. Please try with a smaller diagram or download an SVG file.'\n                }),\n            );\n        }\n    }\n\n    function onDownloadSvg() {\n        downloadSvg();\n    }\n\n    function onCenterView() {\n        onSelection(startIndi(data))\n    }\n\n    function onDismissErrorPopup() {\n        setShowErrorPopup(false);\n    }\n\n    function renderMainArea() {\n        switch (state) {\n            case AppState.SHOWING_CHART:\n            case AppState.LOADING_MORE:\n                const updatedSelection = getSelection(data!.chartData, selection);\n                const sidePanelTabs = [\n                    {\n                        menuItem: intl.formatMessage({\n                            id: 'tab.info',\n                            defaultMessage: 'Info',\n                        }),\n                        render: () => (\n                            <Details gedcom={data!.gedcom} indi={updatedSelection.id}/>\n                        ),\n                    },\n                    {\n                        menuItem: intl.formatMessage({\n                            id: 'tab.settings',\n                            defaultMessage: 'Settings',\n                        }),\n                        render: () => (\n                            <ConfigPanel\n                                config={config}\n                                onChange={(config) => {\n                                    setConfig(config);\n                                    toggleDetails(config, data);\n                                    updateUrl(configToArgs(config));\n                                }}\n                            />\n                        ),\n                    },\n                ];\n                return (\n                    <div id=\"content\">\n                        <ErrorPopup\n                            open={showErrorPopup}\n                            message={error}\n                            onDismiss={onDismissErrorPopup}\n                        />\n                        {state === AppState.LOADING_MORE ? (\n                            <Loader active size=\"small\" className=\"loading-more\"/>\n                        ) : null}\n                        <Chart\n                            data={data!.chartData}\n                            selection={updatedSelection}\n                            chartType={chartType}\n                            onSelection={onSelection}\n                            freezeAnimation={freezeAnimation}\n                            colors={config.color}\n                            hideLanguages={config.languages}\n                            hideTribe={config.tribe}\n                            hideIds={config.id}\n                            hideSex={config.sex}\n                        />\n                        {showSidePanel ? (\n                            <Media greaterThanOrEqual=\"large\" className=\"sidePanel\">\n                                <Tab panes={sidePanelTabs}/>\n                            </Media>\n                        ) : null}\n                    </div>\n                );\n            case AppState.ERROR:\n                return <ErrorMessage message={error!}/>;\n            case AppState.INITIAL:\n            case AppState.LOADING:\n                return <Loader active size=\"large\"/>;\n        }\n    }\n\n    return (\n        <>\n            <Route\n                render={() => (\n                    <TopBar\n                        data={data?.chartData}\n                        showingChart={\n                            history.location.pathname === '/view' &&\n                            (state === AppState.SHOWING_CHART || state === AppState.LOADING_MORE)\n                        }\n                        standalone={standalone}\n                        eventHandlers={{\n                            onSelection,\n                            onDownloadPdf,\n                            onDownloadPng,\n                            onDownloadSvg,\n                            onCenterView,\n                        }}\n                    />\n                )}\n            />\n            {staticUrl ? (\n                <Switch>\n                    <Route exact path=\"/view\" render={renderMainArea}/>\n                    <Redirect to={'/view'}/>\n                </Switch>\n            ) : (\n                <Switch>\n                    <Route exact path=\"/view\" render={renderMainArea}/>\n                    <Redirect to={'/'}/>\n                </Switch>\n            )}\n        </>\n    );\n}\n\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport messages_de from './translations/de.json';\nimport messages_fr from './translations/fr.json';\nimport messages_it from './translations/it.json';\nimport messages_es from './translations/es.json';\nimport messages_pl from './translations/pl.json';\nimport {App} from './app';\nimport {detect} from 'detect-browser';\nimport {HashRouter as Router, Route} from 'react-router-dom';\nimport {IntlProvider} from 'react-intl';\nimport {MediaContextProvider, mediaStyles} from './util/media';\nimport './index.css';\nimport 'semantic-ui-css/semantic.min.css';\nimport 'canvas-toBlob';\n\nconst messages = {\n    de: messages_de,\n    fr: messages_fr,\n    it: messages_it,\n    es: messages_es,\n    pl: messages_pl\n};\nconst language = navigator.language && navigator.language.split(/[-_]/)[0];\nconst browser = detect();\n\nif (browser && browser.name === 'ie') {\n    ReactDOM.render(\n        <p>Genealogy Viewer does not support Internet Explorer. Please try a different (modern) browser.</p>,\n        document.querySelector('#root'),\n    );\n} else {\n    ReactDOM.render(\n        <IntlProvider locale={language} messages={messages[language]}>\n            <MediaContextProvider>\n                <style>{mediaStyles}</style>\n                <Router>\n                    <Route component={App}/>\n                </Router>\n            </MediaContextProvider>\n        </IntlProvider>,\n        document.querySelector('#root'),\n    );\n}\n","import {Date as TopolaDate, DateOrRange, DateRange, getDate} from '../lib/topola';\nimport {IntlShape} from 'react-intl';\n\nconst DATE_QUALIFIERS = new Map([\n    ['abt', 'about'],\n    ['cal', 'calculated'],\n    ['est', 'estimated'],\n]);\n\nfunction formatDate(date: TopolaDate, intl: IntlShape) {\n    const hasDay = date.day !== undefined;\n    const hasMonth = date.month !== undefined;\n    const hasYear = date.year !== undefined;\n    if (!hasDay && !hasMonth && !hasYear) {\n        return date.text || '';\n    }\n    const dateObject = toDateObject(date);\n    const translatedQualifier = formatDateQualifier(date.qualifier, intl);\n\n    const formatOptions: Intl.DateTimeFormatOptions = {\n        day: hasDay ? 'numeric' : undefined,\n        month: hasMonth ? 'long' : undefined,\n        year: hasYear ? 'numeric' : undefined,\n    };\n    const translatedDate = new Intl.DateTimeFormat(\n        intl.locale,\n        formatOptions,\n    ).format(dateObject);\n\n    return [translatedQualifier, translatedDate]\n        .filter((dateElement) => dateElement)\n        .join(' ');\n}\n\nfunction formatDateRage(dateRange: DateRange, intl: IntlShape) {\n    const fromDate = dateRange.from;\n    const toDate = dateRange.to;\n    const translatedFromDate = fromDate && formatDate(fromDate, intl);\n    const translatedToDate = toDate && formatDate(toDate, intl);\n    if (translatedFromDate && translatedToDate) {\n        return intl.formatMessage(\n            {\n                id: 'date.between',\n                defaultMessage: 'between {from} and {to}',\n            },\n            {from: translatedFromDate, to: translatedToDate},\n        );\n    }\n    if (translatedFromDate) {\n        return intl.formatMessage(\n            {\n                id: 'date.after',\n                defaultMessage: 'after {from}',\n            },\n            {from: translatedFromDate},\n        );\n    }\n    if (translatedToDate) {\n        return intl.formatMessage(\n            {\n                id: 'date.before',\n                defaultMessage: 'before {to}',\n            },\n            {to: translatedToDate},\n        );\n    }\n    return '';\n}\n\nexport function formatDateQualifier(\n    qualifier: string | undefined,\n    intl: IntlShape,\n): string {\n    const lowerCaseQualifier = qualifier && qualifier.toLowerCase();\n    return (\n        (lowerCaseQualifier &&\n            intl.formatMessage({\n                id: `date.${lowerCaseQualifier}`,\n                defaultMessage:\n                    DATE_QUALIFIERS.get(lowerCaseQualifier) || lowerCaseQualifier,\n            })) ||\n        ''\n    );\n}\n\n/** Formats a DateOrRange object. */\nexport function formatDateOrRange(\n    dateOrRange: DateOrRange | undefined,\n    intl: IntlShape,\n): string {\n    if (!dateOrRange) {\n        return '';\n    }\n    if (dateOrRange.date) {\n        return formatDate(dateOrRange.date, intl);\n    }\n    if (dateOrRange.dateRange) {\n        return formatDateRage(dateOrRange.dateRange, intl);\n    }\n    return '';\n}\n\n/** Formats a date given in GEDCOM format. */\nexport function translateDate(gedcomDate: string, intl: IntlShape): string {\n    return formatDateOrRange(getDate(gedcomDate), intl);\n}\n\nexport function compareTopolaDates(\n    date1: TopolaDate | undefined,\n    date2: TopolaDate | undefined,\n): number {\n    if (!date1 || !date1.year || !date2 || !date2.year) {\n        return 0;\n    }\n    if (date1.year !== date2.year) {\n        return date1.year - date2.year;\n    }\n    if (!date1.month || !date2.month) {\n        return 0;\n    }\n    if (date1.month !== date2.month) {\n        return date1.month - date2.month;\n    }\n    if (date1.day && date2.day && date1.day !== date2.day) {\n        return date1.month - date2.month;\n    }\n    return 0;\n}\n\n/** Compares a dates given in GEDCOM format. */\nexport function compareDates(\n    firstDateOrRange: DateOrRange | undefined,\n    secondDateOrRange: DateOrRange | undefined,\n): number {\n    const date1 =\n        firstDateOrRange &&\n        (firstDateOrRange.date ||\n            (firstDateOrRange.dateRange &&\n                (firstDateOrRange.dateRange.from || firstDateOrRange.dateRange.to)));\n    const date2 =\n        secondDateOrRange &&\n        (secondDateOrRange.date ||\n            (secondDateOrRange.dateRange &&\n                (secondDateOrRange.dateRange.from || secondDateOrRange.dateRange.to)));\n    return compareTopolaDates(date1, date2);\n}\n\nexport function areDateRangesOverlapped(\n    range1: DateRange,\n    range2: DateRange,\n): boolean {\n    return (\n        compareTopolaDates(range1.from, range2.to) <= 0 &&\n        compareTopolaDates(range1.to, range2.from) >= 0\n    );\n}\n\nexport function isValidDateOrRange(\n    dateOrRange: DateOrRange | undefined,\n): boolean {\n    // invalid when range is closed and start is before end\n    if (isDateRangeClosed(dateOrRange?.dateRange)) {\n        return (\n            compareTopolaDates(\n                dateOrRange?.dateRange?.from,\n                dateOrRange?.dateRange?.to,\n            ) <= 0\n        );\n    }\n    //valid when there is exact date or date range has start or end defined\n    return !!(\n        dateOrRange?.date ||\n        dateOrRange?.dateRange?.from ||\n        dateOrRange?.dateRange?.to\n    );\n}\n\nexport function isDateRangeClosed(range: DateRange | undefined): boolean {\n    return !!(range?.from && range?.to);\n}\n\nexport function toDateObject(date: TopolaDate): Date {\n    return new Date(\n        date.year !== undefined ? date.year! : 0,\n        date.month !== undefined ? date.month! - 1 : 0,\n        date.day !== undefined ? date.day! : 1,\n    );\n}\n"],"sourceRoot":""}