{"version":3,"sources":["util/error.ts","lib/topola/dist/chart-util.js","util/gedcom_util.ts","lib/topola/dist/ancestor-chart.js","lib/topola/dist/id-generator.js","lib/topola/dist/composite-renderer.js","lib/topola/dist/data.js","lib/topola/dist/date-format.js","lib/topola/dist/descendant-chart.js","lib/topola/dist/index.js","lib/topola/dist/api.js","lib/topola/dist/detailed-renderer.js","lib/topola/dist/gedcom.js","lib/topola/dist/hourglass-chart.js","lib/topola/dist/simple-api.js","datasource/data_source.ts","details/translated-tag.tsx","details/wrapped-image.tsx","details/multiline-text.tsx","details/event-extras.tsx","details/events.tsx","details/details.tsx","datasource/embedded.ts","util/error_i18n.ts","menu/menu_item.tsx","util/media.ts","menu/search_index.ts","menu/search.tsx","menu/upload_menu.tsx","menu/top_bar.tsx","menu/url_menu.tsx","config.tsx","chart.tsx","languages/languages-loader.ts","app.tsx","index.tsx","util/date_util.ts","datasource/load_data.ts"],"names":["TopolaError","code","message","args","Error","Object","defineProperty","exports","value","ChartUtil","getChartInfoWithoutMargin","getChartInfo","linkId","V_SPACING","H_SPACING","d3_selection_1","require","d3_flextree_1","d3_array_1","HIDE_TIME_MS","MOVE_TIME_MS","node","parent","id","_a","data","generation","child","additionalMarriage","nodes","x0","min","d","x","width","y0","y","height","size","max","origin","options","this","prototype","linkHorizontal","s","sAnchor","renderer","getFamilyAnchor","dAnchor","spouseParentNodeId","getSpouseAnchor","getIndiAnchor","sx","sy","_b","dx","dy","midX","linkVertical","midY","linkAdditionalMarriage","nodeIndex","children","findIndex","n","siblingNode","updateSvgDimensions","chartInfo","group","select","svgSelector","animate","transition","delay","duration","attr","layOutChart","root","layoutOptions","_this","svg","empty","append","text","getCss","each","depth","flipVertically","baseGeneration","updateNodes","descendants","vSizePerDepth","Map","maxVSize","horizontal","get","set","vSize","vSpacing","undefined","hSpacing","flextree","nodeSize","maxChildSize_1","maxChildSize","spacing","treemap","forEach","renderChart","getSvgForRendering","nodeAnimation","renderNodes","linkAnimation","renderLinks","Promise","all","resolve","boundNodes","selectAll","nodeEnter","enter","transitionsPending","exit","transitionDone","merge","style","on","render","remove","link","links","filter","boundLinks","path","insert","pointerToId","pointer","substring","length","idToIndiMap","map","indis","indi","idToFamMap","fams","fam","prepareGedcom","entries","head","find","entry","tag","other","strcmp","a","b","sortChildren","gedcom","comparator","indiMap","indiId1","indiId2","indi1","indi2","compareDates","birth","birthDatesComparator","newFams","newChildren","sort","assign","sortFamilyChildren","sortSpouses","famMap","famId1","famId2","fam1","fam2","marriage","marriageDatesComparator","newIndis","sortIndiSpouses","dereference","getterFunction","dereferenced","getData","result","tree","subentry","last","push","normalizeGedcom","IMAGE_EXTENSIONS","isImageFile","fileName","lowerName","toLowerCase","some","ext","endsWith","filterImages","images","newImages","image","filePath","url","replaceAll","match","has","title","startsWith","filterImage","convertGedcom","allLanguages","parseGedcom","json","gedcomEntriesToJson","chartData","getName","person","names","subEntry","name","nameEntry","replace","getFileName","fileEntry","fileTitle","fileExtension","getImageFileEntry","objectEntry","__assign","t","i","arguments","p","hasOwnProperty","call","apply","AncestorChart","getAncestorsTree","chart_util_1","d3_hierarchy_1","id_generator_1","ancestorChartOptions","startIndiFamilies","startIndi","getIndi","getFamiliesAsSpouse","startFam","getFam","getMother","swapStartSpouses","ancestorsRoot","createHierarchy","pop","util","famc","parents","stack","idGenerator","IdGenerator","getFamilyAsChild","getId","parentId","family","indiParentNodeId","getFather","father","mother","spouse","stratify","animationPromise","info","ids","num","getFamPositionHorizontal","getFamPositionVertical","CompositeRenderer","getPreferredFamSize","setPreferredIndiSize","getPreferredIndiSize","indiVSizePerDepth","maxIndiVSize","getIndiVSize","getFamVSize","getVSize","hSize","indiHSize","getHSize","x_1","famYOffset","famXOffset","indiWidth","spouseWidth","familyWidth","indiHeight","spouseHeight","familyHeight","JsonDataProvider","JsonIndiDetails","isEgo","getFirstName","firstName","getLastName","lastName","getBirthDate","getMaidenName","maidenName","getNumberOfChildren","numberOfChildren","getNumberOfMarriages","numberOfMarriages","getBirthPlace","place","getDeathDate","death","getDeathPlace","isConfirmedDeath","confirmed","getSex","sex","getLanguages","languages","getLanguagesLabel","abbreviations","lang","abbreviation","join","getTribe","tribe","getImageUrl","getImages","getNotes","notes","getEvents","events","showLanguages","hideLanguages","showTribe","hideTribe","showId","hideId","showSex","hideSex","JsonFamDetails","husb","wife","getChildren","getMarriageDate","getMarriagePlace","formatDateOrRange","formatDate","MONTHS_EN","QUALIFIERS_I18N","shortMonthCache","getShortMonth","month","locale","Intl","DateTimeFormat","cacheKey","format","Date","getQualifier","qualifier","language","split","languageMap","formatDateOnly","day","year","date","dateOrRange","dateRange","from","to","DescendantChart","layOutDescendants","DUMMY_ROOT_NODE_ID","removeDummyNode","allNodes","slice","descendantsRoot","getNodes","famIds","famId","indiId","getSpouse","getFamNode","dummyNode_1","_loop_1","this_1","childId","childNodes","__createBinding","create","o","m","k","k2","enumerable","__exportStar","ChartColors","__extends","extendStatics","setPrototypeOf","__proto__","Array","TypeError","String","__","constructor","DetailedRenderer","getLength","_1","date_format_1","composite_renderer_1","DETAILS_HEIGHT","textLengthCache","textClass","g","getComputedTextLength","SEX_SYMBOLS","_super","getColoringClass","colors","NO_COLOR","COLOR_BY_GENERATION","COLOR_BY_SEX","COLOR_BY_TRIBE","COLOR_BY_NR_LANGUAGES","COLOR_BY_LANGUAGE","getIndiDetails","detailsList","birthDate","birthPlace","deathDate","deathPlace","symbol","listIndex","details","tribeHeight","languagesHeight","idAndSexHeight","maxDetailsWidth","detail","getFamDetails","marriageDate","marriagePlace","update","indiUpdate","xOffset","yOffset","indiEnter","renderIndi","familyEnter","familyUpdate","getFamTransform","renderFamily","selection","getSexClass","tribesCss","getTribeClass","buildTribesMap","egoTribe","values","getLanguagesClass","selectedLanguageId","Math","resetCss","clear","console","log","indiHrefFunc","indiCallback","event","background","selectedLanguage","getClipId","getDetailsWidth","languages_height_start","tribe_height_start","maxDetails","v","details_height_start","_loop_2","lineGroup","sexSymbol","border","famHrefFunc","famCallback","gedcomToJson","getDate","parse_gedcom_1","findTag","findTags","extractName","arr","trim","MONTHS","parseDate","parts","lastPart","fullText","firstPart","Number","gedcomDate","date_1","createNotes","notesTag","reduce","concat","createEvent","typeTag","dateTag","placeTag","type","createFam","husbTag","wifeTag","objects","ego","nameTags","isMaiden","nameTag","main","maiden","nchiTag","nmrTag","sexTag","gedcomLanguages","l","includes","tribeTag","famcTag","objeTags","realObjeTag","file","createIndi","gedcomContents","parse","HourglassChart","ancestor_chart_1","descendant_chart_1","ancestorNodes","descendantNodes","createChart","data_1","SimpleChartHandle","initialRender","renderOptions","chartOptions","indiUrl","famUrl","createChartOptions","chartType","updateSvgSize","setData","DataSourceEnum","TAG_DESCRIPTIONS","TranslatedTag","props","normalizedTag","defaultMessage","WrappedImage","useState","imageOpen","setImageOpen","imageLoaded","setImageLoaded","imageFailed","setImageFailed","imageSrc","setImageSrc","className","onClick","onLoad","onError","e","currentTarget","alt","src","filename","centered","Placeholder","Image","square","Container","fluid","textAlign","Message","negative","compact","Header","Modal","basic","closeIcon","Icon","color","open","onClose","onOpen","Content","label","Label","attached","content","wrapped","MultilineText","lines","line","index","properties","target","eventSources","sources","intl","List","source","Item","verticalAlign","author","publicationInfo","sourceElement","Description","page","EventExtras","useIntl","activeIndex","setActiveIndex","setIndi","handleTabOnClick","menuItemProps","panes","menuItem","Menu","fitted","Popup","position","trigger","circular","Tab","Pane","note","flatMap","tab","renderActiveOnly","menu","tabular","borderless","PersonLink","location","useLocation","search","queryString","Meta","pathname","EVENT_TAGS","FAMILY_EVENT_TAGS","EventHeader","as","sub","familyEntry","spouseReference","familySubEntry","eventPlace","eventImages","imageFileEntry","sourceEntryReference","sourceEntry","abbr","sourceData","resolveDate","eventNotes","toEvent","familyMarriageEvent","personLink","toFamilyEvents","toIndiEvent","Event","Events","eventEntry","event1","event2","EXCLUDED_TAGS","fileDetails","noteDetails","nameDetails","fullName","nameType","getDetails","tags","detailsFunction","element","hasData","getOtherDetails","dataDetails","getMultilineDetails","Details","entriesWithData","Group","divided","EmbeddedMessageType","EmbeddedDataSource","newSource","oldSource","reject","PARENT_READY","window","postMessage","READY","GEDCOM","loadGedcom","addEventListener","onMessage","getI18nMessage","error","formatMessage","MenuType","AppMedia","createMedia","breakpoints","small","large","mediaStyles","createMediaStyle","Media","MediaContextProvider","MenuItem","newProps","menuType","Dropdown","lunr","normalize","input","toLocaleLowerCase","compare","score","naturalSort","ref","LunrSearchIndex","self","initMultiLingualLunrWithoutTrimmer","field","boost","spouseLastName","husbId","husband","getHusbandLastName","add","normalizedName","normalizedSpouseLastName","lunrInstance","pipelineFunctions","searchPipelineFunctions","unshift","stopWordFilter","stemmer","wordCharacters","pipeline","reset","searchPipeline","query","getNameLine","SearchBar","searchResults","setSearchResults","searchString","setSearchString","searchIndex","useRef","getDescriptionLine","debouncedHandleSearch","debounce","results","current","key","description","displaySearchResult","useEffect","initialize","buildSearchIndex","Search","onSearchChange","_","onResultSelect","onSelection","noResultsMessage","placeholder","selectFirstResult","isImageFileName","lower","UploadMenu","history","useHistory","files","filesArray","gedcomFile","loadFile","URL","createObjectURL","imageFileNames","keys","hash","md5","state","htmlFor","accept","multiple","onChange","ScreenSize","UrlMenu","dialogOpen","setDialogOpen","setUrl","inputRef","handleLoad","focus","Form","onSubmit","Input","href","Actions","Button","secondary","primary","TopBar","chartMenus","screenSize","showingChart","LARGE","eventHandlers","onDownloadPdf","onDownloadPng","onDownloadSvg","onCenterView","SMALL","Divider","fileMenus","standalone","greaterThanOrEqual","inverted","at","icon","LanguagesArg","TribeArg","IdsArg","SexArg","DEFAULT_CONFIG","HIDE","SHOW","renderLanguagesOption","renderTribeOption","languageOptions","COLOR_ARG","COLOR_ARG_INVERSE","LANGUAGES_ARG","LANGUAGES_ARG_INVERSE","TRIBE_ARG","TRIBE_ARG_INVERSE","ID_ARG","ID_ARG_INVERSE","SEX_ARG","SEX_ARG_INVERSE","argsToConfig","getParam","ConfigPanel","config","Field","Checkbox","radio","checked","tagName","ChartType","zoomed","scale","transform","offsetX","clientWidth","offsetY","clientHeight","scrollLeft","scrollTop","scrolled","zoomTransform","zoom","translateTo","loadAsDataUrl","blob","reader","FileReader","readAsDataURL","onload","inlineImage","baseVal","fetch","response","warn","inlineImages","getElementsByTagName","loadImage","drawImageOnCanvas","canvas","document","createElement","ctx","getContext","oldFill","fillStyle","fillRect","drawImage","canvasToBlob","toBlob","getStrippedSvg","getElementById","cloneNode","removeAttribute","setAttribute","getAttribute","querySelector","getSvgContentsWithInlinedImages","XMLSerializer","serializeToString","contents","Blob","saveAs","drawOnCanvas","downloadPng","downloadPdf","jspdf","default","doc","orientation","unit","addImage","save","chartColors","TopolaChartColors","ChartWrapper","chart","animating","rerenderRequired","zoomBehavior","rerenderProps","rerenderResetPosition","factor","scaleBy","resetPosition","freezeAnimation","innerHTML","zoomOutFactor","extent","scaleExtent","translateExtent","scrollTopTween","interpolateNumber","scrollLeftTween","svgTransition","tween","then","Chart","chartWrapper","prevProps","usePrevious","hideIds","CSVLoader","csvData","rows","headers","idIndex","indexOf","nameIndex","isoIndex","row","title_fn","iso","toUpperCase","str","word","charAt","AppState","staticUrl","process","REACT_APP_STATIC_URL","ErrorMessage","ErrorPopup","Portal","onDismiss","egoGen","getEgoIndi","getEgoGen","parseInt","loadLanguageOptions","acc","Set","getGedcomLanguages","getArguments","chartTypes","Hourglass","getParamFromSearch","view","embedded","sourceSpec","GEDCOM_URL","handleCors","UPLOADED","EMBEDDED","parsedGen","isNaN","showSidePanel","messages","de","messages_de","fr","messages_fr","it","messages_it","es","messages_es","pl","messages_pl","navigator","browser","detect","ReactDOM","component","INITIAL","setState","setSelection","setError","setShowSidePanel","setStandalone","setChartType","showErrorPopup","setShowErrorPopup","setSourceSpec","setFreezeAnimation","setConfig","setAllLanguages","toggleDetails","getTribes","uploadedDataSource","UploadedDataSource","gedcomUrlDataSource","GedcomUrlDataSource","embeddedDataSource","isNewData","newSourceSpec","newSelection","spec","loadData","loadAllLanguages","loadLanguages","updateUrl","gen","displayErrorPopup","downloadSvg","onDismissErrorPopup","renderMainArea","SHOWING_CHART","LOADING_MORE","updatedSelection","getSelection","sidePanelTabs","c","configToArgs","Loader","active","ERROR","LOADING","rootElement","classList","exact","DATE_QUALIFIERS","hasDay","hasMonth","hasYear","dateObject","toDateObject","formatOptions","lowerCaseQualifier","formatDateQualifier","dateElement","fromDate","toDate","translatedFromDate","translatedToDate","formatDateRage","compareTopolaDates","date1","date2","firstDateOrRange","secondDateOrRange","prepareData","cacheId","serializedData","JSON","stringify","sessionStorage","setItem","loadGedzip","AdmZip","Buffer","arrayBuffer","zip","getEntries","entryName","toString","loadFromUrl","cachedData","getItem","driveUrlMatch1","driveUrlMatch2","urlToFetch","status","statusText"],"mappings":"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","file":"static/js/main.ceed1bc1.chunk.js","sourcesContent":["/** Error class adding an error code used for i18n. */\nexport class TopolaError extends Error {\n    constructor(\n        public readonly code: string,\n        message: string,\n        public readonly args: { [key: string]: string } = {},\n    ) {\n        super(message);\n    }\n}\n","Object.defineProperty(exports, \"__esModule\", { value: true });\n\nexports.ChartUtil = exports.getChartInfoWithoutMargin = exports.getChartInfo = exports.linkId = exports.V_SPACING = exports.H_SPACING = void 0;\nconst d3_selection_1 = require(\"d3-selection\");\nconst d3_flextree_1 = require(\"d3-flextree\");\nconst d3_array_1 = require(\"d3-array\");\nrequire(\"d3-transition\");\n\n/** Horizontal distance between boxes. */\nexports.H_SPACING = 15;\n/** Vertical distance between boxes. */\nexports.V_SPACING = 30;\n/** Margin around the whole drawing. */\nconst MARGIN = 15;\nconst HIDE_TIME_MS = 200;\nconst MOVE_TIME_MS = 500;\n\n/** Assigns an identifier to a link. */\nfunction linkId(node) {\n    if (!node.parent) {\n        return node.id + \":A\";\n    }\n    const _a = node.data.generation > node.parent.data.generation\n        ? [node.data, node.parent.data]\n        : [node.parent.data, node.data], child = _a[0], parent = _a[1];\n    if (child.additionalMarriage) {\n        return child.id + \":A\";\n    }\n    return parent.id + \":\" + child.id;\n}\nexports.linkId = linkId;\nfunction getChartInfo(nodes) {\n    // Calculate chart boundaries.\n    const x0 = d3_array_1.min(nodes, function (d) {\n        return d.x - d.data.width / 2;\n    }) - MARGIN;\n    const y0 = d3_array_1.min(nodes, function (d) {\n        return d.y - d.data.height / 2;\n    }) - MARGIN;\n    const x1 = d3_array_1.max(nodes, function (d) {\n        return d.x + d.data.width / 2;\n    }) + MARGIN;\n    const y1 = d3_array_1.max(nodes, function (d) {\n        return d.y + d.data.height / 2;\n    }) + MARGIN;\n    return { size: [x1 - x0, y1 - y0], origin: [-x0, -y0] };\n}\nexports.getChartInfo = getChartInfo;\nfunction getChartInfoWithoutMargin(nodes) {\n    // Calculate chart boundaries.\n    const x0 = d3_array_1.min(nodes, function (d) {\n        return d.x - d.data.width / 2;\n    });\n    const y0 = d3_array_1.min(nodes, function (d) {\n        return d.y - d.data.height / 2;\n    });\n    const x1 = d3_array_1.max(nodes, function (d) {\n        return d.x + d.data.width / 2;\n    });\n    const y1 = d3_array_1.max(nodes, function (d) {\n        return d.y + d.data.height / 2;\n    });\n    return { size: [x1 - x0, y1 - y0], origin: [-x0, -y0] };\n}\nexports.getChartInfoWithoutMargin = getChartInfoWithoutMargin;\n/** Utility class with common code for all chart types. */\nlet ChartUtil = /** @class */ (function () {\n    function ChartUtil(options) {\n        this.options = options;\n    }\n    /** Creates a path from parent to the child node (horizontal layout). */\n    ChartUtil.prototype.linkHorizontal = function (s, d) {\n        const sAnchor = this.options.renderer.getFamilyAnchor(s.data);\n        const dAnchor = s.id === d.data.spouseParentNodeId\n            ? this.options.renderer.getSpouseAnchor(d.data)\n            : this.options.renderer.getIndiAnchor(d.data);\n        const _a = [s.x + sAnchor[0], s.y + sAnchor[1]], sx = _a[0], sy = _a[1];\n        const _b = [d.x + dAnchor[0], d.y + dAnchor[1]], dx = _b[0], dy = _b[1];\n        const midX = (s.x + s.data.width / 2 + d.x - d.data.width / 2) / 2;\n        return \"M \" + sx + \" \" + sy + \"\\n            L \" + midX + \" \" + sy + \",\\n              \" + midX + \" \" + dy + \",\\n              \" + dx + \" \" + dy;\n    };\n    /** Creates a path from parent to the child node (vertical layout). */\n    ChartUtil.prototype.linkVertical = function (s, d) {\n        const sAnchor = this.options.renderer.getFamilyAnchor(s.data);\n        const dAnchor = s.id === d.data.spouseParentNodeId\n            ? this.options.renderer.getSpouseAnchor(d.data)\n            : this.options.renderer.getIndiAnchor(d.data);\n        const _a = [s.x + sAnchor[0], s.y + sAnchor[1]], sx = _a[0], sy = _a[1];\n        const _b = [d.x + dAnchor[0], d.y + dAnchor[1]], dx = _b[0], dy = _b[1];\n        const midY = s.y + s.data.height / 2 + exports.V_SPACING / 2;\n        return \"M \" + sx + \" \" + sy + \"\\n            L \" + sx + \" \" + midY + \",\\n              \" + dx + \" \" + midY + \",\\n              \" + dx + \" \" + dy;\n    };\n    ChartUtil.prototype.linkAdditionalMarriage = function (node) {\n        const nodeIndex = node.parent.children.findIndex(function (n) {\n            return n.data.id === node.data.id;\n        });\n        // Assert nodeIndex > 0.\n        const siblingNode = node.parent.children[nodeIndex - 1];\n        const sAnchor = this.options.renderer.getIndiAnchor(node.data);\n        const dAnchor = this.options.renderer.getIndiAnchor(siblingNode.data);\n        const _a = [node.x + sAnchor[0], node.y + sAnchor[1]], sx = _a[0], sy = _a[1];\n        const _b = [siblingNode.x + dAnchor[0], siblingNode.y + dAnchor[1]], dx = _b[0], dy = _b[1];\n        return \"M \" + sx + \", \" + sy + \"\\n            L \" + dx + \", \" + dy;\n    };\n    ChartUtil.prototype.updateSvgDimensions = function (chartInfo) {\n        const svg = d3_selection_1.select(this.options.svgSelector);\n        const group = svg.select('g');\n        const transition = this.options.animate\n            ? group.transition().delay(HIDE_TIME_MS).duration(MOVE_TIME_MS)\n            : group;\n        transition.attr('transform', \"translate(\" + chartInfo.origin[0] + \", \" + chartInfo.origin[1] + \")\");\n    };\n    ChartUtil.prototype.layOutChart = function (root, layoutOptions) {\n        const _this = this;\n        if (layoutOptions === void 0) { layoutOptions = {}; }\n        // Add styles so that calculating text size is correct.\n        const svg = d3_selection_1.select(this.options.svgSelector);\n        if (svg.select('style').empty()) {\n            svg.append('style').text(this.options.renderer.getCss());\n        }\n        // Assign generation number.\n        root.each(function (node) {\n            node.data.generation =\n                node.depth * (layoutOptions.flipVertically ? -1 : 1) +\n                    (_this.options.baseGeneration || 0);\n        });\n        // Set preferred sizes.\n        this.options.renderer.updateNodes(root.descendants());\n        const vSizePerDepth = new Map();\n        root.each(function (node) {\n            const depth = node.depth;\n            const maxVSize = d3_array_1.max([\n                _this.options.horizontal ? node.data.width : node.data.height,\n                vSizePerDepth.get(depth),\n            ]);\n            vSizePerDepth.set(depth, maxVSize);\n        });\n        // Set sizes of whole nodes.\n        root.each(function (node) {\n            const vSize = vSizePerDepth.get(node.depth);\n            if (_this.options.horizontal) {\n                node.data.width = vSize;\n            }\n            else {\n                node.data.height = vSize;\n            }\n        });\n        const vSpacing = layoutOptions.vSpacing !== undefined ? layoutOptions.vSpacing : exports.V_SPACING;\n        const hSpacing = layoutOptions.hSpacing !== undefined ? layoutOptions.hSpacing : exports.H_SPACING;\n        // Assigns the x and y position for the nodes.\n        const treemap = d3_flextree_1.flextree()\n            .nodeSize(function (node) {\n                if (_this.options.horizontal) {\n                    const maxChildSize_1 = d3_array_1.max(node.children || [], function (n) {\n                        return n.data.width;\n                    }) || 0;\n                    return [\n                        node.data.height,\n                        (maxChildSize_1 + node.data.width) / 2 + vSpacing,\n                    ];\n                }\n                const maxChildSize = d3_array_1.max(node.children || [], function (n) {\n                    return n.data.height;\n                }) || 0;\n                return [\n                    node.data.width,\n                    (maxChildSize + node.data.height) / 2 + vSpacing,\n                ];\n            }).spacing(function () {\n                return hSpacing;\n            });\n        const nodes = treemap(root).descendants();\n        // Swap x-y coordinates for horizontal layout.\n        nodes.forEach(function (node) {\n            let _a;\n            if (layoutOptions.flipVertically) {\n                node.y = -node.y;\n            }\n            if (_this.options.horizontal) {\n                _a = [node.y, node.x];\n                node.x = _a[0];\n                node.y = _a[1];\n            }\n        });\n        return nodes;\n    };\n    ChartUtil.prototype.renderChart = function (nodes) {\n        const svg = this.getSvgForRendering();\n        const nodeAnimation = this.renderNodes(nodes, svg);\n        const linkAnimation = this.renderLinks(nodes, svg);\n        return Promise.all([\n            nodeAnimation,\n            linkAnimation,\n        ]);\n    };\n    ChartUtil.prototype.renderNodes = function (nodes, svg) {\n        const _this = this;\n        return new Promise(function (resolve) {\n            const boundNodes = svg\n                .select('g')\n                .selectAll('g.node')\n                .data(nodes, function (d) {\n                    return d.id;\n                });\n            const nodeEnter = boundNodes.enter().append('g');\n            let transitionsPending = boundNodes.exit().size() + boundNodes.size() + nodeEnter.size();\n            const transitionDone = function () {\n                transitionsPending--;\n                if (transitionsPending === 0) {\n                    resolve();\n                }\n            };\n            if (!_this.options.animate || transitionsPending === 0) {\n                resolve();\n            }\n            nodeEnter\n                .merge(boundNodes)\n                .attr('class', function (node) {\n                    return \"node generation\" + node.data.generation;\n                });\n            nodeEnter.attr('transform', function (node) {\n                return \"translate(\" + (node.x - node.data.width / 2) + \", \" + (node.y - node.data.height / 2) + \")\";\n            });\n            if (_this.options.animate) {\n                nodeEnter\n                    .style('opacity', 0)\n                    .transition()\n                    .delay(HIDE_TIME_MS + MOVE_TIME_MS)\n                    .duration(HIDE_TIME_MS)\n                    .style('opacity', 1)\n                    .on('end', transitionDone);\n            }\n            const updateTransition = _this.options.animate\n                ? boundNodes\n                    .transition()\n                    .delay(HIDE_TIME_MS)\n                    .duration(MOVE_TIME_MS)\n                    .on('end', transitionDone)\n                : boundNodes;\n            updateTransition.attr('transform', function (node) {\n                return \"translate(\" + (node.x - node.data.width / 2) + \", \" + (node.y - node.data.height / 2) + \")\";\n            });\n            _this.options.renderer.render(nodeEnter, boundNodes);\n            if (_this.options.animate) {\n                boundNodes\n                    .exit()\n                    .transition()\n                    .duration(HIDE_TIME_MS)\n                    .style('opacity', 0)\n                    .remove()\n                    .on('end', transitionDone);\n            } else {\n                boundNodes.exit().remove();\n            }\n        });\n    };\n    ChartUtil.prototype.renderLinks = function (nodes, svg) {\n        const _this = this;\n        return new Promise(function (resolve) {\n            const link = function (parent, child) {\n                if (child.data.additionalMarriage) {\n                    return _this.linkAdditionalMarriage(child);\n                }\n                const flipVertically = parent.data.generation > child.data.generation;\n                if (_this.options.horizontal) {\n                    if (flipVertically) {\n                        return _this.linkHorizontal(child, parent);\n                    }\n                    return _this.linkHorizontal(parent, child);\n                }\n                if (flipVertically) {\n                    return _this.linkVertical(child, parent);\n                }\n                return _this.linkVertical(parent, child);\n            };\n            const links = nodes.filter(function (n) {\n                return !!n.parent || n.data.additionalMarriage;\n            });\n            const boundLinks = svg\n                .select('g')\n                .selectAll('path.link')\n                .data(links, linkId);\n            const path = boundLinks\n                .enter()\n                .insert('path', 'g')\n                .attr('class', function (node) {\n                    return node.data.additionalMarriage ? 'link additional-marriage' : 'link';\n                })\n                .attr('d', function (node) {\n                    return link(node.parent, node);\n                });\n            let transitionsPending = boundLinks.exit().size() + boundLinks.size() + path.size();\n            const transitionDone = function () {\n                transitionsPending--;\n                if (transitionsPending === 0) {\n                    resolve();\n                }\n            };\n            if (!_this.options.animate || transitionsPending === 0) {\n                resolve();\n            }\n            const linkTransition = _this.options.animate\n                ? boundLinks\n                    .transition()\n                    .delay(HIDE_TIME_MS)\n                    .duration(MOVE_TIME_MS)\n                    .on('end', transitionDone)\n                : boundLinks;\n            linkTransition.attr('d', function (node) {\n                return link(node.parent, node);\n            });\n            if (_this.options.animate) {\n                path\n                    .style('opacity', 0)\n                    .transition()\n                    .delay(2 * HIDE_TIME_MS + MOVE_TIME_MS)\n                    .duration(0)\n                    .style('opacity', 1)\n                    .on('end', transitionDone);\n            }\n            if (_this.options.animate) {\n                boundLinks\n                    .exit()\n                    .transition()\n                    .duration(0)\n                    .style('opacity', 0)\n                    .remove()\n                    .on('end', transitionDone);\n            } else {\n                boundLinks.exit().remove();\n            }\n        });\n    };\n    ChartUtil.prototype.getSvgForRendering = function () {\n        const svg = d3_selection_1.select(this.options.svgSelector);\n        if (svg.select('g').empty()) {\n            svg.append('g');\n        }\n        return svg;\n    };\n    return ChartUtil;\n}());\nexports.ChartUtil = ChartUtil;\n","import {GedcomEntry, parse as parseGedcom} from 'parse-gedcom';\nimport {TopolaError} from './error';\nimport {gedcomEntriesToJson, JsonFam, JsonGedcomData, JsonImage, JsonIndi} from '../lib/topola';\nimport {compareDates} from './date_util';\nimport {Language} from \"../languages/languages-loader\";\n\nexport interface GedcomData {\n    /** The HEAD entry. */\n    head: GedcomEntry;\n    /** INDI entries mapped by id. */\n    indis: { [key: string]: GedcomEntry };\n    /** FAM entries mapped by id. */\n    fams: { [key: string]: GedcomEntry };\n    /** Other entries mapped by id, e.g. NOTE, SOUR. */\n    other: { [key: string]: GedcomEntry };\n}\n\nexport interface TopolaData {\n    chartData: JsonGedcomData;\n    gedcom: GedcomData;\n}\n\n/**\n * Returns the identifier extracted from a pointer string.\n * E.g. '@I123@' -> 'I123'\n */\nexport function pointerToId(pointer: string): string {\n    return pointer.substring(1, pointer.length - 1);\n}\n\nexport function idToIndiMap(data: JsonGedcomData): Map<string, JsonIndi> {\n    const map = new Map<string, JsonIndi>();\n    data.indis.forEach((indi) => {\n        map.set(indi.id, indi);\n    });\n    return map;\n}\n\nexport function idToFamMap(data: JsonGedcomData): Map<string, JsonFam> {\n    const map = new Map<string, JsonFam>();\n    data.fams.forEach((fam) => {\n        map.set(fam.id, fam);\n    });\n    return map;\n}\n\nfunction prepareGedcom(entries: GedcomEntry[]): GedcomData {\n    const head = entries.find((entry) => entry.tag === 'HEAD')!;\n    const indis: { [key: string]: GedcomEntry } = {};\n    const fams: { [key: string]: GedcomEntry } = {};\n    const other: { [key: string]: GedcomEntry } = {};\n    entries.forEach((entry) => {\n        if (entry.tag === 'INDI') {\n            indis[pointerToId(entry.pointer)] = entry;\n        } else if (entry.tag === 'FAM') {\n            fams[pointerToId(entry.pointer)] = entry;\n        } else if (entry.pointer) {\n            other[pointerToId(entry.pointer)] = entry;\n        }\n    });\n    return {head, indis, fams, other};\n}\n\nfunction strcmp(a: string, b: string) {\n    if (a < b) {\n        return -1;\n    }\n    if (a > b) {\n        return 1;\n    }\n    return 0;\n}\n\n/** Birthdate comparator for individuals. */\nfunction birthDatesComparator(gedcom: JsonGedcomData) {\n    const indiMap = idToIndiMap(gedcom);\n    return (indiId1: string, indiId2: string) => {\n        const indi1: JsonIndi | undefined = indiMap.get(indiId1);\n        const indi2: JsonIndi | undefined = indiMap.get(indiId2);\n        return (\n            compareDates(indi1 && indi1.birth, indi2 && indi2.birth) ||\n            strcmp(indiId1, indiId2)\n        );\n    };\n}\n\n/** Marriage date comparator for families. */\nfunction marriageDatesComparator(gedcom: JsonGedcomData) {\n    const famMap = idToFamMap(gedcom);\n    return (famId1: string, famId2: string) => {\n        const fam1: JsonFam | undefined = famMap.get(famId1);\n        const fam2: JsonFam | undefined = famMap.get(famId2);\n        return (\n            compareDates(fam1 && fam1.marriage, fam2 && fam2.marriage) ||\n            strcmp(famId1, famId2)\n        );\n    };\n}\n\n/**\n * Sorts children by birthdate in the given family.\n * Does not modify the input objects.\n */\nfunction sortFamilyChildren(\n    fam: JsonFam,\n    comparator: (id1: string, id2: string) => number,\n): JsonFam {\n    if (!fam.children) {\n        return fam;\n    }\n    const newChildren = fam.children.sort(comparator);\n    return Object.assign({}, fam, {children: newChildren});\n}\n\n/**\n * Sorts children by birthdate.\n * Does not modify the input object.\n */\nfunction sortChildren(gedcom: JsonGedcomData): JsonGedcomData {\n    const comparator = birthDatesComparator(gedcom);\n    const newFams = gedcom.fams.map((fam) => sortFamilyChildren(fam, comparator));\n    return Object.assign({}, gedcom, {fams: newFams});\n}\n\n/**\n * Sorts spouses by marriage date.\n * Does not modify the input objects.\n */\nfunction sortIndiSpouses(\n    indi: JsonIndi,\n    comparator: (id1: string, id2: string) => number,\n): JsonFam {\n    if (!indi.fams) {\n        return indi;\n    }\n    const newFams = indi.fams.sort(comparator);\n    return Object.assign({}, indi, {fams: newFams});\n}\n\nfunction sortSpouses(gedcom: JsonGedcomData): JsonGedcomData {\n    const comparator = marriageDatesComparator(gedcom);\n    const newIndis = gedcom.indis.map((indi) =>\n        sortIndiSpouses(indi, comparator),\n    );\n    return Object.assign({}, gedcom, {indis: newIndis});\n}\n\n/**\n * If the entry is a reference to a top-level entry, the referenced entry is returned.\n * Otherwise, returns the given entry unmodified.\n */\nexport function dereference(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    getterFunction: (gedcom: GedcomData) => { [key: string]: GedcomEntry },\n) {\n    if (entry.data) {\n        const dereferenced = getterFunction(gedcom)[pointerToId(entry.data)];\n        if (dereferenced) {\n            return dereferenced;\n        }\n    }\n    return entry;\n}\n\n/**\n * Returns the data for the given GEDCOM entry as an array of lines.\n * Supports continuations with CONT and CONC.\n */\nexport function getData(entry: GedcomEntry) {\n    const result = [entry.data];\n    entry.tree.forEach((subentry) => {\n        if (subentry.tag === 'CONC' && subentry.data) {\n            const last = result.length - 1;\n            result[last] += subentry.data;\n        } else if (subentry.tag === 'CONT' && subentry.data) {\n            result.push(subentry.data);\n        }\n    });\n    return result;\n}\n\n/** Sorts children and spouses. */\nexport function normalizeGedcom(gedcom: JsonGedcomData): JsonGedcomData {\n    return sortSpouses(sortChildren(gedcom));\n}\n\nconst IMAGE_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.gif'];\n\n/** Returns true if the given file name has a known image extension. */\nexport function isImageFile(fileName: string): boolean {\n    const lowerName = fileName.toLowerCase();\n    return IMAGE_EXTENSIONS.some((ext) => lowerName.endsWith(ext));\n}\n\n/**\n * Removes images that are not HTTP links or do not have known image extensions.\n * Does not modify the input object.\n */\nfunction filterImage(indi: JsonIndi, images: Map<string, string>): JsonIndi {\n    if (!indi.images || indi.images.length === 0) {\n        return indi;\n    }\n    const newImages: JsonImage[] = [];\n    indi.images.forEach((image) => {\n        const filePath = image.url.replaceAll('\\\\', '/');\n        const fileName = filePath.match(/[^/]*$/)![0];\n        // If the image file has been loaded into memory, use it.\n        if (images.has(filePath)) {\n            newImages.push({url: images.get(filePath)!, title: image.title});\n        } else if (images.has(fileName)) {\n            newImages.push({url: images.get(fileName)!, title: image.title});\n        } else if (image.url.startsWith('http') && isImageFile(image.url)) {\n            newImages.push(image);\n        }\n    });\n    return Object.assign({}, indi, {images: newImages});\n}\n\n/**\n * Removes images that are not HTTP links.\n * Does not modify the input object.\n */\nfunction filterImages(\n    gedcom: JsonGedcomData,\n    images: Map<string, string>,\n): JsonGedcomData {\n    const newIndis = gedcom.indis.map((indi) => filterImage(indi, images));\n    return Object.assign({}, gedcom, {indis: newIndis});\n}\n\n/**\n * Converts GEDCOM file into JSON data performing additional transformations:\n * - sort children by birthdate\n * - remove images that are not HTTP links and aren't mapped in `images`.\n *\n * @param gedcom\n * @param images Map from file name to image URL. This is used to pass in uploaded images.\n * @param allLanguages\n */\nexport function convertGedcom(\n    gedcom: string,\n    allLanguages: Language[],\n    images: Map<string, string>\n): TopolaData {\n    const entries = parseGedcom(gedcom, allLanguages);\n    const json = gedcomEntriesToJson(entries, allLanguages);\n    if (\n        !json ||\n        !json.indis ||\n        !json.indis.length ||\n        !json.fams ||\n        !json.fams.length\n    ) {\n        throw new TopolaError('GEDCOM_READ_FAILED', 'Failed to read GEDCOM file');\n    }\n    return {\n        chartData: filterImages(normalizeGedcom(json), images),\n        gedcom: prepareGedcom(entries)\n    };\n}\n\nexport function getName(person: GedcomEntry): string | undefined {\n    const names = person.tree.filter((subEntry) => subEntry.tag === 'NAME');\n    const notMarriedName = names.find(\n        (subEntry) =>\n            subEntry.tree.filter(\n                (nameEntry) => nameEntry.tag === 'TYPE' && nameEntry.data === 'married',\n            ).length === 0,\n    );\n    const name = notMarriedName || names[0];\n    return name?.data.replace(/\\//g, '');\n}\n\nexport function getFileName(fileEntry: GedcomEntry): string | undefined {\n    const fileTitle = fileEntry?.tree.find((entry) => entry.tag === 'TITL')?.data;\n    const fileExtension = fileEntry?.tree.find((entry) => entry.tag === 'FORM')?.data;\n    return fileTitle && fileExtension && fileTitle + '.' + fileExtension;\n}\n\nexport function getImageFileEntry(objectEntry: GedcomEntry): GedcomEntry | undefined {\n    return objectEntry.tree.find(\n        (entry) =>\n            entry.tag === 'FILE' &&\n            entry.data.startsWith('http') &&\n            isImageFile(entry.data),\n    );\n}\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AncestorChart = exports.getAncestorsTree = void 0;\nvar chart_util_1 = require(\"./chart-util\");\nvar d3_hierarchy_1 = require(\"d3-hierarchy\");\nvar id_generator_1 = require(\"./id-generator\");\nfunction getAncestorsTree(options) {\n    var ancestorChartOptions = __assign({}, options);\n    var startIndiFamilies = options.startIndi\n        ? options.data.getIndi(options.startIndi).getFamiliesAsSpouse()\n        : [];\n    // If the start individual is set and this person has at least one spouse,\n    // start with the family instead.\n    if (startIndiFamilies.length) {\n        ancestorChartOptions.startFam = startIndiFamilies[0];\n        ancestorChartOptions.startIndi = undefined;\n        var fam = options.data.getFam(startIndiFamilies[0]);\n        if (fam.getMother() === options.startIndi) {\n            ancestorChartOptions.swapStartSpouses = true;\n        }\n    }\n    var ancestors = new AncestorChart(ancestorChartOptions);\n    var ancestorsRoot = ancestors.createHierarchy();\n    // Remove spouse's ancestors if there are multiple spouses\n    // to avoid showing ancestors of just one spouse.\n    if (startIndiFamilies.length > 1 &&\n        ancestorsRoot.children &&\n        ancestorsRoot.children.length > 1) {\n        ancestorsRoot.children.pop();\n        ancestorsRoot.data.spouseParentNodeId = undefined;\n    }\n    return ancestorsRoot;\n}\nexports.getAncestorsTree = getAncestorsTree;\n/** Renders an ancestors chart. */\nvar AncestorChart = /** @class */ (function () {\n    function AncestorChart(options) {\n        this.options = options;\n        this.util = new chart_util_1.ChartUtil(options);\n    }\n    /** Creates a d3 hierarchy from the input data. */\n    AncestorChart.prototype.createHierarchy = function () {\n        let id;\n        let famc;\n        let indi;\n        var parents = [];\n        var stack = [];\n        var idGenerator = this.options.idGenerator || new id_generator_1.IdGenerator();\n        if (this.options.startIndi) {\n            indi = this.options.data.getIndi(this.options.startIndi);\n            famc = indi.getFamilyAsChild();\n            id = famc ? idGenerator.getId(famc) : undefined;\n            if (famc) {\n                stack.push({\n                    id: famc,\n                    parentId: this.options.startIndi,\n                    family: { id: famc },\n                });\n            }\n            parents.push({\n                id: this.options.startIndi,\n                indi: { id: this.options.startIndi },\n                indiParentNodeId: id,\n            });\n        }\n        else {\n            stack.push({\n                id: idGenerator.getId(this.options.startFam),\n                family: { id: this.options.startFam },\n            });\n        }\n        while (stack.length) {\n            var entry = stack.pop();\n            var fam = this.options.data.getFam(entry.family.id);\n            if (!fam) {\n                continue;\n            }\n            var _a = entry.family.id === this.options.startFam &&\n                this.options.swapStartSpouses\n                ? [fam.getMother(), fam.getFather()]\n                : [fam.getFather(), fam.getMother()], father = _a[0], mother = _a[1];\n            if (!father && !mother) {\n                continue;\n            }\n            if (mother) {\n                entry.spouse = { id: mother };\n                indi = this.options.data.getIndi(mother);\n                famc = indi.getFamilyAsChild();\n                if (famc) {\n                    id = idGenerator.getId(famc);\n                    entry.spouseParentNodeId = id;\n                    stack.push({\n                        id: id,\n                        parentId: entry.id,\n                        family: { id: famc },\n                    });\n                }\n            }\n            if (father) {\n                entry.indi = { id: father };\n                indi = this.options.data.getIndi(father);\n                famc = indi.getFamilyAsChild();\n                if (famc) {\n                    id = idGenerator.getId(famc);\n                    entry.indiParentNodeId = id;\n                    stack.push({\n                        id: id,\n                        parentId: entry.id,\n                        family: { id: famc },\n                    });\n                }\n            }\n            parents.push(entry);\n        }\n        return d3_hierarchy_1.stratify()(parents);\n    };\n    /**\n     * Renders the tree, calling the provided renderer to draw boxes for\n     * individuals.\n     */\n    AncestorChart.prototype.render = function () {\n        var root = this.createHierarchy();\n        var nodes = this.util.layOutChart(root, { flipVertically: true });\n        var animationPromise = this.util.renderChart(nodes);\n        var info = chart_util_1.getChartInfo(nodes);\n        this.util.updateSvgDimensions(info);\n        return Object.assign(info, { animationPromise: animationPromise });\n    };\n    return AncestorChart;\n}());\nexports.AncestorChart = AncestorChart;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.IdGenerator = void 0;\n/** Provides unique identifiers. */\nvar IdGenerator = /** @class */ (function () {\n    function IdGenerator() {\n        this.ids = new Map();\n    }\n    /**\n     * Returns the given identifier if it wasn't used before. Otherwise, appends\n     * a number to the given identifier to make it unique.\n     */\n    IdGenerator.prototype.getId = function (id) {\n        if (this.ids.has(id)) {\n            var num = this.ids.get(id);\n            this.ids.set(id, num + 1);\n            return id + \":\" + num;\n        }\n        this.ids.set(id, 1);\n        return id;\n    };\n    return IdGenerator;\n}());\nexports.IdGenerator = IdGenerator;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.getFamPositionHorizontal = exports.getFamPositionVertical = exports.CompositeRenderer = void 0;\n\nconst d3_array_1 = require(\"d3-array\");\n\n/**\n * Common code for tree nodes that are composed of individual and family boxes.\n */\nlet CompositeRenderer = /** @class */ (function () {\n\n    function CompositeRenderer(options) {\n        this.options = options;\n    }\n\n    CompositeRenderer.prototype.getPreferredFamSize = function (id) {\n        // No family box in the simple renderer.\n        return [0, 0];\n    };\n\n    CompositeRenderer.prototype.setPreferredIndiSize = function (indi) {\n        let _a;\n        if (!indi) {\n            return;\n        }\n        _a = this.getPreferredIndiSize(indi.id);\n        indi.width = _a[0];\n        indi.height = _a[1];\n    };\n\n    CompositeRenderer.prototype.updateNodes = function (nodes) {\n        const _this = this;\n        // Calculate individual vertical size per depth.\n        const indiVSizePerDepth = new Map();\n        nodes.forEach(function (node) {\n            let _a;\n            _this.setPreferredIndiSize(node.data.indi);\n            _this.setPreferredIndiSize(node.data.spouse);\n            const family = node.data.family;\n            if (family) {\n                _a = _this.getPreferredFamSize(family.id);\n                family.width = _a[0];\n                family.height = _a[1];\n            }\n            const depth = node.depth;\n            const maxIndiVSize = d3_array_1.max([\n                getIndiVSize(node.data, !!_this.options.horizontal),\n                indiVSizePerDepth.get(depth),\n            ]);\n            indiVSizePerDepth.set(depth, maxIndiVSize);\n        });\n        // Set same width for each depth.\n        nodes.forEach(function (node) {\n            let _a;\n            if (_this.options.horizontal) {\n                if (node.data.indi) {\n                    node.data.indi.width = indiVSizePerDepth.get(node.depth);\n                }\n                if (node.data.spouse) {\n                    node.data.spouse.width = indiVSizePerDepth.get(node.depth);\n                }\n            } else {\n                if (node.data.indi) {\n                    node.data.indi.height = indiVSizePerDepth.get(node.depth);\n                }\n                if (node.data.spouse) {\n                    node.data.spouse.height = indiVSizePerDepth.get(node.depth);\n                }\n            }\n            const vSize = getVSize(node.data, !!_this.options.horizontal);\n            const hSize = getHSize(node.data, !!_this.options.horizontal);\n            _a = _this.options.horizontal ? [vSize, hSize] : [hSize, vSize];\n            node.data.width = _a[0];\n            node.data.height = _a[1];\n        });\n    };\n\n    CompositeRenderer.prototype.getFamilyAnchor = function (node) {\n        if (this.options.horizontal) {\n            const x_1 = -node.width / 2 + getIndiVSize(node, this.options.horizontal) / 2;\n            const famYOffset = node.family\n                ? d3_array_1.max([-getFamPositionHorizontal(node), 0])\n                : 0;\n            const y_1 = -(node.indi && node.spouse ? node.height / 2 - node.indi.height : 0) +\n                famYOffset;\n            return [x_1, y_1];\n        }\n        const famXOffset = node.family\n            ? d3_array_1.max([-getFamPositionVertical(node), 0])\n            : 0;\n        const x = -(node.indi && node.spouse ? node.width / 2 - node.indi.width : 0) +\n            famXOffset;\n        const y = -node.height / 2 + getIndiVSize(node, this.options.horizontal) / 2;\n        return [x, y];\n    };\n\n    CompositeRenderer.prototype.getSpouseAnchor = function (node) {\n        if (this.options.horizontal) {\n            const x_2 = -node.width / 2 + getIndiVSize(node, this.options.horizontal) / 2;\n            const y_2 = node.indi ? node.indi.height / 2 : 0;\n            return [x_2, y_2];\n        }\n        const x = node.indi ? node.indi.width / 2 : 0;\n        const y = -node.height / 2 + getIndiVSize(node, !!this.options.horizontal) / 2;\n        return [x, y];\n    };\n\n    CompositeRenderer.prototype.getIndiAnchor = function (node) {\n        if (this.options.horizontal) {\n            const x_3 = -node.width / 2 + getIndiVSize(node, this.options.horizontal) / 2;\n            const y_3 = node.spouse ? -node.spouse.height / 2 : 0;\n            return [x_3, y_3];\n        }\n        const x = node.spouse ? -node.spouse.width / 2 : 0;\n        const y = -node.height / 2 + getIndiVSize(node, !!this.options.horizontal) / 2;\n        return [x, y];\n    };\n\n    return CompositeRenderer;\n}());\nexports.CompositeRenderer = CompositeRenderer;\n\n/**\n * Returns the relative position of the family box for the vertical layout.\n */\nfunction getFamPositionVertical(node) {\n    const indiWidth = node.indi ? node.indi.width : 0;\n    const spouseWidth = node.spouse ? node.spouse.width : 0;\n    const familyWidth = node.family.width;\n    if (!node.indi || !node.spouse || indiWidth + spouseWidth <= familyWidth) {\n        return (indiWidth + spouseWidth - familyWidth) / 2;\n    }\n    if (familyWidth / 2 >= spouseWidth) {\n        return indiWidth + spouseWidth - familyWidth;\n    }\n    if (familyWidth / 2 >= indiWidth) {\n        return 0;\n    }\n    return indiWidth - familyWidth / 2;\n}\nexports.getFamPositionVertical = getFamPositionVertical;\n\n/**\n * Returns the relative position of the family box for the horizontal layout.\n */\nfunction getFamPositionHorizontal(node) {\n    const indiHeight = node.indi ? node.indi.height : 0;\n    const spouseHeight = node.spouse ? node.spouse.height : 0;\n    const familyHeight = node.family.height;\n    if (!node.indi || !node.spouse) {\n        return (indiHeight + spouseHeight - familyHeight) / 2;\n    }\n    return indiHeight - familyHeight / 2;\n}\nexports.getFamPositionHorizontal = getFamPositionHorizontal;\n\n/** Returns the horizontal size. */\nfunction getHSize(node, horizontal) {\n    if (horizontal) {\n        return ((node.indi ? node.indi.height : 0) +\n            (node.spouse ? node.spouse.height : 0));\n    }\n    const indiHSize = (node.indi ? node.indi.width : 0) + (node.spouse ? node.spouse.width : 0);\n    return d3_array_1.max([indiHSize, node.family ? node.family.width : 0]);\n}\n\nfunction getFamVSize(node, horizontal) {\n    if (horizontal) {\n        return node.family ? node.family.width : 0;\n    }\n    return node.family ? node.family.height : 0;\n}\n\n/** Returns the vertical size of individual boxes. */\nfunction getIndiVSize(node, horizontal) {\n    if (horizontal) {\n        return d3_array_1.max([\n            node.indi ? node.indi.width : 0,\n            node.spouse ? node.spouse.width : 0,\n        ]);\n    }\n    return d3_array_1.max([\n        node.indi ? node.indi.height : 0,\n        node.spouse ? node.spouse.height : 0,\n    ]);\n}\n\n/** Returns the vertical size. */\nfunction getVSize(node, horizontal) {\n    return getIndiVSize(node, horizontal) + getFamVSize(node, horizontal);\n}\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.JsonDataProvider = void 0;\n/** Details of an individual based on Json input. */\nvar JsonIndiDetails = /** @class */ (function () {\n    function JsonIndiDetails(json) {\n        this.json = json;\n    }\n    JsonIndiDetails.prototype.getId = function () {\n        return this.json.id;\n    };\n    JsonIndiDetails.prototype.isEgo = function () {\n        return this.json.isEgo;\n    };\n    JsonIndiDetails.prototype.getFamiliesAsSpouse = function () {\n        return this.json.fams || [];\n    };\n    JsonIndiDetails.prototype.getFamilyAsChild = function () {\n        return this.json.famc || null;\n    };\n    JsonIndiDetails.prototype.getFirstName = function () {\n        return this.json.firstName || null;\n    };\n    JsonIndiDetails.prototype.getLastName = function () {\n        return this.json.lastName || null;\n    };\n    JsonIndiDetails.prototype.getBirthDate = function () {\n        return this.json.birth || null;\n    };\n    JsonIndiDetails.prototype.getMaidenName = function () {\n        return this.json.maidenName || null;\n    };\n    JsonIndiDetails.prototype.getNumberOfChildren = function () {\n        return this.json.numberOfChildren || null;\n    };\n    JsonIndiDetails.prototype.getNumberOfMarriages = function () {\n        return this.json.numberOfMarriages || null;\n    };\n    JsonIndiDetails.prototype.getBirthPlace = function () {\n        return (this.json.birth && this.json.birth.place) || null;\n    };\n    JsonIndiDetails.prototype.getDeathDate = function () {\n        return this.json.death || null;\n    };\n    JsonIndiDetails.prototype.getDeathPlace = function () {\n        return (this.json.death && this.json.death.place) || null;\n    };\n    JsonIndiDetails.prototype.isConfirmedDeath = function () {\n        return !!this.json.death && !!this.json.death.confirmed;\n    };\n    JsonIndiDetails.prototype.getSex = function () {\n        return this.json.sex || null;\n    };\n    JsonIndiDetails.prototype.getLanguages = function () {\n        return this.json.languages || [];\n    };\n    JsonIndiDetails.prototype.getLanguagesLabel = function () {\n        const abbreviations = this.json.languages.map(lang => lang.abbreviation);\n        return abbreviations.length > 0 ? `${abbreviations.join(', ')}` : null;\n    };\n    JsonIndiDetails.prototype.getTribe = function () {\n        return this.json.tribe || null;\n    };\n    JsonIndiDetails.prototype.getImageUrl = function () {\n        return ((this.json.images &&\n            this.json.images.length > 0 &&\n            this.json.images[0].url) ||\n            null);\n    };\n    JsonIndiDetails.prototype.getImages = function () {\n        return this.json.images || [];\n    };\n    JsonIndiDetails.prototype.getNotes = function () {\n        return this.json.notes || [];\n    };\n    JsonIndiDetails.prototype.getEvents = function () {\n        return this.json.events || [];\n    };\n    JsonIndiDetails.prototype.showLanguages = function () {\n        return !this.json.hideLanguages;\n    };\n    JsonIndiDetails.prototype.showTribe = function () {\n        return !this.json.hideTribe;\n    };\n    JsonIndiDetails.prototype.showId = function () {\n        return !this.json.hideId;\n    };\n    JsonIndiDetails.prototype.showSex = function () {\n        return !this.json.hideSex;\n    };\n    return JsonIndiDetails;\n}());\n/** Details of a family based on Json input. */\nvar JsonFamDetails = /** @class */ (function () {\n    function JsonFamDetails(json) {\n        this.json = json;\n    }\n    JsonFamDetails.prototype.getId = function () {\n        return this.json.id;\n    };\n    JsonFamDetails.prototype.getFather = function () {\n        return this.json.husb || null;\n    };\n    JsonFamDetails.prototype.getMother = function () {\n        return this.json.wife || null;\n    };\n    JsonFamDetails.prototype.getChildren = function () {\n        return this.json.children || [];\n    };\n    JsonFamDetails.prototype.getMarriageDate = function () {\n        return this.json.marriage || null;\n    };\n    JsonFamDetails.prototype.getMarriagePlace = function () {\n        return (this.json.marriage && this.json.marriage.place) || null;\n    };\n    return JsonFamDetails;\n}());\n/** Implementation of the DataProvider interface based on Json input. */\nvar JsonDataProvider = /** @class */ (function () {\n    function JsonDataProvider(json) {\n        var _this = this;\n        this.json = json;\n        this.indis = new Map();\n        this.fams = new Map();\n        json.indis.forEach(function (indi) {\n            return _this.indis.set(indi.id, new JsonIndiDetails(indi));\n        });\n        json.fams.forEach(function (fam) { return _this.fams.set(fam.id, new JsonFamDetails(fam)); });\n    }\n    JsonDataProvider.prototype.getIndi = function (id) {\n        return this.indis.get(id) || null;\n    };\n    JsonDataProvider.prototype.getFam = function (id) {\n        return this.fams.get(id) || null;\n    };\n    return JsonDataProvider;\n}());\nexports.JsonDataProvider = JsonDataProvider;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.formatDateOrRange = exports.formatDate = void 0;\n/** Month in English is used as fallback if a requested translation is not found. */\nvar MONTHS_EN = new Map([\n    [1, 'Jan'],\n    [2, 'Feb'],\n    [3, 'Mar'],\n    [4, 'Apr'],\n    [5, 'May'],\n    [6, 'Jun'],\n    [7, 'Jul'],\n    [8, 'Aug'],\n    [9, 'Sep'],\n    [10, 'Oct'],\n    [11, 'Nov'],\n    [12, 'Dec'],\n]);\n/** Translations of the GEDCOM date qualifiers. */\nvar QUALIFIERS_I18N = new Map([\n    [\n        'cs',\n        new Map([\n            ['cal', 'vypot.'],\n            ['abt', 'o'],\n            ['est', 'ocenil'],\n            ['before', 'ped'],\n            ['after', 'po'],\n        ]),\n    ],\n    [\n        'de',\n        new Map([\n            ['cal', 'errech.'],\n            ['abt', 'etwa'],\n            ['est', 'gescht.'],\n            ['before', 'vor'],\n            ['after', 'nach'],\n        ]),\n    ],\n    [\n        'fr',\n        new Map([\n            ['cal', 'calc.'],\n            ['abt', 'vers'],\n            ['est', 'est.'],\n            ['before', 'avant'],\n            ['after', 'aprs'],\n        ]),\n    ],\n    [\n        'it',\n        new Map([\n            ['cal', 'calc.'],\n            ['abt', 'circa il'],\n            ['est', 'stim.'],\n            ['before', 'prima del'],\n            ['after', 'dopo del'],\n        ]),\n    ],\n    [\n        'pl',\n        new Map([\n            ['cal', 'wyl.'],\n            ['abt', 'ok.'],\n            ['est', 'szac.'],\n            ['before', 'przed'],\n            ['after', 'po'],\n        ]),\n    ],\n    [\n        'ru',\n        new Map([\n            ['cal', '.'],\n            ['abt', '.'],\n            ['est', '.'],\n            ['before', ''],\n            ['after', ''],\n        ]),\n    ],\n]);\nvar shortMonthCache = new Map();\nfunction getShortMonth(month, locale) {\n    if (!Intl || !Intl.DateTimeFormat) {\n        return MONTHS_EN.get(month);\n    }\n    var cacheKey = month + \"|\" + (locale || '');\n    if (shortMonthCache.has(cacheKey)) {\n        return shortMonthCache.get(cacheKey);\n    }\n    var result = new Intl.DateTimeFormat(locale, { month: 'short' }).format(new Date(2000, month - 1));\n    shortMonthCache.set(cacheKey, result);\n    return result;\n}\nfunction getQualifier(qualifier, locale) {\n    var language = locale && locale.split(/[-_]/)[0];\n    var languageMap = language && QUALIFIERS_I18N.get(language);\n    return languageMap ? languageMap.get(qualifier) : qualifier;\n}\n/**\n * Formats the date consisting of day, month and year.\n * All parts of the date are optional.\n */\nfunction formatDateOnly(day, month, year, locale) {\n    if (!day && !month && !year) {\n        return '';\n    }\n    // Fall back to formatting the date manually in case of\n    // - locale not provided\n    // - English (to avoid formatting like 'Oct 11, 2009')\n    // - Lack of i18n support in the browser\n    if (!Intl || !Intl.DateTimeFormat || !locale || locale === 'en') {\n        return [day, month && getShortMonth(month, locale), year].join(' ');\n    }\n    var format = {\n        day: day ? 'numeric' : undefined,\n        month: month ? 'short' : undefined,\n        year: year ? 'numeric' : undefined,\n    };\n    return new Intl.DateTimeFormat(locale, format).format(new Date(year !== null && year !== void 0 ? year : 2000, month ? month - 1 : 1, day !== null && day !== void 0 ? day : 1));\n}\n/** Simple date formatter. */\nfunction formatDate(date, locale) {\n    return [\n        date.qualifier && getQualifier(date.qualifier, locale),\n        formatDateOnly(date.day, date.month, date.year, locale),\n        date.text,\n    ].join(' ');\n}\nexports.formatDate = formatDate;\n/** Formats a DateOrRange object. */\nfunction formatDateOrRange(dateOrRange, locale) {\n    if (dateOrRange.date) {\n        return formatDate(dateOrRange.date, locale);\n    }\n    if (!dateOrRange.dateRange) {\n        return '';\n    }\n    var from = dateOrRange.dateRange.from && formatDate(dateOrRange.dateRange.from);\n    var to = dateOrRange.dateRange.to && formatDate(dateOrRange.dateRange.to);\n    if (from && to) {\n        return from + \" .. \" + to;\n    }\n    if (from) {\n        return getQualifier('after', locale) + \" \" + from;\n    }\n    if (to) {\n        return getQualifier('before', locale) + \" \" + to;\n    }\n    return '';\n}\nexports.formatDateOrRange = formatDateOrRange;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.DescendantChart = exports.layOutDescendants = exports.DUMMY_ROOT_NODE_ID = void 0;\nvar d3_hierarchy_1 = require(\"d3-hierarchy\");\nvar chart_util_1 = require(\"./chart-util\");\nvar id_generator_1 = require(\"./id-generator\");\nexports.DUMMY_ROOT_NODE_ID = 'DUMMY_ROOT_NODE';\nfunction layOutDescendants(options, layoutOptions) {\n    if (layoutOptions === void 0) { layoutOptions = {}; }\n    var descendants = new DescendantChart(options);\n    var descendantsRoot = descendants.createHierarchy();\n    return removeDummyNode(new chart_util_1.ChartUtil(options).layOutChart(descendantsRoot, layoutOptions));\n}\nexports.layOutDescendants = layOutDescendants;\n/** Removes the dummy root node if it was added in createHierarchy(). */\nfunction removeDummyNode(allNodes) {\n    if (allNodes[0].id !== exports.DUMMY_ROOT_NODE_ID) {\n        return allNodes;\n    }\n    var nodes = allNodes.slice(1);\n    // Move first node to (0, 0) coordinates.\n    var dx = -nodes[0].x;\n    var dy = -nodes[0].y;\n    nodes.forEach(function (node) {\n        if (node.parent &&\n            node.parent.id === exports.DUMMY_ROOT_NODE_ID &&\n            !node.data.additionalMarriage) {\n            node.parent = null;\n        }\n        node.x += dx;\n        node.y += dy;\n        node.data.generation--;\n    });\n    return nodes;\n}\n/** Returns the spouse of the given individual in the given family. */\nfunction getSpouse(indiId, fam) {\n    if (fam.getFather() === indiId) {\n        return fam.getMother();\n    }\n    return fam.getFather();\n}\n/** Renders a descendants chart. */\nvar DescendantChart = /** @class */ (function () {\n    function DescendantChart(options) {\n        this.options = options;\n        this.util = new chart_util_1.ChartUtil(options);\n    }\n    DescendantChart.prototype.getNodes = function (id) {\n        var _this = this;\n        var indi = this.options.data.getIndi(id);\n        var famIds = indi.getFamiliesAsSpouse();\n        if (!famIds.length) {\n            // Single person.\n            return [\n                {\n                    id: id,\n                    indi: {\n                        id: id,\n                    },\n                },\n            ];\n        }\n        // Marriages.\n        var nodes = famIds.map(function (famId) {\n            var entry = {\n                id: famId,\n                indi: {\n                    id: id,\n                },\n                family: {\n                    id: famId,\n                },\n            };\n            var fam = _this.options.data.getFam(famId);\n            var spouse = getSpouse(id, fam);\n            if (spouse) {\n                entry.spouse = { id: spouse };\n            }\n            return entry;\n        });\n        nodes.slice(1).forEach(function (node) {\n            node.additionalMarriage = true;\n        });\n        return nodes;\n    };\n    DescendantChart.prototype.getFamNode = function (famId) {\n        var node = { id: famId, family: { id: famId } };\n        var fam = this.options.data.getFam(famId);\n        var father = fam.getFather();\n        if (father) {\n            node.indi = { id: father };\n        }\n        var mother = fam.getMother();\n        if (mother) {\n            node.spouse = { id: mother };\n        }\n        return node;\n    };\n    /** Creates a d3 hierarchy from the input data. */\n    DescendantChart.prototype.createHierarchy = function () {\n        var _this = this;\n        var parents = [];\n        var nodes = this.options.startIndi\n            ? this.getNodes(this.options.startIndi)\n            : [this.getFamNode(this.options.startFam)];\n        var idGenerator = this.options.idGenerator || new id_generator_1.IdGenerator();\n        nodes.forEach(function (node) { return (node.id = idGenerator.getId(node.id)); });\n        // If there are multiple root nodes, i.e. the start individual has multiple\n        // marriages, create a dummy root node.\n        // After layout is complete, the dummy node will be removed.\n        if (nodes.length > 1) {\n            var dummyNode_1 = {\n                id: exports.DUMMY_ROOT_NODE_ID,\n                height: 1,\n                width: 1,\n            };\n            parents.push(dummyNode_1);\n            nodes.forEach(function (node) { return (node.parentId = dummyNode_1.id); });\n        }\n        parents.push.apply(parents, nodes);\n        var stack = [];\n        nodes.forEach(function (node) {\n            if (node.family) {\n                stack.push(node);\n            }\n        });\n        var _loop_1 = function () {\n            var entry = stack.pop();\n            var fam = this_1.options.data.getFam(entry.family.id);\n            var children = fam.getChildren();\n            children.forEach(function (childId) {\n                var childNodes = _this.getNodes(childId);\n                childNodes.forEach(function (node) {\n                    node.parentId = entry.id;\n                    if (node.family) {\n                        node.id = \"\" + idGenerator.getId(node.family.id);\n                        stack.push(node);\n                    }\n                });\n                parents.push.apply(parents, childNodes);\n            });\n        };\n        var this_1 = this;\n        while (stack.length) {\n            _loop_1();\n        }\n        return d3_hierarchy_1.stratify()(parents);\n    };\n    /**\n     * Renders the tree, calling the provided renderer to draw boxes for\n     * individuals.\n     */\n    DescendantChart.prototype.render = function () {\n        var root = this.createHierarchy();\n        var nodes = removeDummyNode(this.util.layOutChart(root));\n        var animationPromise = this.util.renderChart(nodes);\n        var info = chart_util_1.getChartInfo(nodes);\n        this.util.updateSvgDimensions(info);\n        return Object.assign(info, { animationPromise: animationPromise });\n    };\n    return DescendantChart;\n}());\nexports.DescendantChart = DescendantChart;\n","var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\n\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nrequire(\"array-flat-polyfill\");\n__exportStar(require(\"./ancestor-chart\"), exports);\n__exportStar(require(\"./api\"), exports);\n__exportStar(require(\"./chart-util\"), exports);\n__exportStar(require(\"./composite-renderer\"), exports);\n__exportStar(require(\"./data\"), exports);\n__exportStar(require(\"./date-format\"), exports);\n__exportStar(require(\"./descendant-chart\"), exports);\n__exportStar(require(\"./detailed-renderer\"), exports);\n__exportStar(require(\"./gedcom\"), exports);\n__exportStar(require(\"./hourglass-chart\"), exports);\n__exportStar(require(\"./simple-api\"), exports);\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.ChartColors = void 0;\nlet ChartColors;\n(function (ChartColors) {\n    ChartColors[ChartColors[\"NO_COLOR\"] = 0] = \"NO_COLOR\";\n    ChartColors[ChartColors[\"COLOR_BY_GENERATION\"] = 1] = \"COLOR_BY_GENERATION\";\n    ChartColors[ChartColors[\"COLOR_BY_SEX\"] = 2] = \"COLOR_BY_SEX\";\n    ChartColors[ChartColors[\"COLOR_BY_TRIBE\"] = 3] = \"COLOR_BY_TRIBE\";\n    ChartColors[ChartColors[\"COLOR_BY_NR_LANGUAGES\"] = 4] = \"COLOR_BY_NR_LANGUAGES\";\n    ChartColors[ChartColors[\"COLOR_BY_LANGUAGE\"] = 5] = \"COLOR_BY_LANGUAGE\";\n})\n// eslint-disable-next-line\n(ChartColors = exports.ChartColors || (exports.ChartColors = {}));\n","var __extends = (this && this.__extends) || (function () {\n    let extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({__proto__: []} instanceof Array && function (d, b) {\n                d.__proto__ = b;\n            }) ||\n            function (d, b) {\n                for (const p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n            };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        if (b === null) {\n            d.prototype = Object.create(b);\n        } else {\n            __.prototype = b.prototype;  // Set the prototype of __ to b's prototype\n            d.prototype = new __();      // Create a new instance of __ to set as d's prototype\n        }\n    };\n})();\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DetailedRenderer = exports.getLength = void 0;\n\nconst d3_selection_1 = require(\"d3-selection\");\nconst _1 = require(\"./index\");\nconst date_format_1 = require(\"./date-format\");\nconst d3_array_1 = require(\"d3-array\");\nrequire(\"d3-transition\");\nconst composite_renderer_1 = require(\"./composite-renderer\");\nconst INDI_MIN_HEIGHT = 44;\nconst INDI_MIN_WIDTH = 64;\nconst FAM_MIN_HEIGHT = 10;\nconst FAM_MIN_WIDTH = 15;\nconst IMAGE_WIDTH = 70;\n\n/** Minimum box height when an image is present. */\nconst IMAGE_HEIGHT = 90;\nconst TRIBE_HEIGHT = 17;\nconst LANGUAGES_HEIGHT = 17;\nconst DETAILS_HEIGHT = 17;\nconst ANIMATION_DELAY_MS = 200;\nconst ANIMATION_DURATION_MS = 500;\nconst textLengthCache = new Map();\n\n/** Calculates the length of the given text in pixels when rendered. */\nfunction getLength(text, textClass) {\n    const cacheKey = text + \"|\" + textClass;\n    if (textLengthCache.has(cacheKey)) {\n        return textLengthCache.get(cacheKey);\n    }\n    const g = d3_selection_1.select('svg').append('g').attr('class', 'detailed node');\n    const x = g.append('text').attr('class', textClass).text(text);\n    const length = x.node().getComputedTextLength();\n    g.remove();\n    textLengthCache.set(cacheKey, length);\n    return length;\n}\nexports.getLength = getLength;\n\nconst SEX_SYMBOLS = new Map([\n    ['F', '\\u2640'],\n    ['M', '\\u2642'],\n]);\n\n/**\n * Renders some details about a person such as date and place of birth\n * and death.\n */\nvar DetailedRenderer = /** @class */ (function (_super) {\n    __extends(DetailedRenderer, _super);\n\n    function DetailedRenderer(options) {\n        var _this = _super.call(this, options) || this;\n        _this.options = options;\n        return _this;\n    }\n\n    DetailedRenderer.prototype.getColoringClass = function () {\n        switch (this.options.colors) {\n            case _1.ChartColors.NO_COLOR:\n                return 'nocolor';\n            case _1.ChartColors.COLOR_BY_GENERATION:\n                return 'bygeneration';\n            case _1.ChartColors.COLOR_BY_SEX:\n                return 'bysex';\n            case _1.ChartColors.COLOR_BY_TRIBE:\n                return 'bytribe';\n            case _1.ChartColors.COLOR_BY_NR_LANGUAGES:\n                return 'bylanguages';\n            case _1.ChartColors.COLOR_BY_LANGUAGE:\n                return 'bylanguages';\n            default:\n                return 'bygeneration';\n        }\n    };\n\n    /** Extracts lines of details for a person. */\n    DetailedRenderer.prototype.getIndiDetails = function (indi) {\n        const detailsList = [];\n        const birthDate = indi.getBirthDate() && date_format_1.formatDateOrRange(indi.getBirthDate(), this.options.locale);\n        const birthPlace = indi.getBirthPlace();\n        const deathDate = indi.getDeathDate() && date_format_1.formatDateOrRange(indi.getDeathDate(), this.options.locale);\n        const deathPlace = indi.getDeathPlace();\n        if (birthDate) {\n            detailsList.push({ symbol: '', text: birthDate });\n        }\n        if (birthPlace) {\n            detailsList.push({ symbol: '', text: birthPlace });\n        }\n        if (birthDate || birthPlace) {\n            detailsList[0].symbol = '*';\n        }\n        const listIndex = detailsList.length;\n        if (deathDate) {\n            detailsList.push({ symbol: '', text: deathDate });\n        }\n        if (deathPlace) {\n            detailsList.push({ symbol: '', text: deathPlace });\n        }\n        if (deathDate || deathPlace) {\n            detailsList[listIndex].symbol = '+';\n        }\n        else if (indi.isConfirmedDeath()) {\n            detailsList.push({ symbol: '+', text: '' });\n        }\n        return detailsList;\n    };\n\n    DetailedRenderer.prototype.getPreferredIndiSize = function (id) {\n        // Height\n        const indi = this.options.data.getIndi(id);\n        const details = this.getIndiDetails(indi);\n        const tribeHeight = indi.showTribe() && indi.getTribe() != null ? TRIBE_HEIGHT : 0;\n        const languagesHeight = indi.showLanguages() && indi.getLanguages().length > 0 ? LANGUAGES_HEIGHT : 0;\n        const idAndSexHeight = indi.showId() || indi.showSex() ? DETAILS_HEIGHT : 0;\n        const height = d3_array_1.max([\n            INDI_MIN_HEIGHT + languagesHeight + tribeHeight + (details.length * DETAILS_HEIGHT) + idAndSexHeight,\n            indi.getImageUrl() ? IMAGE_HEIGHT : 0,\n        ]);\n        // Width\n        const maxDetailsWidth = d3_array_1.max(details.map(detail => getLength(detail.text, 'details')));\n        const width = d3_array_1.max([\n            maxDetailsWidth + 22,\n            getLength(indi.getFirstName() || '', 'name') + 8,\n            getLength(indi.getLastName() || '', 'name') + 8,\n            indi.showLanguages() && indi.getLanguages().length > 0 ? (getLength(indi.getLanguagesLabel(), 'languages') + 28) : 0,\n            indi.showTribe() && indi.getTribe() != null ? (getLength(indi.getTribe(), 'tribe') + 28) : 0,\n            getLength(id, 'id') + 32,\n            INDI_MIN_WIDTH,\n        ]) + (indi.getImageUrl() ? IMAGE_WIDTH : 0);\n        return [width, height];\n    };\n\n    /** Extracts lines of details for a family. */\n    DetailedRenderer.prototype.getFamDetails = function (fam) {\n        const detailsList = [];\n        const marriageDate = fam.getMarriageDate() &&\n            date_format_1.formatDateOrRange(fam.getMarriageDate(), this.options.locale);\n        const marriagePlace = fam.getMarriagePlace();\n        if (marriageDate) {\n            detailsList.push({ symbol: '', text: marriageDate });\n        }\n        if (marriagePlace) {\n            detailsList.push({ symbol: '', text: marriagePlace });\n        }\n        if (marriageDate || marriagePlace) {\n            detailsList[0].symbol = '\\u26AD';\n        }\n        return detailsList;\n    };\n\n    DetailedRenderer.prototype.getPreferredFamSize = function (id) {\n        const fam = this.options.data.getFam(id);\n        const details = this.getFamDetails(fam);\n        const height = d3_array_1.max([10 + details.length * DETAILS_HEIGHT, FAM_MIN_HEIGHT]);\n        const maxDetailsWidth = d3_array_1.max(details.map(function (x) { return getLength(x.text, 'details'); }));\n        const width = d3_array_1.max([maxDetailsWidth + 22, FAM_MIN_WIDTH]);\n        return [width, height];\n    };\n\n    DetailedRenderer.prototype.render = function (enter, update) {\n        const _this = this;\n        enter = enter.append('g').attr('class', 'detailed');\n        update = update.select('g');\n        const indiUpdate = enter\n            .merge(update)\n            .selectAll('g.indi')\n            .data(function (node) {\n                const result = [];\n                const famXOffset = !_this.options.horizontal && node.data.family\n                ? d3_array_1.max([-composite_renderer_1.getFamPositionVertical(node.data), 0])\n                : 0;\n                const famYOffset = _this.options.horizontal && node.data.family\n                ? d3_array_1.max([-composite_renderer_1.getFamPositionHorizontal(node.data), 0])\n                : 0;\n            if (node.data.indi) {\n                result.push({\n                    indi: node.data.indi,\n                    generation: node.data.generation,\n                    xOffset: famXOffset,\n                    yOffset: 0,\n                });\n            }\n            if (node.data.spouse) {\n                result.push({\n                    indi: node.data.spouse,\n                    generation: node.data.generation,\n                    xOffset: !_this.options.horizontal && node.data.indi\n                        ? node.data.indi.width + famXOffset\n                        : 0,\n                    yOffset: _this.options.horizontal && node.data.indi\n                        ? node.data.indi.height + famYOffset\n                        : 0,\n                });\n            }\n            return result;\n        }, function (data) { return data.indi.id; });\n        const indiEnter = indiUpdate\n            .enter()\n            .append('g')\n            .attr('class', 'indi');\n        this.transition(indiEnter.merge(indiUpdate)).attr('transform', function (node) { return \"translate(\" + node.xOffset + \", \" + node.yOffset + \")\"; });\n        this.renderIndi(indiEnter, indiUpdate);\n        const familyEnter = enter\n            .select(function (node) {\n            return node.data.family ? this : null;\n        }).append('g').attr('class', 'family');\n        const familyUpdate = update\n            .select(function (node) {\n            return node.data.family ? this : null;\n        }).select('g.family');\n        this.transition(familyEnter.merge(familyUpdate)).attr('transform', function (node) {\n            return _this.getFamTransform(node.data);\n        });\n        this.renderFamily(familyEnter);\n    };\n\n    DetailedRenderer.prototype.getCss = function () {\n        return null  // moved to external file\n    };\n\n    DetailedRenderer.prototype.transition = function (selection) {\n        return this.options.animate\n            ? selection\n                .transition()\n                .delay(ANIMATION_DELAY_MS)\n                .duration(ANIMATION_DURATION_MS)\n            : selection;\n    };\n\n    DetailedRenderer.prototype.getFamTransform = function (node) {\n        if (this.options.horizontal) {\n            return \"translate(\" + ((node.indi && node.indi.width) || node.spouse.width) + \", \" + d3_array_1.max([composite_renderer_1.getFamPositionHorizontal(node), 0]) + \")\";\n        }\n        return \"translate(\" + d3_array_1.max([composite_renderer_1.getFamPositionVertical(node), 0]) + \", \" + ((node.indi && node.indi.height) || node.spouse.height) + \")\";\n    };\n\n    DetailedRenderer.prototype.getSexClass = function (indiId) {\n        let _a;\n        const sex = (_a = this.options.data.getIndi(indiId)) === null || _a === void 0 ? void 0 : _a.getSex();\n        switch (sex) {\n            case 'M':\n                return 'male';\n            case 'F':\n                return 'female';\n            default:\n                break;\n        }\n    };\n\n    const tribesCss = new Map();\n    DetailedRenderer.prototype.getTribeClass = function (indiId) {\n        if (tribesCss.size === 0) {\n            this.buildTribesMap()\n        }\n        let _a;\n        const tribe = (_a = this.options.data.getIndi(indiId)) === null || _a === void 0 ? void 0 : _a.getTribe();\n        if (tribe) {\n            return tribesCss.get(tribe);\n        }\n        return ''  // Blank if no tribe\n    };\n\n    DetailedRenderer.prototype.buildTribesMap = function () {\n        // Assign the tribe of the ego as tribe0\n        if (!tribesCss.has(\"tribe0\")) {\n            const egoTribe = Array.from(this.options.data.indis?.values() || []).find(indi => indi.isEgo())?.json.tribe\n            if (egoTribe) {\n                tribesCss.set(egoTribe, \"tribe0\")\n            }\n        }\n        Array.from(this.options.data.indis?.values() || [])\n            .filter(indi => indi.getTribe() != null)\n            .forEach(indi => {\n                const tribe = indi.getTribe()\n                if (!tribesCss.has(tribe)) {\n                    tribesCss.set(tribe, \"tribe\" + tribesCss.size)\n                }\n                if (tribesCss.size > 9) {\n                    throw new Error('No CSS for more than 9 different tribes')\n                }\n            })\n    }\n\n    DetailedRenderer.prototype.getLanguagesClass = function (indiId, selectedLanguageId) {\n        let _a;\n        const languages = (_a = this.options.data.getIndi(indiId)) === null || _a === void 0 ? void 0 : _a.getLanguages();\n        if (selectedLanguageId != null) {\n            // By specific language\n            const hasSelectedLanguage = languages.some(language => language.id === selectedLanguageId);\n            if (hasSelectedLanguage) {\n                return \"l\" + selectedLanguageId;\n            }\n        } else {\n            // By nr. languages\n            return languages.length > 0 ? 'n' + Math.min(languages.length, 7) : '';\n        }\n        return '' // Blank if no language\n    }\n\n    DetailedRenderer.prototype.resetCss = function () {\n        tribesCss.clear()\n        console.log('Cleared CSS maps')\n    }\n\n    DetailedRenderer.prototype.renderIndi = function (enter, update) {\n        const _this = this;\n\n        if (this.options.indiHrefFunc) {\n            enter = enter\n                .append('a')\n                .attr('href', function (data) { return _this.options.indiHrefFunc(data.indi.id); });\n            update = update.select('a');\n        }\n\n        if (this.options.indiCallback) {\n            enter.on('click', function (event, data) {\n                return _this.options.indiCallback({\n                    id: data.indi.id,\n                    generation: data.generation,\n                });\n            });\n        }\n\n        // Background\n        const background = enter\n            .append('rect')\n            .attr('rx', 5)\n            .attr('stroke-width', 0)\n            .attr('class', function (node) {\n                return \"background \"\n                    +_this.getColoringClass() + \" \"\n                    + _this.getSexClass(node.indi.id) + \" \"\n                    + _this.getTribeClass(node.indi.id) + \" \"\n                    + _this.getLanguagesClass(node.indi.id, _this.options.selectedLanguage) + \" \";\n            })\n            .merge(update.select('rect.background'));\n        this.transition(background)\n            .attr('width', function (node) { return node.indi.width; })\n            .attr('height', function (node) { return node.indi.height; });\n\n        // Clip path\n        const getClipId = function (id) {\n            return \"clip-\" + id;\n        };\n        enter\n            .append('clipPath')\n            .attr('id', function (node) { return getClipId(node.indi.id); })\n            .append('rect')\n            .attr('rx', 5)\n            .merge(update.select('clipPath rect'))\n            .attr('width', function (node) { return node.indi.width; })\n            .attr('height', function (node) { return node.indi.height; });\n        const getIndi = function (data) {\n            return _this.options.data.getIndi(data.indi.id);\n        };\n        const getDetailsWidth = function (data) {\n            return data.indi.width - (getIndi(data).getImageUrl() ? IMAGE_WIDTH : 0);\n        };\n\n        // Name\n        enter\n            .append('text')\n            .attr('text-anchor', 'middle')\n            .attr('class', 'name')\n            .attr('transform', function (node) { return \"translate(\" + getDetailsWidth(node) / 2 + \", 17)\"; })\n            .text(function (node) { return getIndi(node).getFirstName(); });\n        enter\n            .append('text')\n            .attr('text-anchor', 'middle')\n            .attr('class', 'name')\n            .attr('transform', function (node) { return \"translate(\" + getDetailsWidth(node) / 2 + \", 33)\"; })\n            .text(function (node) { return getIndi(node).getLastName(); })\n\n        // Languages\n        const languages = enter\n            .filter(function (node) {\n                return getIndi(node).showLanguages() && getIndi(node).getLanguages().length > 0\n            })\n            .append('text')\n            .attr('text-anchor', 'middle')\n            .attr('class', 'languages')\n            .text(function (node) {\n                return getIndi(node).getLanguagesLabel()\n            });\n        this.transition(languages).attr('transform', function (node) {\n            // if the indi does not have tribe to show, the height start does not apply\n            const languages_height_start =  getIndi(node).showLanguages() && getIndi(node).getLanguages().length > 0 ? 52 : null\n            return \"translate(\" + getDetailsWidth(node) / 2 + \", \" + languages_height_start + \")\";\n        });\n\n        // Tribe\n        const tribe = enter\n            .filter(function (node) {\n                return getIndi(node).showTribe() && getIndi(node).getTribe() != null\n            })\n            .append('text')\n            .attr('class', 'tribe')\n            .text(function (node) {\n                return ' ' + getIndi(node).getTribe()\n            });\n        this.transition(tribe).attr('transform', function (node) {\n            let tribe_height_start =  null\n            if (getIndi(node).showLanguages() && getIndi(node).getLanguages().length > 0) {\n                tribe_height_start = 71\n            } else if (getIndi(node).showTribe() && getIndi(node).getTribe() != null) {\n                tribe_height_start = 55\n            }\n            return \"translate(5, \" + tribe_height_start + \")\";\n        });\n\n        // Extract details\n        const details = new Map();\n        enter.each(function (node) {\n            const indi = getIndi(node);\n            const detailsList = _this.getIndiDetails(indi);\n            details.set(node.indi.id, detailsList);\n        });\n        const maxDetails = d3_array_1.max(Array.from(details.values(), function (v) {\n            return v.length;\n        }));\n\n        function details_height_start(node) {\n            return 55\n                + ((getIndi(node).showLanguages() && getIndi(node).getLanguages().length > 0) ? LANGUAGES_HEIGHT : 0)\n                + ((getIndi(node).showTribe() && getIndi(node).getTribe() != null) ? TRIBE_HEIGHT : 0)\n        }\n\n        const _loop_2 = function (i) {\n            const lineGroup = enter.filter(function (node) {\n                return details.get(node.indi.id).length > i;\n            });\n\n            lineGroup\n                .append('text')\n                .attr('text-anchor', 'middle')\n                .attr('class', 'details')\n                .attr('transform', function (node) {\n                    return \"translate(9, \" + (details_height_start(node) + i * DETAILS_HEIGHT) + \")\"\n                })\n                .text(function (node) {\n                    return details.get(node.indi.id)[i].symbol;\n                });\n            lineGroup\n                .append('text')\n                .attr('class', 'details')\n                .attr('transform', function (node) {\n                    return \"translate(15, \" + (details_height_start(node) + i * DETAILS_HEIGHT) + \")\"\n                })\n                .text(function (node) {\n                    return details.get(node.indi.id)[i].text;\n                });\n        };\n        // Render details\n        for (let i = 0; i < maxDetails; ++i) {\n            _loop_2(i);\n        }\n\n        // Render id\n        const id = enter\n            .append('text')\n            .attr('class', 'id')\n            .text(function (node) {\n                return (getIndi(node).showId() ? node.indi.id : '');\n            })\n            .merge(update.select('text.id'));\n        this.transition(id).attr('transform', function (node) { return \"translate(9, \" + (node.indi.height - 5) + \")\"; });\n\n        // Render sex\n        const sex = enter\n            .append('text')\n            .attr('class', 'details sex')\n            .attr('text-anchor', 'end')\n            .text(function (node) {\n                const sexSymbol = SEX_SYMBOLS.get(getIndi(node).getSex() || '') || '';\n                return getIndi(node).showSex() ? sexSymbol : '';\n            })\n            .merge(update.select('text.sex'));\n        this.transition(sex).attr('transform', function (node) {\n            return \"translate(\" + (getDetailsWidth(node) - 5) + \", \" + (node.indi.height - 5) + \")\";\n        });\n\n        // Image\n        enter.filter(function (node) { return !!getIndi(node).getImageUrl(); })\n            .append('image')\n            .attr('width', IMAGE_WIDTH)\n            .attr('height', function (node) { return node.indi.height; })\n            .attr('preserveAspectRatio', 'xMidYMin')\n            .attr('transform', function (node) { return \"translate(\" + (node.indi.width - IMAGE_WIDTH) + \", 0)\"; })\n            .attr('clip-path', function (node) { return \"url(#\" + getClipId(node.indi.id) + \")\"; })\n            .attr('href', function (node) { return getIndi(node).getImageUrl(); });\n\n        // Border on top\n        const border = enter\n            .append('rect')\n            .attr('rx', 5)\n            .attr('fill-opacity', 0)\n            .attr('class', 'border')\n            .merge(update.select('rect.border'));\n        this.transition(border)\n            .attr('width', function (node) { return node.indi.width; })\n            .attr('height', function (node) { return node.indi.height; });\n    };\n\n    DetailedRenderer.prototype.renderFamily = function (enter) {\n        const _this = this;\n\n        if (this.options.famHrefFunc) {\n            enter = enter\n                .append('a')\n                .attr('href', function (node) {\n                return _this.options.famHrefFunc(node.data.family.id);\n            });\n        }\n\n        if (this.options.famCallback) {\n            enter.on('click', function (event, node) {\n                return _this.options.famCallback({\n                    id: node.data.family.id,\n                    generation: node.data.generation,\n                });\n            });\n        }\n\n        // Extract details\n        const details = new Map();\n        enter.each(function (node) {\n            const famId = node.data.family.id;\n            const fam = _this.options.data.getFam(famId);\n            const detailsList = _this.getFamDetails(fam);\n            details.set(famId, detailsList);\n        });\n        const maxDetails = d3_array_1.max(Array.from(details.values(), function (v) {\n            return v.length;\n        }));\n\n        // Box\n        enter.filter(function (node) {\n                const detail = details.get(node.data.family.id);\n                return 0 < detail.length;\n        }).append('rect')\n        .attr('class', this.getColoringClass())\n        .attr('rx', 5)\n        .attr('ry', 5)\n        .attr('width', function (node) { return node.data.family.width; })\n        .attr('height', function (node) { return node.data.family.height; });\n        const _loop_2 = function (i) {\n            const lineGroup = enter.filter(function (node) {\n                return details.get(node.data.family.id).length > i;\n            });\n            lineGroup\n                .append('text')\n                .attr('text-anchor', 'middle')\n                .attr('class', 'details')\n                .attr('transform', \"translate(9, \" + (16 + i * DETAILS_HEIGHT) + \")\")\n                .text(function (node) {\n                    return details.get(node.data.family.id)[i].symbol;\n                });\n            lineGroup\n                .append('text')\n                .attr('text-anchor', 'start')\n                .attr('class', 'details')\n                .attr('transform', \"translate(15, \" + (16 + i * DETAILS_HEIGHT) + \")\")\n                .text(function (node) {\n                    return details.get(node.data.family.id)[i].text;\n                });\n        };\n        // Render details\n        for (let i = 0; i < maxDetails; ++i) {\n            _loop_2(i);\n        }\n    };\n\n    return DetailedRenderer;\n}(composite_renderer_1.CompositeRenderer));\nexports.DetailedRenderer = DetailedRenderer;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.gedcomEntriesToJson = exports.gedcomToJson = exports.getDate = void 0;\nconst parse_gedcom_1 = require(\"parse-gedcom\");\n\n/** Returns the first entry with the given tag or undefined if not found. */\nfunction findTag(tree, tag) {\n    return tree.find(function (entry) { return entry.tag === tag; });\n}\n\n/** Returns all entries with the given tag. */\nfunction findTags(tree, tag) {\n    return tree.filter(function (entry) { return entry.tag === tag; });\n}\n\n/**\n * Returns the identifier extracted from a pointer string.\n * E.g. '@I123@' -> 'I123'\n */\nfunction pointerToId(pointer) {\n    return pointer.substring(1, pointer.length - 1);\n}\n\n/** Extracts the first and last name from a GEDCOM name field. */\nfunction extractName(name) {\n    const arr = name.split('/');\n    if (arr.length === 1) {\n        return { firstName: arr[0].trim() };\n    }\n    return { firstName: arr[0].trim(), lastName: arr[1].trim() };\n}\n\n/** Maps month abbreviations used in GEDCOM to month numbers. */\nconst MONTHS = new Map([\n    ['jan', 1],\n    ['feb', 2],\n    ['mar', 3],\n    ['apr', 4],\n    ['may', 5],\n    ['jun', 6],\n    ['jul', 7],\n    ['aug', 8],\n    ['sep', 9],\n    ['oct', 10],\n    ['nov', 11],\n    ['dec', 12],\n]);\n\n/** Parses the GEDCOM date into the Date structure. */\nfunction parseDate(parts) {\n    let lastPart;\n    if (!parts || !parts.length) {\n        return undefined;\n    }\n    const result = {};\n    // Remove parentheses if they surround the text\n    if (parts[0].startsWith('(') && parts[parts.length - 1].endsWith(')')) {\n        parts[0] = parts[0].substring(1);\n        lastPart = parts[parts.length - 1];\n        parts[parts.length - 1] = lastPart.substring(0, lastPart.length - 1);\n    }\n    const fullText = parts.join(' ');\n    const firstPart = parts[0].toLowerCase();\n    if (firstPart === 'cal' || firstPart === 'abt' || firstPart === 'est') {\n        result.qualifier = firstPart;\n        parts = parts.slice(1);\n    }\n    if (parts.length && parts[parts.length - 1].match(/^\\d{1,4}$/)) {\n        result.year = Number(parts[parts.length - 1]);\n        parts = parts.slice(0, parts.length - 1);\n    }\n    if (parts.length) {\n        lastPart = parts[parts.length - 1].toLowerCase();\n        if (MONTHS.has(lastPart)) {\n            result.month = MONTHS.get(lastPart);\n            parts = parts.slice(0, parts.length - 1);\n        }\n    }\n    if (parts.length && parts[0].match(/^\\d\\d?$/)) {\n        result.day = Number(parts[0]);\n        parts = parts.slice(0, parts.length - 1);\n    }\n    if (parts.length) {\n        // A part didn't get parsed. Return the whole text verbatim.\n        return { text: fullText };\n    }\n    return result;\n}\n\n/** Parses a GEDCOM date or date range. */\nfunction getDate(gedcomDate) {\n    const parts = gedcomDate.replace(/@.*@/, '').trim().split(' ');\n    const firstPart = parts[0].toLowerCase();\n    if (firstPart.startsWith('bet')) {\n        const i = parts.findIndex(function (x) {\n            return x.toLowerCase() === 'and';\n        });\n        const from = parseDate(parts.slice(1, i));\n        const to = parseDate(parts.slice(i + 1));\n        return { dateRange: { from: from, to: to } };\n    }\n    if (firstPart.startsWith('bef') || firstPart.startsWith('aft')) {\n        const date_1 = parseDate(parts.slice(1));\n        if (firstPart.startsWith('bef')) {\n            return { dateRange: { to: date_1 } };\n        }\n        return { dateRange: { from: date_1 } };\n    }\n    const date = parseDate(parts);\n    if (date) {\n        return { date: date };\n    }\n    return undefined;\n}\nexports.getDate = getDate;\n\n/**\n * Tries to treat an input tag as NOTE and parse all lines of notes\n */\nfunction createNotes(notesTag) {\n    if (!notesTag || notesTag.tag !== 'NOTE')\n        return undefined;\n    return findTags(notesTag.tree, 'CONT')\n        .filter(function (x) { return x.data; })\n        .reduce(function (a, i) { return a.concat(i.data); }, [notesTag.data]);\n}\n\n/**\n * Creates a JsonEvent object from a GEDCOM entry.\n * Used for BIRT, DEAT and MARR tags.\n */\nfunction createEvent(entry) {\n    if (!entry) {\n        return undefined;\n    }\n    const typeTag = findTag(entry.tree, 'TYPE');\n    const dateTag = findTag(entry.tree, 'DATE');\n    const placeTag = findTag(entry.tree, 'PLAC');\n    const date = dateTag && dateTag.data && getDate(dateTag.data);\n    const place = placeTag && placeTag.data;\n    if (date || place) {\n        const result = date || {};\n        if (place) {\n            result.place = place;\n        }\n        result.confirmed = true;\n        result.type = typeTag ? typeTag.data : undefined;\n        result.notes = createNotes(findTag(entry.tree, 'NOTE'));\n        return result;\n    }\n    if (entry.data && entry.data.toLowerCase() === 'y') {\n        return { confirmed: true };\n    }\n    return undefined;\n}\n\n/** Creates a JsonIndi object from an INDI entry in GEDCOM. */\nfunction createIndi(entry, objects, ego, allLanguages) {\n    let firstName;\n    let lastName;\n    const id = pointerToId(entry.pointer);\n    const fams = findTags(entry.tree, 'FAMS').map(function (entry) {\n        return pointerToId(entry.data);\n    });\n    const indi = {id: id, fams: fams};\n\n    // is Ego?\n    if (ego) {\n        indi.isEgo = pointerToId(ego.pointer) === id\n    }\n\n    // Name\n    const nameTags = findTags(entry.tree, 'NAME');\n    const isMaiden = function (nameTag) {\n        const type = findTag(nameTag.tree, 'TYPE');\n        return type !== undefined && type.data === 'maiden';\n    };\n    const main = nameTags.find(function (x) {\n        return !isMaiden(x);\n    });\n    const maiden = nameTags.find(isMaiden);\n    if (main) {\n        const _a = extractName(main.data);\n        firstName = _a.firstName;\n        lastName = _a.lastName;\n        if (firstName) {\n            indi.firstName = firstName;\n        }\n        if (lastName) {\n            indi.lastName = lastName;\n        }\n    }\n    if (maiden) {\n        let _b = extractName(maiden.data);\n        firstName = _b.firstName;\n        lastName = _b.lastName;\n        if (lastName) {\n            indi.maidenName = lastName;\n        }\n        if (firstName && !indi.firstName) {\n            indi.firstName = firstName;\n        }\n    }\n    // Number of children\n    const nchiTag = findTag(entry.tree, 'NCHI');\n    if (nchiTag) {\n        indi.numberOfChildren = +nchiTag.data;\n    }\n    // Number of marriages\n    const nmrTag = findTag(entry.tree, 'NMR');\n    if (nmrTag) {\n        indi.numberOfMarriages = +nmrTag.data;\n    }\n    // Sex\n    const sexTag = findTag(entry.tree, 'SEX');\n    if (sexTag) {\n        indi.sex = sexTag.data;\n    }\n    // Languages\n    const languageTags = findTags(entry.tree, 'LANG')\n    if (languageTags) {\n        const gedcomLanguages = findTags(entry.tree, 'LANG').map(lang => lang.data)\n        indi.languages = allLanguages.filter(l => gedcomLanguages.includes(l.name));\n    }\n    // Tribe\n    const tribeTag = findTag(entry.tree, '_TRIB');\n    if (tribeTag) {\n        indi.tribe = tribeTag.data;\n    }\n    // Family with parents\n    const famcTag = findTag(entry.tree, 'FAMC');\n    if (famcTag) {\n        indi.famc = pointerToId(famcTag.data);\n    }\n    // Image URL\n    const objeTags = findTags(entry.tree, 'OBJE');\n    if (objeTags.length > 0) {\n        // Dereference OBJECT if needed\n        const getFileTag = function (tag) {\n            const realObjeTag = tag.data ? objects.get(pointerToId(tag.data)) : tag;\n            if (!realObjeTag)\n                return undefined;\n            const file = findTag(realObjeTag.tree, 'FILE');\n            const title = findTag(realObjeTag.tree, 'TITL');\n            if (!file)\n                return undefined;\n            return {\n                url: file.data,\n                title: title && title.data,\n            };\n        };\n        indi.images = objeTags\n            .map(getFileTag)\n            .filter(function (x) { return x !== undefined; });\n    }\n    // Birthdate and place\n    const birth = createEvent(findTag(entry.tree, 'BIRT'));\n    if (birth) {\n        indi.birth = birth;\n    }\n    // Death date and place\n    const death = createEvent(findTag(entry.tree, 'DEAT'));\n    if (death) {\n        indi.death = death;\n    }\n    // Notes\n    indi.notes = createNotes(findTag(entry.tree, 'NOTE'));\n    // Events\n    indi.events = findTags(entry.tree, 'EVEN')\n        .map(createEvent)\n        .filter(function (x) { return x !== null; });\n    return indi;\n}\n\n/** Creates a JsonFam object from an FAM entry in GEDCOM. */\nfunction createFam(entry) {\n    const id = pointerToId(entry.pointer);\n    const children = findTags(entry.tree, 'CHIL').map(function (entry) {\n        return pointerToId(entry.data);\n    });\n    const fam = {id: id, children: children};\n    // Husband.\n    const husbTag = findTag(entry.tree, 'HUSB');\n    if (husbTag) {\n        fam.husb = pointerToId(husbTag.data);\n    }\n    // Wife.\n    const wifeTag = findTag(entry.tree, 'WIFE');\n    if (wifeTag) {\n        fam.wife = pointerToId(wifeTag.data);\n    }\n    // Marriage\n    const marriage = createEvent(findTag(entry.tree, 'MARR'));\n    if (marriage) {\n        fam.marriage = marriage;\n    }\n    return fam;\n}\n\n/** Creates a map from ID to entry from an array of entries. */\nfunction createMap(entries) {\n    return new Map(entries.map(function (entry) { return [pointerToId(entry.pointer), entry]; }));\n}\n\n/** Parses a GEDCOM file into a JsonGedcomData structure. */\nfunction gedcomToJson(gedcomContents, allLanguages) {\n    return gedcomEntriesToJson(parse_gedcom_1.parse(gedcomContents, allLanguages));\n}\nexports.gedcomToJson = gedcomToJson;\n\n/** Converts parsed GEDCOM entries into a JsonGedcomData structure. */\nfunction gedcomEntriesToJson(gedcom, allLanguages) {\n    const objects = createMap(findTags(gedcom, 'OBJE'));\n    const ego = findTags(gedcom, 'EGO')\n    const indis = findTags(gedcom, 'INDI').map(function (entry) {\n        return createIndi(entry, objects, ego.length > 0 ? ego[0] : undefined, allLanguages);\n    });\n    const fams = findTags(gedcom, 'FAM').map(createFam);\n    return { indis: indis, fams: fams };\n}\nexports.gedcomEntriesToJson = gedcomEntriesToJson;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.HourglassChart = void 0;\nvar ancestor_chart_1 = require(\"./ancestor-chart\");\nvar chart_util_1 = require(\"./chart-util\");\nvar descendant_chart_1 = require(\"./descendant-chart\");\n/**\n * Renders an hourglass chart. It consists of an ancestor chart and\n * a descendant chart for a family.\n */\nvar HourglassChart = /** @class */ (function () {\n    function HourglassChart(options) {\n        this.options = options;\n        this.util = new chart_util_1.ChartUtil(options);\n    }\n    HourglassChart.prototype.render = function () {\n        const ancestorsRoot = ancestor_chart_1.getAncestorsTree(this.options);\n        const ancestorNodes = this.util.layOutChart(ancestorsRoot, {\n            flipVertically: true,\n        });\n        const descendantNodes = descendant_chart_1.layOutDescendants(this.options);\n        // slice(1) removes the duplicated start node.\n        const nodes = ancestorNodes.slice(1).concat(descendantNodes);\n        const animationPromise = this.util.renderChart(nodes);\n        const info = chart_util_1.getChartInfo(nodes);\n        this.util.updateSvgDimensions(info);\n        return Object.assign(info, { animationPromise: animationPromise });\n    };\n    return HourglassChart;\n}());\nexports.HourglassChart = HourglassChart;\n","Object.defineProperty(exports, \"__esModule\", { value: true });\nexports.createChart = void 0;\nconst d3_selection_1 = require(\"d3-selection\");\nconst data_1 = require(\"./data\");\nconst DEFAULT_SVG_SELECTOR = 'svg';\n\nfunction createChartOptions(chartOptions, renderOptions, options) {\n    const data = new data_1.JsonDataProvider(chartOptions.json);\n    const indiHrefFunc = chartOptions.indiUrl ? function (id) {\n            return chartOptions.indiUrl.replace(`${id}`, id);\n        } : undefined;\n    const famHrefFunc = chartOptions.famUrl ? function (id) {\n            return chartOptions.famUrl.replace(`${id}`, id);\n        } : undefined;\n    // If startIndi nor startFam is provided, select the first indi in the data.\n    if (!renderOptions.startIndi && !renderOptions.startFam) {\n        renderOptions.startIndi = chartOptions.json.indis[0].id;\n    }\n    const animate = !options.initialRender && chartOptions.animate;\n    return {\n        data: data,\n        renderer: new chartOptions.renderer({\n            data: data,\n            indiHrefFunc: indiHrefFunc,\n            famHrefFunc: famHrefFunc,\n            indiCallback: chartOptions.indiCallback,\n            famCallback: chartOptions.famCallback,\n            horizontal: chartOptions.horizontal,\n            colors: chartOptions.colors,\n            selectedLanguage: chartOptions.selectedLanguage,\n            animate: animate,\n            locale: chartOptions.locale,\n        }),\n        startIndi: renderOptions.startIndi,\n        startFam: renderOptions.startFam,\n        svgSelector: chartOptions.svgSelector || DEFAULT_SVG_SELECTOR,\n        horizontal: chartOptions.horizontal,\n        baseGeneration: renderOptions.baseGeneration,\n        animate: animate,\n    };\n}\n\nconst SimpleChartHandle = /** @class */ (function () {\n\n    function SimpleChartHandle(options) {\n        this.options = options;\n        this.initialRender = true;\n    }\n\n    SimpleChartHandle.prototype.render = function (renderOptions) {\n        if (renderOptions === void 0) {\n            renderOptions = {};\n        }\n        const chartOptions = createChartOptions(this.options, renderOptions, {\n            initialRender: this.initialRender\n        });\n        // Reset CSS maps\n        if (this.initialRender) {\n            chartOptions.renderer.resetCss();\n        }\n        this.initialRender = false;\n        const chart = new this.options.chartType(chartOptions);\n        const info = chart.render();\n        if (this.options.updateSvgSize !== false) {\n            d3_selection_1.select(chartOptions.svgSelector)\n                .attr('width', info.size[0])\n                .attr('height', info.size[1]);\n        }\n        return info;\n    };\n    /**\n     * Updates the chart input data.\n     * This is useful when the data is dynamically loaded and a different subset\n     * of data will be displayed.\n     */\n    SimpleChartHandle.prototype.setData = function (json) {\n        this.options.json = json;\n    };\n    return SimpleChartHandle;\n}());\n\nfunction createChart(options) {\n    return new SimpleChartHandle(options);\n}\nexports.createChart = createChart;\n","import {IndiInfo} from '../lib/topola';\nimport {TopolaData} from '../util/gedcom_util';\nimport {Language} from \"../languages/languages-loader\";\n\n/** Supported data sources. */\nexport enum DataSourceEnum {\n    UPLOADED,\n    GEDCOM_URL,\n    EMBEDDED,\n}\n\n/** Source specification together with individual selection. */\nexport interface SourceSelection<SourceSpecT> {\n    spec: SourceSpecT;\n    selection?: IndiInfo;\n    allLanguages?: Language[];\n}\n\n/** Interface encapsulating functions specific for a data source. */\nexport interface DataSource<SourceSpecT> {\n    /**\n     * Returns true if the application is now loading a completely new data set\n     * and the existing one should be wiped.\n     */\n    isNewData(\n        newSource: SourceSelection<SourceSpecT>,\n        oldSource: SourceSelection<SourceSpecT>,\n        data?: TopolaData,\n    ): boolean;\n\n    /** Loads data from the data source. */\n    loadData(spec: SourceSelection<SourceSpecT>): Promise<TopolaData>;\n}\n","import {FormattedMessage} from 'react-intl';\n\nconst TAG_DESCRIPTIONS = new Map([\n    ['ADOP', 'Adoption'],\n    ['BAPM', 'Baptism'],\n    ['BIRT', 'Birth'],\n    ['BURI', 'Burial'],\n    ['CENS', 'Census'],\n    ['CHR', 'Christening'],\n    ['CREM', 'Cremation'],\n    ['DEAT', 'Death'],\n    ['EDUC', 'Education'],\n    ['EMAIL', 'E-mail'],\n    ['EMIG', 'Emigration'],\n    ['EVEN', 'Event'],\n    ['FACT', 'Fact'],\n    ['IMMI', 'Immigration'],\n    ['MARR', 'Marriage'],\n    ['MARS', 'Marriage settlement'],\n    ['ETHN', 'Ethnic'],\n    ['TRIB', 'Clan'],\n    ['LANG', 'Language'],\n    ['DIV', 'Divorce'],\n    ['MILT', 'Military services'],\n    ['NATU', 'Naturalization'],\n    ['OCCU', 'Occupation'],\n    ['TITL', 'Title'],\n    ['WWW', 'WWW'],\n    ['birth', 'Birth name'],\n    ['married', 'Married name'],\n    ['maiden', 'Maiden name'],\n    ['immigrant', 'Immigrant name'],\n    ['aka', 'Also known as'],\n]);\n\ninterface Props {\n    tag: string;\n}\n\nexport function TranslatedTag(props: Props) {\n    const normalizedTag = props.tag.replace(/_/g, '');\n    return (\n        <FormattedMessage\n            id={`gedcom.${normalizedTag}`}\n            defaultMessage={TAG_DESCRIPTIONS.get(normalizedTag) || normalizedTag}\n        />\n    );\n}\n","import {\n    Container,\n    Icon,\n    Image,\n    Label,\n    Message,\n    Modal,\n    Placeholder,\n} from 'semantic-ui-react';\nimport {SyntheticEvent, useState} from 'react';\nimport {FormattedMessage} from 'react-intl';\n\ninterface Props {\n    url: string;\n    filename: string;\n    title?: string;\n}\n\nexport function WrappedImage(props: Props) {\n    const [imageOpen, setImageOpen] = useState(false);\n    const [imageLoaded, setImageLoaded] = useState(false);\n    const [imageFailed, setImageFailed] = useState(false);\n    const [imageSrc, setImageSrc] = useState('');\n\n    if (imageLoaded && imageSrc !== props.url) {\n        setImageLoaded(false);\n    }\n    return (\n        <>\n            <Image\n                className={imageLoaded ? 'loaded-image-thumbnail' : 'hidden-image'}\n                onClick={() => setImageOpen(true)}\n                onLoad={() => {\n                    setImageLoaded(true);\n                    setImageSrc(props.url);\n                    setImageFailed(false);\n                }}\n                onError={(e: SyntheticEvent<HTMLImageElement, Event>) => {\n                    setImageLoaded(true);\n                    setImageSrc(props.url);\n                    setImageFailed(true);\n                    e.currentTarget.alt = '';\n                }}\n                src={props.url}\n                alt={props.title || props.filename}\n                centered={true}\n            />\n            <Placeholder className={!imageLoaded ? 'image-placeholder' : 'hidden-image'}>\n                <Placeholder.Image square/>\n            </Placeholder>\n            {imageFailed && (\n                <Container fluid textAlign=\"center\">\n                    <Message negative compact>\n                        <Message.Header>\n                            <FormattedMessage\n                                id=\"error.failed_to_load_image\"\n                                defaultMessage={'Failed to load image file'}\n                            />\n                        </Message.Header>\n                    </Message>\n                </Container>\n            )}\n            <Modal\n                basic\n                size=\"large\"\n                closeIcon={<Icon name=\"close\" color=\"red\"/>}\n                open={imageOpen}\n                onClose={() => setImageOpen(false)}\n                onOpen={() => setImageOpen(true)}\n                centered={false}\n            >\n                <Modal.Header>{props.title}</Modal.Header>\n                <Modal.Content image>\n                    <Image\n                        className=\"modal-image\"\n                        src={props.url}\n                        alt={props.title || props.filename}\n                        label={<Label attached=\"bottom\" content={props.filename}/>}\n                        wrapped\n                    />\n                </Modal.Content>\n            </Modal>\n        </>\n    );\n}\n","import Linkify from 'react-linkify';\n\ninterface Props {\n    lines: (JSX.Element | string)[];\n}\n\nexport function MultilineText(props: Props) {\n    return (\n        <>\n            {props.lines.map((line, index) => (\n                <div key={index}>\n                    <Linkify properties={{target: '_blank'}}>{line}</Linkify>\n                    <br/>\n                </div>\n            ))}\n        </>\n    );\n}\n","import {FormattedMessage, IntlShape, useIntl} from 'react-intl';\nimport {Icon, Item, List, Menu, MenuItemProps, Popup, Tab,} from 'semantic-ui-react';\nimport * as React from 'react';\nimport {useState} from 'react';\nimport {WrappedImage} from './wrapped-image';\nimport {MultilineText} from './multiline-text';\nimport {DateOrRange} from '../lib/topola';\nimport {formatDateOrRange} from '../util/date_util';\nimport Linkify from 'react-linkify';\n\nexport interface Image {\n    url: string;\n    filename: string;\n    title?: string;\n}\n\nexport interface Source {\n    title?: string;\n    author?: string;\n    page?: string;\n    date?: DateOrRange;\n    publicationInfo?: string;\n}\n\ninterface Props {\n    images?: Image[];\n    notes?: string[][];\n    sources?: Source[];\n    indi: string;\n}\n\nfunction eventImages(images: Image[] | undefined) {\n    return (\n        !!images &&\n        images.map((image, index) => (\n            <List key={index}>\n                <List.Item>\n                    <WrappedImage\n                        url={image.url}\n                        filename={image.filename}\n                        title={image.title}\n                    />\n                </List.Item>\n            </List>\n        ))\n    );\n}\n\nfunction eventNotes(notes: string[][] | undefined) {\n    return (\n        !!notes?.length &&\n        notes.map((note, index) => (\n            <div key={index}>\n                <MultilineText\n                    lines={note.map((line, index) => (\n                        <i key={index}>{line}</i>\n                    ))}\n                />\n            </div>\n        ))\n    );\n}\n\nfunction eventSources(sources: Source[] | undefined, intl: IntlShape) {\n    return (\n        !!sources?.length && (\n            <List>\n                {sources.map((source, index) => (\n                    <List.Item key={index}>\n                        <List.Icon verticalAlign=\"middle\" name=\"circle\" size=\"tiny\"/>\n                        <List.Content>\n                            <List.Header>\n                                <Linkify properties={{target: '_blank'}}>\n                                    {[source.author, source.title, source.publicationInfo]\n                                        .filter((sourceElement) => sourceElement)\n                                        .join(', ')}\n                                </Linkify>\n                            </List.Header>\n                            <List.Description>\n                                <Linkify properties={{target: '_blank'}}>{source.page}</Linkify>\n                                {source.date\n                                    ? ' [' + formatDateOrRange(source.date, intl) + ']'\n                                    : null}\n                            </List.Description>\n                        </List.Content>\n                    </List.Item>\n                ))}\n            </List>\n        )\n    );\n}\n\nexport function EventExtras(props: Props) {\n    const intl = useIntl();\n    const [activeIndex, setActiveIndex] = useState(-1);\n    const [indi, setIndi] = useState('');\n\n    if (!indi || indi !== props.indi) {\n        setActiveIndex(-1);\n        setIndi(props.indi);\n    }\n\n    function handleTabOnClick(\n        event: React.MouseEvent<HTMLAnchorElement>,\n        menuItemProps: MenuItemProps,\n    ) {\n        menuItemProps.index !== undefined && activeIndex !== menuItemProps.index\n            ? setActiveIndex(menuItemProps.index)\n            : setActiveIndex(-1);\n    }\n\n    const imageTab = props.images?.length && {\n        menuItem: (\n            <Menu.Item fitted key=\"images\" onClick={handleTabOnClick}>\n                <Popup\n                    content={\n                        <FormattedMessage id=\"extras.images\" defaultMessage=\"Images\"/>\n                    }\n                    size=\"mini\"\n                    position=\"bottom center\"\n                    trigger={<Icon circular name=\"camera\"/>}\n                />\n            </Menu.Item>\n        ),\n        render: () => <Tab.Pane>{eventImages(props.images)}</Tab.Pane>,\n    };\n\n    const noteTab = props.notes?.length && {\n        menuItem: (\n            <Menu.Item fitted key=\"notes\" onClick={handleTabOnClick}>\n                <Popup\n                    content={\n                        <FormattedMessage id=\"extras.notes\" defaultMessage=\"Notes\"/>\n                    }\n                    size=\"mini\"\n                    position=\"bottom center\"\n                    trigger={<Icon circular name=\"sticky note outline\"/>}\n                />\n            </Menu.Item>\n        ),\n        render: () => <Tab.Pane>{eventNotes(props.notes)}</Tab.Pane>,\n    };\n\n    const sourceTab = props.sources?.length && {\n        menuItem: (\n            <Menu.Item fitted key=\"sources\" onClick={handleTabOnClick}>\n                <Popup\n                    content={\n                        <FormattedMessage id=\"extras.sources\" defaultMessage=\"Sources\"/>\n                    }\n                    size=\"mini\"\n                    position=\"bottom center\"\n                    trigger={<Icon circular name=\"quote right\"/>}\n                />\n            </Menu.Item>\n        ),\n        render: () => <Tab.Pane>{eventSources(props.sources, intl)}</Tab.Pane>,\n    };\n\n    const panes = [imageTab, noteTab, sourceTab].flatMap((tab) =>\n        tab ? [tab] : [],\n    );\n\n    if (panes.length) {\n        return (\n            <Item.Description>\n                <Tab\n                    className=\"event-extras\"\n                    activeIndex={activeIndex}\n                    renderActiveOnly={true}\n                    menu={{\n                        tabular: true,\n                        attached: true,\n                        compact: true,\n                        borderless: true,\n                    }}\n                    panes={panes}\n                />\n            </Item.Description>\n        );\n    }\n    return null;\n}\n","import * as queryString from 'query-string';\nimport flatMap from 'array.prototype.flatmap';\nimport {compareDates, formatDateOrRange} from '../util/date_util';\nimport {\n    dereference,\n    GedcomData,\n    getData,\n    getFileName,\n    getImageFileEntry,\n    getName,\n    pointerToId,\n} from '../util/gedcom_util';\nimport {GedcomEntry} from 'parse-gedcom';\nimport {FormattedMessage, useIntl} from 'react-intl';\nimport {Link, useLocation} from 'react-router-dom';\nimport {TranslatedTag} from './translated-tag';\nimport {Header, Item} from 'semantic-ui-react';\nimport {EventExtras, Image, Source} from './event-extras';\nimport {DateOrRange, getDate} from '../lib/topola';\n\nfunction PersonLink(props: { person: GedcomEntry }) {\n    const location = useLocation();\n    const name = getName(props.person);\n    const search = queryString.parse(location.search);\n    search['indi'] = pointerToId(props.person.pointer);\n    return (\n        <Item.Meta>\n            <Link to={{pathname: '/view', search: queryString.stringify(search)}}>\n                {name ? (name) : (<FormattedMessage id=\"name.unknown_name\" defaultMessage=\"N.N.\"/>)}\n            </Link>\n        </Item.Meta>\n    );\n}\n\ninterface Props {\n    gedcom: GedcomData;\n    indi: string;\n    entries: GedcomEntry[];\n}\n\ninterface EventData {\n    type: string;\n    date?: DateOrRange;\n    personLink?: GedcomEntry;\n    place?: string[];\n    images?: Image[];\n    notes?: string[][];\n    sources?: Source[];\n    indi: string;\n}\n\nconst EVENT_TAGS = [\n    'BIRT',\n    'BAPM',\n    'CHR',\n    'FAMS',\n    'EVEN',\n    'CENS',\n    'DEAT',\n    'BURI',\n];\n\nconst FAMILY_EVENT_TAGS = ['MARR', 'MARS', 'DIV'];\n\nfunction EventHeader(props: { event: EventData }) {\n    const intl = useIntl();\n    return (\n        <div className=\"event-header\">\n            <Header as=\"span\" size=\"small\">\n                <TranslatedTag tag={props.event.type}/>\n            </Header>\n            {props.event.date ? (\n                <Header as=\"span\" textAlign=\"right\" sub>\n                    {formatDateOrRange(props.event.date, intl)}\n                </Header>\n            ) : null}\n        </div>\n    );\n}\n\nfunction getSpouse(indi: string, familyEntry: GedcomEntry, gedcom: GedcomData) {\n    const spouseReference = familyEntry.tree\n        .filter((familySubEntry) => ['WIFE', 'HUSB'].includes(familySubEntry.tag))\n        .find((familySubEntry) => !familySubEntry.data.includes(indi));\n    if (!spouseReference) {\n        return undefined;\n    }\n    return dereference(spouseReference, gedcom, (gedcom) => gedcom.indis);\n}\n\nfunction eventPlace(entry: GedcomEntry) {\n    const place = entry.tree.find((subEntry) => subEntry.tag === 'PLAC');\n    return place?.data ? getData(place) : undefined;\n}\n\nfunction eventImages(entry: GedcomEntry, gedcom: GedcomData): Image[] {\n    return entry.tree\n        .filter((subEntry) => 'OBJE' === subEntry.tag)\n        .map((objectEntry) =>\n            dereference(objectEntry, gedcom, (gedcom) => gedcom.other),\n        )\n        .map((objectEntry) => getImageFileEntry(objectEntry))\n        .flatMap((imageFileEntry) =>\n            imageFileEntry ? [\n                    {\n                        url: imageFileEntry?.data || '',\n                        filename: getFileName(imageFileEntry) || '',\n                    },\n                ] : [],\n        );\n}\n\nfunction eventSources(entry: GedcomEntry, gedcom: GedcomData): Source[] {\n    return entry.tree\n        .filter((subEntry) => 'SOUR' === subEntry.tag)\n        .map((sourceEntryReference) => {\n            const sourceEntry = dereference(sourceEntryReference, gedcom, (gedcom) => gedcom.other);\n            const title = sourceEntry.tree.find((subEntry) => 'TITL' === subEntry.tag);\n            const abbr = sourceEntry.tree.find((subEntry) => 'ABBR' === subEntry.tag);\n            const author = sourceEntry.tree.find((subEntry) => 'AUTH' === subEntry.tag);\n            const publicationInfo = sourceEntry.tree.find((subEntry) => 'PUBL' === subEntry.tag);\n            const page = sourceEntryReference.tree.find((subEntry) => 'PAGE' === subEntry.tag);\n            const sourceData = sourceEntryReference.tree.find((subEntry) => 'DATA' === subEntry.tag);\n            const date = sourceData ? resolveDate(sourceData) : undefined;\n            return {\n                title: title?.data || abbr?.data,\n                author: author?.data,\n                page: page?.data,\n                date: date ? getDate(date.data) : undefined,\n                publicationInfo: publicationInfo?.data,\n            };\n        });\n}\n\nfunction eventNotes(entry: GedcomEntry, gedcom: GedcomData): string[][] {\n    return entry.tree\n        .filter((subentry) => ['NOTE', 'TYPE'].includes(subentry.tag))\n        .map((note) => dereference(note, gedcom, (gedcom) => gedcom.other))\n        .map((note) => getData(note));\n}\n\nfunction toEvent(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    indi: string,\n): EventData[] {\n    return entry.tag === 'FAMS' ? toFamilyEvents(entry, gedcom, indi) : toIndiEvent(entry, gedcom, indi);\n}\n\nfunction toIndiEvent(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    indi: string,\n): EventData[] {\n    const date = resolveDate(entry) || null;\n    return [\n        {\n            date: date ? getDate(date.data) : undefined,\n            type: entry.tag,\n            place: eventPlace(entry),\n            images: eventImages(entry, gedcom),\n            notes: eventNotes(entry, gedcom),\n            sources: eventSources(entry, gedcom),\n            indi: indi,\n        },\n    ];\n}\n\nfunction resolveDate(entry: GedcomEntry) {\n    return entry.tree.find((subEntry) => subEntry.tag === 'DATE');\n}\n\nfunction toFamilyEvents(\n    entry: GedcomEntry,\n    gedcom: GedcomData,\n    indi: string,\n): EventData[] {\n    const family = dereference(entry, gedcom, (gedcom) => gedcom.fams);\n    return flatMap(FAMILY_EVENT_TAGS, (tag) =>\n        family.tree.filter((entry) => entry.tag === tag),\n    ).map((familyMarriageEvent) => {\n        const date = resolveDate(familyMarriageEvent) || null;\n        return {\n            date: date ? getDate(date.data) : undefined,\n            type: familyMarriageEvent.tag,\n            personLink: getSpouse(indi, family, gedcom),\n            place: eventPlace(familyMarriageEvent),\n            images: eventImages(familyMarriageEvent, gedcom),\n            notes: eventNotes(familyMarriageEvent, gedcom),\n            sources: eventSources(familyMarriageEvent, gedcom),\n            indi: indi,\n        };\n    });\n}\n\nfunction Event(props: { event: EventData }) {\n    return (\n        <Item>\n            <Item.Content>\n                <EventHeader event={props.event}/>\n                {!!props.event.personLink && (<PersonLink person={props.event.personLink}/>)}\n                {!!props.event.place && (<Item.Description>{props.event.place}</Item.Description>)}\n                <EventExtras\n                    images={props.event.images}\n                    notes={props.event.notes}\n                    sources={props.event.sources}\n                    indi={props.event.indi}\n                />\n            </Item.Content>\n        </Item>\n    );\n}\n\nexport function Events(props: Props) {\n    const events = flatMap(EVENT_TAGS, (tag) =>\n        props.entries\n            .filter((entry) => entry.tag === tag)\n            .map((eventEntry) => toEvent(eventEntry, props.gedcom, props.indi))\n            .flatMap((events) => events)\n            .sort((event1, event2) => compareDates(event1.date, event2.date)),\n    );\n    if (events.length) {\n        return (\n            <>\n                {events.map((event, index) => (\n                    <Event event={event} key={index}/>\n                ))}\n            </>\n        );\n    }\n    return null;\n}\n","import flatMap from 'array.prototype.flatmap';\nimport {\n    dereference,\n    GedcomData,\n    getData,\n    getFileName,\n    getImageFileEntry\n} from '../util/gedcom_util';\nimport {Events} from './events';\nimport {GedcomEntry} from 'parse-gedcom';\nimport {MultilineText} from './multiline-text';\nimport {TranslatedTag} from './translated-tag';\nimport {Header, Item} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {WrappedImage} from './wrapped-image';\n\nconst EXCLUDED_TAGS = [\n    'BIRT',\n    'BAPM',\n    'CHR',\n    'EVEN',\n    'CENS',\n    'DEAT',\n    'BURI',\n    'NAME',\n    'SEX',\n    'FAMC',\n    'FAMS',\n    'NOTE',\n    'SOUR',\n    'LANG',\n];\n\nfunction dataDetails(entry: GedcomEntry) {\n    const lines = [];\n    if (entry.data) {\n        lines.push(...getData(entry));\n    }\n    entry.tree\n        .filter((subentry) => subentry.tag === 'NOTE')\n        .forEach((note) =>\n            getData(note).forEach((line) => lines.push(<i>{line}</i>)),\n        );\n    if (!lines.length) {\n        return null;\n    }\n    return (\n        <>\n            <Header sub>\n                <TranslatedTag tag={entry.tag}/>\n            </Header>\n            <span>\n                <MultilineText lines={lines}/>\n            </span>\n        </>\n    );\n}\n\nfunction fileDetails(objectEntry: GedcomEntry) {\n    const imageFileEntry = getImageFileEntry(objectEntry);\n    return imageFileEntry ? (\n        <div className=\"person-image\">\n            <WrappedImage\n                url={imageFileEntry.data}\n                filename={getFileName(imageFileEntry) || ''}\n            />\n        </div>\n    ) : null;\n}\n\nfunction noteDetails(entry: GedcomEntry) {\n    return (\n        <MultilineText\n            lines={getData(entry).map((line, index) => (\n                <i key={index}>{line}</i>\n            ))}\n        />\n    );\n}\n\nfunction nameDetails(entry: GedcomEntry) {\n    const fullName = entry.data.replaceAll('/', '');\n    const nameType = entry.tree.find(\n        (entry) => entry.tag === 'TYPE' && entry.data !== 'Unknown',\n    )?.data;\n    return (\n        <>\n            <Header as=\"span\" size=\"large\">\n                {fullName ? (\n                    fullName\n                ) : (\n                    <FormattedMessage id=\"name.unknown_name\" defaultMessage=\"N.N.\"/>\n                )}\n            </Header>\n            {fullName && nameType && (\n                <Item.Meta>\n                    <TranslatedTag tag={nameType}/>\n                </Item.Meta>\n            )}\n        </>\n    );\n}\n\nfunction getDetails(\n    entries: GedcomEntry[],\n    tags: string[],\n    detailsFunction: (entry: GedcomEntry) => JSX.Element | null,\n): JSX.Element[] {\n    return flatMap(tags, (tag) =>\n        entries\n            .filter((entry) => entry.tag === tag)\n            .map((entry) => detailsFunction(entry)),\n    )\n        .filter((element) => element !== null)\n        .map((element, index) => (\n            <Item key={index}>\n                <Item.Content>{element}</Item.Content>\n            </Item>\n        ));\n}\n\n/**\n * Returns true if there is displayable information in this entry.\n * Returns false if there is no data in this entry or this is only a reference\n * to another entry.\n */\nfunction hasData(entry: GedcomEntry) {\n    return entry.tree.length > 0 || (entry.data && !entry.data.startsWith('@'));\n}\n\nfunction getOtherDetails(entries: GedcomEntry[]) {\n    return entries\n        .filter((entry) => !EXCLUDED_TAGS.includes(entry.tag))\n        .filter(hasData)\n        .map((entry) => dataDetails(entry))\n        .filter((element) => element !== null)\n        .map((element, index) => (\n            <Item key={index}>\n                <Item.Content>{element}</Item.Content>\n            </Item>\n        ));\n}\n\nfunction getMultilineDetails(\n    entries: GedcomEntry[],\n    tags: string[],\n    title: [string, string],\n) {\n    const lines= entries\n        .filter((entry) => tags.includes(entry.tag))\n        .filter(hasData)\n        .map((element) => element.data)\n    if (!lines.length) {\n        return null;\n    }\n    return (\n        <Item key=\"languages\">\n            <Item.Content>\n                <Header as=\"span\">\n                    <FormattedMessage id={title[0]} defaultMessage={title[1]}/>\n                </Header>\n                <span>\n                    <MultilineText lines={lines}/>\n                </span>\n            </Item.Content>\n        </Item>\n    );\n}\n\ninterface Props {\n    gedcom: GedcomData;\n    indi: string;\n}\n\nexport function Details(props: Props) {\n    const entries = props.gedcom.indis[props.indi].tree;\n    const entriesWithData = entries\n        .map((entry) => dereference(entry, props.gedcom, (gedcom) => gedcom.other))\n        .filter(hasData);\n\n    return (\n        <div className=\"details\">\n            <Item.Group divided>\n                {getDetails(entries, ['NAME'], nameDetails)}\n                {getDetails(entriesWithData, ['OBJE'], fileDetails)}\n                <Events gedcom={props.gedcom} entries={entries} indi={props.indi}/>\n                {getMultilineDetails(entriesWithData, ['LANG'], ['gedcom.languages', 'Languages'])}\n                {getOtherDetails(entriesWithData)}\n                {getDetails(entriesWithData, ['NOTE'], noteDetails)}\n            </Item.Group>\n        </div>\n    );\n}\n","import {DataSource, DataSourceEnum, SourceSelection} from './data_source';\nimport {TopolaData} from '../util/gedcom_util';\nimport {loadGedcom} from './load_data';\nimport {Language} from \"../languages/languages-loader\";\n\n/**\n * Message types used in embedded mode.\n * When the parent is ready to receive messages, it sends PARENT_READY.\n * When the child (this app) is ready to receive messages, it sends READY.\n * When the child receives PARENT_READY, it sends READY.\n * When the parent receives READY, it sends data in a GEDCOM message.\n */\nenum EmbeddedMessageType {\n    GEDCOM = 'gedcom',\n    READY = 'ready',\n    PARENT_READY = 'parent_ready',\n}\n\n/** Message sent to parent or received from parent in embedded mode. */\ninterface EmbeddedMessage {\n    message: EmbeddedMessageType;\n}\n\ninterface GedcomMessage extends EmbeddedMessage {\n    message: EmbeddedMessageType.GEDCOM;\n    gedcom?: string;\n    allLanguages?: Language[]\n}\n\nexport interface EmbeddedSourceSpec {\n    source: DataSourceEnum.EMBEDDED;\n}\n\n/** GEDCOM file received from outside the iframe. */\nexport class EmbeddedDataSource implements DataSource<EmbeddedSourceSpec> {\n    isNewData(\n        newSource: SourceSelection<EmbeddedSourceSpec>,\n        oldSource: SourceSelection<EmbeddedSourceSpec>,\n        data?: TopolaData,\n    ): boolean {\n        // Never reload data.\n        return false;\n    }\n\n    private async onMessage(\n        message: EmbeddedMessage,\n        resolve: (value: TopolaData) => void,\n        reject: (reason: any) => void,\n    ) {\n        if (message.message === EmbeddedMessageType.PARENT_READY) {\n            // Parent didn't receive the first 'ready' message, so we need to send it again.\n            window.parent.postMessage({message: EmbeddedMessageType.READY}, '*');\n        } else if (message.message === EmbeddedMessageType.GEDCOM) {\n            const gedcom = (message as GedcomMessage).gedcom;\n            const allLanguages = (message as GedcomMessage).allLanguages;\n            if (!gedcom || !allLanguages) {\n                return;\n            }\n            try {\n                const data = await loadGedcom('', gedcom, allLanguages);\n                resolve(data);\n            } catch (error) {\n                reject(error);\n            }\n        }\n    }\n\n    async loadData(source: SourceSelection<EmbeddedSourceSpec>): Promise<TopolaData> {\n        // Notify the parent window that we are ready.\n        return new Promise<TopolaData>((resolve, reject) => {\n            window.parent.postMessage({message: EmbeddedMessageType.READY}, '*');\n            window.addEventListener('message', (data) =>\n                this.onMessage(data.data, resolve, reject),\n            );\n        });\n    }\n}\n","import {IntlShape} from 'react-intl';\nimport {TopolaError} from './error';\n\n/**\n * Returns a translated message for the given error. If the message can't be\n * translated, the original error.message is returned.\n */\nexport function getI18nMessage(error: Error, intl: IntlShape): string {\n    if (!(error instanceof TopolaError)) {\n        return error.message;\n    }\n    return intl.formatMessage(\n        {\n            id: `error.${error.code}`,\n            defaultMessage: error.message,\n        },\n        error.args,\n    );\n}\n","import {\n    Menu,\n    Dropdown,\n    MenuItemProps,\n    DropdownItemProps,\n} from 'semantic-ui-react';\n\nexport enum MenuType {\n    Menu,\n    Dropdown,\n}\n\ninterface Props {\n    menuType?: MenuType;\n}\n\nexport function MenuItem(props: Props & MenuItemProps & DropdownItemProps) {\n    const newProps = {...props};\n    // Remove menuType from props to avoid error message in the console.\n    delete newProps.menuType;\n    return (\n        <>\n            {props.menuType === MenuType.Menu ? (\n                <Menu.Item {...newProps}>{props.children}</Menu.Item>\n            ) : (\n                <Dropdown.Item {...newProps}>{props.children}</Dropdown.Item>\n            )}\n        </>\n    );\n}\n","import {createMedia} from '@artsy/fresnel';\n\n/** Defines the breakpoints at which to show different UI variants.*/\nconst AppMedia = createMedia({\n    breakpoints: {\n        small: 320,\n        large: 768,\n    },\n});\nexport const mediaStyles = AppMedia.createMediaStyle();\nexport const {Media, MediaContextProvider} = AppMedia;\n","import lunr, {PipelineFunction} from 'lunr';\nimport naturalSort from 'javascript-natural-sort';\nimport {idToFamMap, idToIndiMap} from '../util/gedcom_util';\nimport {JsonFam, JsonGedcomData, JsonIndi} from '../lib/topola';\n\nrequire('lunr-languages/lunr.stemmer.support')(lunr);\nrequire('lunr-languages/lunr.de')(lunr);\nrequire('lunr-languages/lunr.fr')(lunr);\nrequire('lunr-languages/lunr.it')(lunr);\nrequire('lunr-languages/lunr.ru')(lunr);\n\nconst MAX_RESULTS = 8;\n\nexport interface SearchResult {\n    id: string;\n    indi: JsonIndi;\n}\n\nexport interface SearchIndex {\n    search(input: string): SearchResult[];\n}\n\n/** Removes accents from letters, e.g. ->o, ->e. */\nfunction normalize(input: string) {\n    return input\n        .toLocaleLowerCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .replace(/\\u0142/g, 'l'); // Special case:  is not affected by NFD.\n}\n\n/** Comparator to sort by score first, then by id. */\nfunction compare(a: lunr.Index.Result, b: lunr.Index.Result) {\n    if (a.score !== b.score) {\n        return b.score - a.score;\n    }\n    return naturalSort(a.ref, b.ref);\n}\n\n/** Returns all last names of all husbands as a space-separated string. */\nfunction getHusbandLastName(\n    indi: JsonIndi,\n    indiMap: Map<String, JsonIndi>,\n    famMap: Map<string, JsonFam>,\n): string {\n    return (indi.fams || [])\n        .map((famId) => famMap.get(famId))\n        .map((fam) => fam && fam.husb)\n        .map((husbId) => husbId && indiMap.get(husbId))\n        .map((husband) => husband && husband.lastName)\n        .join(' ');\n}\n\nclass LunrSearchIndex implements SearchIndex {\n    private index: lunr.Index | undefined;\n    private indiMap: Map<string, JsonIndi>;\n    private famMap: Map<string, JsonFam>;\n\n    constructor(data: JsonGedcomData) {\n        this.indiMap = idToIndiMap(data);\n        this.famMap = idToFamMap(data);\n    }\n\n    initialize() {\n        const self = this;\n        this.index = lunr(function () {\n            //Trimmer will break non-latin characters, so custom multilingual implementation must be used\n            self.initMultiLingualLunrWithoutTrimmer(this, [\n                'de',\n                'en',\n                'fr',\n                'it',\n                'ru',\n            ]);\n            this.ref('id');\n            this.field('id');\n            this.field('name', {boost: 10});\n            this.field('normalizedName', {boost: 8});\n            this.field('spouseLastName', {boost: 2});\n            this.field('normalizedSpouseLastName', {boost: 2});\n\n            self.indiMap.forEach((indi) => {\n                const name = [indi.firstName, indi.lastName].join(' ');\n                const spouseLastName = getHusbandLastName(\n                    indi,\n                    self.indiMap,\n                    self.famMap,\n                );\n                this.add({\n                    id: indi.id,\n                    name,\n                    normalizedName: normalize(name),\n                    spouseLastName,\n                    normalizedSpouseLastName: normalize(spouseLastName),\n                });\n            });\n        });\n    }\n\n    private initMultiLingualLunrWithoutTrimmer(\n        lunrInstance: any,\n        languages: string[],\n    ): void {\n        let wordCharacters = '';\n        const pipelineFunctions: PipelineFunction[] = [];\n        const searchPipelineFunctions: PipelineFunction[] = [];\n        languages.forEach((language) => {\n            if (language === 'en') {\n                wordCharacters += '\\\\w';\n                pipelineFunctions.unshift(lunr.stopWordFilter);\n                pipelineFunctions.push(lunr.stemmer);\n                searchPipelineFunctions.push(lunr.stemmer);\n            } else {\n                wordCharacters += lunr[language].wordCharacters;\n                if (lunr[language].stopWordFilter) {\n                    pipelineFunctions.unshift(lunr[language].stopWordFilter);\n                }\n                if (lunr[language].stemmer) {\n                    pipelineFunctions.push(lunr[language].stemmer);\n                    searchPipelineFunctions.push(lunr[language].stemmer);\n                }\n            }\n        });\n        lunrInstance.pipeline.reset();\n        lunrInstance.pipeline.add.apply(lunrInstance.pipeline, pipelineFunctions);\n\n        if (lunrInstance.searchPipeline) {\n            lunrInstance.searchPipeline.reset();\n            lunrInstance.searchPipeline.add.apply(\n                lunrInstance.searchPipeline,\n                searchPipelineFunctions,\n            );\n        }\n    }\n\n    public search(input: string): SearchResult[] {\n        const query = input\n            .split(' ')\n            .filter((s) => !!s)\n            .map((s) => `${s} ${s}*`)\n            .join(' ');\n        const results = this.index!.search(query);\n        return results\n            .sort(compare)\n            .slice(0, MAX_RESULTS)\n            .map((result) => ({id: result.ref, indi: this.indiMap.get(result.ref)!}));\n    }\n}\n\n/** Builds a search index from data. */\nexport function buildSearchIndex(data: JsonGedcomData): SearchIndex {\n    const index = new LunrSearchIndex(data);\n    index.initialize();\n    return index;\n}\n","import debounce from 'debounce';\nimport {buildSearchIndex, SearchIndex, SearchResult} from './search_index';\nimport {formatDateOrRange} from '../util/date_util';\nimport {IndiInfo, JsonGedcomData, JsonIndi} from '../lib/topola';\nimport {Search, SearchResultProps} from 'semantic-ui-react';\nimport {useEffect, useRef, useState} from 'react';\nimport {useIntl} from 'react-intl';\n\nfunction getNameLine(result: SearchResult) {\n    const name = [result.indi.firstName, result.indi.lastName].join(' ').trim();\n    if (result.id.length > 8) {\n        return name;\n    }\n    return (\n        <>\n            {name} <i>({result.id})</i>\n        </>\n    );\n}\n\ninterface Props {\n    /** Data used for the search index. */\n    data: JsonGedcomData;\n    onSelection: (indiInfo: IndiInfo) => void;\n}\n\n/** Displays and handles the search box in the top bar. */\nexport function SearchBar(props: Props) {\n    const [searchResults, setSearchResults] = useState<SearchResultProps[]>([]);\n    const [searchString, setSearchString] = useState('');\n    const searchIndex = useRef<SearchIndex>();\n    const intl = useIntl();\n\n    function getDescriptionLine(indi: JsonIndi) {\n        const birthDate = formatDateOrRange(indi.birth, intl);\n        const deathDate = formatDateOrRange(indi.death, intl);\n        if (!deathDate) {\n            return birthDate;\n        }\n        return `${birthDate}  ${deathDate}`;\n    }\n\n    /** Produces an object that is displayed in the Semantic UI Search results. */\n    function displaySearchResult(result: SearchResult): SearchResultProps {\n        return {\n            id: result.id,\n            key: result.id,\n            title: getNameLine(result),\n            description: getDescriptionLine(result.indi),\n        } as SearchResultProps;\n    }\n\n    /** On search input change. */\n    function handleSearch(input: string | undefined) {\n        if (!input) {\n            return;\n        }\n        const results = searchIndex\n            .current!.search(input)\n            .map((result) => displaySearchResult(result));\n        setSearchResults(results);\n    }\n\n    const debouncedHandleSearch = useRef(debounce(handleSearch, 200));\n\n    /** On search result selected. */\n    function handleResultSelect(id: string) {\n        props.onSelection({id, generation: 0});\n        setSearchString('');\n    }\n\n    /** On search string changed. */\n    function onChange(value: string) {\n        debouncedHandleSearch.current(value);\n        setSearchString(value);\n    }\n\n    // Initialize the search index.\n    useEffect(() => {\n        searchIndex.current = buildSearchIndex(props.data);\n    }, [props.data]);\n\n    return (\n        <Search\n            onSearchChange={(_, data) => onChange(data.value!)}\n            onResultSelect={(_, data) => handleResultSelect(data.result.id)}\n            results={searchResults}\n            noResultsMessage={intl.formatMessage({\n                id: 'menu.search.no_results',\n                defaultMessage: 'No results found',\n            })}\n            placeholder={intl.formatMessage({\n                id: 'menu.search.placeholder',\n                defaultMessage: 'Search for people',\n            })}\n            selectFirstResult={true}\n            value={searchString}\n            id=\"search\"\n        />\n    );\n}\n","import * as queryString from 'query-string';\nimport md5 from 'md5';\nimport {Dropdown, Icon, Menu} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {MenuType} from './menu_item';\nimport {SyntheticEvent} from 'react';\nimport {useHistory, useLocation} from 'react-router';\nimport {loadFile} from '../datasource/load_data';\n\nfunction isImageFileName(fileName: string) {\n    const lower = fileName.toLowerCase();\n    return lower.endsWith('.jpg') || lower.endsWith('.png');\n}\n\ninterface Props {\n    menuType: MenuType;\n}\n\n/** Displays and handles the \"Open file\" menu. */\nexport function UploadMenu(props: Props) {\n    const history = useHistory();\n    const location = useLocation();\n\n    async function handleUpload(event: SyntheticEvent<HTMLInputElement>) {\n        const files = (event.target as HTMLInputElement).files;\n        if (!files || !files.length) {\n            return;\n        }\n        const filesArray = Array.from(files);\n        (event.target as HTMLInputElement).value = ''; // Reset the file input.\n\n        const gedcomFile =\n            filesArray.length === 1\n                ? filesArray[0]\n                : filesArray.find((file) => file.name.toLowerCase().endsWith('.ged')) ||\n                filesArray[0];\n        const {gedcom, images} = await loadFile(gedcomFile);\n\n        // Convert uploaded images to object URLs.\n        filesArray\n            .filter((file) => file.name !== gedcomFile.name && isImageFileName(file.name))\n            .forEach((file) => images.set(file.name, URL.createObjectURL(file)));\n\n        // Hash GEDCOM contents with uploaded image file names.\n        const imageFileNames = Array.from(images.keys()).sort().join('|');\n        const hash = md5(md5(gedcom) + imageFileNames);\n\n        // Use history.replace() when re-uploading the same file and history.push() when loading a new file.\n        const search = queryString.parse(location.search);\n        const historyPush = search.file === hash ? history.replace : history.push;\n\n        historyPush({\n            pathname: '/view',\n            search: queryString.stringify({file: hash}),\n            state: {data: gedcom, images},\n        });\n    }\n\n    const content = (\n        <>\n            <Icon name=\"folder open\"/>\n            <FormattedMessage id=\"menu.open_file\" defaultMessage=\"Open file\"/>\n        </>\n    );\n    return (\n        <>\n            {props.menuType === MenuType.Menu ? (\n                <label htmlFor=\"fileInput\">\n                    <Menu.Item as=\"a\">{content}</Menu.Item>\n                </label>\n            ) : (\n                <Dropdown.Item as=\"label\" htmlFor=\"fileInput\">\n                    {content}\n                </Dropdown.Item>\n            )}\n            <input\n                className=\"hidden\"\n                type=\"file\"\n                accept=\".ged,.gdz,.gedzip,.zip,image/*\"\n                id=\"fileInput\"\n                multiple\n                onChange={handleUpload}\n            />\n        </>\n    );\n}\n","import {Dropdown, Icon, Menu} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {Media} from '../util/media';\nimport {MenuType} from './menu_item';\nimport {SearchBar} from './search';\nimport {UploadMenu} from './upload_menu';\nimport {UrlMenu} from './url_menu';\nimport {useHistory, useLocation} from 'react-router';\nimport {IndiInfo, JsonGedcomData} from '../lib/topola';\n\nenum ScreenSize {\n    LARGE,\n    SMALL,\n}\n\ninterface EventHandlers {\n    onSelection: (indiInfo: IndiInfo) => void;\n    onDownloadPdf: () => void;\n    onDownloadPng: () => void;\n    onDownloadSvg: () => void;\n    onCenterView: () => void;\n}\n\ninterface Props {\n    /** True if the application is currently showing a chart. */\n    showingChart: boolean;\n    /** Data used for the search index. */\n    data?: JsonGedcomData;\n    standalone: boolean;\n    eventHandlers: EventHandlers;\n}\n\nexport function TopBar(props: Props) {\n    useHistory();\n    useLocation();\n    function chartMenus(screenSize: ScreenSize) {\n        if (!props.showingChart) {\n            return null;\n        }\n        switch (screenSize) {\n            case ScreenSize.LARGE:\n                return (\n                    <>\n                        <Dropdown\n                            trigger={\n                                <div>\n                                    <Icon name=\"download\"/>\n                                    <FormattedMessage id=\"menu.download\" defaultMessage=\"Download\"/>\n                                </div>\n                            }\n                            className=\"item\"\n                        >\n                            <Dropdown.Menu>\n                                <Dropdown.Item onClick={props.eventHandlers.onDownloadPdf}>\n                                    <FormattedMessage id=\"menu.pdf_file\" defaultMessage=\"PDF file\"/>\n                                </Dropdown.Item>\n                                <Dropdown.Item onClick={props.eventHandlers.onDownloadPng}>\n                                    <FormattedMessage id=\"menu.png_file\" defaultMessage=\"PNG file\"/>\n                                </Dropdown.Item>\n                                <Dropdown.Item onClick={props.eventHandlers.onDownloadSvg}>\n                                    <FormattedMessage id=\"menu.svg_file\" defaultMessage=\"SVG file\"/>\n                                </Dropdown.Item>\n                            </Dropdown.Menu>\n                        </Dropdown>\n\n                        <Menu.Item onClick={props.eventHandlers.onCenterView}>\n                            <Icon name=\"eye\" />\n                            <FormattedMessage id=\"menu.view\" defaultMessage=\"Center view\" />\n                        </Menu.Item>\n\n                        <Menu.Menu position=\"right\">\n                            <SearchBar\n                                data={props.data!}\n                                onSelection={props.eventHandlers.onSelection}\n                                {...props}\n                            />\n                        </Menu.Menu>\n                    </>\n                );\n\n            case ScreenSize.SMALL:\n                return (\n                    <>\n                        <Dropdown.Item onClick={props.eventHandlers.onDownloadPdf}>\n                            <Icon name=\"download\"/>\n                            <FormattedMessage id=\"menu.download_pdf\" defaultMessage=\"Download PDF\"/>\n                        </Dropdown.Item>\n                        <Dropdown.Item onClick={props.eventHandlers.onDownloadPng}>\n                            <Icon name=\"download\"/>\n                            <FormattedMessage id=\"menu.download_png\" defaultMessage=\"Download PNG\"/>\n                        </Dropdown.Item>\n                        <Dropdown.Item onClick={props.eventHandlers.onDownloadSvg}>\n                            <Icon name=\"download\"/>\n                            <FormattedMessage id=\"menu.download_svg\" defaultMessage=\"Download SVG\"/>\n                        </Dropdown.Item>\n                        <Dropdown.Divider/>\n                    </>\n                );\n        }\n    }\n\n    function fileMenus(screenSize: ScreenSize) {\n        // Don't show \"open\" menus in non-standalone mode.\n        if (!props.standalone) {\n            return null;\n        }\n\n        switch (screenSize) {\n            case ScreenSize.LARGE:\n                // Show dropdown if chart is shown, otherwise show individual menu items.\n                return props.showingChart ? (\n                    <>\n                        <UploadMenu menuType={MenuType.Menu} {...props} />\n                        {/*<UrlMenu menuType={MenuType.Menu} {...props} />*/}\n                    </>\n                ) : (\n                    <Dropdown\n                        trigger={\n                            <div>\n                                <Icon name=\"folder open\"/>\n                                <FormattedMessage id=\"menu.open\" defaultMessage=\"Open\"/>\n                            </div>\n                        }\n                        className=\"item\"\n                    >\n                        <Dropdown.Menu>\n                            <UploadMenu menuType={MenuType.Dropdown} {...props} />\n                            <UrlMenu menuType={MenuType.Dropdown} {...props} />\n                        </Dropdown.Menu>\n                    </Dropdown>\n                );\n\n            case ScreenSize.SMALL:\n                return (\n                    <>\n                        <UploadMenu menuType={MenuType.Dropdown} {...props} />\n                        {/*<UrlMenu menuType={MenuType.Dropdown} {...props} />*/}\n                        <Dropdown.Divider/>\n                    </>\n                );\n        }\n    }\n\n    function mobileMenus() {\n        return (\n            <>\n                <Dropdown\n                    trigger={\n                        <div>\n                            <Icon name=\"sidebar\"/>\n                        </div>\n                    }\n                    className=\"item\"\n                    icon={null}\n                >\n                    <Dropdown.Menu>\n                        {fileMenus(ScreenSize.SMALL)}\n                        {chartMenus(ScreenSize.SMALL)}\n                    </Dropdown.Menu>\n                </Dropdown>\n            </>\n        );\n    }\n\n    function desktopMenus() {\n        return (\n            <>\n                {fileMenus(ScreenSize.LARGE)}\n                {chartMenus(ScreenSize.LARGE)}\n            </>\n        );\n    }\n\n    return (\n        <>\n            <Menu\n                as={Media}\n                greaterThanOrEqual=\"large\"\n                attached=\"top\"\n                inverted\n                color=\"blue\"\n                size=\"large\"\n            >\n                {desktopMenus()}\n            </Menu>\n            <Menu\n                as={Media}\n                at=\"small\"\n                attached=\"top\"\n                inverted\n                color=\"blue\"\n                size=\"large\"\n            >\n                {mobileMenus()}\n            </Menu>\n        </>\n    );\n}\n","import * as queryString from 'query-string';\nimport {Button, Form, Header, Icon, Input, Modal} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {MenuItem, MenuType} from './menu_item';\nimport {useEffect, useRef, useState} from 'react';\nimport {useHistory} from 'react-router';\n\ninterface Props {\n    menuType: MenuType;\n}\n\n/** Displays and handles the \"Open URL\" menu. */\nexport function UrlMenu(props: Props) {\n    const [dialogOpen, setDialogOpen] = useState(false);\n    const [url, setUrl] = useState('');\n    const inputRef = useRef<Input>(null);\n    const history = useHistory();\n\n    useEffect(() => {\n        if (dialogOpen) {\n            setUrl('');\n            inputRef.current!.focus();\n        }\n    }, [dialogOpen]);\n\n    /** Load button clicked in the \"Load from URL\" dialog. */\n    function handleLoad() {\n        setDialogOpen(false);\n        if (url) {\n            history.push({\n                pathname: '/view',\n                search: queryString.stringify({url}),\n            });\n        }\n    }\n\n    function loadFromUrlModal() {\n        return (\n            <Modal\n                open={dialogOpen}\n                onClose={() => setDialogOpen(false)}\n                centered={false}\n            >\n                <Header>\n                    <Icon name=\"cloud download\"/>\n                    <FormattedMessage\n                        id=\"load_from_url.title\"\n                        defaultMessage=\"Load from URL\"\n                    />\n                </Header>\n                <Modal.Content>\n                    <Form onSubmit={handleLoad}>\n                        <Input\n                            placeholder=\"https://\"\n                            fluid\n                            value={url}\n                            onChange={(_, data) => setUrl(data.value)}\n                            ref={inputRef}\n                        />\n                        <p>\n                            <FormattedMessage\n                                id=\"load_from_url.comment\"\n                                defaultMessage={\n                                    'Data from the URL will be loaded through {link} to avoid CORS issues.'\n                                }\n                                values={{\n                                    link: (\n                                        <a href=\"https://topolaproxy.bieda.it/\">\n                                            topolaproxy.bieda.it (cors-anywhere proxy)\n                                        </a>\n                                    ),\n                                }}\n                            />\n                        </p>\n                    </Form>\n                </Modal.Content>\n                <Modal.Actions>\n                    <Button secondary onClick={() => setDialogOpen(false)}>\n                        <FormattedMessage\n                            id=\"load_from_url.cancel\"\n                            defaultMessage=\"Cancel\"\n                        />\n                    </Button>\n                    <Button primary onClick={handleLoad}>\n                        <FormattedMessage id=\"load_from_url.load\" defaultMessage=\"Load\"/>\n                    </Button>\n                </Modal.Actions>\n            </Modal>\n        );\n    }\n\n    return (\n        <>\n            <MenuItem onClick={() => setDialogOpen(true)} menuType={props.menuType}>\n                <Icon name=\"cloud download\"/>\n                <FormattedMessage\n                    id=\"menu.load_from_url\"\n                    defaultMessage=\"Load from URL\"\n                />\n            </MenuItem>\n            {loadFromUrlModal()}\n        </>\n    );\n}\n","import {Item, Checkbox, Form, Header} from 'semantic-ui-react';\nimport {FormattedMessage} from 'react-intl';\nimport {ParsedQuery} from 'query-string';\nimport {Language} from \"./languages/languages-loader\";\n\nexport enum ChartColors {\n    NO_COLOR,\n    COLOR_BY_SEX,\n    COLOR_BY_GENERATION,\n    COLOR_BY_TRIBE,\n    COLOR_BY_NR_LANGUAGES = 4,\n    COLOR_BY_LANGUAGE = 5,\n}\n\nexport enum LanguagesArg {\n    HIDE,\n    SHOW,\n}\n\nexport enum TribeArg {\n    HIDE,\n    SHOW,\n}\n\nexport enum IdsArg {\n    HIDE,\n    SHOW,\n}\n\nexport enum SexArg {\n    HIDE,\n    SHOW,\n}\n\nexport interface Config {\n    color: ChartColors;\n    languages: LanguagesArg;\n    tribe: TribeArg;\n    id: IdsArg;\n    sex: SexArg;\n    renderLanguagesOption: boolean\n    renderTribeOption: boolean\n    languageOptions: Language[],\n    selectedLanguage: string | null\n}\n\nexport const DEFAULT_CONFIG: Config = {\n    color: ChartColors.COLOR_BY_GENERATION,\n    languages: LanguagesArg.HIDE,\n    tribe: TribeArg.HIDE,\n    id: IdsArg.SHOW,\n    sex: SexArg.SHOW,\n    renderLanguagesOption: false,\n    renderTribeOption: false,\n    languageOptions: [],\n    selectedLanguage: null,\n};\n\nconst COLOR_ARG = new Map<string, ChartColors>([\n    ['n', ChartColors.NO_COLOR],\n    ['g', ChartColors.COLOR_BY_GENERATION],\n    ['s', ChartColors.COLOR_BY_SEX],\n    ['t', ChartColors.COLOR_BY_TRIBE],\n    ['nl', ChartColors.COLOR_BY_NR_LANGUAGES],\n    ['l', ChartColors.COLOR_BY_LANGUAGE],\n]);\nconst COLOR_ARG_INVERSE = new Map<ChartColors, string>();\nCOLOR_ARG.forEach((v, k) => COLOR_ARG_INVERSE.set(v, k));\n\nconst LANGUAGES_ARG = new Map<string, LanguagesArg>([\n    ['h', LanguagesArg.HIDE],\n    ['s', LanguagesArg.SHOW],\n]);\nconst LANGUAGES_ARG_INVERSE = new Map<LanguagesArg, string>();\nLANGUAGES_ARG.forEach((v, k) => LANGUAGES_ARG_INVERSE.set(v, k));\n\nconst TRIBE_ARG = new Map<string, TribeArg>([\n    ['h', TribeArg.HIDE],\n    ['s', TribeArg.SHOW],\n]);\nconst TRIBE_ARG_INVERSE = new Map<TribeArg, string>();\nTRIBE_ARG.forEach((v, k) => TRIBE_ARG_INVERSE.set(v, k));\n\nconst ID_ARG = new Map<string, IdsArg>([\n    ['h', IdsArg.HIDE],\n    ['s', IdsArg.SHOW],\n]);\nconst ID_ARG_INVERSE = new Map<IdsArg, string>();\nID_ARG.forEach((v, k) => ID_ARG_INVERSE.set(v, k));\n\nconst SEX_ARG = new Map<string, SexArg>([\n    ['h', SexArg.HIDE],\n    ['s', SexArg.SHOW],\n]);\nconst SEX_ARG_INVERSE = new Map<SexArg, string>();\nSEX_ARG.forEach((v, k) => SEX_ARG_INVERSE.set(v, k));\n\nexport function argsToConfig(args: ParsedQuery<any>): Config {\n    const getParam = (name: string) => {\n        return typeof args[name] === 'string' || typeof args[name] === 'number' ? args[name] : undefined;\n    };\n    return {\n        color: COLOR_ARG.get(getParam('c') ?? '') ?? DEFAULT_CONFIG.color,\n        languages: LANGUAGES_ARG.get(getParam('l') ?? '') ?? DEFAULT_CONFIG.languages,\n        selectedLanguage: getParam('n') ?? DEFAULT_CONFIG.selectedLanguage,\n        tribe: TRIBE_ARG.get(getParam('t') ?? '') ?? DEFAULT_CONFIG.tribe,\n        id: ID_ARG.get(getParam('i') ?? '') ?? DEFAULT_CONFIG.id,\n        sex: SEX_ARG.get(getParam('s') ?? '') ?? DEFAULT_CONFIG.sex,\n        renderTribeOption: DEFAULT_CONFIG.renderTribeOption,\n        renderLanguagesOption: DEFAULT_CONFIG.renderLanguagesOption,\n        languageOptions: DEFAULT_CONFIG.languageOptions\n    };\n}\n\nexport function configToArgs(config: Config): ParsedQuery<any> {\n    return {\n        c: COLOR_ARG_INVERSE.get(config.color),\n        l: LANGUAGES_ARG_INVERSE.get(config.languages),\n        t: TRIBE_ARG_INVERSE.get(config.tribe),\n        i: ID_ARG_INVERSE.get(config.id),\n        s: SEX_ARG_INVERSE.get(config.sex),\n        n: config.selectedLanguage\n    };\n}\n\nexport function ConfigPanel(props: {config: Config; onChange: (config: Config) => void}) {\n    const languageOptions = [];\n    for (let i = 0; i < props.config.languageOptions.length; i++) {\n        const language = props.config.languageOptions[i];\n        languageOptions.push(\n            <Form.Field key={i} className={!props.config.renderLanguagesOption ? 'hidden' : 'no-margin suboption'}>\n                <Checkbox\n                    radio\n                    label={language.name}\n                    name=\"checkboxRadioGroup\"\n                    value={i}\n                    checked={props.config.selectedLanguage === language.id}\n                    onClick={\n                        () => props.onChange({\n                            ...props.config,\n                            selectedLanguage: language.id,\n                            color: ChartColors.COLOR_BY_LANGUAGE,\n                            languages: LanguagesArg.SHOW,\n                        })\n                    }\n                />\n            </Form.Field>\n        );\n    }\n    return (\n        <Form className=\"details no-border-bottom\">\n            <Item.Group>\n                <Item>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.colors\" defaultMessage=\"Colors\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.NO_COLOR\" defaultMessage=\"none\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"none\"\n                                checked={props.config.color === ChartColors.NO_COLOR}\n                                onClick={\n                                    () => props.onChange({\n                                        ...props.config,\n                                        color: ChartColors.NO_COLOR,\n                                        languages: LanguagesArg.HIDE,\n                                        tribe: TribeArg.HIDE,\n                                        selectedLanguage: null\n                                    })\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_GENERATION\" defaultMessage=\"by generation\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"generation\"\n                                checked={props.config.color === ChartColors.COLOR_BY_GENERATION}\n                                onClick={\n                                    () => props.onChange({\n                                        ...props.config,\n                                        color: ChartColors.COLOR_BY_GENERATION,\n                                        languages: LanguagesArg.HIDE,\n                                        tribe: TribeArg.HIDE,\n                                        selectedLanguage: null,\n                                    })\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_SEX\" defaultMessage=\"by sex\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"gender\"\n                                checked={props.config.color === ChartColors.COLOR_BY_SEX}\n                                onClick={\n                                    () => props.onChange({\n                                        ...props.config,\n                                        color: ChartColors.COLOR_BY_SEX,\n                                        languages: LanguagesArg.HIDE,\n                                        tribe: TribeArg.HIDE,\n                                        selectedLanguage: null,\n                                    })\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className={!props.config.renderTribeOption ? 'hidden' : 'no-margin'}>\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_TRIBE\" defaultMessage=\"by tribe\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"tribe\"\n                                checked={props.config.color === ChartColors.COLOR_BY_TRIBE}\n                                onClick={\n                                    () => props.onChange({\n                                        ...props.config,\n                                        color: ChartColors.COLOR_BY_TRIBE,\n                                        languages: LanguagesArg.HIDE,\n                                        tribe: TribeArg.SHOW,\n                                        selectedLanguage: null,\n                                    })\n                                }\n                            />\n                        </Form.Field>\n                        <Form.Field className={!props.config.renderLanguagesOption ? 'hidden' : 'no-margin'}>\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.colors.COLOR_BY_LANGUAGES\" defaultMessage=\"by languages\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"languages\"\n                                checked={props.config.color === ChartColors.COLOR_BY_NR_LANGUAGES}\n                                onClick={\n                                    () => props.onChange({\n                                        ...props.config,\n                                        color: ChartColors.COLOR_BY_NR_LANGUAGES,\n                                        languages: LanguagesArg.SHOW,\n                                        tribe: TribeArg.HIDE,\n                                        selectedLanguage: null,\n                                    })\n                                }\n                            />\n                        </Form.Field>\n                        {languageOptions}\n                    </Item.Content>\n                </Item>\n\n                <Item className={!props.config.renderLanguagesOption ? 'hidden' : ''}>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.languages\" defaultMessage=\"Languages\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.toggle.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.languages === LanguagesArg.HIDE}\n                                onClick={() => props.onChange({...props.config, languages: LanguagesArg.HIDE})}\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.toggle.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.languages === LanguagesArg.SHOW}\n                                onClick={() => props.onChange({...props.config, languages: LanguagesArg.SHOW})}\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n\n                <Item className={!props.config.renderTribeOption ? 'hidden' : ''}>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.tribe\" defaultMessage=\"Tribe\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.toggle.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.tribe === TribeArg.HIDE}\n                                onClick={() => props.onChange({...props.config, tribe: TribeArg.HIDE})}\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.toggle.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.tribe === TribeArg.SHOW}\n                                onClick={() => props.onChange({...props.config, tribe: TribeArg.SHOW})}\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n\n                <Item>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.ids\" defaultMessage=\"IDs\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.toggle.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.id === IdsArg.HIDE}\n                                onClick={() => props.onChange({...props.config, id: IdsArg.HIDE})}\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.toggle.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.id === IdsArg.SHOW}\n                                onClick={() => props.onChange({...props.config, id: IdsArg.SHOW})}\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n\n                <Item>\n                    <Item.Content>\n                        <Header sub>\n                            <FormattedMessage id=\"config.sex\" defaultMessage=\"Sex\"/>\n                        </Header>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.toggle.HIDE\" defaultMessage=\"hide\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"hide\"\n                                checked={props.config.sex === SexArg.HIDE}\n                                onClick={() => props.onChange({...props.config, sex: SexArg.HIDE})}\n                            />\n                        </Form.Field>\n                        <Form.Field className=\"no-margin\">\n                            <Checkbox\n                                radio\n                                label={\n                                    <FormattedMessage tagName=\"label\" id=\"config.toggle.SHOW\" defaultMessage=\"show\"/>\n                                }\n                                name=\"checkboxRadioGroup\"\n                                value=\"show\"\n                                checked={props.config.sex === SexArg.SHOW}\n                                onClick={() => props.onChange({...props.config, sex: SexArg.SHOW})}\n                            />\n                        </Form.Field>\n                    </Item.Content>\n                </Item>\n            </Item.Group>\n            <div style={{textAlign: \"center\"}}>\n                <Form.Button primary onClick={() => props.onChange(DEFAULT_CONFIG)}>\n                    <FormattedMessage id=\"config.reset\" defaultMessage=\"Reset\"/>\n                </Form.Button>\n            </div>\n        </Form>\n\n);\n}\n","import {ChartColors, LanguagesArg, TribeArg, IdsArg, SexArg} from './config';\nimport {interpolateNumber} from 'd3-interpolate';\nimport {IntlShape, useIntl} from 'react-intl';\nimport {max, min} from 'd3-array';\nimport {Media} from './util/media';\nimport {saveAs} from 'file-saver';\nimport {select, Selection} from 'd3-selection';\nimport {useEffect, useRef} from 'react';\nimport 'd3-transition';\nimport {D3ZoomEvent, zoom, ZoomBehavior, ZoomedElementBaseType, zoomTransform,} from 'd3-zoom';\nimport {\n    ChartColors as TopolaChartColors,\n    ChartHandle,\n    createChart,\n    DetailedRenderer,\n    HourglassChart,\n    IndiInfo,\n    JsonGedcomData,\n} from './lib/topola';\n\n\n/** How much to zoom when using the +/- buttons. */\nconst ZOOM_FACTOR = 1.3;\n\n/**\n * Called when the view is dragged with the mouse.\n *\n * @param size the size of the chart\n * @param event\n */\nfunction zoomed(\n    size: [number, number],\n    event: D3ZoomEvent<ZoomedElementBaseType, unknown>,\n) {\n    const parent = select('#svgContainer').node() as Element;\n    const scale = event.transform.k;\n    const offsetX = max([0, (parent.clientWidth - size[0] * scale) / 2]);\n    const offsetY = max([0, (parent.clientHeight - size[1] * scale) / 2]);\n    select('#chartSvg')\n        .attr('width', size[0] * scale)\n        .attr('height', size[1] * scale)\n        .attr('transform', `translate(${offsetX}, ${offsetY})`);\n    select('#chart').attr('transform', `scale(${scale})`);\n    parent.scrollLeft = -event.transform.x;\n    parent.scrollTop = -event.transform.y;\n}\n\n/** Called when the scrollbars are used. */\nfunction scrolled() {\n    const parent = select('#svgContainer').node() as Element;\n    const x = parent.scrollLeft + parent.clientWidth / 2;\n    const y = parent.scrollTop + parent.clientHeight / 2;\n    const scale = zoomTransform(parent).k;\n    select(parent).call(zoom().translateTo, x / scale, y / scale);\n}\n\n/** Loads blob as data URL. */\nfunction loadAsDataUrl(blob: Blob): Promise<string> {\n    const reader = new FileReader();\n    reader.readAsDataURL(blob);\n    return new Promise<string>((resolve) => {\n        reader.onload = (e) => resolve((e.target as FileReader).result as string);\n    });\n}\n\nasync function inlineImage(image: SVGImageElement) {\n    const href = image.href.baseVal;\n    if (!href) {\n        return;\n    }\n    try {\n        const response = await fetch(href);\n        const blob = await response.blob();\n        image.href.baseVal = await loadAsDataUrl(blob);\n    } catch (e) {\n        console.warn('Failed to load image:', e);\n    }\n}\n\n/**\n * Fetches all images in the SVG and replaces them with inlined images as data\n * URLs. Images are replaced in place. The replacement is done, the returned\n * promise is resolved.\n */\nasync function inlineImages(svg: Element): Promise<void> {\n    const images = Array.from(svg.getElementsByTagName('image'));\n    await Promise.all(images.map(inlineImage));\n}\n\n/** Loads a blob into an image object. */\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\n    const image = new Image();\n    image.src = URL.createObjectURL(blob);\n    return new Promise<HTMLImageElement>((resolve) => {\n        image.addEventListener('load', () => resolve(image));\n    });\n}\n\n/** Draw image on a new canvas and return the canvas. */\nfunction drawImageOnCanvas(image: HTMLImageElement) {\n    const canvas = document.createElement('canvas');\n    // Scale image for better quality.\n    canvas.width = image.width * 2;\n    canvas.height = image.height * 2;\n    const ctx = canvas.getContext('2d')!;\n    const oldFill = ctx.fillStyle;\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    ctx.fillStyle = oldFill;\n    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);\n    return canvas;\n}\n\nfunction canvasToBlob(canvas: HTMLCanvasElement, type: string) {\n    return new Promise<Blob>((resolve, reject) => {\n        canvas.toBlob((blob) => {\n            if (blob) {\n                resolve(blob);\n            } else {\n                reject();\n            }\n        }, type);\n    });\n}\n\n/** Return a copy of the SVG chart but without scaling and positioning. */\nfunction getStrippedSvg() {\n    const svg = document.getElementById('chartSvg')!.cloneNode(true) as Element;\n    svg.removeAttribute('transform');\n    const parent = select('#svgContainer').node() as Element;\n    const scale = zoomTransform(parent).k;\n    svg.setAttribute('width', String(Number(svg.getAttribute('width')) / scale));\n    svg.setAttribute(\n        'height',\n        String(Number(svg.getAttribute('height')) / scale),\n    );\n    svg.querySelector('#chart')!.removeAttribute('transform');\n    return svg;\n}\n\nasync function getSvgContentsWithInlinedImages() {\n    const svg = getStrippedSvg();\n    await inlineImages(svg);\n    return new XMLSerializer().serializeToString(svg);\n}\n\nexport async function downloadSvg() {\n    const contents = await getSvgContentsWithInlinedImages();\n    const blob = new Blob([contents], {type: 'image/svg+xml'});\n    saveAs(blob, 'genealogy.svg');\n}\n\nasync function drawOnCanvas(): Promise<HTMLCanvasElement> {\n    const contents = await getSvgContentsWithInlinedImages();\n    const blob = new Blob([contents], {type: 'image/svg+xml'});\n    return drawImageOnCanvas(await loadImage(blob));\n}\n\nexport async function downloadPng() {\n    const canvas = await drawOnCanvas();\n    const blob = await canvasToBlob(canvas, 'image/png');\n    saveAs(blob, 'genealogy.png');\n}\n\nexport async function downloadPdf() {\n    // Lazy load jspdf.\n    const {default: jspdf} = await import('jspdf');\n    const canvas = await drawOnCanvas();\n    const doc = new jspdf({\n        orientation: canvas.width > canvas.height ? 'l' : 'p',\n        unit: 'pt',\n        format: [canvas.width, canvas.height],\n    });\n    doc.addImage(canvas, 'PNG', 0, 0, canvas.width, canvas.height, 'NONE');\n    doc.save('genealogy.pdf');\n}\n\n/** Supported chart types. */\nexport enum ChartType {\n    Hourglass\n}\n\nconst chartColors = new Map<ChartColors, TopolaChartColors>([\n    [ChartColors.NO_COLOR, TopolaChartColors.NO_COLOR],\n    [ChartColors.COLOR_BY_GENERATION, TopolaChartColors.COLOR_BY_GENERATION],\n    [ChartColors.COLOR_BY_SEX, TopolaChartColors.COLOR_BY_SEX],\n    [ChartColors.COLOR_BY_TRIBE, TopolaChartColors.COLOR_BY_TRIBE],\n    [ChartColors.COLOR_BY_NR_LANGUAGES, TopolaChartColors.COLOR_BY_NR_LANGUAGES],\n    [ChartColors.COLOR_BY_LANGUAGE, TopolaChartColors.COLOR_BY_LANGUAGE]\n]);\n\nexport interface ChartProps {\n    data: JsonGedcomData;\n    selection: IndiInfo;\n    chartType: ChartType;\n    onSelection: (indiInfo: IndiInfo) => void;\n    freezeAnimation?: boolean;\n    colors?: ChartColors;\n    selectedLanguage?: string | null;\n    hideLanguages?: LanguagesArg;\n    hideTribe?: TribeArg;\n    hideIds?: IdsArg;\n    hideSex?: SexArg;\n}\n\nclass ChartWrapper {\n    private chart?: ChartHandle;\n    /** Animation is in progress. */\n    private animating = false;\n    /** Rendering is required after the current animation finishes. */\n    private rerenderRequired = false;\n    /** The d3 zoom behavior object. */\n    private zoomBehavior?: ZoomBehavior<Element, any>;\n    /** Props that will be used for re-rendering. */\n    private rerenderProps?: ChartProps;\n    private rerenderResetPosition?: boolean;\n\n    zoom(factor: number) {\n        const parent = select('#svgContainer') as Selection<Element, any, any, any>;\n        this.zoomBehavior!.scaleBy(parent, factor);\n    }\n\n    /**\n     * Renders the chart or performs a transition animation to a new state.\n     * If indiInfo is not given, it means that it is the initial render and no animation is performed.\n     */\n    renderChart(\n        props: ChartProps,\n        intl: IntlShape,\n        args: { initialRender: boolean; resetPosition: boolean } = {\n            initialRender: false,\n            resetPosition: false,\n        },\n    ) {\n        // Wait for animation to finish if animation is in progress.\n        if (!args.initialRender && this.animating) {\n            this.rerenderRequired = true;\n            this.rerenderProps = props;\n            this.rerenderResetPosition = args.resetPosition;\n            return;\n        }\n\n        // Freeze changing selection after initial rendering.\n        if (!args.initialRender && props.freezeAnimation) {\n            return;\n        }\n\n        if (args.initialRender) {\n            (select('#chart').node() as HTMLElement).innerHTML = '';\n            this.chart = createChart({\n                json: props.data,\n                chartType: HourglassChart,\n                renderer: DetailedRenderer,\n                svgSelector: '#chart',\n                indiCallback: (info) => props.onSelection(info),\n                colors: chartColors.get(props.colors!),\n                selectedLanguage: props.selectedLanguage,\n                animate: true,\n                updateSvgSize: false,\n                locale: intl.locale,\n            });\n        } else {\n            this.chart!.setData(props.data);\n        }\n\n        const chartInfo = this.chart!.render({\n            startIndi: props.selection.id,\n            baseGeneration: props.selection.generation,\n        });\n        const svg = select('#chartSvg');\n        const parent = select('#svgContainer').node() as Element;\n        const scale = zoomTransform(parent).k;\n        const zoomOutFactor = min([\n            1,\n            scale,\n            parent.clientWidth / chartInfo.size[0],\n            parent.clientHeight / chartInfo.size[1],\n        ])!;\n        const extent: [number, number] = [max([0.1, zoomOutFactor])!, 2];\n\n        this.zoomBehavior = zoom()\n            .scaleExtent(extent)\n            .translateExtent([[0, 0], chartInfo.size])\n            .on('zoom', (event) => zoomed(chartInfo.size, event));\n        select(parent).on('scroll', scrolled).call(this.zoomBehavior);\n\n        const scrollTopTween = (scrollTop: number) => {\n            return () => {\n                const i = interpolateNumber(parent.scrollTop, scrollTop);\n                return (t: number) => {\n                    parent.scrollTop = i(t);\n                };\n            };\n        };\n\n        const scrollLeftTween = (scrollLeft: number) => {\n            return () => {\n                const i = interpolateNumber(parent.scrollLeft, scrollLeft);\n                return (t: number) => {\n                    parent.scrollLeft = i(t);\n                };\n            };\n        };\n\n        const dx = parent.clientWidth / 2 - chartInfo.origin[0] * scale;\n        const dy = parent.clientHeight / 2 - chartInfo.origin[1] * scale;\n        const offsetX = max([\n            0,\n            (parent.clientWidth - chartInfo.size[0] * scale) / 2,\n        ]);\n        const offsetY = max([\n            0,\n            (parent.clientHeight - chartInfo.size[1] * scale) / 2,\n        ]);\n        const svgTransition = svg.transition().delay(200).duration(500);\n        const transition = args.initialRender ? svg : svgTransition;\n        transition\n            .attr('transform', `translate(${offsetX}, ${offsetY})`)\n            .attr('width', chartInfo.size[0] * scale)\n            .attr('height', chartInfo.size[1] * scale);\n        if (args.resetPosition) {\n            if (args.initialRender) {\n                parent.scrollLeft = -dx;\n                parent.scrollTop = -dy;\n            } else {\n                svgTransition\n                    .tween('scrollLeft', scrollLeftTween(-dx))\n                    .tween('scrollTop', scrollTopTween(-dy));\n            }\n        }\n\n        // After the animation is finished, rerender the chart if required.\n        this.animating = true;\n        chartInfo.animationPromise.then(() => {\n            this.animating = false;\n            if (this.rerenderRequired) {\n                this.rerenderRequired = false;\n                // Use `this.rerenderProps` instead of the props in scope because\n                // the props may have been updated in the meantime.\n                this.renderChart(this.rerenderProps!, intl, {\n                    initialRender: false,\n                    resetPosition: !!this.rerenderResetPosition,\n                });\n            }\n        });\n    }\n}\n\nfunction usePrevious<T>(value: T): T | undefined {\n    const ref = useRef<T>();\n    useEffect(() => {\n        ref.current = value;\n    });\n    return ref.current;\n}\n\nexport function Chart(props: ChartProps) {\n    const chartWrapper = useRef(new ChartWrapper());\n    const prevProps = usePrevious(props);\n    const intl = useIntl();\n\n    useEffect(() => {\n        if (prevProps) {\n            const initialRender =\n                props.chartType !== prevProps?.chartType ||\n                props.colors !== prevProps?.colors ||\n                props.selectedLanguage !== prevProps?.selectedLanguage ||\n                props.hideLanguages !== prevProps?.hideLanguages ||\n                props.hideTribe !== prevProps?.hideTribe ||\n                props.hideIds !== prevProps?.hideIds ||\n                props.hideSex !== prevProps?.hideSex;\n            const resetPosition =\n                props.chartType !== prevProps?.chartType ||\n                props.data !== prevProps.data ||\n                props.selection !== prevProps.selection;\n            chartWrapper.current.renderChart(props, intl, {\n                initialRender,\n                resetPosition,\n            });\n        } else {\n            chartWrapper.current.renderChart(props, intl, {\n                initialRender: true,\n                resetPosition: true,\n            });\n        }\n    });\n\n    return (\n        <div id=\"svgContainer\">\n            <Media greaterThanOrEqual=\"large\" className=\"zoom\">\n                <button className=\"zoom-in\" onClick={() => chartWrapper.current.zoom(ZOOM_FACTOR)}>+</button>\n                <button className=\"zoom-out\" onClick={() => chartWrapper.current.zoom(1 / ZOOM_FACTOR)}></button>\n            </Media>\n            <svg id=\"chartSvg\">\n                <g id=\"chart\"/>\n            </svg>\n        </div>\n    );\n}\n","export interface Language {\n    id: string;\n    name: string;\n    iso: string | null;\n    abbreviation: string;\n}\n\nexport default class CSVLoader {\n    // Singleton\n    private static csvData: Language[] | null = null;\n\n    static async loadLanguages(filePath: string) {\n        if (CSVLoader.csvData) {\n            return CSVLoader.csvData;\n        }\n        try {\n            const data = await fetch(filePath);\n            const text = await data.text();\n\n            const rows = text.trim().split('\\n');\n            const headers = rows[0].split(',');\n\n            const idIndex = headers.indexOf('id');\n            const nameIndex = headers.indexOf('name');\n            const isoIndex = headers.indexOf('ISO 639-3');\n\n            CSVLoader.csvData = rows.slice(1).map(row => {\n                const values = row.split(',');\n                return {\n                    id: values[idIndex],\n                    name: CSVLoader.title_fn(values[nameIndex]),\n                    iso: values[isoIndex],\n                    abbreviation: values[isoIndex].toUpperCase() || (values[nameIndex].slice(0, 3).toUpperCase() + '*')\n                } as Language;\n            });\n            return CSVLoader.csvData;\n        } catch (error) {\n            console.error(error);\n            throw error;\n        }\n    }\n\n    private static title_fn = (str: string) =>\n        str.split(/[-_\\s]/) // Split by hyphen, underscore, or space\n           .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n           .join('-');\n}\n","import * as H from 'history';\nimport * as queryString from 'query-string';\nimport {DataSourceEnum, SourceSelection} from './datasource/data_source';\nimport {Details} from './details/details';\nimport {EmbeddedDataSource, EmbeddedSourceSpec} from './datasource/embedded';\nimport {FormattedMessage, useIntl} from 'react-intl';\nimport {getI18nMessage} from './util/error_i18n';\nimport {IndiInfo} from './lib/topola';\nimport {Loader, Message, Portal, Tab} from 'semantic-ui-react';\nimport {Media} from './util/media';\nimport {Redirect, Route, Switch} from 'react-router-dom';\nimport {TopBar} from './menu/top_bar';\nimport {TopolaData} from './util/gedcom_util';\nimport {useEffect, useState} from 'react';\nimport {useHistory, useLocation} from 'react-router';\nimport {idToIndiMap} from './util/gedcom_util';\nimport {Chart, ChartType, downloadPdf, downloadPng, downloadSvg} from './chart';\nimport {getSelection, UploadSourceSpec, UrlSourceSpec, GedcomUrlDataSource, UploadedDataSource} from './datasource/load_data';\nimport CSVLoader, {Language} from \"./languages/languages-loader\";\nimport {argsToConfig, Config, ConfigPanel, configToArgs, DEFAULT_CONFIG, LanguagesArg, TribeArg, IdsArg, SexArg} from './config';\n\n\n/**\n * Load GEDCOM URL from REACT_APP_STATIC_URL environment variable.\n *\n * If this environment variable is provided, the viewer is switched to\n * single-tree mode without the option to load other data.\n */\nconst staticUrl = process.env.REACT_APP_STATIC_URL;\n\n/** Shows an error message in the middle of the screen. */\nfunction ErrorMessage(props: { message?: string }) {\n    return (\n        <Message negative className=\"error\">\n            <Message.Header>\n                <FormattedMessage\n                    id=\"error.failed_to_load_file\"\n                    defaultMessage={'Failed to load file'}\n                />\n            </Message.Header>\n            <p>{props.message}</p>\n        </Message>\n    );\n}\n\ninterface ErrorPopupProps {\n    message?: string;\n    open: boolean;\n    onDismiss: () => void;\n}\n\n/**\n * Shows a dismissable error message in the bottom left corner of the screen.\n */\nfunction ErrorPopup(props: ErrorPopupProps) {\n    return (\n        <Portal open={props.open} onClose={props.onDismiss}>\n            <Message negative className=\"errorPopup\" onDismiss={props.onDismiss}>\n                <Message.Header>\n                    <FormattedMessage id=\"error.error\" defaultMessage={'Error'}/>\n                </Message.Header>\n                <p>{props.message}</p>\n            </Message>\n        </Portal>\n    );\n}\n\nenum AppState {\n    INITIAL,\n    LOADING,\n    ERROR,\n    SHOWING_CHART,\n    LOADING_MORE,\n}\n\ntype DataSourceSpec = UrlSourceSpec | UploadSourceSpec | EmbeddedSourceSpec;\n\n/**\n * Arguments passed to the application, primarily through URL parameters.\n * Non-optional arguments get populated with default values.\n */\ninterface Arguments {\n    sourceSpec?: DataSourceSpec;\n    selection?: IndiInfo;\n    chartType: ChartType;\n    standalone: boolean;\n    freezeAnimation: boolean;\n    showSidePanel: boolean;\n    config: Config;\n}\n\nfunction getParamFromSearch(name: string, search: queryString.ParsedQuery) {\n    const value = search[name];\n    return typeof value === 'string' ? value : undefined;\n}\n\nfunction startIndi(data: TopolaData | undefined) {\n    const egoGen = getEgoGen(data)\n    return {\n        id: data?.chartData?.indis?.[0]?.id || 'I0',  // lowest ID on the chart\n        generation: egoGen !== undefined ? -parseInt(egoGen, 10) : 0\n    };\n}\n\nfunction getEgoIndi(data: TopolaData | undefined) {\n    return Object.entries(data?.gedcom?.other || {}).filter(([_, value]) => value.tag === \"EGO\")\n}\n\nfunction getEgoGen(data: TopolaData | undefined) {\n    return getEgoIndi(data)\n        .map(([_, value]) => value.tree.find(sub => sub.tag === \"GEN\")?.data)\n        .find(data => data !== undefined);\n}\n\nfunction loadLanguageOptions(data: TopolaData | undefined, allLanguages: Language[]) {\n    const gedcomLanguages = Array.from(getGedcomLanguages(data));\n    return allLanguages.filter((l: Language) => gedcomLanguages.includes(l.name)).sort();\n}\n\nfunction getGedcomLanguages(data: TopolaData | undefined) {\n    return Object.entries(data?.gedcom?.indis || {})\n        .reduce<Set<string>>((acc, [_, value]) => {\n            const langDataArray = value.tree.filter((sub: any) => sub.tag === \"LANG\");\n            langDataArray.forEach(lang => {\n                if (lang.data) acc.add(lang.data);\n            });\n            return acc;\n        }, new Set<string>());\n}\n\nfunction getTribes(data: TopolaData | undefined) {\n    return Object.entries(data?.gedcom?.indis || {})\n        .reduce<Set<string>>((acc, [_, value]) => {\n            const langDataArray = value.tree.filter((sub: any) => sub.tag === \"_TRIB\");\n            langDataArray.forEach(lang => {\n                if (lang.data) acc.add(lang.data);\n            });\n            return acc;\n        }, new Set<string>());\n}\n\n/**\n * Retrieve arguments passed into the application through the URL and uploaded data.\n */\nfunction getArguments(location: H.Location<any>, allLanguages: Language[]): Arguments {\n    const chartTypes = new Map<string | undefined, ChartType>([\n        ['hourglass', ChartType.Hourglass]\n    ]);\n    const search = queryString.parse(location.search);\n    const getParam = (name: string) => getParamFromSearch(name, search);\n    const view = getParam('view');\n    const hash = getParam('file');\n    const url = getParam('url');\n    const embedded = getParam('embedded') === 'true'; // False by default.\n    let sourceSpec: DataSourceSpec | undefined = undefined;\n    if (staticUrl) {\n        sourceSpec = {\n            source: DataSourceEnum.GEDCOM_URL,\n            url: staticUrl,\n            handleCors: false,\n            allLanguages: allLanguages\n        };\n    } else if (hash) {\n        sourceSpec = {\n            source: DataSourceEnum.UPLOADED,\n            hash,\n            gedcom: location.state && location.state.data,\n            allLanguages: allLanguages,\n            images: location.state && location.state.images,\n        };\n    } else if (url) {\n        sourceSpec = {\n            source: DataSourceEnum.GEDCOM_URL,\n            url,\n            allLanguages: allLanguages,\n            handleCors: getParam('handleCors') !== 'false', // True by default.\n        };\n    } else if (embedded) {\n        sourceSpec = {source: DataSourceEnum.EMBEDDED};\n    }\n\n    const indi = getParam('indi');\n    const parsedGen = Number(getParam('gen'));\n    const selection = indi\n        ? {id: indi, generation: !isNaN(parsedGen) ? parsedGen : 0}\n        : undefined\n\n    return {\n        sourceSpec,\n        selection,\n        // Hourglass is the default view.\n        chartType: chartTypes.get(view) || ChartType.Hourglass,\n        showSidePanel: getParam('sidePanel') !== 'false', // True by default.\n        standalone: getParam('standalone') !== 'false' && !embedded && !staticUrl,\n        freezeAnimation: getParam('freeze') === 'true', // False by default\n        config: argsToConfig(search),\n    };\n}\n\nexport function App() {\n    /** State of the application. */\n    const [state, setState] = useState<AppState>(AppState.INITIAL);\n    /** Loaded data. */\n    const [data, setData] = useState<TopolaData>();\n    /** Selected individual. */\n    const [selection, setSelection] = useState<IndiInfo>();\n    /** Error to display. */\n    const [error, setError] = useState<string>();\n    /** Whether the side panel is shown. */\n    const [showSidePanel, setShowSidePanel] = useState(false);\n    /** Whether the app is in standalone mode, i.e. showing 'open file' menus. */\n    const [standalone, setStandalone] = useState(true);\n    /** Type of displayed chart. */\n    const [chartType, setChartType] = useState<ChartType>(ChartType.Hourglass);\n    /** Whether to show the error popup. */\n    const [showErrorPopup, setShowErrorPopup] = useState(false);\n    /** Specification of the source of the data. */\n    const [sourceSpec, setSourceSpec] = useState<DataSourceSpec>();\n    /** Freeze animations after initial chart render. */\n    const [freezeAnimation, setFreezeAnimation] = useState(false);\n    const [config, setConfig] = useState(DEFAULT_CONFIG);\n    /** All languages. */\n    const [allLanguages, setAllLanguages] = useState<Language[]>([]);\n\n\n    const intl = useIntl();\n    const history = useHistory();\n    const location = useLocation();\n\n    /** Sets the state with a new individual selection and chart type. */\n    function updateDisplay(newSelection: IndiInfo) {\n        if (!selection || selection.id !== newSelection.id || selection!.generation !== newSelection.generation) {\n            setSelection(newSelection);\n        }\n    }\n\n    function toggleDetails(config: Config, data: TopolaData | undefined, allLanguages: Language[]) {\n        if (data === undefined) {\n            return;\n        }\n        // Find if there are languages\n        config.languageOptions = loadLanguageOptions(data, allLanguages)\n        config.renderLanguagesOption = config.languageOptions.length > 0\n        // Find if there are tribes\n        config.renderTribeOption = Array.from(getTribes(data)).length > 0\n        idToIndiMap(data.chartData).forEach((indi) => {\n            indi.hideLanguages = config.languages === LanguagesArg.HIDE;\n            indi.hideTribe = config.tribe === TribeArg.HIDE;\n            indi.hideId = config.id === IdsArg.HIDE;\n            indi.hideSex = config.sex === SexArg.HIDE;\n        });\n    }\n\n    /** Sets error message after data load failure. */\n    function setErrorMessage(message: string) {\n        setError(message);\n        setState(AppState.ERROR);\n    }\n\n    const uploadedDataSource = new UploadedDataSource();\n    const gedcomUrlDataSource = new GedcomUrlDataSource();\n    const embeddedDataSource = new EmbeddedDataSource();\n\n    function isNewData(newSourceSpec: DataSourceSpec, newSelection?: IndiInfo) {\n        if (!sourceSpec || sourceSpec.source !== newSourceSpec.source) {\n            // New data source means new data\n            return true;\n        }\n        const newSource = {spec: newSourceSpec, selection: newSelection};\n        const oldSource = {\n            spec: sourceSpec,\n            selection: selection,\n        };\n        switch (newSource.spec.source) {\n            case DataSourceEnum.UPLOADED:\n                return uploadedDataSource.isNewData(\n                    newSource as SourceSelection<UploadSourceSpec>,\n                    oldSource as SourceSelection<UploadSourceSpec>,\n                    data,\n                );\n            case DataSourceEnum.GEDCOM_URL:\n                return gedcomUrlDataSource.isNewData(\n                    newSource as SourceSelection<UrlSourceSpec>,\n                    oldSource as SourceSelection<UrlSourceSpec>,\n                    data,\n                );\n            case DataSourceEnum.EMBEDDED:\n                return embeddedDataSource.isNewData(\n                    newSource as SourceSelection<EmbeddedSourceSpec>,\n                    oldSource as SourceSelection<EmbeddedSourceSpec>,\n                    data,\n                );\n        }\n    }\n\n    function loadData(newSourceSpec: DataSourceSpec, newSelection?: IndiInfo, allLanguages?: Language[]) {\n        switch (newSourceSpec.source) {\n            case DataSourceEnum.UPLOADED:\n                return uploadedDataSource.loadData({spec: newSourceSpec, selection: newSelection, allLanguages: allLanguages});\n            case DataSourceEnum.GEDCOM_URL:\n                return gedcomUrlDataSource.loadData({spec: newSourceSpec, selection: newSelection, allLanguages: allLanguages});\n            case DataSourceEnum.EMBEDDED:\n                return embeddedDataSource.loadData({spec: newSourceSpec, selection: newSelection, allLanguages: allLanguages});\n        }\n    }\n\n    // Function to load languages from CSV\n    const loadAllLanguages = async () => {\n        const allLanguages = await CSVLoader.loadLanguages('data/languages.csv') || [];\n        setAllLanguages(allLanguages);\n    };\n\n    // useEffect to load languages when pathname is '/view'\n    useEffect(() => {\n        loadAllLanguages();\n    }, [location.pathname]);\n\n    useEffect(() => {\n        const rootElement = document.getElementById('root');\n        if (location.pathname === '/') {\n            // @ts-ignore\n            rootElement.classList.add('bgLogo');\n        } else {\n            // @ts-ignore\n            rootElement.classList.remove('bgLogo');\n        }\n\n        (async () => {\n            if (location.pathname !== '/view') {\n                if (state !== AppState.INITIAL) {\n                    setState(AppState.INITIAL);\n                }\n                return;\n            }\n\n            const args = getArguments(location, allLanguages);\n            if (!args.sourceSpec) {\n                history.replace({pathname: '/'});\n                return;\n            }\n            if (\n                state === AppState.INITIAL || isNewData(args.sourceSpec, args.selection)\n            ) {\n                setState(AppState.LOADING);\n                setSourceSpec(args.sourceSpec);\n                setStandalone(args.standalone);\n                setChartType(args.chartType);\n                setFreezeAnimation(args.freezeAnimation);\n                setConfig(args.config);\n                try {\n                    const data = await loadData(args.sourceSpec, args.selection);\n                    setData(data);\n                    setSelection(args.selection !== undefined ? args.selection : startIndi(data));\n                    toggleDetails(args.config, data, allLanguages);\n                    setShowSidePanel(args.showSidePanel);\n                    setState(AppState.SHOWING_CHART);\n                } catch (error: any) {\n                    setErrorMessage(getI18nMessage(error, intl));\n                }\n            } else if (\n                state === AppState.SHOWING_CHART || state === AppState.LOADING_MORE\n            ) {\n                setChartType(args.chartType);\n                setState(AppState.SHOWING_CHART);\n                updateDisplay(args.selection !== undefined ? args.selection : startIndi(data));\n            }\n        })();\n    });\n\n    function updateUrl(args: queryString.ParsedQuery<any>) {\n        const search = queryString.parse(location.search);\n        for (const key in args) {\n            search[key] = args[key];\n        }\n        location.search = queryString.stringify(search);\n        history.push(location);\n    }\n\n    /**\n     * Called when the user clicks an individual box in the chart. Updates the browser URL.\n     */\n    function onSelection(selection: IndiInfo) {\n        updateUrl({\n            indi: selection.id,\n            gen: selection.generation,\n        });\n    }\n\n    function displayErrorPopup(message: string) {\n        setShowErrorPopup(true);\n        setError(message);\n    }\n\n    async function onDownloadPdf() {\n        try {\n            await downloadPdf();\n        } catch (e) {\n            displayErrorPopup(\n                intl.formatMessage({\n                    id: 'error.failed_pdf',\n                    defaultMessage:\n                        'Failed to generate PDF file.' +\n                        ' Please try with a smaller diagram or download an SVG file.',\n                }),\n            );\n        }\n    }\n\n    async function onDownloadPng() {\n        try {\n            await downloadPng();\n        } catch (e) {\n            displayErrorPopup(\n                intl.formatMessage({\n                    id: 'error.failed_png',\n                    defaultMessage:'Failed to generate PNG file. Please try with a smaller diagram or download an SVG file.'\n                }),\n            );\n        }\n    }\n\n    function onDownloadSvg() {\n        downloadSvg();\n    }\n\n    function onCenterView() {\n        onSelection(startIndi(data))\n    }\n\n    function onDismissErrorPopup() {\n        setShowErrorPopup(false);\n    }\n\n    function renderMainArea() {\n        switch (state) {\n            case AppState.SHOWING_CHART:\n            case AppState.LOADING_MORE:\n                const updatedSelection = getSelection(data!.chartData, selection);\n                const sidePanelTabs = [\n                    {\n                        menuItem: intl.formatMessage({id: 'tab.info', defaultMessage: 'Info'}),\n                        render: () => (\n                            <Details gedcom={data!.gedcom} indi={updatedSelection.id}/>\n                        ),\n                    },\n                    {\n                        menuItem: intl.formatMessage({\n                            id: 'tab.settings',\n                            defaultMessage: 'Settings',\n                        }),\n                        render: () => (\n                            <ConfigPanel\n                                config={config}\n                                onChange={(config) => {\n                                    setConfig(config);\n                                    toggleDetails(config, data, allLanguages);\n                                    updateUrl(configToArgs(config));\n                                }}\n                            />\n                        ),\n                    },\n                ];\n                return (\n                    <div id=\"content\">\n                        <ErrorPopup\n                            open={showErrorPopup}\n                            message={error}\n                            onDismiss={onDismissErrorPopup}\n                        />\n                        {state === AppState.LOADING_MORE ? (\n                            <Loader active size=\"small\" className=\"loading-more\"/>\n                        ) : null}\n                        <Chart\n                            data={data!.chartData}\n                            selection={updatedSelection}\n                            chartType={chartType}\n                            onSelection={onSelection}\n                            freezeAnimation={freezeAnimation}\n                            colors={config.color}\n                            selectedLanguage={config.selectedLanguage}\n                            hideLanguages={config.languages}\n                            hideTribe={config.tribe}\n                            hideIds={config.id}\n                            hideSex={config.sex}\n                        />\n                        {showSidePanel ? (\n                            <Media greaterThanOrEqual=\"large\" className=\"sidePanel\">\n                                <Tab panes={sidePanelTabs}/>\n                            </Media>\n                        ) : null}\n                    </div>\n                );\n            case AppState.ERROR:\n                return <ErrorMessage message={error!}/>;\n            case AppState.INITIAL:\n            case AppState.LOADING:\n                return <Loader active size=\"large\"/>;\n        }\n    }\n\n    return (\n        <>\n            <Route\n                render={() => (\n                    <TopBar\n                        data={data?.chartData}\n                        showingChart={\n                            history.location.pathname === '/view' &&\n                            (state === AppState.SHOWING_CHART || state === AppState.LOADING_MORE)\n                        }\n                        standalone={standalone}\n                        eventHandlers={{\n                            onSelection,\n                            onDownloadPdf,\n                            onDownloadPng,\n                            onDownloadSvg,\n                            onCenterView,\n                        }}\n                    />\n                )}\n            />\n            {staticUrl ? (\n                <Switch>\n                    <Route exact path=\"/view\" render={renderMainArea}/>\n                    <Redirect to={'/view'}/>\n                </Switch>\n            ) : (\n                <Switch>\n                    <Route exact path=\"/view\" render={renderMainArea}/>\n                    <Redirect to={'/'}/>\n                </Switch>\n            )}\n        </>\n    );\n}\n\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport messages_de from './translations/de.json';\nimport messages_fr from './translations/fr.json';\nimport messages_it from './translations/it.json';\nimport messages_es from './translations/es.json';\nimport messages_pl from './translations/pl.json';\nimport {App} from './app';\nimport {detect} from 'detect-browser';\nimport {HashRouter as Router, Route} from 'react-router-dom';\nimport {IntlProvider} from 'react-intl';\nimport {MediaContextProvider, mediaStyles} from './util/media';\nimport './index.css';\nimport 'semantic-ui-css/semantic.min.css';\nimport 'canvas-toBlob';\n\nconst messages = {\n    de: messages_de,\n    fr: messages_fr,\n    it: messages_it,\n    es: messages_es,\n    pl: messages_pl\n};\nconst language = navigator.language && navigator.language.split(/[-_]/)[0];\nconst browser = detect();\n\nif (browser && browser.name === 'ie') {\n    ReactDOM.render(\n        <p>Genealogy Viewer does not support Internet Explorer. Please try a different (modern) browser.</p>,\n        document.querySelector('#root'),\n    );\n} else {\n    ReactDOM.render(\n        <IntlProvider locale={language} messages={messages[language]}>\n            <MediaContextProvider>\n                <style>{mediaStyles}</style>\n                <Router>\n                    <Route component={App}/>\n                </Router>\n            </MediaContextProvider>\n        </IntlProvider>,\n        document.querySelector('#root'),\n    );\n}\n","import {Date as TopolaDate, DateOrRange, DateRange, getDate} from '../lib/topola';\nimport {IntlShape} from 'react-intl';\n\nconst DATE_QUALIFIERS = new Map([\n    ['abt', 'about'],\n    ['cal', 'calculated'],\n    ['est', 'estimated'],\n]);\n\nfunction formatDate(date: TopolaDate, intl: IntlShape) {\n    const hasDay = date.day !== undefined;\n    const hasMonth = date.month !== undefined;\n    const hasYear = date.year !== undefined;\n    if (!hasDay && !hasMonth && !hasYear) {\n        return date.text || '';\n    }\n    const dateObject = toDateObject(date);\n    const translatedQualifier = formatDateQualifier(date.qualifier, intl);\n\n    const formatOptions: Intl.DateTimeFormatOptions = {\n        day: hasDay ? 'numeric' : undefined,\n        month: hasMonth ? 'long' : undefined,\n        year: hasYear ? 'numeric' : undefined,\n    };\n    const translatedDate = new Intl.DateTimeFormat(\n        intl.locale,\n        formatOptions,\n    ).format(dateObject);\n\n    return [translatedQualifier, translatedDate]\n        .filter((dateElement) => dateElement)\n        .join(' ');\n}\n\nfunction formatDateRage(dateRange: DateRange, intl: IntlShape) {\n    const fromDate = dateRange.from;\n    const toDate = dateRange.to;\n    const translatedFromDate = fromDate && formatDate(fromDate, intl);\n    const translatedToDate = toDate && formatDate(toDate, intl);\n    if (translatedFromDate && translatedToDate) {\n        return intl.formatMessage(\n            {\n                id: 'date.between',\n                defaultMessage: 'between {from} and {to}',\n            },\n            {from: translatedFromDate, to: translatedToDate},\n        );\n    }\n    if (translatedFromDate) {\n        return intl.formatMessage(\n            {\n                id: 'date.after',\n                defaultMessage: 'after {from}',\n            },\n            {from: translatedFromDate},\n        );\n    }\n    if (translatedToDate) {\n        return intl.formatMessage(\n            {\n                id: 'date.before',\n                defaultMessage: 'before {to}',\n            },\n            {to: translatedToDate},\n        );\n    }\n    return '';\n}\n\nexport function formatDateQualifier(\n    qualifier: string | undefined,\n    intl: IntlShape,\n): string {\n    const lowerCaseQualifier = qualifier && qualifier.toLowerCase();\n    return (\n        (lowerCaseQualifier &&\n            intl.formatMessage({\n                id: `date.${lowerCaseQualifier}`,\n                defaultMessage:\n                    DATE_QUALIFIERS.get(lowerCaseQualifier) || lowerCaseQualifier,\n            })) ||\n        ''\n    );\n}\n\n/** Formats a DateOrRange object. */\nexport function formatDateOrRange(\n    dateOrRange: DateOrRange | undefined,\n    intl: IntlShape,\n): string {\n    if (!dateOrRange) {\n        return '';\n    }\n    if (dateOrRange.date) {\n        return formatDate(dateOrRange.date, intl);\n    }\n    if (dateOrRange.dateRange) {\n        return formatDateRage(dateOrRange.dateRange, intl);\n    }\n    return '';\n}\n\n/** Formats a date given in GEDCOM format. */\nexport function translateDate(gedcomDate: string, intl: IntlShape): string {\n    return formatDateOrRange(getDate(gedcomDate), intl);\n}\n\nexport function compareTopolaDates(\n    date1: TopolaDate | undefined,\n    date2: TopolaDate | undefined,\n): number {\n    if (!date1 || !date1.year || !date2 || !date2.year) {\n        return 0;\n    }\n    if (date1.year !== date2.year) {\n        return date1.year - date2.year;\n    }\n    if (!date1.month || !date2.month) {\n        return 0;\n    }\n    if (date1.month !== date2.month) {\n        return date1.month - date2.month;\n    }\n    if (date1.day && date2.day && date1.day !== date2.day) {\n        return date1.month - date2.month;\n    }\n    return 0;\n}\n\n/** Compares a dates given in GEDCOM format. */\nexport function compareDates(\n    firstDateOrRange: DateOrRange | undefined,\n    secondDateOrRange: DateOrRange | undefined,\n): number {\n    const date1 =\n        firstDateOrRange &&\n        (firstDateOrRange.date ||\n            (firstDateOrRange.dateRange &&\n                (firstDateOrRange.dateRange.from || firstDateOrRange.dateRange.to)));\n    const date2 =\n        secondDateOrRange &&\n        (secondDateOrRange.date ||\n            (secondDateOrRange.dateRange &&\n                (secondDateOrRange.dateRange.from || secondDateOrRange.dateRange.to)));\n    return compareTopolaDates(date1, date2);\n}\n\nexport function areDateRangesOverlapped(\n    range1: DateRange,\n    range2: DateRange,\n): boolean {\n    return (\n        compareTopolaDates(range1.from, range2.to) <= 0 &&\n        compareTopolaDates(range1.to, range2.from) >= 0\n    );\n}\n\nexport function isValidDateOrRange(\n    dateOrRange: DateOrRange | undefined,\n): boolean {\n    // invalid when range is closed and start is before end\n    if (isDateRangeClosed(dateOrRange?.dateRange)) {\n        return (\n            compareTopolaDates(\n                dateOrRange?.dateRange?.from,\n                dateOrRange?.dateRange?.to,\n            ) <= 0\n        );\n    }\n    //valid when there is exact date or date range has start or end defined\n    return !!(\n        dateOrRange?.date ||\n        dateOrRange?.dateRange?.from ||\n        dateOrRange?.dateRange?.to\n    );\n}\n\nexport function isDateRangeClosed(range: DateRange | undefined): boolean {\n    return !!(range?.from && range?.to);\n}\n\nexport function toDateObject(date: TopolaDate): Date {\n    return new Date(\n        date.year !== undefined ? date.year! : 0,\n        date.month !== undefined ? date.month! - 1 : 0,\n        date.day !== undefined ? date.day! : 1,\n    );\n}\n","import {convertGedcom, TopolaData} from '../util/gedcom_util';\nimport {DataSource, DataSourceEnum, SourceSelection} from './data_source';\nimport {IndiInfo, JsonGedcomData} from '../lib/topola';\nimport {TopolaError} from '../util/error';\nimport AdmZip from 'adm-zip';\nimport {Language} from \"../languages/languages-loader\";\n\nexport interface UploadSourceSpec {\n    source: DataSourceEnum.UPLOADED;\n    gedcom: string;\n    allLanguages: Language[];\n    hash: string;\n    images?: Map<string, string>;\n}\n\nexport interface UrlSourceSpec {\n    source: DataSourceEnum.GEDCOM_URL;\n    url: string;\n    allLanguages: Language[];\n    handleCors: boolean;\n}\n\n/**\n * Returns a valid IndiInfo object, either with the given indi and generation\n * or with an individual taken from the data and generation 0.\n */\nexport function getSelection(data: JsonGedcomData, selection?: IndiInfo): IndiInfo {\n    // If ID is not given, or it doesn't exist in the data, use the first ID in the data.\n    const id = selection && data.indis.some((i) => i.id === selection.id)\n        ? selection.id\n        : data.indis[0].id;\n    return {id, generation: selection?.generation || 0};\n}\n\nfunction prepareData(\n    gedcom: string,\n    cacheId: string,\n    allLanguages: Language[],\n    images?: Map<string, string>\n): TopolaData {\n    const data = convertGedcom(gedcom, allLanguages, images || new Map());\n    const serializedData = JSON.stringify(data);\n    try {\n        sessionStorage.setItem(cacheId, serializedData);\n    } catch (e) {\n        console.warn('Failed to store data in session storage: ' + e);\n    }\n    return data;\n}\n\nasync function loadGedzip(blob: Blob): Promise<{ gedcom: string; images: Map<string, string> }> {\n    const zip = new AdmZip(Buffer.from(await blob.arrayBuffer()));\n    const entries = zip.getEntries();\n    let gedcom = undefined;\n    const images = new Map<string, string>();\n    for (const entry of entries) {\n        if (entry.entryName.endsWith('.ged')) {\n            if (gedcom) {\n                console.warn('Multiple GEDCOM files found in zip archive.');\n            } else {\n                gedcom = entry.getData().toString();\n            }\n        } else {\n            // Save image for later.\n            images.set(\n                entry.entryName,\n                URL.createObjectURL(new Blob([entry.getData()])),\n            );\n        }\n    }\n    if (!gedcom) {\n        throw new Error('GEDCOM file not found in zip archive.');\n    }\n    return {gedcom, images};\n}\n\nexport async function loadFile(blob: Blob): Promise<{ gedcom: string; images: Map<string, string> }> {\n    const fileHeader = await blob.slice(0, 2).text();\n    if (fileHeader === 'PK') {\n        return loadGedzip(blob);\n    }\n    return {gedcom: await blob.text(), images: new Map()};\n}\n\n/** Fetches data from the given URL. Uses cors-anywhere if handleCors is true. */\nexport async function loadFromUrl(\n    url: string,\n    handleCors: boolean,\n    allLanguages: Language[]\n): Promise<TopolaData> {\n    try {\n        const cachedData = sessionStorage.getItem(url);\n        if (cachedData) {\n            return JSON.parse(cachedData);\n        }\n    } catch (e) {\n        console.warn('Failed to load data from session storage: ' + e);\n    }\n    const driveUrlMatch1 = url.match(/https:\\/\\/drive\\.google\\.com\\/file\\/d\\/(.*)\\/.*/);\n    if (driveUrlMatch1) {\n        url = `https://drive.google.com/uc?id=${driveUrlMatch1[1]}&export=download`;\n    }\n    const driveUrlMatch2 = url.match(/https:\\/\\/drive\\.google\\.com\\/open\\?id=([^&]*)&?.*/);\n    if (driveUrlMatch2) {\n        url = `https://drive.google.com/uc?id=${driveUrlMatch2[1]}&export=download`;\n    }\n    const urlToFetch = handleCors ? 'https://topolaproxy.bieda.it/' + url : url;\n    const response = await window.fetch(urlToFetch);\n    if (response.status !== 200) {\n        throw new Error(response.statusText);\n    }\n    const {gedcom, images} = await loadFile(await response.blob());\n    return prepareData(gedcom, url, allLanguages, images);\n}\n\n/** Loads data from the given GEDCOM file contents. */\nexport async function loadGedcom(\n    hash: string,\n    gedcom?: string,\n    allLanguages?: Language[],\n    images?: Map<string, string>\n): Promise<TopolaData> {\n    try {\n        const cachedData = sessionStorage.getItem(hash);\n        if (cachedData) {\n            return JSON.parse(cachedData);\n        }\n    } catch (e) {\n        console.warn('Failed to load data from session storage: ' + e);\n    }\n    if ((!gedcom) || (!allLanguages)) {\n        throw new TopolaError('ERROR_LOADING_UPLOADED_FILE',\n            'Error loading data. Please upload your file again.',\n        );\n    }\n    return prepareData(gedcom, hash, allLanguages, images);\n}\n\n\n/** Files opened from the local computer. */\nexport class UploadedDataSource implements DataSource<UploadSourceSpec> {\n\n    isNewData(\n        newSource: SourceSelection<UploadSourceSpec>,\n        oldSource: SourceSelection<UploadSourceSpec>,\n        data?: TopolaData,\n    ): boolean {\n        return newSource.spec.hash !== oldSource.spec.hash;\n    }\n\n    async loadData(source: SourceSelection<UploadSourceSpec>): Promise<TopolaData> {\n        try {\n            return await loadGedcom(\n                source.spec.hash,\n                source.spec.gedcom,\n                source.spec.allLanguages,\n                source.spec.images,\n            );\n        } catch (error) {\n            throw error;\n        }\n    }\n}\n\n/** GEDCOM file loaded by pointing to a URL. */\nexport class GedcomUrlDataSource implements DataSource<UrlSourceSpec> {\n    isNewData(newSource: SourceSelection<UrlSourceSpec>, oldSource: SourceSelection<UrlSourceSpec>, data?: TopolaData) {\n        return newSource.spec.url !== oldSource.spec.url;\n    }\n    async loadData(source: SourceSelection<UrlSourceSpec>): Promise<TopolaData> {\n        try {\n            return await loadFromUrl(source.spec.url, source.spec.handleCors, source.spec.allLanguages);\n        } catch (error) {\n            throw error;\n        }\n    }\n}"],"sourceRoot":""}